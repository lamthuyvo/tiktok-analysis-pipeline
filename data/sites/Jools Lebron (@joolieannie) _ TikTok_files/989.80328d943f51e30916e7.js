"use strict";(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([[989],{44390:(e,t,n)=>{n.d(t,{N:()=>r});var o=n(50453),i=n(93166);function r(){const{isBot:e}=(0,o.L)((0,i.U)((()=>["isBot"]),[]));return Boolean(e)}},40517:(e,t,n)=>{n.d(t,{x:()=>L});var o=n(40099),i=n(11060),r=n(50453),a=n(52964),l=n(19572),s=n(38498),d=n(96871),c=n(41570),u=n(42245),m=n(43823),p=n(5413),h=n(85942),v=n(85348),f=n(56137),g=n(14900),_=n(10840),b=n.n(_),y=n(51492),C=n(74758),w=n(24642),I=n(3753),M=n(73580),O=n(71067),k=n(64966),T=n(86893),S=n(13387);let P=null;const E=()=>{(0,o.useEffect)((()=>{var e,t,o,i;"msft"!==(0,S.o7)()||P||(e=void 0,t=void 0,i=function*(){const e=document.createElement("meta");e.setAttribute("http-equiv","origin-trial"),e.setAttribute("content","AsVEW3gqIbrtBiuGllHCQ3Mr/25eNi3NIqwbhn2Oy3yo3kMWE9md0cgkScgdxDId/MhVauGpgBCLhlNk1caFIC0AAABoeyJvcmlnaW4iOiJodHRwczovL3Rpa3Rvay5jb206NDQzIiwiaXNTdWJkb21haW4iOnRydWUsImZlYXR1cmUiOiJtc0FjcXVpc2l0aW9uSW5mbyIsImV4cGlyeSI6MTcyNjE1OTMxMH0="),document.head.appendChild(e);const t=(yield n.e(5269).then(n.bind(n,62779))).default;P=new t({ti:"187137935"})},new((o=void 0)||(o=Promise))((function(n,r){function a(e){try{s(i.next(e))}catch(e){r(e)}}function l(e){try{s(i.throw(e))}catch(e){r(e)}}function s(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,l)}s((i=i.apply(e,t||[])).next())})))}),[])};var N=n(62382),x=function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function a(e){try{s(o.next(e))}catch(e){r(e)}}function l(e){try{s(o.throw(e))}catch(e){r(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,l)}s((o=o.apply(e,t||[])).next())}))};function L(e,t,n,_,S,P){var L;const{pathname:A}=(0,i.zy)();(0,d.LT)(),function(){const e=(0,M.Nj)(O.$F),t=(0,r.L)((0,a.W)((()=>["user","wid","abTestVersion","webIdCreatedTime"]),[])),{wid:n,abTestVersion:i,webIdCreatedTime:d}=t,c=(0,l.qt)(i,"webapp_login_causal_inference"),u=(0,s.mv)(d);(0,o.useEffect)((()=>{if("v1"===c){const t=(0,y.Z)(n||"",3,C.g).toString();e.setEnterMethod("simulated"),e.setCloseable(!1),e.setPredictionPayload(t),e.loginNotify()}}),[u,c,e,n])}();const[{isMiniPlayerShowing:V},j]=(0,c.Sp)(),{isElectronApp:F}=(0,u.B_)();(0,o.useEffect)((()=>{V&&j.closeMiniPlayer({playMode:null,enter_method:"click_navigation"})}),[A,t]),(0,o.useEffect)((()=>{!function(){x(this,void 0,void 0,(function*(){if(F){const e=yield function(){return x(this,void 0,void 0,(function*(){try{const{data:e}=yield b().app.getWid();return(0,I.wt)(e,I.PO)}catch(e){return}}))}();w.f.config({commonHeaderConfig:{"header.custom":{webapp_wid:e}}})}}))}()}),[]);const{abTestVersion:Y}=null!==(L=(0,a.W)((()=>["abTestVersion"]),[]))&&void 0!==L?L:{},D=(0,m.wW)();(0,d.tF)((()=>{var t,n,o;return{page_name:e,enter_from:e,ui_type:S,vidab:null!==(t=null==Y?void 0:Y.versionName)&&void 0!==t?t:"",seo_vidab:(null!==(n=null==D?void 0:D.vidList)&&void 0!==n?n:[]).join(","),[k.ET]:(0,p.fU)()||null===(o=(0,T.YI)(k.FR))||void 0===o?void 0:o[k.ET]}}),[e,t,A],P),(0,h.DQ)(e);const W=(0,d.ct)({eParams:n});(0,o.useEffect)((()=>{!(null==n?void 0:n.notReady)&&W()}),[W,t]),(0,v.M$)(e),(0,f.rF)({pid:null!=_?_:e}),E(),(0,N.Ee)(e),(0,g.P)()}},41692:(e,t,n)=>{n.d(t,{Wg:()=>i,s3:()=>r});var o=n(95669);const i=e=>(0,o.useDataWithInfinite)(e),r=e=>(0,o.useMutateAction)(e)},63377:(e,t,n)=>{n.d(t,{f:()=>ce});var o=n(2787),i=n(67518),r=n(40099),a=n(89787),l=n(15068),s=n(62209),d=n(6874),c=n(10825),u=n(42541),m=n(91379),p=n(24642),h=n(72531),v=n(96836),f=n(87145),g=n(18360),_=n(47845),b=n(51611),y=n(75431),C=n(63077),w=n(73580),I=n(23658),M=n(73835),O=n(6688),k=n(94454),T=n(95117),S=n(44041),P=n(39789),E=n(29088),N=n(56008),x=n(95120),L=n(49138),A=n(44300),V=n(90390),j=n(31371),F=n(77311),Y=n(72945),D=n(52964),W=n(74276),B=n(88251),R=n(78677),z=n(63244),H=n(92680),U=n(47218),q=n(50417),G=n(98151);const X=(0,G.default)(a.I05)`
  width: 32px !important;
  height: 32px !important;
  min-width: 0 !important;
  padding-left: 0 !important;
  padding-right: 0 !important;
  background-color: transparent !important;

  &:hover {
    background-color: ${e=>e.theme.colors.UIShapeNeutral4} !important;
  }

  & > :first-of-type {
    & > .TUXButton-label {
      display: none !important;
    }
  }
`,Z=(0,G.default)(a.ZPA)`
  .TUXFormField-header {
    display: none !important;
  }

  .TUXInputBox {
    padding-inline-end: 0 !important;
  }
`,K=(0,r.memo)((function({url:e}){const t=(0,r.useCallback)((e=>{if(!(e.target instanceof HTMLButtonElement||e.target instanceof SVGElement))return e.stopPropagation(),void e.preventDefault()}),[]);return(0,o.Y)("div",{style:{width:"100%"},onClickCapture:t,children:(0,o.Y)(Z,{style:{width:"100%"},value:e,onChange:()=>{},label:"",trailingIcon:(0,o.Y)(X,{variant:"secondary",label:"",leadingIcon:(0,o.Y)(q.j,{})})})})})),J=(0,r.memo)((function(){const e=(0,d.s)();return(0,o.Y)(a.I05,{style:{width:"100%"},label:e("copy_link"),variant:"secondary",leadingIcon:(0,o.Y)(q.j,{})})}));var Q=n(75546),$=n(83242),ee=n(32797),te=n(60652),ne=function(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(o=Object.getOwnPropertySymbols(e);i<o.length;i++)t.indexOf(o[i])<0&&Object.prototype.propertyIsEnumerable.call(e,o[i])&&(n[o[i]]=e[o[i]])}return n};const oe=y.AH`
  circle:first-of-type {
    fill: black;
  }
`,ie=y.AH`
  path:first-of-type {
    fill: black;
  }
`,re=(0,G.default)(te.A)`
  path:first-of-type {
    fill: ${e=>e.monochrome?"black":"#00BAD0"};
  }
`,ae=(0,r.memo)((function(e){var{icon:t,bgColor:n,textColor:i}=e,r=ne(e,["icon","bgColor","textColor"]);const a=t;return(0,o.FD)("svg",Object.assign(Object.assign({color:"inherit",viewBox:"0 0 48 48",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em"},r),{children:[(0,o.Y)("path",{d:"M24 48a24 24 0 1 1 0-48 24 24 0 0 1 0 48Z",fill:n}),(0,o.Y)("foreignObject",{x:"50%",y:"50%",width:28,height:28,transform:"translate(-14 -14)",children:(0,o.Y)(a,{fontSize:28,color:i})})]}))})),le=((0,r.memo)((function(e){return(0,o.Y)(ae,Object.assign({icon:Q.A,bgColor:"black",textColor:"white"},e))})),G.default.div`
  display: inline-flex;
  align-items: center;
  justify-content: center;

  & > svg {
    fill: black;
  }

  &::before {
    content: '';
    position: absolute;
    width: 85%;
    height: 85%;
    border-radius: 50%;
    background-color: white;
    z-index: -1;
  }
`),se=(0,r.memo)((function(e){var{monochrome:t}=e,n=ne(e,["monochrome"]);return t?(0,o.Y)(le,{children:(0,o.Y)(ee.A,{})}):(0,o.Y)($.W,Object.assign({},n))}));function de(e){var t,n,i;const a=function({videoId:e="",mode:t,embedCode:n,embedType:o,isEmbedBanned:i=!1,from:r=0}){const{user:a}=(0,z.x)(),l=(0,s.ZO)(),{vl1:d,forFriend:c,subVideoMeta:u,canRepost:m}=(0,v.F3)((t=>{var n,o;const i=t[e];return{vl1:null==i?void 0:i.vl1,forFriend:null==i?void 0:i.forFriend,subVideoMeta:null==i?void 0:i.subVideoMeta,canRepost:void 0!==i&&(null===(o=null===(n=i.item_control)||void 0===n?void 0:n.can_repost)||void 0===o||o)}}),U.bN),{repostActionVid:p}=(0,s.hn)(),h=m&&"v4"===p,f=(!a||a.hasIMPermission)&&!(d&&!c)&&!(1===r||2===r);return(0,C.P)(W.M,{selector:e=>{var o;let r=null!==(o=e.platforms)&&void 0!==o?o:[];f||(r=r.filter((e=>"message"!==e))),l&&(r=r.filter((e=>"facebook"!==e))),h||(r=r.filter((e=>"repost"!==e)));const a=new Set(["copy","repost","message","embed"]),s=r.filter((e=>!a.has(e)));!n||i||u||s.unshift("embed"),f&&s.unshift("message"),h&&s.unshift("repost"),s.unshift("copy");const d=s.filter((e=>"copy"!==e));return 0===t?d:s},dependencies:[t,n,o,f,l,h]})}(e),l=function({videoId:e="",onClickShare:t,enabled:n=!0,shareUrl:o="",teaParams:i={},from:a=0,onEmbedModalVisibleChange:l,onSendMessagePanelOpen:s}){var u,m;const p=(0,d.s)(),{user:g}=null!==(u=(0,D.W)((()=>["user"]),[]))&&void 0!==u?u:{},_=Boolean(g),b=(0,w.Nj)(F.A),{expanded:y}=(0,c.kw)(),C=(0,v.mG)(),I=(0,H.b1)(),{handleClickRepost:M}=(0,B.l)({itemId:e,playMode:null!==(m=i.play_mode)&&void 0!==m?m:"one_column"});return(0,r.useCallback)((e=>{return r=this,d=void 0,u=function*(){const r=(0,R.io)({platform:e,url:null!=o?o:""});let d=null;"string"==typeof r?d=r:r(),n||(h.F.destroy(),h.F.open({content:p("web_sharing_disable_toast"),duration:3,widthType:"half",getContainer:f.M,getContainerPosition:"fixed"}));const{group_id:c,author_id:u}=i,m=function(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(o=Object.getOwnPropertySymbols(e);i<o.length;i++)t.indexOf(o[i])<0&&Object.prototype.propertyIsEnumerable.call(e,o[i])&&(n[o[i]]=e[o[i]])}return n}(i,["group_id","author_id"]);if(null==t||t(e,{group_id:c,play_mode:m.play_mode}),b.handleShare(Object.assign({platform:e,group_id:c,author_id:u,share_option_type:y,share_click_from:3===a?"long":"short",tab_name:"",playlist_id:"",popup_type:""},m)),m.is_ad_event&&m.value&&m.tag&&m.log_extra){const{log_extra:e,tag:t,value:n}=m;Y.pg.handleShare({log_extra:e,tag:t,value:n,is_ad_event:"1"})}if(yield C.addMlModelTrainData({id:c,action:"share"}),d)window.open(d,"_blank","noreferrer");else if("copy"===e)h.F.open({content:p("Copied"),duration:1.2,widthType:"half",getContainer:f.M,getContainerPosition:"fixed"});else if("embed"===e)null==l||l(!0);else if("message"===e){if(!_)return void I.openModal({query:{enter_method:"share_button",group_id:c}});null==s||s()}else if("repost"===e){if(!_)return void I.openModal({query:{enter_method:"click_repost",group_id:c}});M()}},new((c=void 0)||(c=Promise))((function(e,t){function n(e){try{i(u.next(e))}catch(e){t(e)}}function o(e){try{i(u.throw(e))}catch(e){t(e)}}function i(t){var i;t.done?e(t.value):(i=t.value,i instanceof c?i:new c((function(e){e(i)}))).then(n,o)}i((u=u.apply(r,d||[])).next())}));var r,d,c,u}),[p,t,M,s,l,n,i,b,y,C,_,I,o,a])}(e),u=function({shareUrl:e}){const t=(0,d.s)(),{hasHorizontalModalShare:n,hasFloatingShare:i,isAllBlackFloating:a}=(0,s.mT)();return(0,r.useMemo)((()=>({facebook:{title:"Facebook",icon:(0,o.Y)(se,{monochrome:a})},pinterest:{title:"Pinterest",icon:(0,o.Y)(I.A,{css:a&&oe})},twitter:{title:"X",icon:(0,o.Y)(M.b,{})},whatsapp:{title:"WhatsApp",icon:(0,o.Y)(O.A,{css:a&&ie})},reddit:{title:"Reddit",icon:(0,o.Y)(k.A,{css:a&&ie})},vk:{title:"VK",icon:(0,o.Y)(T.A,{css:a&&ie})},sms:{title:"Sms",icon:(0,o.Y)(S.A,{css:a&&ie})},telegram:{title:"Telegram",icon:(0,o.Y)(P.A,{css:a&&ie})},line:{title:"Line",icon:(0,o.Y)(E.A,{css:a&&y.AH`
                path:nth-of-type(odd) {
                  fill: black;
                }
              `})},linkedin:{title:"LinkedIn",icon:(0,o.Y)(N.A,{css:a&&oe})},email:{title:"Email",icon:(0,o.Y)(x.A,{css:a&&ie})},copy:i?{title:t("copy_link"),icon:(0,o.Y)(L.A,{css:a&&ie})}:{title:n?(0,o.Y)(K,{url:null!=e?e:""}):(0,o.Y)(J,{}),fullWidth:!0,position:"top"},embed:{title:t("embed"),icon:(0,o.Y)(re,{monochrome:a}),states:{disabled:{title:t("embed"),disabled:!0,tooltip:t("embed_profile_tooltip")}}},message:{title:t("support_webapp_sharing_option_button"),icon:(0,o.Y)(A.A,{css:a&&ie})},repost:{title:t("pcWeb_repost_btn"),icon:(0,o.Y)(V.A,{style:{borderRadius:"50%"},css:a&&ie}),states:{active:{title:t("pcWeb_removeRepost_btn"),icon:(0,o.Y)(j.A,{style:{borderRadius:"50%"},css:a&&ie})}}}})),[t,e,a,n,i])}(e),{isReposted:m}=(0,B.l)({itemId:null!==(t=e.videoId)&&void 0!==t?t:"",playMode:null!==(i=null===(n=e.teaParams)||void 0===n?void 0:n.play_mode)&&void 0!==i?i:"one_column"});return(0,r.useMemo)((()=>a.map((t=>{let n;return"embed"===t&&e.isEmbedDisabled?n="disabled":"repost"===t&&m&&(n="active"),Object.assign(Object.assign({},u[t]),{key:t,action:()=>l(t),state:n})}))),[l,u,a,m,e.isEmbedDisabled])}const ce=(0,r.memo)((0,r.forwardRef)((function(e,t){var{trigger:n,onOpen:y,onClose:C,dismissOnScroll:w,placement:I,userId:M}=e,O=function(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(o=Object.getOwnPropertySymbols(e);i<o.length;i++)t.indexOf(o[i])<0&&Object.prototype.propertyIsEnumerable.call(e,o[i])&&(n[o[i]]=e[o[i]])}return n}(e,["trigger","onOpen","onClose","dismissOnScroll","placement","userId"]);const{embedCode:k,embedType:T,isEmbedBanned:S,isEmbedDisabled:P,videoId:E,uniqueId:N,musicId:x,tagTitle:L,musicTitle:A,teaParams:V}=O,{hasHorizontalModalShare:j,hasFloatingShare:F,isFloatingShareMore:Y,hasSharePanelTitle:D}=(0,s.mT)(),W=(0,_.$T)(),[B,R]=(0,r.useState)(!1),[z,H]=(0,r.useState)(!1),[U,q]=(0,r.useState)(!1),G=(0,r.useRef)(null),X=(0,r.useContext)(b.z),Z=(0,d.s)(),K=(0,c.XF)(),{expanded:J}=(0,c.kw)(),{zIndex:Q}=(0,i.u)(),$=(0,v.F3)((e=>{var t;return Boolean(null===(t=e[null!=E?E:""])||void 0===t?void 0:t.subVideoMeta)})),ee=(0,g.nr)(),te=(0,r.useMemo)((()=>Object.assign({share_option_type:J,is_embed_available:P||!k||S?0:1,is_sub_only_video:$?1:0,group_id:null!=E?E:"",author_id:null!=M?M:"",play_mode:"others"},V)),[V,J,P,S,$,k,E,M]),ne=(0,r.useCallback)((e=>{e!==B&&(F||ee.setAutoScrollPaused(e),R(e),e?(p.f.sendEvent("share_panel_show",te),null==y||y()):(p.f.sendEvent("share_panel_close",te),null==C||C()))}),[y,C,B,te,ee,F]),oe=(0,r.useCallback)((()=>{q(!0)}),[]),ie=(0,r.useCallback)((()=>{q(!1)}),[]),re=(0,r.useCallback)((()=>{p.f.sendEvent("click_share_button",Object.assign(Object.assign({},te),{platform:"embed"})),h.F.open({content:Z("embed_success"),duration:1.2,widthType:"half",getContainer:f.M,getContainerPosition:"fixed"}),H(!1)}),[Z,te]),ae=(0,r.useCallback)((()=>{p.f.sendEvent("show_more_share_options",Object.assign({enter_method:Y?"click":F?"scroll":"modal_scroll"},te))}),[te,Y,F]);(0,r.useImperativeHandle)(t,(()=>({show(){var e;null===(e=G.current)||void 0===e||e.focus(),ne(!0)}})),[ne]),(0,r.useEffect)((()=>{K()}),[K]),(0,r.useEffect)((()=>{if(w&&B){const e=()=>ne(!1),t=W&&(null==X?void 0:X.current)||window;return t.addEventListener("scroll",e),()=>{t.removeEventListener("scroll",e)}}}),[ne,B,W,w,X]);const le=de(Object.assign({onSendMessagePanelOpen:oe,onEmbedModalVisibleChange:H},O)),se=(0,r.cloneElement)(n,{role:"button","data-e2e":"share-btn","aria-label":Z("webapp_share_btn"),ref:G,tabIndex:0}),ce=(0,r.useMemo)((()=>({title:D?Z("Share to"):"",open:B,onOpenChange:ne,onShowMore:ae,trigger:se,e2eTag:"share"})),[Z,ne,ae,B,se,D]),ue=F?(0,o.Y)(l.ActionPopover,Object.assign({actionOptions:le,overflow:Y?"expand":"scroll",initialVisibleItems:5,placement:I},ce)):(0,o.Y)(l.ActionModal,Object.assign({actionOptions:le,direction:j?"horizontal":"vertical"},ce));return(0,o.FD)(o.FK,{children:[ue,k&&!S&&(0,o.Y)(a.nOL,{open:z,onOpenChange:H,style:{zIndex:Q.modal,width:"fit-content",maxWidth:"unset"},children:(0,o.Y)(u.f,{onCopy:re,onClose:()=>H(!1),code:k,type:T,videoId:E,uniqueId:N,musicId:x,tagTitle:L,musicTitle:A})}),E&&U&&(0,o.Y)(m.k,{visible:U,videoId:E,onClose:ie})]})})))},99462:(e,t,n)=>{n.d(t,{Bi:()=>h,My:()=>p});var o=n(76031),i=n(40099),r=n(11060),a=n(57384),l=n(5390),s=n(94683),d=n(50453),c=n(6874),u=n(24642),m=n(27081);const p=({itemId:e})=>{const{search:t}=(0,r.zy)(),n=(0,i.useMemo)((()=>(0,o.parse)(t)),[t]),c=n.cid&&(0,a.d)(n.cid),{id:u}=(0,d.L)(l.Qq.getItem("highlight_comment")),m=(0,s.Ig)(),p=null!=c?c:m?u:void 0,h=l.MX.getItem("vid"),v=l.MX.getItem("cid");return(!h&&p||p&&v!==p)&&(l.MX.setItem("vid",e),l.MX.setItem("cid",p)),p},h=({itemId:e,highlightCid:t,comments:n,commentToastState:a},s)=>{const{hasCheckedHighlightedComment:d,checkHighlightedComment:p}=(()=>{const e=(0,c.s)(),[t,n]=(0,i.useState)(!1),{search:a}=(0,r.zy)(),s=(0,i.useMemo)((()=>(0,o.parse)(a)),[a]),d=(0,i.useCallback)(((o,i,r,a)=>{if(t)return;const d=l.MX.getItem("vid");if(!d||i===d)return s.cid&&!a?(u.f.sendEvent("copy_comment_unavailable",{comment_id:a}),r.show({message:e("subCommentURL_comments_linkMissing_toast")}),void n(!0)):void(a?(o.flatMap((e=>e.reply_comment?[e.cid,...e.reply_comment.map((e=>e.cid))]:[e.cid])).includes(a)?u.f.sendEvent("copy_comment_show",{comment_id:a}):(u.f.sendEvent("copy_comment_unavailable",{comment_id:a}),r.show({message:e("subCommentURL_comments_linkMissing_toast")})),n(!0)):n(!0));n(!0)}),[t,s.cid,e]);return{hasCheckedHighlightedComment:t,checkHighlightedComment:d}})(),h=(0,i.useRef)(!1),v=(0,i.useMemo)((()=>performance.now()),[]);(0,i.useEffect)((()=>{if(n&&!h.current){const t=performance.now()-v;m.ao.handleCommentLoadComplete({play_mode:"video_detail",group_id:e,duration:t,fetch_type:"load_by_current"}),h.current=!0}n&&!d&&p(n,e,a,t)}),s)}},78229:(e,t,n)=>{n.d(t,{GX:()=>s,bA:()=>c,sV:()=>u,vO:()=>d});var o=n(96836),i=n(68407),r=n(52964),a=n(47218),l=n(41692);const s=({itemId:e,highlightCid:t,enabled:n=!0})=>(0,l.Wg)({query:"fetchComment",queryKeyParams:{videoId:e},queryParams:{aweme_id:e,insert_ids:t},options:{select:e=>({pageParams:[],pages:[Object.assign(Object.assign({},e.pages[0]),{comments:e.pages.flatMap((e=>e.comments)),total:e.pages[0].total?Number(e.pages[0].total):void 0})]}),enabled:n}});function d(e,t){if(!e)return!0;const{commentSetting:n,relation:o,id:i}=e;return 1===n&&2!==o&&t!==i}const c=e=>{var t,n;const l=(0,o.F3)((t=>t[e]),a.bN),s=(0,i.nW)((e=>{var t;return e.users[null!==(t=null==l?void 0:l.author)&&void 0!==t?t:""]}),a.bN),{user:c}=null!==(t=(0,r.W)((()=>["user"]),[]))&&void 0!==t?t:{},u=!1===(null===(n=null==l?void 0:l.item_control)||void 0===n?void 0:n.can_comment),m=3===(null==l?void 0:l.itemCommentStatus)||3===(null==s?void 0:s.commentSetting),p=d(s,null==c?void 0:c.uid),h=!!(null==l?void 0:l.scheduleTime);return{commentStatus:u?"COMMENTS_OFF_ADS":m?"COMMENTS_OFF":p?"COMMENTS_FRIENDS_ONLY":h?"COMMENTS_SCHEDULED":void 0,isCommentContentUnavailable:m||u||h,shouldRestrictCommentBar:m||u||h||p}},u=(e,t,n)=>{var o;const i=e?0:Number(null!==(o=null==t?void 0:t.commentCount)&&void 0!==o?o:0);return null!=n?n:i}},62382:(e,t,n)=>{n.d(t,{vT:()=>b,_k:()=>I,Ee:()=>y,ip:()=>w,Ob:()=>C});var o=n(71111),i=n(76e3);const r={pageName:null,itemID:"",sentBatchCount:0},a=(0,o.atom)(r),{useAtomService:l,useServiceDispatchers:s,useServiceState:d,getStaticApi:c}=(0,i.i)(a,((e,t)=>({setCache(n){const{itemID:o}=e(a);o||t(a,(e=>Object.assign(Object.assign({},n),{sentBatchCount:e.sentBatchCount})))},clearCache(){t(a,(e=>Object.assign(Object.assign({},r),{sentBatchCount:e.sentBatchCount})))},incrementSentBatchCount(){t(a,(e=>Object.assign(Object.assign({},e),{sentBatchCount:e.sentBatchCount+1})))}})));var u=n(40099),m=n(59590),p=n(62209),h=n(52964);const v="webapp_fyp_feeder_landing";let f=!0;const g=e=>{var t;const{sendCreatorItemId:n}=(0,p.CQ)(),{user:o}=null!==(t=(0,h.W)((()=>["user"]),[]))&&void 0!==t?t:{};return n&&"others_homepage"===e&&f&&!o},_=e=>{const{isFYP:t}=(0,p.FT)();return t&&("video_detail"===e||"graphic_detail"===e)&&f},b=()=>f,y=e=>{const t=s(),n=g(e),o=_(e);(0,u.useEffect)((()=>()=>{n||o||t.clearCache()}),[t,n,o]),(0,u.useEffect)((()=>{(0,m.Hd)(v)&&(f=!1),(0,m.J2)(v,"1")}),[e])},C=(e,t)=>{const n=s(),o=g(e),i=_(e);(0,u.useEffect)((()=>{t&&(o||i)&&n.setCache({pageName:e,itemID:t})}),[t,e,o,i,n])},w=()=>{const{isFYP:e}=(0,p.FT)(),{sendCreatorItemId:t,batchCount:n}=(0,p.CQ)(),{itemID:o,pageName:i,sentBatchCount:r}=d(),a=e&&("video_detail"===i||"graphic_detail"===i);let l=0;a?l=1:t&&"others_homepage"===i&&(l=n);const s=o&&r<l?o:"";return{fypFeederItemId:s,setFirstItemId:a?s:""}},I=e=>{const t=s();(0,u.useEffect)((()=>{e&&e>0&&t.incrementSentBatchCount()}),[e,t])}},47845:(e,t,n)=>{n.d(t,{Hq:()=>oe,X5:()=>de,fN:()=>se,iG:()=>re,YJ:()=>ae,MD:()=>le,ID:()=>K,is:()=>Q,tw:()=>ee,KQ:()=>te,$T:()=>J});var o=n(40099),i=n(11060),r=n(50453),a=n(52964),l=n(19572),s=n(62209),d=n(36862),c=n(67262),u=n(41570),m=n(32623),p=n(85645),h=n(76e3),v=n(2866);const f=(0,p.y)(v.C),{useServiceState:g}=(0,h.i)(f,(()=>({})));var _=n(69750),b=n(59590),y=n(72302),C=n(85348),w=n(5413),I=n(50978),M=n(16582),O=n(66541),k=n(54136),T=n(60417),S=n(20131),P=n(37734),E=n(73580),N=n(63077),x=n(43904),L=n(45643),A=n(33005),V=n(85927),j=n(27081),F=n(96836),Y=n(88338),D=n(92171),W=n(64960),B=n(47476),R=n(18360),z=n(47218),H=n(64655),U=n(62382),q=n(99462),G=n(78229),X=n(44390),Z=function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function a(e){try{s(o.next(e))}catch(e){r(e)}}function l(e){try{s(o.throw(e))}catch(e){r(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,l)}s((o=o.apply(e,t||[])).next())}))};const K=()=>{var e;const{abTestVersion:t}=(0,r.L)((0,a.W)((()=>["abTestVersion"]),[]));return{hasRedesign:"v1"===(null!==(e=(0,l.qt)(t,"fyp_redesign"))&&void 0!==e?e:"v0")}},J=()=>{const{hasRedesign:e}=K(),{isInProductHoldout:t}=(0,s.Vv)();return!(!e||t)},Q=()=>{var e;const{abTestVersion:t}=(0,r.L)((0,a.W)((()=>["abTestVersion"]),[])),n=null!==(e=(0,l.qt)(t,"fyp_up_down"))&&void 0!==e?e:"v0",{hasRedesign:o}=K();return o&&"v0"!==n},$=(e,t=0,n=0)=>{const o=isNaN(t)?0:t,i=isNaN(n)?0:n,r=Math.min(o,i),a=Math.max(o,i),l=Math.max(a-r-1,0),s=[];for(let t=r+1;t<a;t++)s.push(e[t]);return{skippedGroupIds:s.join(","),skippedGroupNum:l}},ee=({itemList:e,isBrowserModeShowing:t,isLiveBrowserShowing:n,oneColItemRef:i,prevPlayingIndex:a,currPlayingIndex:l,playVideoOfIndex:p,scrollingElementRef:h})=>{var v,f;const{isInProductHoldout:C}=(0,s.Vv)(),w=J(),I=!C,[M,O]=(0,F.l8)(),k=null!==(f=null===(v=M[e[l]])||void 0===v?void 0:v.itemMute)&&void 0!==f&&f,{mute:T,setMute:S}=(0,d.ah)({playMode:0,itemMute:k}),P=(0,c.vn)((e=>e.isModalShow),z.bN),N=(0,E.Nj)(x.AU),[{isMiniPlayerShowing:V},j]=(0,u.Sp)(),{commentPanelActive:D}=(0,Y.Cx)((e=>({commentPanelActive:!!e.itemId})),z.bN),{skippedGroupIds:R,skippedGroupNum:H}=$(e,a,l),U=(0,m.mZ)((e=>e.isOpen)),q=g((e=>e.inputFocus)),G=(0,_.G)({actionWhenUserLoggedIn:(0,o.useCallback)((e=>{O.postLikeVideo({id:e,enter_method:"keydown"})}),[O]),modalConfig:{query:{enter_method:"click_like",group_id:e[l]}},reportClickEvent:e=>{L.O.handleGeneralClick("like",{group_id:e,play_mode:"one_column"})}}),X=(0,o.useCallback)(((e,t)=>{let n;isNaN(e)||(n=e<t?"one_column_scroll_next":"one_column_scroll_prev",N.reportVideoInteractStart({startTime:Date.now(),situation:n,prevVideoIndex:e,currVideoIndex:t}))}),[N]),Z=(0,o.useCallback)((o=>{var r,a,s,d;if(q||t||n||U||P)return;if(!i.current[l+1]&&(32===o.keyCode||40===o.keyCode))return;const c=o.target.tagName.toLocaleLowerCase(),u=["input","textarea","button"].includes(c),m="link"===o.target.getAttribute("role"),p=o.target.className.includes("DraftEditor-content");if(D&&p)return;const v=w&&(null==h?void 0:h.current)||window;if(32===o.keyCode&&(!u||m)||40===o.keyCode){const t=e[l+1];o.preventDefault();const n=null===(r=i.current[l+1])||void 0===r?void 0:r.offsetTop;(0,b.a6)(I?n:(null!=n?n:60)-60,100,v),A.L.handleVideoChange({enter_method:"keydown",play_mode:"one_column",group_id:t,author_id:null===(a=M[t])||void 0===a?void 0:a.authorId,skipped_group_num:H,skipped_group_ids:R},"next"),N.handleUserChangeVideoOrPlayMode()}else if(38===o.keyCode&&l>0){const t=e[l-1];o.preventDefault();const n=null===(s=i.current[l-1])||void 0===s?void 0:s.offsetTop;(0,b.a6)(I?n:(null!=n?n:60)-60,100,v),A.L.handleVideoChange({enter_method:"keydown",play_mode:"one_column",group_id:t,author_id:null===(d=M[t])||void 0===d?void 0:d.authorId,skipped_group_num:H,skipped_group_ids:R},"prev"),N.handleUserChangeVideoOrPlayMode()}else 77!==o.keyCode||u?76!==o.keyCode||u||G(e[l]):(o.preventDefault(),S(!T,"keydown"))}),[q,t,n,U,P,i,l,e,M,H,R,S,T,G,N,w]),K=(0,y.d7)((n=>{var o;for(let a=0;a<i.current.length;a++){const s=i.current[a];if(Number(null==s?void 0:s.ratio)<=.5)continue;if(t||l===a&&!n)return;if(V){const t=(0,r.L)(M[e[a]]),n=!!t.ad_info||!!t.liveRoomInfo;j.updateVideoIndex({newIndex:a,newId:e[a],isMiniPlayerNotSupported:n})}else(0,W.uQ)(B.Y.PlayerChange),p(a);const d=l<a;if("start"===(0,b.y5)())return;d||"done"!==(0,b.y5)()||(0,b.Zn)();const{skippedGroupIds:c,skippedGroupNum:u}=$(e,l,a),m=e[a],h=l<a?"next":"prev";return A.L.handleVideoChange({enter_method:"scroll",play_mode:"one_column",group_id:m,author_id:null===(o=M[m])||void 0===o?void 0:o.authorId,skipped_group_num:u,skipped_group_ids:c},h),n||N.handleUserChangeVideoOrPlayMode(),void X(l,a)}}),[i,t,l,p,e,M,X,N,V],200);return{handleKeydown:Z,handleScroll:K}},te=()=>{var e;const{abTestVersion:t}=(0,r.L)((0,a.W)((()=>["abTestVersion"]),[])),n=null!==(e=(0,l.qt)(t,"comment_browser_mode"))&&void 0!==e?e:"v0";return{alwaysOpenBrowserMode:"v2"===n,alwaysOpenLoginModal:"v1"===n}},ne=new Map,oe=e=>{const{id:t,is_comments_clicked:n}=e,o=C.Zr.get(t);if(ne.delete(t),!o)return;const{hit:i,predict_value:r,model_url:a,features:l=[],threshold:s,scene:d,is_ad:c}=o;V.F.handleModelPredict({hit:Number(i),scene:d,predict_value:r,group_id:t,model_url:a,features:l.toString(),threshold:s,f_real:Number(n),is_ad:Number(c)}),C.Zr.delete(t)},ie=e=>{const{hasNewCommentsDesign:t}=(0,H.IE)(),n=(0,q.My)({itemId:e}),[i,r]=(0,o.useState)(!1),a=(0,X.N)();return(0,w.fU)()||a||(0,G.GX)({itemId:e,highlightCid:n,enabled:i}),{hasNewCommentsDesign:t,setEnablePreload:r,triggerCommentsPreload:({preload_type:e,id:t})=>{r(!0),j.ao.handleCommentPreload({play_mode:"one_column",group_id:t,preload_type:e})}}},re=({id:e,playerRef:t,isActive:i,pageType:a=5})=>{const{preloadCommentList:l,comments:s}=(0,C.Oz)(e),d=(0,D.JW)((e=>e.isFeedPersonalized),z.bN),c=(0,R.eu)(),{isMiniPlayerShowing:m}=(0,u.mE)(),p=!!(0,r.L)((0,I.F3)((t=>t[e]),z.bN,[e])).ad_info,h=(0,y.ZC)(i),{hasNewCommentsDesign:v,setEnablePreload:f,triggerCommentsPreload:g}=ie(e),{commentsPreloadStrategy:_}=(0,N.P)(M.$,{selector:e=>{var t,n,o;return{commentsPreloadStrategy:null===(o=null===(n=null===(t=e.bizContext)||void 0===t?void 0:t.config)||void 0===n?void 0:n.onDeviceMLConfig)||void 0===o?void 0:o.commentsPreload}},dependencies:[]}),{enableOnDeviceML:b,isMLWithModelLowThreshold:w,isMLWithStrategy:O,isMLWithModel:k}=(0,C.K1)();(0,o.useEffect)((()=>{!(t&&b&&i&&5===a)||(null==t?void 0:t.currentTime)>0||c||m||Z(void 0,void 0,void 0,(function*(){if((null==s?void 0:s.length)>0||C.oS.get(e))return;const{commentPreloadHighThreshold:t,commentPreloadLowThreshold:o}=null!=_?_:{},i=w?o:t;if(!i)return;const{Sibyl:r,EScene:a,EBiz:c}=yield n.e(5850).then(n.bind(n,40681)),u=new r({biz:c.TIKTOK_WEB_FYP}),m=u.createStrategyEngine({abConfig:i,scene:a.COMMENT});m.setThresholdCallback((()=>Z(void 0,void 0,void 0,(function*(){var t,n,o;if(C.Zr.get(e)||!ne.get(e))return;if(O)return l({aweme_id:e,cursor:0,is_non_personalized:!d},"model"),void C.Zr.set(e,{features:[],hit:!0,model_url:"",predict_value:1,scene:"comments_preload_strategy",threshold:0,is_ad:p});if(!k)return;const{package:r="",engine_config:s={}}=null!==(t=null==i?void 0:i.preload_ml)&&void 0!==t?t:{},c=yield u.createEngine({scene:a.COMMENT,modelUrl:r,inputs:null!==(n=null==s?void 0:s.inputs)&&void 0!==n?n:[],outputs:null!==(o=null==s?void 0:s.outputs)&&void 0!==o?o:[]}),h=c.inference({features:{}}),f=m.hitThresholdValue(h),{thresholdValue:_}=m.getInferenceStrategy(),b=c.getFeatureVector({features:{}});C.Zr.set(e,{features:b,hit:f,model_url:r,predict_value:h,scene:"comments_preload_ml",threshold:_,is_ad:p}),f&&(v?g({id:e,preload_type:"model"}):l({aweme_id:e,cursor:0,is_non_personalized:!d},"model"))}))))}))}),[null==t?void 0:t.currentTime,i,m,c]),(0,o.useEffect)((()=>{5===a&&(!i&&h&&(oe({id:e,is_comments_clicked:!1}),f(!1),C.oS.delete(e)),i&&ne.set(e,!0))}),[i])},ae=e=>{const t=(0,o.useRef)(0),n=(0,o.useRef)(0),{comments:i,preloadCommentList:r}=(0,C.Oz)(e),a=(0,D.JW)((e=>e.isFeedPersonalized),z.bN),{hasNewCommentsDesign:l,setEnablePreload:s,triggerCommentsPreload:d}=ie(e);return{startPreload:()=>{0===(null==i?void 0:i.length)&&(t.current=(new Date).getTime(),window.clearTimeout(n.current),n.current=window.setTimeout((()=>{l?d({id:e,preload_type:"hover"}):r({aweme_id:e,cursor:0,is_non_personalized:!a},"hover")}),100))},cancelPreload:()=>{var e;(new Date).getTime()-Number(null!==(e=null==t?void 0:t.current)&&void 0!==e?e:0)<100&&(s(!1),window.clearTimeout(n.current)),t.current=null}}},le=()=>{const{preloadThreshold:e}=(()=>{var e;const{abTestVersion:t}=(0,r.L)((0,a.W)((()=>["abTestVersion"]),[])),n=null!==(e=(0,l.qt)(t,"preload_with_left"))&&void 0!==e?e:"0";return{preloadThreshold:Number(n)}})(),{pathname:t}=(0,i.zy)(),{streamDeviceType:n}=(0,O.A)(),{user:d,abTestVersion:c,language:u}=(0,r.L)((0,a.W)((()=>["user","language","abTestVersion"]),[])),[m,p]=(0,k.NY)((e=>null!=e?e:{list:[],loading:!1,hasMore:!0}),[]),{loading:h,hasMore:v,list:f}=m,g=(0,s.sH)(),_=(0,T.JD)((e=>e.showingBrowserMode)),{fypFeederItemId:b}=(0,U.ip)();return{handlePreloadWithCheck:(0,o.useCallback)((({currentIndex:o})=>{var i,r;if(!h&&e&&f.length-o===e){if(h||!v)return;const e=(0,S.ey)();p.getRecommendList({key:"foryou",routeName:null!==(r=null===(i=(0,P.jN)(t))||void 0===i?void 0:i.name)&&void 0!==r?r:P.eU.foryou,user:d,abTestVersion:c,language:u,fromPage:"fyp",watchLiveLastTime:e,device_type:n,ttamParams:g,showingBrowserMode:_,fypFeederItemId:b})}}),[h,f,_,g,b])}},se=()=>{var e,t;const{abTestVersion:n}=(0,r.L)((0,a.W)((()=>["abTestVersion"]),[])),o="v1"===(null!==(e=(0,l.qt)(n,"fyp_redesign"))&&void 0!==e?e:"v0"),i=null!==(t=(0,l.qt)(n,"refactor_anchor_tag"))&&void 0!==t?t:"v0";return{anchorOpacity:o?"v1"===i?"light":"v2"===i?"lightest":"original":"original"}},de=()=>{var e,t;const{abTestVersion:n}=(0,r.L)((0,a.W)((()=>["abTestVersion"]),[])),o="v1"===(null!==(e=(0,l.qt)(n,"fyp_redesign"))&&void 0!==e?e:"v0"),i=null!==(t=(0,l.qt)(n,"fyp_top_gradient"))&&void 0!==t?t:"v0";return{hasNewTopGradient:o&&"v0"!==i,hasNoGradient:o&&"v1"===i,hasIosGradient:o&&"v2"===i,hasAndroidShadow:o&&"v3"===i}}},51611:(e,t,n)=>{n.d(t,{z:()=>o});const o=(0,n(40099).createContext)(null)}}]);