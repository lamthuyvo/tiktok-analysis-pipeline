/*! For license information please see npm-xg-plugin.51af891ac669263ff5fd.js.LICENSE.txt */
(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([[6820],{66301:(e,t,r)=>{"use strict";function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,i)}return r}function n(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){u(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,m(i.key),i)}}function o(e,t,r){return t&&s(e.prototype,t),r&&s(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function u(e,t,r){return(t=m(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function c(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function h(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return c(e)}function f(){return f="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=d(e)););return e}(e,t);if(i){var n=Object.getOwnPropertyDescriptor(i,t);return n.get?n.get.call(arguments.length<3?e:r):n.value}},f.apply(this,arguments)}function A(e){return function(e){if(Array.isArray(e))return v(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||p(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(e,t){if(e){if("string"==typeof e)return v(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?v(e,t):void 0}}function v(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function m(e){var t=function(e){if("object"!=typeof e||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}r.d(t,{DS:()=>Je,K:()=>et,Ay:()=>tt}),r(28800),r(3829),r(96077),r(2361),r(34573),r(14318),r(94214),r(25866),r(68913),r(78067),r(60887);var g="undefined"!=typeof window&&window.location.href.indexOf("loggerdebug")>-1;function y(e,t){for(var r,i=arguments.length,n=new Array(i>2?i-2:0),a=2;a<i;a++)n[a-2]=arguments[a];g&&(r=console).log.apply(r,["[logger>".concat(e,"]"),t].concat(n))}function b(){return(new Date).getTime()}function _(e){return Object.prototype.toString.call(e).match(/([^\s.*]+)(?=]$)/g)[0]}function E(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,r=Math.pow(10,t);return Math.round(e*r)/r}function T(e){return parseInt((1e3*e).toFixed(0),10)}function k(e){return e&&e instanceof window.HTMLMediaElement}function S(e){if(!e||"string"!=typeof e)return"";var t=e.split("/"),r="";return t.length>3&&t[2]&&(r=t[2]),r}function D(e){try{return JSON.stringify(e)}catch(e){return""}}function R(e){return"string"==typeof e&&/^blob/.test(e)}function L(e){var t,r,i;return null!==(t=e)&&void 0!==t&&t.media&&(e=e.media),!!(e&&e instanceof HTMLMediaElement)&&(R(null===(r=e)||void 0===r?void 0:r.currentSrc)||R(null===(i=e)||void 0===i?void 0:i.src))}function C(e){return null==e}function w(e,t,r){var i=r||0;return e>0&&t>0?t-e>i&&i?i:t-e:0}var I={UN_KNOW:0,EXPIRED:1,NO_EXPIRED:2},x=[new RegExp("(\\?|&)expire=([^&]*)(&|$)"),new RegExp("(\\?|&)x-tos-expires=([^&]*)(&|$)"),new RegExp("(\\?|&)x-expires=([^&]*)(&|$)")];function P(e){if(!e||"string"!=typeof e)return I.UN_KNOW;var t=I.UN_KNOW;try{var r=[];if(x.forEach((function(t){var i=e.match(t);i&&r.push(i)})),r.length>0)t=parseInt(r[0][2],10);else{var i=e.split("/");i.length>5&&8===i[4].length&&(t=parseInt(i[4],16))}if(t>0){var n=new Date;return t<=Date.UTC(n.getUTCFullYear(),n.getUTCMonth(),n.getUTCDate(),n.getUTCHours(),n.getUTCMinutes(),0)/1e3?I.EXPIRED:I.NO_EXPIRED}return I.UN_KNOW}catch(e){return I.UN_KNOW}}function F(e){try{return e.toString()}catch(e){return""}}function O(e,t){Object.keys(e).forEach((function(r){C(t[r])||(e[r]=t[r])}))}const M="2.0.15";r(53735),r(60463),r(32412),r(20420),r(52595),r(98812),r(82610);var B=[{key:"QQBrowser",reg:/(qqbrowser)\/([\d.]+)/},{key:"2345Explorer",reg:/(2345explorer)\/([\d.]+)/},{key:"Wexin",reg:/(micromessenger)\/([\d.]+)/},{key:"Openlanguage",reg:/(openlanguage)\/([\d.]+)/},{key:"NewsArticle",reg:/(newsarticle)\/([\d.]+)/},{key:"VideoArticle",reg:/(videoarticle)\/([\d.]+)/},{key:"Hotsoon",reg:/(live_stream)_([\d.]+)/},{key:"Aweme",reg:/(aweme)_([\d.]+)/},{key:"Lark",reg:/(lark)\/([\d.]+)/},{key:"PlayStation",reg:/(playstation)/},{key:"BingPreview",reg:/(bingpreview)\/([\d.]+)/},{key:"Baiduspider",reg:/(baiduspider-render)\/([\d.]+)/},{key:"YandexBot",reg:/(yandexbot)\/([\d.]+)/},{key:"Chrome",reg:/(chrome)\/([\d.]+)/},{key:"Safari",reg:/(version)\/([\d.]+)\s*(safari)/}],G=[{key:"Trident",reg:/(rv:)([\d.]+)/},{key:"Trident",reg:/(msie)\s*([\d.]+)/}],N=["Baiduspider","YandexBot"],V=!("undefined"==typeof window),U={isIOS:!1,isAndroid:!1,isMobile:!1,isPC:!1,isPad:!1,isSpider:!1,isSupportMP4:!0,mime:"",name:"",appVersion:"",isChrome:!1,isSafari:!1};"undefined"!=typeof navigator&&function(e){if("undefined"==typeof navigator)return e;var t=window.navigator.userAgent.toLocaleLowerCase(),r=/(iphone)/.test(t)||/(ipad)/.test(t),i=/(android)/.test(t),n=/(windows phone)/.test(t),a=r||i||n;e.isIOS=r,e.isAndroid=i,e.isPC=!a,e.isPad=/(ipad)/.test(t);var s=function(){var e={isSupport:!1,mime:""};if("undefined"==typeof document)return e;var t=document.createElement("video");return"function"==typeof t.canPlayType?(["avc1.42E01E, mp4a.40.2","avc1.58A01E, mp4a.40.2","avc1.4D401E, mp4a.40.2","avc1.64001E, mp4a.40.2","avc1.42E01E","mp4v.20.8","avc1.42E01E, mp4a.40.2","avc1.58A01E, mp4a.40.2","avc1.4D401E, mp4a.40.2","avc1.64001E, mp4a.40.2","mp4v.20.8, mp4a.40.2","mp4v.20.240, mp4a.40.2"].map((function(r){var i;"probably"===(null===(i=t)||void 0===i?void 0:i.canPlayType('video/mp4; codecs="'.concat(r,'"')))&&(e.isSupport=!0,e.mime+="||".concat(r))})),e):(t=null,e)}();e.isSupportMP4=s.isSupport,e.mime=s.mime;var o="",u="",d=[],l=B;/trident/.test(t)&&(l=G);for(var c=0;c<l.length;c++)if(d=l[c].reg.exec(t)){o=l[c].key,u=d.length>2?d[2]:"";break}if(o)e["is".concat(o)]=!0,e.name=o,e.appVersion=u;else{var h=function(){var e=navigator.mimeTypes;if(e){for(var t=0;t<e.length;t++){if(e[t].type&&e[t].type.indexOf("360")>-1)return!0;if(e[t].type&&e[t].type.indexOf("application/vnd.chromium.remoting-viewer")>-1)return!0;if(e[t].description&&e[t].description.indexOf("360")>-1)return!0}return!1}}();h&&(e.name="360EE")}e.name&&"Trident"!==e.name&&/(trident)/.exec(t)&&(e.name=e.name?"".concat(e.name,"_Trident"):"Trident"),e.isSpider=function(e,t){var r=!1;return N.map((function(t){t===e&&(r=!0)})),/spider/.test(t)&&(r=!0),r}(e.name,t)}(U);var Z=!("undefined"==typeof navigator),W={sdk_version:M,pc:"",pv:"",sv:"",line_app_id:0,line_user_id:"",app_version:"",platform:U.isPad?"pad":U.isMobile?"mobile":"pc",cpu_core:0,memory_size:0,support:0,webdriver:-1,absdkVersion:"",d_score:-1,vendor:"",gpu:"",deviceScore:{},ua:""},j="",X=0;function Y(e){Object.keys(e).forEach((function(t){void 0!==e[t]&&("playerCoreVersion"===t?W.pc=e[t]:"playerVersion"===t?W.pv=e[t]:"appVersion"===t?W.app_version=e[t]:"strategyVersion"===t?W.sv=e[t]:void 0!==W[t]&&(W[t]=e[t]))}))}!function(){if(Z){var e=window.navigator,t=e&&e.hardwareConcurrency||0,r=e&&e.deviceMemory||0,i=e&&e.webdriver?1:0,n=e&&e.userAgent||"";W.cpu_core=t,W.memory_size=r,W.webdriver=i,W.ua=n,a=function(e){W.support=e},s=U.isSupportMP4?1e4:0,s="undefined"!=typeof MediaSource&&MediaSource.isTypeSupported&&(MediaSource.isTypeSupported('video/mp4;codecs="hev1.1.6.L120.90"')||MediaSource.isTypeSupported('video/mp4;codecs="hev1.2.4.L120.90"')||MediaSource.isTypeSupported('video/mp4;codecs="hev1.3.E.L120.90"')||MediaSource.isTypeSupported('video/mp4;codecs="hev1.4.10.L120.90"'))?s+1e3:s,function(e){var t={supported:!1,smooth:!1,powerEfficient:!1};if(!e||"undefined"==typeof navigator)return Promise.resolve(t);if(navigator.mediaCapabilities&&navigator.mediaCapabilities.decodingInfo)return navigator.mediaCapabilities.decodingInfo(e);var r=e.video||{},i=e.audio||{};try{var n=MediaSource.isTypeSupported(r.contentType),a=MediaSource.isTypeSupported(i.contentType);return Promise.resolve({supported:n&&a,smooth:!1,powerEfficient:!1})}catch(e){return Promise.resolve(t)}}({type:"file",video:{contentType:'video/mp4;codecs="hev1.1.6.L120.90"',width:1920,height:1080,bitrate:1e4,framerate:30}}).then((function(e){e&&e.supported?s+=100:s+=10,a(s)})).catch((function(e){a(s+=1)})),y("CommonData",W)}var a,s}(),r(52665);var H="videoplayer_oneopera",Q="videoplayer_oneevent",K="mdl_video_data_size",z="mdl_video_preload",J="unknown",q=6e4,$="playcatch",ee="reset",te="page_unload",re=(r(70731),{PLAY:"play",PAUSE:"pause",PLAYING:"playing",WAITING:"waiting",ENDED:"ended",SEEKING:"seeking",SEEKED:"seeked",LOAD_START:"loadstart",LOADED_DATA:"loadeddata",TIMEUPDATE:"timeupdate",PROGRESS:"progress",CANPLAY:"canplay",VOLUME_CHANGE:"volumechange",RATE_CHANGE:"ratechange",LOADED_METADATA:"loadedmetadata",DURATION_CHANGE:"durationchange",EMPTIED:"emptied",ERROR:"error",SUSPEND:"suspend",ABORT:"abort",STALLED:"stalled"}),ie={PLAY_CATCH:"playCatch",AUTOPLAY_PREVENTED:"autoplay_was_prevented",AUTOPLAY_STARTED:"autoplay_started",PLAYER_DESTROY:"destroy",RESET:"reset",SOURCE_ERROR:"source_error",INITIAL_URL:"initialUrl",LOADSTART_MSE:"loadstart_mse",DEFI_CHANGE:"definitionChange",BEFORE_DEFI_CHANGE:"beforeDefinitionChange",DEFI_CHANGE_SUCCESS:"definitionChangeSuccess",XG_LOG_CACHE:"xglog_cache",DEGRADE:"degrade",ABR_CHANGE:"ABR_CHANGE",DEFI_CHANGE_DETAIL:"definitionChangeDetail",PRF_DATA_SIZE:"prf_data_size",MEDIA_FORMAT_ERROR:"media_format_error",META_READY:"metaReady"},ne={autoplay_started:"_onAutoPlayStart",autoplay_was_prevented:"_onAutoPlayPrevented",source_error:"_onSourceError",initialUrl:"_onInitialUrl",destroy:"_onPlayerDestroy",reset:"_onPlayerReset",loadstart_mse:"_onLoadstartMse",definitionChange:"_onDefiChange",beforeDefinitionChange:"_onBeforeDefiChange",definitionChangeSuccess:"_onDefiChangeSuccess",xglog_cache:"_onXgLogCache",degrade:"_onDegrade",ABR_CHANGE:"_onAbrChange",definitionChangeDetail:"_onDefiChangeDetail",prf_data_size:"_onPrfDataSize",media_format_error:"_onMediaFormatError",metaReady:"_onMetaReady"};function ae(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(e&&t){var i=k(e),n=Object.keys(re).map((function(e){return re[e]})),a=Object.keys(ie).map((function(e){return ie[e]}));(i?n:[].concat(A(n),A(a))).forEach((function(n){var a=function(e,t){var r="_on".concat(e.charAt(0).toUpperCase()).concat(e.slice(1));return{evt:e,handler:t[r]?t[r]:t[ne[e]]}}(n,t),s=a.handler,o=a.evt;s&&(i?1===r?e.addEventListener(o,s):e.removeEventListener(o,s):1===r?e.on(o,s):e.off(o,s))}))}}var se=[];function oe(e,t,r){se.push({id:e,name:t,handler:r})}function ue(e,t){for(var r=-1,i=0;i<se.length;i++)if(se[i].id===e&&se[i].name===t){r=i;break}r>-1&&se.splice(r,1)}var de="beforeunload",le="visibilitychange";function ce(e,t){for(var r=arguments.length,i=new Array(r>2?r-2:0),n=2;n<r;n++)i[n-2]=arguments[n];se.forEach((function(r){var n=r.name,a=r.handler;n===e&&a.apply(void 0,[t].concat(i))}))}function he(e){return k(e)?e:(null==e?void 0:e.media)||(null==e?void 0:e.video)}function fe(e){return Ae(e,["readyState","networkState"])}function Ae(e,t){var r=he(e);if(!r)return{};if(Array.isArray(t)){var i={};return t.forEach((function(e){i[e]=r[e]})),i}return r[t]}function pe(e){var t;return e?(e.vtype?e.vtype:(null===(t=e.config)||void 0===t?void 0:t.vtype)||"")||(e.dash?"DASH":""):""}function ve(e,t){var r=0;return e>0&&t>0&&e<t?(r=parseInt((t-e).toFixed(0),10))>q?q:r:0}"undefined"!=typeof document&&(y("GLOBAL_EVENTS","bindGlobalEvents",U.isPC,U.isMobile,U.isPad),"undefined"!=typeof document&&(U.isPC?window.addEventListener("beforeunload",(function(){ce("beforeunload")})):(U.isMobile||U.isPad)&&window.addEventListener("pagehide",(function(){ce("beforeunload")})),document.addEventListener("visibilitychange",(function(e){ce("visibilitychange",document.visibilityState)}))));var me={manifest:1e3,network:2e3,demux:3e3,remux:4e3,media:5e3,drm:7e3,other:8e3,runtime:9e3,no_error_handler:9997,custom_error:9998,notSupport:1005},ge={1:5101,2:5102,3:5103,4:5104,5:5105,6:5106};function ye(e){var t=[];return["errorMessage","message","httpCode"].forEach((function(r){void 0!==e[r]&&t.push(e[r])})),e.response&&t.push(e.response.statusText||""),t.join("_")}function be(e){var t=e.errorType;return me[t]?me[t]:"number"==typeof t?t:me.media}var _e=function(){function e(){a(this,e),this.first=null,this.latest=null,this.errors=[],this.count=0,this.retryCount=0}return o(e,[{key:"parseError",value:function(e,t){var r=null;k(t)?(e=t.error,r={code:ge[e.code],type:me.media,message:e.message}):r={code:e.errorCode,type:be(e),message:ye(e)},r.pos=e.currentTime||t.currentTime;var i=e.url||e.src||Ae(t,"currentSrc");r.isExpired=P(i);var a=fe(t),s=a.readyState,o=a.networkState;return n(n({},r),{},{cdnUrl:i,cdnHost:S(i),time:b(),readyState:s,networkState:o})}},{key:"setError",value:function(e,t){this.count++;var r,i=this.parseError(e,t);this.first?i.interval=i.time-((null===(r=this.latest)||void 0===r?void 0:r.time)||0):(i.interval=0,this.first=i),y("ERROR","setError",i),(U.isPC&&!U.isSupportMP4||U.isSpider)&&(i.code=ge[5],i.type=me.notSupport),i.stage=t.currentTime>0?"playing":"beforePlay",this.latest=i,this.errors.length>=10&&this.errors.splice(0,1),this.errors.push(i)}},{key:"errorCodes",get:function(){var e=[];return this.errors.forEach((function(t){e.push(t.code)})),e.join(";")}},{key:"reset",value:function(){this.first=null,this.latest=null,this.errors=[],this.count=0}}]),e}();function Ee(e,t){var r=Math.min(e,t);return r>0?r>2160?"8K":r>1792?"4K":r>1216?"2K":r>896?"1080P":r>640?"720P":r>512?"540P":r>416?"480P":r>288?"360P":"240P":J}function Te(e){var t,r=0,i=function(e){var t="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=p(e))){t&&(e=t);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,a=!0,s=!1;return{s:function(){t=t.call(e)},n:function(){var e=t.next();return a=e.done,e},e:function(e){s=!0,n=e},f:function(){try{a||null==t.return||t.return()}finally{if(s)throw n}}}}(e);try{for(i.s();!(t=i.n()).done;){var n=t.value;n.end<0||n.start>n.end||(r+=1e3*n.end-1e3*n.start)}}catch(e){i.e(e)}finally{i.f()}return Math.round(r)/1e3}function ke(e,t){var r={startPos:0,endPos:0,include:0,diff:0,cur:t};if(!e||e.length<1)return r;for(var i=-1,n=-1,a=T(t),s=e.length-1;s>-1;s--){var o=T(e.start(s)),u=T(e.end(s));if(a>=o&&a<=u){r.include=1,r.startPos=o/1e3,r.endPos=u/1e3,r.diff=(u-a)/1e3;break}a<o&&(i<0||o-a<i)?(i=(o-a)/1e3,n=s):a>u&&(i<0||a-u<i)&&(i=(a-u)/1e3,n=s)}return 1!==r.include&&(n<0&&(n=e.length-1),r.startPos=T(e.start(n)),r.endPos=T(e.end(n))),r}function Se(e){var t=[];if(!e||e.length<1)return t;for(var r=e.length,i=0;i<r;i++){var n=T(e.start(i))/1e3,a=T(e.end(i))/1e3;t.push({start:n,end:a})}return t}function De(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(!e)return!1;t=T(t);for(var i=0;i<e.length;i++){var n=T(e.start(i))+r,a=T(e.end(i))-r;if(t>n&&t<a)return!0}return!1}var Re="Operate",Le=function(){function e(t){a(this,e),this.suspendCallback=t,this.init()}return o(e,[{key:"reset",value:function(){this.init()}},{key:"init",value:function(){this.seekCount=0,this.sat=0,this.ops=[],this.seek=this.getOperaInfo("seeked"),this.latestSeek=null,this.firstSeek=null,this.latestSwitch=this.getOperaInfo("switch"),this.firstSwitch=null,this.pauseLog={start:-1,acuTime:0,totalCount:0}}},{key:"getOperaInfo",value:function(e){return{op:e,stateBefore:-1,stateAfter:-1,start:0,end:0,pos:0,inBuffer:!1,intervalId:0,readyState:-1,networkState:-1}}},{key:"pushOP",value:function(e){var t=this.ops;t.length>10&&t.splice(0,t.length-10),t.push(e)}},{key:"clearTimer",value:function(){var e=this.seek;e.intervalId&&(clearTimeout(e.intervalId),e.intervalId=0)}},{key:"startSeekTimeout",value:function(){var e=this,t=this.seek;this.clearTimer(),t.intervalId=setTimeout((function(){t.start&&e.suspendSeek("timeout","timeout"),e.clearTimer()}),6e4)}},{key:"startSeek",value:function(e,t){var r=this.seek;if(y(Re,"startSeek","start1: ".concat(b()-r.start," start:").concat(r.start," currentTime:").concat(e.currentTime," pos:").concat(r.pos),t),r.start&&b()-r.start>6e3&&this.suspendSeek("seeking","seeking"),!r.start){r.start=b();var i=fe(e),n=i.readyState,a=i.networkState;r.pos=e.currentTime,r.stateBefore=t,r.inBuffer=De(e.buffered,e.currentTime,1),r.readyState=n,r.networkState=a,y(Re,"startSeek","start: ".concat(b()-r.start," pos:").concat(r.pos," inBuffer:").concat(r.inBuffer),Se(e.buffered)),this.seekCount++,this.startSeekTimeout()}}},{key:"suspendSeek",value:function(e,t){var r=this.seek;if(r.start){var i=b()-r.start;y(Re,"suspendSeek","endType:".concat(t," cost: ").concat(i," inBuffer:").concat(r.inBuffer));var n=this.latestSeek,a={costTime:i,stateBefore:r.stateBefore,stateAfter:e,start:r.start,end:b(),pos:r.pos,inBuffer:r.inBuffer,op:"seek",endType:t,interval:n?r.start-n.start:0,readyState:r.readyState,networkState:r.networkState};this.latestSeek=a,this.firstSeek||(this.firstSeek=a),this.pushOP(a),this.clearTimer(),r.start=0,r.intervalId=0,r.pos=0,r.inBuffer=!1,this.sat+=i,this.suspendCallback&&this.suspendCallback(H,this.latestSeek)}}},{key:"startPause",value:function(){var e=this.pauseLog;y(Re,"endPause>pauseLog.start:".concat(e.start)),e.start<0&&(e.start=b(),e.totalCount++)}},{key:"endPause",value:function(){var e=this.pauseLog;e.start>0&&(e.acuTime+=b()-e.start,e.start=-1,y(Re,"endPause>pauseLog.acuTime:".concat(e.acuTime)))}}]),e}(),Ce=function(){function e(t){a(this,e),this._last=t,this._current=t,this._initVal=t}return o(e,[{key:"initial",set:function(e){this._initVal=e}},{key:"current",get:function(){return this._current},set:function(e){this._current!==e&&(this._last=this._current,this._current=e)}},{key:"last",get:function(){return this._last}},{key:"reset",value:function(){this._current=this._initVal,this._last=this._initVal}}]),e}(),we=function(){function e(){a(this,e),this.reset()}return o(e,[{key:"reset",value:function(){this.t=0,this.visible=!1,this.fAcc=0,this.bAcc=0,this.acc=0,this.loopAcc=0}},{key:"update",value:function(e,t){if(this.t){var r=b()-this.t;this.acc+=r,this.t=0,this.visible?this.fAcc+=r:this.bAcc+=r,t&&(this.loopAcc=this.acc)}}},{key:"start",value:function(e){this.t||(y("ACC","startACC",e,this.t,this.visible),this.t=b())}},{key:"getWatchDuration",value:function(){switch(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0){case 1:return this.fAcc;case 2:return this.bAcc;default:return this.acc}}}]),e}();function Ie(){return{networkState:-1,readyState:-1,pos:-1,inBuffer:!1,start:0,end:0,startDiff:-1,endDiff:-1,rate:0,endType:J,costTime:0}}var xe="PlayPerformance",Pe=function(){function e(){a(this,e),this.switchPlayerTime=0,this.init()}return o(e,[{key:"init",value:function(){this.isMSE=!1,this.loadState=0,this.playbackState=0,this.seeking=!1,this.ended=!1,this.paused=!1,this.duration=0,this.currentTime=new Ce(0),this.playbackRate=new Ce(0),this.muted=new Ce(!1),this.volume=new Ce(1),this.resolution=new Ce(""),this.definition=new Ce(J),this.bitrate=new Ce(0),this.width=0,this.height=0,this.state=new Ce(J),this.newTime=b(),this.startLoadTime=0,this.playTime=0,this.bufferFinishTime=0,this.playCount=0,this.vvTime=0,this.startPlayInfo={time:0,buffer:0,vvBuffer:0,startPos:0},this.leave={time:0,method:""},this.exit={time:0,method:""},this.fvt=0,this.nvt=0,this.lpt=0,this.loadvt=0,this.switchPt=0,this.userFvt=0,this.buffFinishTime=0,this.loopCount=0,this.br={time:0,method:"",count:0,lTime:0,lPos:-1,pos:-1},this.visible="visible"===document.visibilityState,this.initialUrl={url:"",ip:"",host:"",resolution:"",definition:"",bitrate:0,width:0,height:0},this.curUrlInfo={url:"",ip:"",host:"",resolution:"",definition:"",bitrate:0,width:0,height:0},this.accPlayed=new we,this.accPlayed.visible=this.visible,this.startStep=0,this.buffered={init:0,list:[],cur:{}},this.buffered=null,this.readyState=-1,this.networkState=-1,this.preloadData={size:0,time:0},this.meta={a_codec:"",v_codec:"",f_time:0}}},{key:"reset",value:function(e){e?(this.loopCount++,this.startStep=0,this.playTime=0,this.vvTime=0,this.bufferFinishTime=0,this.br={time:0,method:"",count:0,lTime:0,lPos:-1,pos:-1},this.seeking=!1,this.ended=!1,this.accPlayed.reset(),this.startPlayInfo={time:0,buffer:0,vvBuffer:0,startPos:0}):this.init()}},{key:"setInitData",value:function(e){var t=this;["playbackRate","volume","currentTime","muted"].forEach((function(r){t.change(r,e[r])}))}},{key:"setMeta",value:function(e){e?O(this.meta,e):this.meta={a_codec:"",v_codec:"",f_time:0}}},{key:"updateUrl",value:function(e){var t=this.initialUrl;t.url||(t.url=e.url||"",t.host=S(e.url)),e.definition&&(t.definition=e.definition),e.ip&&(t.ip=e.ip),e.bitrate&&(t.bitrate=e.bitrate)}},{key:"updatePState",value:function(e,t){var r=fe(e),i=r.readyState,n=r.networkState;this.readyState=i,this.networkState=n}},{key:"setLoadStartTime",value:function(){this.startLoadTime=b(),this.switchPt=this.switchPlayerTime?ve(this.switchPlayerTime,this.startLoadTime):0}},{key:"setPT",value:function(e){y(xe,"setPT>".concat(e)),this.startStep=1,this.startLoadTime||this.setLoadStartTime(),this.playTime||(this.playTime=b(),y(xe,"setPT","init pt:".concat(this.playTime,", document.visibilityState:").concat(this.visible)))}},{key:"setVT",value:function(e,t){if(1===this.startStep){if(y(xe,"setVT>".concat(e)),!this.vvTime){var r=b();this.vvTime=r,this.fvt=r-this.playTime,this.nvt=r-this.newTime,this.loadvt=r-this.startLoadTime,this.userFvt=this.switchPlayerTime>0?r-this.switchPlayerTime:this.loadvt,this.startPlayInfo.vvBuffer=ke(t,0).endPos;var i=this.resolution.current;i&&(this.initialUrl.resolution=i),y(xe,"setVT: first frame inited","vt-pt:".concat(this.fvt," vt-nt:").concat(this.nvt," loadvt:").concat(this.loadvt))}this.startStep=2}}},{key:"setBreak",value:function(e,t){var r=this.br;r.method=e,r.time||(r.time=b(),r.pos=t),r.lTime=b(),r.count++,r.lPos=t}},{key:"setPreload",value:function(e){this.preloadData=e}},{key:"setFirstPlayInfo",value:function(e){var t=this.startPlayInfo,r=this.state;if(!(t.time>0||"playing"!==r.current)){var i=ke(e.buffered,e.currentTime),n=b();t.time=n,t.buffer=i.endPos,t.startPos=e.currentTime,y(xe,"setFirstPlayInfo","vt_interval:".concat(n-this.vvTime," pt_interval::").concat(n-this.playTime),t)}}},{key:"updateBuffed",value:function(e,t){if(!this.bufferFinishTime)for(var r=Se(e),i=r.length-1;i>=0;i--)if(r[i].end>=this.duration-1){this.bufferFinishTime=b();break}}},{key:"setExit",value:function(e){var t=this.leave,r=this.exit;this.vvTime||(t.method=e,t.time=b(),this.playTime&&(this.lpt=t.time-this.playTime)),r.method=e,r.time=b()}},{key:"updateAcc",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.accPlayed.update(e,t)}},{key:"startAccTime",value:function(e){this.accPlayed.start(e)}},{key:"change",value:function(e,t){var r=this,i=_(e);"string"==typeof e?this[e]&&(this[e].current=t):"Object"===i&&Object.keys(e).forEach((function(t){"undefined"!==r[t]&&(r[t].current=e[t])}))}},{key:"changeWidthHeight",value:function(e,t){e&&t&&(this.width=e,this.height=t,this.resolution.current=Ee(e,t))}},{key:"getWatchDuration",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.accPlayed.getWatchDuration(e)}},{key:"ifFirstTimeUpdate",get:function(){return this.startPlayInfo.time>0}}]),e}(),Fe="WaitData",Oe=function(){function e(t){a(this,e),this.suspendCallback=t,this.init()}return o(e,[{key:"reset",value:function(){this.init()}},{key:"init",value:function(){this._startTime=-1,this._realStartTime=-1,this._intervalId=0,this._tIntervalId=0,this._startPos=0,this._inBuffer=!1,this._startDiff=0,this._endDiff=0,this._playRate=-1,this.nbc=0,this.dbc=0,this.dAcuTime=0,this.nAcuTime=0,this.firstWait=Ie(),this.latestWait=Ie(),this.waitList=[]}},{key:"_clearTimer",value:function(e){this[e]&&(clearTimeout(this[e]),this[e]=null)}},{key:"_startTimeout",value:function(){var e=this;this._clearTimer("_tIntervalId"),this._tIntervalId=setTimeout((function(){e.suspendWait("timeout"),e._clearTimer("_tIntervalId")}),6e4)}},{key:"_realStartWait",value:function(e){if(this._startTime>0){this._realStartTime=b();var t=e.buffered,r=e.currentTime,i=e.networkState,n=e.readyState,a=De(t,r,1);y(Fe,"_realStartWait","realStartTime:".concat(this._realStartTime-this._startTime,"\n       startPos:").concat(this._startPos," curPos:").concat(r," isInBuf:").concat(a)),a?this.dbc++:this.nbc++;var s={networkState:i,readyState:n,pos:this._startPos,inBuffer:this._inBuffer,start:this._startTime,end:0,startDiff:this._startDiff,endDiff:0,rate:this._playRate,endType:J,costTime:0,interval:this.latestWait.end>0?this._startTime-this.latestWait.end:0};this.latestWait=s,this.firstWait.start||(this.firstWait=s)}}},{key:"startWait",value:function(e){var t=this;if(!(this._startTime>0)){this._tIntervalId&&this._clearTimer("_tIntervalId"),this._startTime=b(),this._startPos=e.currentTime;var r=ke(e.buffered,this._startPos);this._inBuffer=1===r.include,this._startDiff=r.diff,this._playRate=e.playbackRate,y(Fe,"startWait>inBuffer:".concat(this._inBuffer," startDiff:").concat(this._startDiff," startPos:").concat(this._startPos," seeking:").concat(e.seeking),Se(e.buffered)),this._intervalId=setTimeout((function(){t._startTime>0&&(t._realStartWait(e),t._startTimeout()),t._clearTimer("_intervalId")}),200)}}},{key:"suspendWait",value:function(e,t){if(!(this._startTime<0)){this._clearTimer("_intervalId"),this._clearTimer("_tIntervalId");var r=b(),i=r-this._startTime;if(i=i>6e4?6e4:i,this._realStartTime<0)return y(Fe,"suspendWait>".concat(e," not realStart cost:").concat(i)),this._startTime=-1,this._inBuffer=!1,void(this._startDiff=0);var n=this.latestWait;this._inBuffer?this.dAcuTime+=i:this.nAcuTime+=i;var a=ke(t.buffered,n.pos);n.endType=e,n.costTime=i,n.endDiff=a.diff,n.end=r,y(Fe,"suspendWait>inBuffer:".concat(this._inBuffer," endDiff:").concat(n.endDiff," startDiff:").concat(n.startDiff," startPos:").concat(n.pos," realCost:").concat(i," ").concat(e),Se(t.buffered)),this._startTime=-1,this._realStartTime=-1,this._inBuffer=!1,this._playRate=-1,this.suspendCallback&&this.suspendCallback(Q,n)}}}]),e}(),Me=function(){function e(t){a(this,e),this.pIndex=-1,this.codec_type="unknown",this.vtype="default",this.defaultBitrate=0,this.defaultDefinition="unknown",this.play_type=0,this.source_type="dir_url",this.playMode="unknown",this.vid="",this.tag="default",this.subtag="default",this.preSubtag="unknown",this.preTag="unknown",this.envInfo={},this.ext={},this.bitrateSetHevc=[],this.bitrateSet=[],this.init(t)}return o(e,[{key:"init",value:function(e){var t=this;Object.keys(e).forEach((function(r){var i,n;i=t,n=r,Object.prototype.hasOwnProperty.call(i,n)&&!C(e[r])&&(t[r]=e[r])}))}},{key:"reset",value:function(e){this.init(e)}}]),e}();function Be(e){return e.map((function(e){if(!e)return"";if("string"==typeof e)return e;var t=[];return e.qualityType&&t.push(e.qualityType),e.definition&&t.push(e.definition),e.gearName&&t.push(e.gearName),t.join("|")}))}r(16407);var Ge="MDLPlayback",Ne=function(){function e(t,r){a(this,e),this.opts=r||{openSizeLog:!0},this.suspendCallback=t,this.init()}return o(e,[{key:"getInitBitrate",value:function(){return{bitrate:0,aBitrate:0,cdnSize:0,cdnVSize:0,pcdnSize:0,pcdnVSize:0,definition:"",fileid:""}}},{key:"init",value:function(){this.played=[],this.playedSize=0,this.cdnSize=0,this.pcdnSize=0,this.cdnVSize=0,this.pcdnVSize=0,this.lastBitrate=null,this.curBitrate=this.getInitBitrate(),this.nextBitrate=null,this.nextStart=-1,this.accDatas={cdnSize:0,cdnVSize:0,pcdnSize:0,pcdnVSize:0,playedSize:0},this.buffers=[]}},{key:"reset",value:function(){this.init()}},{key:"updatePlayed",value:function(e,t,r){var i=this.played,n=this.curBitrate,a=i.length,s=n.bitrate,o=n.aBitrate;if(0===t||a<1){var u=a>0?i[a-1]:null;u&&u.end<0?(u.start=e,u.bitrate=s,u.aBitrate=o):i.push({start:e,end:-1,bitrate:s,aBitrate:o})}else{var d=i[a-1];d.end=e,d.bitrate||(d.bitrate=s,d.aBitrate=o)}}},{key:"calculateVideoPlaySize",value:function(){return 0}},{key:"getPlayedDuration",value:function(){return Te(this.played)}},{key:"calculatePlaySize",value:function(){var e=this.played,t=this.curBitrate,r=Te(e),i=Math.round((t.aBitrate+t.bitrate)*r/8);return this.playedSize+=i,y(Ge,"calculatePlaySize","duration: ".concat(r," playedSize:").concat(this.playedSize)),this.played=[],this.playedSize}},{key:"calculateCacheSize",value:function(){var e=this.curBitrate,t=this.buffers,r=function(e){var t=0;return e.forEach((function(e){e.start<e.end&&(t+=e.end-e.start)})),t}(t),i=Math.round((e.aBitrate+e.bitrate)*r/8);return this.cdnSize=i,this.cdnVSize=i,y(Ge,"calculateCacheSize","duration: ".concat(r," cdnSize:").concat(this.cdnSize),e,t),this.buffers=[],this.cdnSize}},{key:"updateAccData",value:function(){var e=this,t=this.accDatas;["cdnSize","cdnVSize","pcdnSize","pcdnVSize","playedSize"].forEach((function(r){t[r]+=e[r],e[r]=0}))}},{key:"updateBuffed",value:function(e){this.buffers=Se(e)}},{key:"breakPlaybackData",value:function(e,t){L(he(t))||this.calculateCacheSize(),this.calculatePlaySize();var r=this.cdnSize,i=this.cdnVSize,n=this.pcdnSize,a=this.pcdnVSize,s=this.accDatas;y(Ge,"breakPlaybackData",e,r,i,n,a,s),[r,i,n,a].filter((function(e){return e>0})).length>0&&(this.sendMDLEvent(e,this),this.updateAccData())}},{key:"getFileSize",value:function(e){return function(e,t){var r=t.vBitrate,i=t.aBitrate;return{audio:Math.round(e*i/8),video:Math.round(e*r/8),total:Math.round(e*(r+i)/8)}}(e,this.curBitrate)}},{key:"checkNextBitrateStart",value:function(e){var t=this.nextBitrate;this.nextStart>-1&&e>=e&&t&&(this.calculatePlaySize(),y(Ge,"checkNextBitrate",e,e,this.cdnSize),t&&(this.curBitrate=n({},t)),this.updatePlayed(e,0),this.nextStart=-1,this.nextBitrate=null)}},{key:"updateDefInfo",value:function(e,t){var r=e.mediaType,i=e.start,n=e.bitrate,a=e.definition,s=e.fileid;y(Ge,"updateDefInfo",t,r,e);var o=this.getInitBitrate();"audio"===r?o.aBitrate=n||0:(o.bitrate=n||0,o.definition=a,o.fileid=s,this.updateLastDefInfo(),this.nextStart=C(i)?-1:i,-1===this.nextStart&&(this.curBitrate=o))}},{key:"updateLastDefInfo",value:function(){var e=this.curBitrate;e.bitrate>0&&(this.lastBitrate=n({},e))}},{key:"updateDownload",value:function(e){var t=e.cdn_size,r=e.pcdn_size,i=e.mediaType,n=e.bitrate,a=this.curBitrate,s=this.nextBitrate,o=t||0,u=r||0,d=0,l=0;"audio"!==i&&(d=o,l=u),this.cdnSize+=o,this.pcdnSize+=u,this.cdnVSize+=d,this.pcdnVSize+=l;var c=this.nextStart>0?s:a;y(Ge,"updateDownload",null==c?void 0:c.bitrate,this.played.length>0?"end:".concat(this.played[0].end," bitrate:").concat(this.played[0].bitrate):-1),c&&(c.bitrate=n||0,c.cdnSize+=o,c.pcdnSize+=u,c.cdnVSize+=d,c.pcdnVSize+=l)}},{key:"sendMDLEvent",value:function(e,t){var r=this.suspendCallback;if(this.opts.openSizeLog&&r){var i=t.cdnSize,n=t.cdnVSize,a={vds:i,pvds:t.pcdnSize,vvds:n,pvvds:t.pcdnVSize,df:t.definition,end_type:e};y(Ge,"sendMDLEvent",e,K,a),r(K,a)}}}]),e}(),Ve=0,Ue="Collector",Ze=function(){function e(t,r){var i=this;a(this,e),this._onLoadstartMse=function(){y(Ue,"onLoadstartMse",i.playPerf.startLoadTime,(new Date).getTime()),i.playPerf.setLoadStartTime(),i._onLoadstart(i.player,ie.LOADSTART_MSE),i.playPerf.setMeta(null)},this._onMetaReady=function(e){var t=e.audioCodec,r=e.videoCodec,n=e.timeRange,a=void 0===n?[]:n;i.playPerf.setMeta({v_codec:t||"",a_codec:r||"",f_time:a.length>0?T(a[0].endTime||0):0})},this._onLoadstart=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"loadstart",r=i.playPerf,n=i.playMDL,a=i.player;y(Ue,"onLoadstart","startStep:".concat(r.startStep),(new Date).getTime());var s,o=t!==ie.LOADSTART_MSE&&(!(s=a.currentSrc)||window.location.href.indexOf(s)>-1),u=t,d=t===ie.LOADSTART_MSE||L(he(a));r.isMSE=d,r.updateBuffed(a.buffered,u),n.updateBuffed(a.buffered),r.change("state",u),r.loadState=1,r.playbackState=1,r.seeking=!1,r.updatePState(a,u),r.setPreload(function(e){var t=(e||{}).plugins,r={vtype:J,time:0,size:0,f_size:0,bitrate:0,codec:"UNKNOWN"};if(!t||!t.mp4encryptplayer)return r;var i=t.mp4encryptplayer.preLoadData;if(i){var n=i.type,a=i.fileSize,s=i.vtype,o=i.codecType,u=i.bitrate,d=i.preloadTime,l=i.byteLength,c=i.definition;return{vtype:s,time:T(d),size:l,f_size:a||0,bitrate:u,definition:c,type:n,codec:o}}return r}(a)),y(Ue,"onLoadstart","startStep:".concat(r.startStep),!o),r.setInitData(a),d||(i.setInitialUrl({url:a.currentSrc}),n.updateDefInfo(function(e,t){var r=e||{},i=r.curDefinition,n=r.config;return i&&i.bitrate?i:n&&n.defaultBitrate?{bitrate:n.defaultBitrate||0,definition:n.defaultDefinition||""}:t?{bitrate:t.defaultBitrate||0,definition:t.defaultDefinition||""}:{bitrate:0,definition:""}}(a,i.vInfo),0)),0!==r.startStep||o||r.setPT(u)},this._onDurationchange=function(){var e=i.player;i.playPerf.duration=e.duration,y(Ue,"onDurationchange",e.duration)},this._onLoadedmetadata=function(){},this._onLoadeddata=function(){var e=i.playPerf,t=i.playMDL,r=i.player,n=re.LOADED_DATA;y(Ue,"onLoadeddata");var a=he(r),s=(null==a?void 0:a.videoWidth)||0,o=(null==a?void 0:a.videoHeight)||0;e.changeWidthHeight(s,o),e.playbackState=2,e.change("state",n),e.loadState=9,e.updatePState(r,n),e.updateBuffed(r.buffered,n),t.updateBuffed(r.buffered),e.setVT(n,r.buffered)},this._onCanplay=function(){var e=i.playPerf,t=i.playMDL,r=i.player;y(Ue,"onCanplay","startStep:".concat(e.startStep," vvTime:").concat(e.vvTime," playTime:").concat(e.playTime)),e.updatePState(r,re.CANPLAY),e.updateBuffed(r.buffered,re.CANPLAY),t.updateBuffed(r.buffered),e.setVT("canplay",r.buffered)},this._onPause=function(){var e=i.operate,t=i.playPerf,r=i.player,n=i.playMDL;r.error||(y(Ue,"onPause",t.state.current),t.change({state:re.PAUSE}),t.playbackState=4,t.paused=!1,t.updateAcc(re.PAUSE),n.updatePlayed(r.currentTime,1),e.startPause())},this._onPlaying=function(){var e=i.operate,t=i.playPerf,r=i.wait,n=i.player,a=i.playMDL;y(Ue,"onPlaying",t.state);var s=re.PLAYING;t.paused=!1,t.change("state",s),t.playbackState=3,t.startAccTime(s),a.updatePlayed(n.currentTime,1),r.suspendWait(s,n),e.endPause()},this._onWaiting=function(){var e=i.playPerf,t=i.wait,r=i.player,n=e.ifFirstTimeUpdate,a=e.vvTime,s=re.WAITING;y(Ue,"onWaiting",n,a),!r.seeking&&n&&a&&(t.startWait(r),e.change("state",s),e.playbackState=7),e.updatePState(r,s),e.updateAcc(re.WAITING)},this._onSeeking=function(){var e=i.playPerf,t=i.wait,r=i.operate,n=i.player,a=i.playMDL,s=e.ifFirstTimeUpdate,o=e.state,u=e.startStep,d=e.vvTime;y(Ue,"onSeeking",n.currentTime,"curState:".concat(o.current," lasteState:").concat(o.last," vvTime:").concat(d," ended1:").concat(n.ended," ifFirstTimeUpdate:").concat(s),n.seeking,o.current!==re.ENDED||d&&s);var l=re.SEEKING;(function(e){return e!==re.ENDED&&e!==re.LOAD_START})(o.current)&&d&&s&&(e.seeking=!0,t.suspendWait(l,n),r.startSeek(n,o.current),e.change("state",l),e.playbackState=8),e.updatePState(n,l),0===u&&e.setPT(l),e.startAccTime(l),a.updatePlayed(n.currentTime,0)},this._onSeeked=function(){var e=i.player,t=i.playPerf,r=i.operate;y(Ue,"onSeeked",e.seeking,e.currentTime),t.updatePState(e,re.SEEKED),t.seeking=!1;var n=e.paused?re.PAUSE:re.PLAYING;t.change("state",n),t.playbackState=e.paused?4:3,r.suspendSeek(t.state.current,re.SEEKED)},this._onTimeupdate=function(){var e=i.playPerf,t=i.playMDL,r=i.player;if(!r.error){var n=r.currentTime;e.change({currentTime:n}),t.updatePlayed(n,1),e.setFirstPlayInfo(r),!r.paused&&!r.ended&&e.startAccTime(re.TIMEUPDATE)}},this._onProgress=function(){var e=i.player,t=i.playMDL,r=i.playPerf;r.updatePState(e,re.PROGRESS),r.updateBuffed(e.buffered,re.PROGRESS),t.updateBuffed(e.buffered)},this._onSuspend=function(){var e=i.player,t=i.playPerf;y(Ue,"onSuspend"),t.updatePState(e,re.SUSPEND)},this._onVolumechange=function(){var e=i.player,t=e.muted,r=e.volume;i.playPerf.change({muted:t,volume:r})},this._onRatechange=function(){i.playPerf.change("playbackRate",i.player.playbackRate)},this._onEmptied=function(){var e=i.player,t=i.playPerf;t.loadState=0,t.updatePState(e,re.EMPTIED),t.updateBuffed(e.buffered,re.EMPTIED),y(Ue,"onEmptied")},this._onStalled=function(){var e=i.player,t=i.playPerf,r=re.STALLED;t.updatePState(e,r),"Safari"===U.name||(t.loadState=11,t.change("state",r)),y(Ue,"onStalled")},this._onAbort=function(){var e=i.player,t=i.playPerf,r=re.ABORT;t.updatePState(e,r),t.change("state",r),y(Ue,"onAbort")},this.options=t||{},this.player=r,Ve||(Ve=function(){try{return parseInt(window.performance.now().toFixed(0),10)}catch(e){return 0}}()),this.playPerf=new Pe,this.operate=new Le((function(e,t){i._suspendStateCallback(e,t)})),this.wait=new Oe((function(e,t){i._suspendStateCallback(e,t)})),this.vInfo=new Me({}),this.error=new _e,this.extData={};var n={openSizeLog:this.options.openSizeLog},s=this.options,o=s.ext,u=s.switchPlayerTime;this.setExtData(o),this.setSwitchTime(u),this.playMDL=new Ne((function(e,t){return i._suspendStateCallback(e,t)}),n)}return o(e,[{key:"_suspendStateCallback",value:function(e,t){y(Ue,"_suspendStateCallback",e,t)}},{key:"performanceNow",get:function(){return Ve}},{key:"resetDataOnEnded",value:function(){this.reset(!0)}},{key:"reset",value:function(e){y(Ue,"reset","isEnded:".concat(e));var t=this.operate,r=this.playPerf,i=this.wait,n=this.error,a=this.playMDL;t.reset(),r.reset(e),i.reset(),n.reset(),a.reset()}},{key:"setSwitchTime",value:function(e){this.playPerf.switchPlayerTime=e||b()}},{key:"setExtData",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object.keys(t).forEach((function(r){e.extData[r]=t[r]}))}},{key:"setPlayLeaveInfo",value:function(e,t){var r=e||ie.RESET,i=t||ee;y(Ue,"setPlayLeaveInfo");var n=this.playPerf,a=this.wait,s=this.operate,o=this.player;n.setExit(i),a.suspendWait(r,o),s.suspendSeek(n.state.current,r)}},{key:"setInitialUrl",value:function(e){var t=this.playPerf,r=this.vInfo;e.definition||(e.definition=r.defaultDefinition),e.bitrate||(e.bitrate=0|r.defaultBitrate),t.updateUrl(e)}},{key:"_onPlay",value:function(){var e=this.playPerf,t=this.player,r=this.options;t.error||(y(Ue,"onPlay","startStep :".concat(e.startStep," this.ended:").concat(e.ended)),e.state.current===re.PAUSE&&e.playCount++,e.ended&&e.loopCount++,r.ifSendVVEnded&&e.ended&&(this.resetDataOnEnded(),e.ended=!1,e.setPT("play")))}},{key:"_onEnded",value:function(){y(Ue,"onEnded");var e=re.ENDED,t=this.playPerf,r=this.wait,i=this.player,n=this.options;t.ended=!0,t.change("state",e),t.playbackState=6,t.updateAcc(e,!0),r.suspendWait(e,i),n.ifSendVVEnded&&t.setExit("ended")}},{key:"_onError",value:function(e){y(Ue,"onError",e);var t=re.ERROR,r=this.playPerf,i=this.playMDL,n=this.wait,a=this.operate,s=this.error,o=this.player;s.setError(e,o),r.updatePState(o,t),r.updateBuffed(o.buffered,t),i.updateBuffed(o.buffered),r.change("state",t),r.loadState=10,r.playbackState=5,r.setExit("error"),r.seeking=!1,r.updateAcc(t),n.suspendWait(t,o),i.breakPlaybackData(t,o),a.suspendSeek(r.state.current,t)}},{key:"_onPlayCatch",value:function(e,t){var r=this.playPerf,i=this.wait,n=this.operate,a=this.playMDL,s=this.player,o=ie.PLAY_CATCH;r.updatePState(s,o),r.change("state",o),r.seeking=!1,r.updateAcc(o),r.setBreak(o,r.currentTime.current),i.suspendWait(o,s),a.breakPlaybackData(o,s),n.suspendSeek(r.state.current,o)}},{key:"_onPlayerDestroy",value:function(){var e=this.playPerf,t=this.playMDL,r=this.wait,i=this.operate,n=this.player,a=ie.PLAYER_DESTROY;e.setExit("destroy"),e.updateAcc(a),r.suspendWait(a,n),t.breakPlaybackData(a,n),i.suspendSeek(e.state.current,a)}},{key:"_onAutoPlayStart",value:function(){y(Ue,"onAutoPlayStart"),this.playPerf.playbackState=3}},{key:"_onAutoPlayPrevented",value:function(){y(Ue,"onAutoPlayPrevented"),this.playPerf.playbackState=9}},{key:"sendEvent",value:function(e,t){}}]),e}();function We(e){switch(e){case 0:return"duration";case 1:return"size";default:return J}}function je(e){var t=e.url;return"Array"===_(t)&&t.length>0&&(t=t[0].src||""),{cdn_url:t||"",cdn_host:S(t)||"",cdn_ip:e.ip||""}}var Xe={preload_start:"onLoadStart",preload_ended:"onLoadEnded",error:"onError",prf_data_size:"onPrfDataSize",prf_meta_ready:"onPrfMetaReady"},Ye="MDLPreload";function He(e,t,r,i){var a=t.source_type,s=t.codec_type,o=t.vtype,u=t.preTag,d=t.tag,l=t.subtag,c=t.pIndex,h=t.preSubtag,f=t.vid,A=t.play_type,p=t.envInfo,v=t.ext,m=t.playMode,g=r.networkState,y=r.readyState,_=r.duration,E=r.currentTime,S=r.width,R=r.height,L=r.isMSE,C=T(i.currentTime||E.current),w=pe(i)||o,I=function(e){return e&&e.config&&e.config.codecType?e.config.codecType:""}(i)||s,x=k(i)?A+2:A,P=W.pv?W.pv:i?i.version:"",F=W.deviceScore,O=void 0===F?{}:F;return n(n(n({local_time:b(),player_sessionid:e},W),O),{},{pv:P||J,codec_type:I,play_type:x,source_type:a,v:f,width:S,height:R,vtype:w,tag:d||J,subtag:l||m||J,pre_tag:u,pre_subtag:h,p_index:c,video_net_s:g,video_ready_s:y,vd:T(_),cur_play_pos:C,visible:r.visible?1:0,net:navigator.onLine?"online":"offline",is_mse:L?1:0,env_info:D(p),ext:D(v)})}var Qe="Collector",Ke=null,ze=new(function(){function e(t){var r=this;a(this,e),this.onLoadStart=function(e){y(Ye,"onPreloadStart",e.cacheKey,e);var t,i=e.codecType,a=e.vtype,s=e.vid,o=e.width,u=e.height,d=e.bitrate,l=e.file_id,c=e.definition,h=e.type,f=r.data,A=je(e);t=o&&u?Ee(o,u):c;var p=n(n(n({},f),A),{},{v:s,codec_type:i,vtype:a,bitrate:d,fileid:l||"",df:t,task_type:C(h)?-1:h});r.vid=s,r.data=p,r.meta={a_codec:"",v_codec:"",f_time:0,f_size:0},r.startTime=b(),r.state="start"},this.onLoadEnded=function(e){if(y(Ye,"onPreloadEnded",e.cacheKey,e),r.vid&&r.vid===e.vid){var t=je(e),i=b()-r.startTime,a=r.data.vds;r.setMetaFirst(e);var s=n(n({},r.data),{},{vplt:E(e.preloadTime,2),vpls:a||e.preloadSize,cost_time:e.costTime||i,bitrate:e.bitrate,fileid:e.file_id||"",isexpired:P(t.cdn_url)});r.sendMDLEvent("loadended",s)}else console.warn(Ye,"onLoadEnded","cacheKey_not_match",r.vid,e.cacheKey);r.vid="",r.startTime=0,r.data=r.getInitData(),r.state="suspend"},this.onError=function(e){if(y(Ye,"onError",e),r.vid){var t=e.context,i=b()-r.startTime,a=je(t||{}),s=n(n({},r.data),{},{errc:e.errorCode,err_msg:ye(e),cost_time:e.costTime||i,fileid:e.file_id||"",isexpired:P(a.cdn_url)},a);r.sendMDLEvent("loaderror",s)}r.vid="",r.startTime=0,r.data=r.getInitData(),r.state="suspend"},this.onPrfDataSize=function(e){if(r.vid){var t=e.cdn_size,i=e.pcdn_size,n=e.mediaType,a=r.data,s=t||0,o=i||0,u=0,d=0;"audio"!==n&&(u=s,d=o),a.vds+=s,a.pvds+=o,a.vvds+=u,a.pvvds+=d}r.state="load"},this.onPrfMetaReady=function(e){r.setMetaFirst(e)},this.eventCallback=t,this.init()}return o(e,[{key:"init",value:function(){this.emptyCount=0,this.data=this.getInitData(),this.vid="",this.extData={tag:J,subtag:J,preSubtag:J,preTag:J,pIndex:-1,isMSE:!1},this.meta={a_codec:"",v_codec:"",f_time:0,f_size:0},this.state="init"}},{key:"getInitData",value:function(){return{codec_type:J,v:"",vtype:J,errc:0,err_msg:"",vplt:0,vpls:0,vds:0,pvds:0,vvds:0,pvvds:0,cdn_host:"",cdn_ip:"",cost_time:0,df:J,bitrate:0,fileid:"",task_type:-1,isexpired:0}}},{key:"setMetaFirst",value:function(e){var t=e||{},r=t.mediaSegList,i=void 0===r?[]:r,n=t.meta,a=void 0===n?{}:n,s=i.length>0?i[0]:{},o=s.timeRange,u=void 0===o?[]:o,d=s.totalRange,l=void 0===d?[]:d;this.meta.f_size=l.length>1?l[1]:0,this.meta.f_time=u.length>1?T(u[1]):0,this.meta.v_codec=a.videoCodec||"",this.meta.a_codec=a.audioCodec||""}},{key:"reset",value:function(){this.init()}},{key:"setExtData",value:function(e){e&&O(this.extData,e)}},{key:"attach",value:function(e){var t=this;this.preload!==e&&(y(Ye,"attach"),this.preload&&this.detach(),this.preload=e,Object.keys(Xe).forEach((function(e){t.preload.on(e,t[Xe[e]])})))}},{key:"detach",value:function(){var e=this;y(Ye,"attach "),this.preload&&Object.keys(Xe).forEach((function(t){e.preload.off(t,e[Xe[t]])})),this.reset(),this.preload=null}},{key:"sendMDLEvent",value:function(e,t){var r=this.eventCallback,i=this.extData,a=n(n(n({},W),t),{},{task_type:We(t.task_type),empty_c:0,tag:i.tag||J,subtag:i.subtag||J,pre_tag:i.preTag||J,pre_subtag:i.preSubtag||J,p_index:i.pIndex,is_mse:i.isMSE?1:0,meta:D(this.meta)});y(Ye,"event",e,z,a),r&&r(z,a)}}]),e}())((function(e,t){Ke&&Ke.event(e,t)})),Je=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&l(e,t)}(s,e);var t,r,i=(t=s,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,i=d(t);if(r){var n=d(this).constructor;e=Reflect.construct(i,arguments,n)}else e=i.apply(this,arguments);return h(this,e)});function s(e,t){var r,n,o,u,l,A,p,v;a(this,s);var m=function(e){var t={line_app_id:0,line_user_id:"",playerCoreVersion:"",playerVersion:"",app_version:"",channel:"cn",channelDomain:"",absdkVersion:"",maxQueueCount:5,ifSendVVEnded:!1,isTask:!1,vtype:"MP4",codec_type:"",tag:"普通视频",playType:0,sourceType:"vid",subtag:"",playMode:"",sendLocalCallback:function(e,t){},disableLocalCache:!1,closeResolutionLog:!1,closeSeekLog:!1,needXhrCheck:!1,trackerConfig:{},envInfo:{},ext:{},openSizeLog:!0};return Object.keys(e).forEach((function(r){t[r]=e[r]})),t}(e);return(v=i.call(this,m,t))._onPlay=function(){var e=v.playPerf,t=e.ended,i=e.state,n=e.isMSE;t&&(v.isSendOnePlay=!1),f((r=c(v),d(s.prototype)),"_onPlay",r).call(r),ze.setExtData({isMSE:n}),y(Qe,"onPlay",i.current,i.last)},v._onEnded=function(){f((n=c(v),d(s.prototype)),"_onEnded",n).call(n),v.options.ifSendVVEnded&&v._trackOnePlay("ended")},v._onError=function(e){f((o=c(v),d(s.prototype)),"_onError",o).call(o,e);var t=v.error.latest,r=c(v).playPerf;if(y(Qe,"onError",e,t),"dash"!==v.player.type||!v.player.replayRunning){if(r.playTime||r.setPT("error"),(null==t?void 0:t.code)===ge[5])return v._trackOneError("error",t),void(v.isSendOnePlay=!0);v._trackOneError("error",t),v._trackOnePlay("error",t)}},v._onSourceError=function(e){y(Qe,"onSourceError",e)},v._onPlayCatch=function(e,t){y(Qe,"onPlayCatch",e,t);var r=t?t.message:"";if("MP4_0"!==e||"no preload"!==r){f((u=c(v),d(s.prototype)),"_onPlayCatch",u).call(u,e,t);var i=v.playPerf.initialUrl;R(t.url)&&(t.url=i.url);var n=c(v).error;n.setError(t,v.player),v.playMDL.breakPlaybackData($,v.player),v._trackOneError($,n.latest)}},v._onPlayerDestroy=function(){f((l=c(v),d(s.prototype)),"_onPlayerDestroy",l).call(l);var e=v.playPerf.playTime;y(Qe,"onPlayerDestroy",v.sessionId,e),e>0&&v._trackOnePlay("player_destroy"),v.reset(!1),v._unBindEvt()},v._onPlayerReset=function(){var e=v.playPerf.playTime;y(Qe,"onPlayerReset",v.sessionId,"playTime:".concat(e)),v.playMDL.breakPlaybackData(ee,v.player),e>0&&(v.setPlayLeaveInfo(ie.RESET,ee),v._trackOnePlay(ie.RESET)),v.reset(!1)},v._onAutoPlayStart=function(){f((A=c(v),d(s.prototype)),"_onAutoPlayStart",A).call(A)},v._onAutoPlayPrevented=function(){f((p=c(v),d(s.prototype)),"_onAutoPlayPrevented",p).call(p)},v._onVisibilityChange=function(e){y(Qe,"onVisibilityChange",e);var t=c(v).playPerf;t.visible="visible"===e,t.updateAcc("visible",!1)},v._onInitialUrl=function(e){y(Qe,"onInitialUrl",e),v.setInitialUrl(e)},v._onBeforeDefiChange=function(e){y(Qe,"onBeforeDefinitionChange",e)},v._onDefiChange=function(e){y(Qe,"onDefinitionChange",e)},v._onDefiChangeSuccess=function(){y(Qe,"onDefiChangeSuccess")},v._onDefiChangeDetail=function(e){y(Qe,"onDefiChangeDetail",e);var t=c(v),r=t.playMDL,i=t.player;r.updateDefInfo(e,i.currentTime),r.lastBitrate&&e.mediaType},v._onPrfDataSize=function(e){y(Qe,"onPrfDataSize",e),v.playMDL.updateDownload(e)},v._onXgLogCache=function(){var e=function(e){return(null==e?void 0:e.logCache)||(null==e?void 0:e.getLogCache)}(v.player);e&&(v.templog={vtype:pe(v.player),log:e})},v._onDegrade=function(e){y(Qe,"onDegrade",e)},v._onAbrChange=function(e){var t=e.prev,r=e.cur,i=e.abrInfo;y(Qe,"onAbrChange",t,r,i)},v._onMediaFormatError=function(e){y(Qe,"onMediaFormatError",e)},v._onPageUnload=function(){var e=v.playPerf.playTime;if(y(Qe,"onPageUnload",v.sessionId,e),e>0){var t=te;v.setPlayLeaveInfo(t,t),v.playMDL.breakPlaybackData(t,v.player),v._trackOnePlay(te)}},e&&e.line_app_id?(v.isSendOnePlay=!1,v.sessionId="",v.init(e),v.player&&v._bindEvt(v.player),v):(console.warn("player.config.vodLogOpts.line_app_id is necessary for plugin xgVodLogger"),h(v))}return o(s,[{key:"init",value:function(e){y(Qe,"init",e);var t=this.options||{};Object.keys(e).forEach((function(r){t[r]=e[r]}));var r=n({},e.trackConfig);["referrer","channel","channel_domain"].forEach((function(t){void 0!==e[t]&&(r[t]=e[t])})),e.channelDomain&&(r.channel_domain=e.channelDomain),Ke&&Ke.config(r),this.initSessionId(),this.update(e)}},{key:"update",value:function(e){Y(e),this.vInfo.init(e);var t=e.ext,r=void 0===t?{}:t,i=e.switchPlayerTime;this.setExtData(r),i&&this.setSwitchTime(i),ze.setExtData(e)}},{key:"initSessionId",value:function(){if(!this.sessionId){var e="0";try{e=function(e){if(!window.localStorage)return"";var t=window.localStorage.getItem(e)||"";try{return JSON.parse(t)}catch(e){return t}}(j).web_id||"0"}catch(t){e="0"}this.sessionId=function(e){var t="0";try{var r=window.localStorage.getItem(e)||"",i=JSON.parse(r);t=(null==i?void 0:i.web_id)||"0"}catch(e){t="0"}return function(e){var t=(new Date).getTime(),r=0;try{r=parseInt(e)}catch(e){r=0}return t+=r,window.performance&&"function"==typeof window.performance.now&&(t+=window.performance.now()),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var r=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"===e?r:3&r|8).toString(16)}))}(t)}(e),y(Qe,"sessionId webId:".concat(e," ").concat(this.sessionId))}}},{key:"attachPlayer",value:function(e){e!==this.player&&(this.detachPlayer(this.player),this.player=e,this.player.version&&(W.pv=this.player.version),this._bindEvt(e));var t=null==e?void 0:e.preloader;t&&ze.attach(t);var r=(null==e?void 0:e.version)||"";W.pv=r}},{key:"detachPlayer",value:function(e){e&&this._unBindEvt(),e===this.player&&(this.player=null)}},{key:"resetConfig",value:function(e){y(Qe,"reset",e)}},{key:"reset",value:function(e){f(d(s.prototype),"reset",this).call(this,e),this.isSendOnePlay=!1}},{key:"destroy",value:function(){var e=this.operate,t=this.playPerf,r=this.playMDL,i=this.wait,n=this.error,a=this.player;y(Qe,"destroy",this.sessionId);var s="log_destroy";t.setExit("log_destroy"),t.updateAcc(s),r.breakPlaybackData(s,a),this._trackOnePlay(s),e.reset(),t.reset(!1),i.reset(),n.reset(),r.reset(),this.detachPlayer(this.player)}},{key:"getTokenFromTracker",value:function(){return Ke?Ke.getToken():{}}},{key:"_bindEvt",value:function(e){e&&(y(Qe,"_bindEvt",e.playerId),oe(this.sessionId,le,this._onVisibilityChange),oe(this.sessionId,de,this._onPageUnload),ae(e,this,1))}},{key:"_unBindEvt",value:function(){var e=this.player;e&&(ae(e,this,2),ue(this.sessionId,le),ue(this.sessionId,de))}},{key:"_suspendStateCallback",value:function(e,t){if(e&&t)switch(y(Qe,"_suspendStateCallback",e,t),e){case Q:this._trackOneEvent("wait",t);break;case H:this._trackOneOpera(t.op,t);break;case K:this._trackMdlVideoSize(t)}}},{key:"_trackOnePlay",value:function(e,t){var r=this.playPerf;if(!this.isSendOnePlay&&r.playTime){var i=function(e,t,r){var i,a,s=e.vInfo,o=e.playPerf,u=e.playMDL,d=e.wait,l=e.operate,c=e.error,h=e.player,f=e.sessionId,A=e.extData,p=e.performanceNow,v=He(f,s,o,h),m=o.initialUrl,g=m.url,y=m.host,b=m.ip,_=m.bitrate,k=o.leave,S=o.exit,R=o.playTime,L=o.vvTime,C=o.newTime,w=o.volume,I=o.muted,x=o.playbackRate,F=o.bufferFinishTime,O=o.preloadData,M=o.br,B=o.resolution,G=o.startLoadTime,N=o.userFvt,V=o.width,U=o.height,Z=o.switchPt,W=o.meta,j=l.seekCount,X=l.sat,Y=l.pauseLog,H=u.accDatas,Q=H.playedSize,K=H.cdnSize,z=H.cdnVSize,J=H.pcdnSize,q=H.pcdnVSize,$=d.firstWait,ee=c.errors,te=c.first,re=o.getWatchDuration(),ie=function(e){if(e&&e.pcdnVVStat){var t=e.pcdnVVStat;return{try_req:t.try_req_num,req_succ:t.req_node_succ,has_ret:t.has_ret_node,conn_ret:t.conn_ret_num,conn_fail:t.conn_fail_num,conn_jump:t.conn_jump_num}}return{}}(h),ne=function(e){return e&&e.performance||{}}(h),ae=function(e){var t=he(e),r={total:0,dropped:0,drop_rate:0};try{var i=null==t?void 0:t.getVideoPlaybackQuality();return r.dropped=(null==i?void 0:i.droppedVideoFrames)||0,r.total=(null==i?void 0:i.totalVideoFrames)||0,r.total>0&&(r.drop_rate=E(r.dropped/r.total*100)),r}catch(e){return r}}(h),se=s.bitrateSet,oe=(a=s.bitrateSetHevc,{h1:(i=se).length,h2:a.length,set1:Be(i),set2:Be(a)}),ue=_;return n(n({},v),{},{perf_time:p,prepare_start_time:0,prepare_end_time:0,initial_url:g||"",initial_host:y,initial_ip:b,isexpired:P(g),width:V,height:U,initial_resolution:o.initialUrl.resolution,pt:R,vt:L,fvt:ve(R,L),svt:ve(G,L),nvt:L>0?L-C:R-C,user_fvt:N,switch_pt:Z,player_created_t:C,lt:k.time,lpt:S.time-R,et:S.time,lv_method:S.method,bft:F,volume:E(w.current,2),mute:I.current?1:0,play_speed:x.current,sc:j,sat:X,dbc:d.dbc,nbc:d.nbc,bc:d.dbc+d.nbc,bu_acu_t:d.dAcuTime+d.nAcuTime,de_bu_acu_t:d.dAcuTime,n_bu_acu_t:d.nAcuTime,pause_acu_t:Y.acuTime,start_time:T(o.startPlayInfo.startPos),finish:o.ended||o.loopCount>0?1:0,lc:o.loopCount,watch_dur:re,is_start_play_automatically:0,first_buf_startt:$.start,first_buf_endt:$.end,play_c:o.playCount,load_state:o.loadState,playback_state:o.playbackState,pcdn:D(ie),pre_info:D(O),perf:D(ne),frame_info:D(ae),br:M.count,fbrt:M.time,df:B.current,lf:B.last,bitrate:ue,errc:r?r.code:0,errt:r?r.type:0,vsc_message:r?r.message:"",fir_errc:te?te.code:0,fir_errt:te?te.type:0,accu_errc:c.count||0,merror:D(ee),end_type:t,vps:Q,vds:K,pvds:J,vvds:z,pvvds:q,vplt:O.time,vpls:O.size,ext:D(A),bitset:D(oe),meta:D(W)})}(this,e,t);y(Qe,"_trackOnePlay_".concat(e),i),this.isSendOnePlay=!0,this.sendEvent("videoplayer_oneplay",i)}else y(Qe,"_trackOnePlay_".concat(e," isSendOnePlay:").concat(this.isSendOnePlay," pt:").concat(r.playTime))}},{key:"_trackOneEvent",value:function(e,t){var r=function(e,t,r){var i=r.vInfo,a=r.playPerf,s=r.operate,o=r.player,u=He(r.sessionId,i,a,o),d=a.playbackRate,l=a.startPlayInfo,c=s.latestSeek,h=s.latestSwitch;return n(n({},u),{},{event_type:e,cost_time:t.costTime,end_type:t.endType,first_frame_interval:w(l.time,t.start),last_seek_interval:c?w(c.start,t.start):0,last_switch_interval:h?w(h.start,t.start):0,last_event_interval:t.interval,video_pos:T(t.pos),play_speed:d.current,st:t.start,et:t.end})}(e,t,this);y(Qe,"_trackOneEvent_".concat(e),t,r),this.sendEvent(Q,r)}},{key:"_trackOneOpera",value:function(e,t){var r=function(e,t,r){var i=r.vInfo,a=r.playPerf,s=r.player;return n(n({},He(r.sessionId,i,a,s)),{},{opera_type:e,end_type:t.endType,state_before:t.stateBefore,state_after:t.stateAfter,cost_time:t.costTime,is_seek_in_buffer:t.inBuffer?1:0,last_interval:t.interval,video_pos:T(t.pos),cdn_url:"",cdn_ip:""})}(e,t,this);y(Qe,"_trackOneOpera_".concat(e),t,r),this.sendEvent(H,r)}},{key:"_trackOneError",value:function(e,t){if(t){var r=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",i=t.error,a=t.vInfo,s=t.playPerf,o=t.player,u=t.sessionId,d=t.extData,l=He(u,a,s,o),c=s.initialUrl.resolution,h=i.errorCodes;return n(n({},l),{},{errt:e.type,errc:e.code,err_msg:e.message,cdn_url:e.cdnUrl,cdn_host:e.cdnHost,cdn_ip:e.cdnIp,es:e.stage||"",isexpired:e.isExpired,resolution:F(c),end_type:r,last_errors:h,retry_count:i.retryCount,ext:D(d)})}(t,this,e);y(Qe,"_trackOneError_".concat(e),t,r),this.sendEvent("videoplayer_oneerror",r)}}},{key:"_trackMdlVideoSize",value:function(e){var t=function(e,t){var r=e.vInfo,i=e.playPerf,a=e.player;return n(n({},He(e.sessionId,r,i,a)),t)}(this,e);y(Qe,"_trackMdlVideoSize".concat(e.end_type),t),this.sendEvent(K,t)}},{key:"sendEvent",value:function(e,t){Ke&&Ke.event(e,t)}}],[{key:"version",get:function(){return M}},{key:"preloadMDL",get:function(){return ze}},{key:"Tracker",get:function(){return Ke},set:function(e){Ke=e}},{key:"sendEvent",value:function(e,t){Ke&&Ke.event(e,t)}},{key:"commonData",set:function(e){Y(e)}},{key:"TEA_ID",get:function(){return X},set:function(e){j="__tea_cache_tokens_".concat(X=e)}},{key:"AB_SDK_VERSION",get:function(){return W.absdkVersion},set:function(e){W.absdkVersion=Array.isArray(e)?e.join(","):e}},{key:"attachPreloader",value:function(e){ze.attach(e)}},{key:"detachPreloader",value:function(){ze.detach()}},{key:"defaultConfig",get:function(){return{line_app_id:0,line_user_id:"",playerCoreVersion:"",playerVersion:"",app_version:"",channel:"cn",channelDomain:"",absdkVersion:"",maxQueueCount:5,ifSendVVEnded:!1,isTask:!1,vtype:"MP4",codec_type:"",tag:"普通视频",playType:0,sourceType:"vid",subtag:"",playMode:"",sendLocalCallback:function(e,t){},disableLocalCache:!1,closeResolutionLog:!1,closeSeekLog:!1,needXhrCheck:!1,trackerConfig:{},envInfo:{},ext:{},openSizeLog:!0}}}]),s}(Ze),qe="XGTracker",$e="__xgplayer_vod_log__",et={appId:548444,_tt:{user_unique_id:""},_tracker:null,_options:{},init:function(e,t,r){var i=this;if((t.appId||t.app_id)&&(this.appId=t.appId||t.app_id),this._options=t,V){y(qe,"init",this.appId,t),!window[$e]&&e?this._tracker=window[$e]=new e("xgplayer_tracker"):this._tracker=window[$e];var a=t.channel,s=t.channel_domain,o=n(n({app_id:this.appId,log:!1,disable_sdk_monitor:!0,enable_ab_test:!1,disable_auto_pv:!0},t),{},{channel:a||"cn",channel_domain:s});return this._tracker.init(o),this._tracker.getToken((function(e){i._tt=e})),this.config(r),this._tracker.start(),this._tracker}},config:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=n({},e);U&&U.name&&!U.isChrome&&!U.isSafari&&(t.browser=U.name,U.appVersion&&(t.browser_version=U.appVersion));var r=e.user_unique_id||e.line_user_id;r&&(t.user_unique_id=r,t.web_id=r,this._tt={user_unique_id:r}),e.referrer&&(t.referrer=e.referrer,t.referrer_host=S(e.referrer)),this._tracker&&this._tracker.config(t)},getToken:function(){return this._tt},event:function(e,t){var r;(y(qe,"sendEvent_".concat(this.appId),!this._tracker,e,t),this._tracker)&&(t.line_user_id||(t.line_user_id=(null===(r=this._tt)||void 0===r?void 0:r.user_unique_id)||""),"function"==typeof this._tracker?this._tracker(e,t):this._tracker.event(e,t))}};Je.TrackerEventCallback=function(e,t){et.event(e,t)},Je.Tracker=et;var tt=function(e){if(e&&e.player){var t=e.player.config.vodLogOpts||{};e.player.vodLogger=new Je(t,e.player),e.player.plugins.xgVodLogger=e.player.vodLogger}else this.vodLogger=new Je(this.config.vodLogOpts||{},this)};tt.initTracker=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};et.init(e,t)},tt.configTracker=function(e){et.config(e)},tt.pluginName="__xgVodLogger",tt.playerConfig={},tt.setABSdkVersion=function(e){Je.AB_SDK_VERSION=e}},16984:(e,t,r)=>{var i;window,e.exports=(i=r(58679),function(e){var t={};function r(i){if(t[i])return t[i].exports;var n=t[i]={i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=e,r.c=t,r.d=function(e,t,i){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(i,n,function(t){return e[t]}.bind(null,n));return i},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){e.exports=r(1)},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),a=A(r(2)),s=A(r(3)),o=A(r(4)),u=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(5)),d=A(r(6)),l=A(r(7)),c=r(8),h=r(9),f=A(r(10));function A(e){return e&&e.__esModule?e:{default:e}}function p(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function v(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function m(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var g=o.default._||{},y=g.parse,b=g.decrypt,_=a.default.Util||a.default.util,E=function(){function e(t){p(this,e);var r=t.autoplay;t.autoplay&&(t.autoplay=!1),t.expireDetectType=[].concat(t.expireDetectType||[]),t.videoInit=!1;var i=v(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));i._autoplay=r,i._curDefinitionIndex=0,i._errReqCount=0,i.hlsOpts=t.hlsOpts||{},i.hlsOpts.enableSoftwareAES=!(self.crypto&&self.crypto.subtle&&self.crypto.subtle.importKey&&(0,h.isNativeFunc)(self.crypto.subtle.importKey));var n=i,a=function(){function e(t){p(this,e);var r=v(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t)),i=r.load.bind(r);return r.load=function(e,t,r){var a=r.onError;r.onError=function(e,t,r){403===e.code&&(n._errReqCount++,n._errReqCount>2&&n.emitExpireEvent()),a(e,t,r)},i(e,t,r)},r}return m(e,o.default.DefaultConfig.loader),e}();return i.hlsOpts.fLoader=a,i.versionNum>=3?i.hlsjs=i.hlsAlias={}:i.hls=i.hlsAlias={},i.hlsNext(0,"startPlay",t),i.config.checkHlsOffline&&d.default.on(i,"timeupdate",(function(){i.hlsAlias&&i.video&&!i.video.videoHeight?(i.hlsAlias.hlsOfflineCount=void 0===i.hlsAlias.hlsOfflineCount?1:i.hlsAlias.hlsOfflineCount+1,i.hlsAlias.hlsOfflineCount>3&&(i.pause(),i.emit("error",{msg:"OFFLINE",errorCode:-9997}),i.onError())):i.hlsAlias&&(i.hlsAlias.hlsOfflineCount=0)}),"destroy"),i.hlsTimer=new l.default,i.hlsTimer.repeat((function(){t.expireDetectType.indexOf("getUrlTime")>-1&&i.getUrlTime&&i.duration&&(new Date).getTime()/1e3>i.getUrlTime+3300+i.duration&&(i.getUrlTime=0,i.emitExpireEvent()),t.expireDetectType.indexOf("xhrStatus")>-1&&i.hlsAlias&&i.hlsAlias.manifestUrl&&Math.random()<1/7.5&&new f.default({url:i.hlsAlias.manifestUrl,type:"",xhrSetup:t.xhrSetup}).catch((function(e){e&&void 0!==e.status&&(i.hlsAlias.hlsExpireCount=void 0===i.hlsAlias.hlsExpireCount?1:i.hlsAlias.hlsExpireCount+1,i.hlsAlias.hlsExpireCount>3&&(i.hlsAlias.hlsExpireCount=0,i.emitExpireEvent()))})),t.expireDetectType.indexOf("urlExpire")>-1&&i.urlExpireTimestamp&&(new Date).getTime()/1e3>=i.urlExpireTimestamp&&(i.urlExpireTimestamp=u.MAX_TIMESTAMP,i.emitExpireEvent())}),t.checkExpireInterval||400),d.default.on(i,"destroy",(function(){i.hlsTimer&&(i.hlsTimer.clear(),i.hlsTimer=null)}),"destroy"),i}return m(e,a.default),n(e,[{key:"emitExpireEvent",value:function(){var e=(new Date).getTime()/1e3;this.emitExpireTimestamp?e-this.emitExpireTimestamp>u.MIN_EXPIRE_INTERVAL&&(this.emitExpireTimestamp=e,this.emit("MEDIA_EXPIRED")):(this.emitExpireTimestamp=e,this.emit("MEDIA_EXPIRED"))}},{key:"hlsNext",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"NEXT",i=arguments[2],n=this,a=n.config||{};if(n._errReqCount=0,i)for(var o in i)a[o]=i[o];if("startPlay"===r||a.preload||n.unloadSource(),e&&(a.startTime=e),a&&a.startTime&&d.default.once(n,"canplay",(function(){n.currentTime=a.startTime})),n.url=i.url,!i.url||!/\.(mp3|m4a)/.test(i.url)&&!/(mp3|m4a)/.test(i.type))return i.url?("startPlay"!==r&&(a.autoplay?(a.autoplay=!1,n._autoplay=!0):n._autoplay=!1),n.init(),void n.emit("can_start")):void((i.playAuthToken||i.vid)&&("startPlay"!==r&&(a.autoplay?(a.autoplay=!1,this._autoplay=!0):n._autoplay=!1),function(e,t,r,i){s.default.url(e,t).then((function(e){var t=[],i=e.Data||e;i&&i.PlayInfoList&&i.PlayInfoList.length>0?(t=i.PlayInfoList,r({videoList:t,rawData:e})):(console.error("HAS NO VIDEO INFORMATION CORRECTLY, PLEASE CHRECK THE TOKEN."),r({videoList:[],rawData:e}))})).catch((function(e){i&&"function"==typeof i&&i(e)}))}(i.playAuthToken,i.playDomain,(function(r){var s=r.videoList,o=r.rawData;if(n.emit("get_play_info",o),s&&s.length>0&&(s[0].MainPlayUrl||s[0].src)){if(s.sort((function(e,t){return t.Bitrate-e.Bitrate})),s[0].Bitrate){var u=0;s.every((function(e,t){return s[0].Bitrate===e.Bitrate&&(u=t,!0)})),u>0&&s.splice(u)}n.emit("resourceReady",s.sort((function(e,t){return t.Bitrate-e.Bitrate})).map((function(e){return e.MainPlayUrl=i.testUrl||e.MainPlayUrl,{name:e.Definition||"标清",url:e.MainPlayUrl||e.src}}))),s[0].UrlExpire&&(n.urlExpireTimestamp=i.testUrlExpire||s[0].UrlExpire),n.getUrlTime=(new Date).getTime()/1e3,e&&d.default.once(n,"playing",(function(){n.currentTime=e,n.play()}));var l=s[0].MainPlayUrl||s[0].src;n.url=a.url=l;for(var c=0;c<s.length;c++)s[c].Definition.toLocaleLowerCase()===a.defaultDefinition&&(n._curDefinitionIndex=c,l=s[c].MainPlayUrl||s[c].src,n.url=a.url=l);var h=s[0].Format;if(s[0]&&s[0].type&&/(mp3|m4a|mp4)/.test(s[0].type))return void n.emit("can_start");if(h&&"m3u8"!=h&&"hls"!=h)return void n.emit("can_start");t.init(),n.emit("can_start")}else{var f=o||{ResponseMetadata:{Error:{CodeN:0,Message:""},RequestId:""}};n.emit("playInterfaceInfo",{code:f.ResponseMetadata.Error.CodeN,message:f.ResponseMetadata.Error.Message,logid:f.ResponseMetadata.RequestId}),n.emit("error",{msg:"HAS NO VIDEO INFORMATION CORRECTLY, PLEASE CHRECK THE TOKEN.",errorCode:-9998})}}),(function(e){n.emit("error",{msg:e,errorCode:-9999})}))));n.emit("can_start")}},{key:"switchURL",value:function(e){var t=this,r=t.config||{};t.url=e,r.url=e;var n=t.currentTime;_.addClass(t.root,"xgplayer-is-enter"),d.default.once(t,"playing",(function(){_.removeClass(t.root,"xgplayer-is-enter")})),d.default.once(t,"canplay",(function(){t.currentTime=n,t.play()})),"object"===i(t.hlsAlias)&&(t.hlsAlias.originUrl=e,t.hlsAlias.mobile&&"function"==typeof t._start?t._start():t.src=e)}},{key:"init",value:function(){var e=this,t=_,r=this,i=r.config||{},n=r.start;if(this.browser=d.default.getBrowserVersion(),void 0===i.useHls){var a=!1;if(navigator.userAgent.toLocaleLowerCase().indexOf("ipad")>-1?(navigator.userAgent.toLocaleLowerCase().indexOf("mobile")>-1&&"MacIntel"!==navigator.platform&&"Win32"!==navigator.platform||!d.default.checkMediaSourceSupport())&&(a=!0):navigator.userAgent.toLocaleLowerCase().indexOf("mobile")>-1&&"MacIntel"!==navigator.platform&&"Win32"!==navigator.platform&&!d.default.checkMediaSourceSupport()&&(a=!0),a)return r.hlsAlias={originUrl:r.definitionList?r.definitionList[r._curDefinitionIndex||0].url:i.definitionList?i.definitionList[r._curDefinitionIndex||0].url:i.url||"",mobile:!0},r.versionNum>=3?r.hlsjs=r.hlsAlias:r.hls=r.hlsAlias,r._start=function(){r.loadSource(i.url,(function(e){if(e.length)r.root.querySelector("video")&&(r.video.querySelector("source")||r.video.src)?(r.autoplay=i.autoplay=!0,r.src=e):n.call(r,e);else{var t=new FileReader;t.onload=function(){r.root.querySelector("video")&&(r.video.querySelector("source")||r.video.src)?(r.autoplay=i.autoplay=!0,r.src=t.result):n.call(r,t.result)},t.readAsDataURL(e)}}))},i.autoplay=r._autoplay,r._autoplay&&(r.video.autoplay=!0),void r._start();r._start=r.start,r.start=function(){}}else i.useHls||r.loadSource(i.url,(function(e){if(e.length)r.root.querySelector("video")&&(r.video.querySelector("source")||r.video.src)?(r.autoplay=i.autoplay=!0,r.src=e):n.call(r,e);else{var t=new FileReader;t.onload=function(){var e=t.result;r.root.querySelector("video")&&(r.video.querySelector("source")||r.video.src)?(r.autoplay=i.autoplay=!0,r.src=e):n.call(r,e)},t.readAsDataURL(e)}}));if(r.root.querySelector("video")&&(r.video.querySelector("source")||r.video.src))r.src=i.url;else{var s=void 0;s=new o.default(this.hlsOpts),this.hlsAlias=s,r.versionNum>=3?r.hlsjs=r.hlsAlias:r.hls=r.hlsAlias,this.hlsAlias.originUrl=i.url||"",Object.defineProperty(r,"src",{get:function(){return r.currentSrc},set:function(e){i.url=e,t.removeClass(r.root,"xgplayer-is-live");var n=document.querySelector(".xgplayer-live");n&&n.parentNode.removeChild(n),r.autoplay=!0,r.paused||r.pause(),r.hlsAlias.stopLoad(),r.hlsAlias.detachMedia(),r.hlsAlias.destroy(),r.hlsAlias=new o.default(r.hlsOpts),r.hlsAlias.originUrl=i.url||"",r.versionNum>=3?r.hlsjs=r.hlsAlias:r.hls=r.hlsAlias,r.register(),r._autoplay?(r.video.setAttribute("autoplay",!0),r._autoplay&&d.default.once(r,"canplay",(function(){r.play().catch((function(e){}))}))):r.video.removeAttribute("autoplay"),r.hlsAlias.attachMedia(r.video)},configurable:!0}),this.hasStart=!0,this.register(),d.default.once(this,"complete",(function(){(e.config.autoplay||e._autoplay)&&d.default.once(r,"canplay",(function(){r.play().catch((function(e){}))}));var t=(0,c.getMediaSource)(),n=(0,c.getSourceBuffer)();if(n||t){var a=[];n&&a.push(n),t&&a.push(t),(0,h.isNativeFunc)(a)?s.attachMedia(r.video):r.emit("error",{msg:"MediaSource or SourceBuffer hijack",errorCode:-9995})}if(i.isLive){_.addClass(r.root,"xgplayer-is-live");var o=_.createDom("xg-live","LIVE",{},"xgplayer-live");r.controls.appendChild(o)}})),this.config.autoplay=this._autoplay,this.root.insertBefore(this.video,this.root.firstChild),this.emit("complete"),d.default.once(this,"destroy",(function(){s.stopLoad()}))}}},{key:"updateM3U8",value:function(e,t,r){var i=this.config||{},n=this.hlsAlias;"TOP"!==i.getKeyType&&(e=window.atob(e));var a=void 0;try{a=new Blob([e],{type:"text/html"})}catch(t){window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder,(a=new BlobBuilder).append(e),a=a.getBlob()}var s=URL.createObjectURL(a);t=t.replace(/,URI="([^"]+)"/,',URI="'+s+'"');var o=d.default.isRelativeURL(this.url)?d.default.getAbsoluteURL(this.url):this.url,u=o.match(/((http|https):?\/\/.+)\/\w+\.\w+/)||[],l=o&&u.length>1?u[1]+"/":"";t=t.replace(/(#EXTINF:)(\d+\.?\d*)(?:,(?:[^\r|\n]*)(?:\r|\n)*)(.*(?!#))/g,(function(e,t,r,i){return/(http|https)?\:?\/\//.test(i)?t+r+",\n"+i:t+r+",\n"+l+i}));var c=void 0;try{c=new Blob([t],{type:"application/x-mpegURL"})}catch(e){window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder,(c=new BlobBuilder).append(t),c=c.getBlob()}var h=URL.createObjectURL(c);n&&(!0===n.mobile?(i.url=h,r&&r(c)):(n.loadSource(h),r&&r(c)))}},{key:"loadSource",value:function e(t,r){return function(e,t,r){function i(e,t){var r=parseInt(e.slice(t,t+2),16);return r>>>7==0?[1,r]:r>>>6==2?(r=(63&r)<<8,[2,r+=parseInt(e.slice(t+2,t+4),16)]):(r=(63&r)<<16,[3,r+=parseInt(e.slice(t+2,t+6),16)])}var n,a=0,s=[],o=[],u=parseInt(e.slice(0,8),16),d=parseInt(e.slice(8,16),16);if(1213091658!==u||1077891651!==d)throw new Error("mhe");if(0!==parseInt(e.slice(16,18),16))throw new Error("ve");for(n=0;n<4;++n)a+=(3&parseInt(e.slice(24+2*n,26+2*n),16))<<2*n;var l=parseInt(e.slice(32,40),16),c=2*parseInt(e.slice(48,56),16);for(n=56;n<c+56;n+=2)s.push(parseInt(e.slice(n,n+2),16));var h=c+56,f=parseInt(e.slice(h,h+4),16);for(h+=4,n=0;n<f;++n){var A=i(e,h);h+=2*A[0];for(var p="",v=0;v<A[1];++v){var m=i(e,h);p+=String.fromCharCode(a^m[1]),h+=2*m[0]}o.push(p)}return t.p=null,function e(t,r,i,n,a){var u,d,l,c,h,f=-1,A=[],p=[0,null],v=null,m=[r];for(d=Math.min(r.length,i),l=0;l<d;++l)m.push(r[l]);m.p=n;for(var g=[];;)try{var y=s[t++];if(y<38)if(y<14)y<5?y<3?A[++f]=0===y||null:3===y?(u=s[t++],A[++f]=u<<24>>24):(u=(s[t]<<8)+s[t+1],t+=2,A[++f]=u<<16>>16):y<8?5===y?(u=((u=((u=s[t++])<<8)+s[t++])<<8)+s[t++],A[++f]=(u<<8)+s[t++]):(u=(s[t]<<8)+s[t+1],t+=2,A[++f]=o[u]):A[++f]=y<11?void 0:11===y?a:{};else if(y<20)if(y<18)if(14===y)u=(s[t]<<8)+s[t+1],t+=2,d=o[u],l=A[f--],A[f][d]=l;else{for(d=s[t++],l=s[t++],c=m;d>0;--d)c=c.p;A[++f]=c[l]}else 18===y?(u=(s[t]<<8)+s[t+1],t+=2,d=o[u],A[f]=A[f][d]):(d=A[f--],A[f]=A[f][d]);else if(y<24)if(20===y){for(d=s[t++],l=s[t++],c=m;d>0;--d)c=c.p;c[l]=A[f--]}else u=(s[t]<<8)+s[t+1],t+=2,d=o[u],l=A[f--],c=A[f--],l[d]=c;else y<29?(d=A[f--],A[f]+=d):29===y?A[f]=-A[f]:(d=A[f--],A[f]=A[f]===d);else if(y<62)y<55?y<51?38===y?(d=A[f--],A[f]=A[f]!==d):A[f]=!A[f]:51===y?(u=(u=(s[t]<<8)+s[t+1])<<16>>16,t+=2,A[f]?--f:t+=u):(u=(u=(s[t]<<8)+s[t+1])<<16>>16,t+=2,A[f]?t+=u:--f):y<59?55===y?(d=A[f--],A[f]=A[f]instanceof d):A[f]=void 0:y<60?(u=s[t++],d=A[f--],(l=function e(){var t=e._v;return(0,e._u)(t[0],arguments,t[1],t[2],this)})._v=[d,u,m],l._u=e,A[++f]=l):60===y?(u=s[t++],d=A[f--],(c=[l=function e(){var t=e._v;return(0,e._u)(t[0],arguments,t[1],t[2],this)}]).p=m,l._v=[d,u,c],l._u=e,A[++f]=l):(u=(u=(s[t]<<8)+s[t+1])<<16>>16,t+=2,(d=g[g.length-1])[1]=t+u);else if(y<68)if(y<66)if(62===y)u=(u=(s[t]<<8)+s[t+1])<<16>>16,t+=2,(d=g[g.length-1])&&!d[1]?(d[0]=3,d.push(t)):g.push([1,0,t]),t+=u;else if(l=(d=g.pop())[0],c=p[0],1===l)t=d[1];else if(0===l)if(0===c)t=d[1];else{if(1!==c)throw p[1];if(!v)return p[1];t=v[1],a=v[2],m=v[3],g=v[4],A[++f]=p[1],p=[0,null],v=v[0]}else t=d[2],d[0]=0,g.push(d);else if(66===y){for(d=A[f--],l=null;c=g.pop();)if(2===c[0]||3===c[0]){l=c;break}if(l)p=[1,d],t=l[2],l[0]=0,g.push(l);else{if(!v)return d;t=v[1],a=v[2],m=v[3],g=v[4],A[++f]=d,p=[0,null],v=v[0]}}else f-=u=s[t++],l=A.slice(f+1,f+u+1),d=A[f--],c=A[f--],d._u===e?(d=d._v,v=[v,t,a,m,g],t=d[0],null==c&&(c=function(){return this}()),a=c,(m=[l].concat(l)).length=Math.min(d[1],u)+1,m.p=d[2],g=[]):A[++f]=d.apply(c,l);else if(y<71)if(68===y){for(u=s[t++],c=[void 0],h=u;h>0;--h)c[h]=A[f--];l=A[f--],d=Function.bind.apply(l,c),A[++f]=new d}else t+=2+(u=(u=(s[t]<<8)+s[t+1])<<16>>16);else y<73?(u=(u=(s[t]<<8)+s[t+1])<<16>>16,t+=2,(d=A[f--])||(t+=u)):73===y?--f:(d=A[f],A[++f]=d)}catch(e){for(p=[0,null];(u=g.pop())&&!u[0];);if(!u){e:for(;v;){for(d=v[4];u=d.pop();)if(u[0])break e;v=v[0]}if(!v)throw e;t=v[1],a=v[2],m=v[3],g=v[4],v=v[0]}1===(d=u[0])?(t=u[2],u[0]=0,g.push(u),A[++f]=e):2===d?(t=u[2],u[0]=0,g.push(u),p=[3,e]):(t=u[3],u[0]=2,g.push(u),A[++f]=e)}}(l,[],0,t,r)}("484e4f4a403f52430022283155de60610000036dd65f7cec000003c91100011200091400021100024a12000a11020c07000b440143014700da1100024a12000a11020c07000c440143010301131400031102021200034a12000d110003430114000411000433000611000412000e47009111010212000f070010254700591102021200034a12001111010212001243014700121102034a12001311010212001243014500061101021200121400050700141101021200153400030700041807001618110005180700171811000412000e1814000345002b1101021200183400030700040700191811000412000e1807001a18110102120012340003070004181400030d1100030e001b1100020e001c4245004a11010347004411010312001d002547001611020b33000c0211020b1101021200064301494500231101034a12001e11010212000643014911020b33000c0211020b11010212000643014908421100013234000711000112001b32470002084211000112001b14000211000112001c14000305000002203c0114000411010212001233001c11010212000f0700102547000911010212001545000611010212001847006511010112002d07002e264700261102011200030d1100020e000607002f0e000544014a120008050000033b3b0143014945002f11020844001400051100054a1200300700311100024302491100054a12003243004905000003473b0011000515003445001f1101021200354700161101014a12002c11010212003511000311020b43034908420300381400023e00571400091103014a12001f0700200d070021110009180e002204270c1d0e00234302490d1104021200034a120011110001120009430147000911000112000945000f1104034a12002411000112000943010e0025140002413d00a01104044a120026110001120009430114000211030212000f0700102547001211000212002712002811000215002545006e110303110405120003373247004b11000212002514000302110406110003430114000411000412002914000511000412002a14000611000412002b1400070211040711000511000611000743031400081100081100021500251104034a1200241100021200254301110002150025411103014a12002c11000212002511020311040b43034908420211010411000143014908421101051200330400c82534000a1101051200330400ce2547000a0211010411010543014908420b1400011100011200003400010d1400020b12000114000311010a1100031500021101011200030d0700040e000511010a0e00061100021200070e000744014a12000805000000003b0143014a12000805000001433b0143014908420036062a26272f202e0821253a082520283a0b242827202f2c3a3d1c3b25072d2c2f283c253d00043d30392c033c3b250831213b1a2c3d3c39043d212c270c3b2c3a3926273a2c1d2c313d0524283d2a21156a0c111d641164020c107361153e6274153e6260620e651c1b00746b6112176b1462606b0839283b3a2c1c3b250228220a2e2c3d022c301d30392c031d061908203a0b283a2c7f7d08222c301d26222c2704283d262b0266660a392528300d26242820270176126f1a263c3b2a2c7423283b3f203a6f08227409222c300d26242820272266222d3a66283920663f7a66222c303a763a263c3b2a2c7423283b3f203a6f282274076f3d26222c277406222c301c3b25032a3d310624262b20252c0a2526282d1a263c3b2a2c042c24203d052c3b3b263b153a2c2a3b2c3d022c306939283b3a2c692c3b3b263b03243a2e092c3b3b263b0a262d2c042b3d2628042d283d280539283b3a2c061b2c3a3c253d091a2c2a3b2c3d022c30072c272a0d283d2803222c3002203f0a3c392d283d2c047a1c71072b3b263e3a2c3b05000c697878043d2c313d0426392c27032e2c3d043a2c272d063a3d283d3c3a0626272526282d08222c301f28253c2c",{get 0(){return e},get 1(){return f},get 2(){return d},get 3(){return window},4:JSON,get 5(){return o},get 6(){return y},get 7(){return b},get 8(){return XMLHttpRequest},9:arguments,10:t,11:r,12:RegExp},this)}},{key:"unloadSource",value:function(){this.hlsAlias instanceof o.default&&this.hls.detachMedia(),this.video&&(this.video.removeAttribute("src"),this.video.load())}},{key:"register",value:function(){var e=this.hlsAlias,t=_,r=this,i=r.config||{};r.once("playing",(function(){var e=!1,t=r.video.querySelector("track");t&&("hidden"===t.track.mode&&(e=!0),t.track.mode="hidden",r.video.removeChild(t)),i.textTrack&&i.textTrack.length>0&&i.textTrack.some((function(t){if(t.src&&t.label&&t.default){var i=document.createElement("track");return i.src=t.src,i.kind=t.kind,i.label=t.label,i.srclang=t.srclang,i.default=!0,r.video.appendChild(i),e&&(i.track.mode="hidden"),!0}}))})),e.once(o.default.Events.MEDIA_ATTACHED,(function(){r.loadSource(i.url)})),e.on(o.default.Events.LEVEL_LOADED,(function(i,n){if(!e.inited&&(e.inited=!0,n&&n.details&&n.details.live)){t.addClass(r.root,"xgplayer-is-live");var a=t.createDom("xg-live","LIVE",{},"xgplayer-live");r.controls.appendChild(a)}})),e.on(o.default.Events.ERROR,(function(e,t){t.fatal&&r.emit("error",t)}))}},{key:"versionNum",get:function(){return this.version&&this.version[0]&&parseInt(this.version[0])}}]),e}();E.isSupported=function(e){e=e||navigator.userAgent.toLocaleLowerCase();var t=/(iphone)/.test(e)||/(ipad)/.test(e),r=/(android)/.test(e),i=/(windows phone)/.test(e),n=!(t||r||i),a=/(xiaomi)/.test(e),s=/(quark)/.test(e);return!(a||(n||r?!window.MediaSource||!window.MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E, mp4a.40.2"'):!t||s||e.indexOf("iphone os 11_4")>-1||e.indexOf("iphone os 11_2")>-1))},E.HlsJs=o.default,t.default=E,e.exports=t.default},function(e,t){e.exports=i},function(e,t){e.exports=function(e){var t={};function r(i){if(t[i])return t[i].exports;var n=t[i]={i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=e,r.c=t,r.d=function(e,t,i){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(i,n,function(t){return e[t]}.bind(null,n));return i},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=22)}([function(e,t,r){"use strict";var i=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=i)},function(e,t,r){"use strict";var i=r(12)("wks"),n=r(13),a=r(0).Symbol,s="function"==typeof a;(e.exports=function(e){return i[e]||(i[e]=s&&a[e]||(s?a:n)("Symbol."+e))}).store=i},function(e,t,r){"use strict";var i=e.exports={version:"2.6.12"};"number"==typeof __e&&(__e=i)},function(e,t,r){"use strict";var i=r(4);e.exports=function(e){if(!i(e))throw TypeError(e+" is not an object!");return e}},function(e,t,r){"use strict";var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};e.exports=function(e){return"object"===(void 0===e?"undefined":i(e))?null!==e:"function"==typeof e}},function(e,t,r){"use strict";var i=r(6);e.exports=function(e,t,r){if(i(e),void 0===t)return e;switch(r){case 1:return function(r){return e.call(t,r)};case 2:return function(r,i){return e.call(t,r,i)};case 3:return function(r,i,n){return e.call(t,r,i,n)}}return function(){return e.apply(t,arguments)}}},function(e,t,r){"use strict";e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},function(e,t,r){"use strict";e.exports=!r(15)((function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}))},function(e,t,r){"use strict";var i={}.toString;e.exports=function(e){return i.call(e).slice(8,-1)}},function(e,t,r){"use strict";var i=r(3),n=r(26),a=r(27),s=Object.defineProperty;t.f=r(7)?Object.defineProperty:function(e,t,r){if(i(e),t=a(t,!0),i(r),n)try{return s(e,t,r)}catch(e){}if("get"in r||"set"in r)throw TypeError("Accessors not supported!");return"value"in r&&(e[t]=r.value),e}},function(e,t,r){"use strict";e.exports=!1},function(e,t,r){"use strict";var i=r(8),n=r(1)("toStringTag"),a="Arguments"==i(function(){return arguments}());e.exports=function(e){var t,r,s;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),n))?r:a?i(t):"Object"==(s=i(t))&&"function"==typeof t.callee?"Arguments":s}},function(e,t,r){"use strict";var i=r(2),n=r(0),a=n["__core-js_shared__"]||(n["__core-js_shared__"]={});(e.exports=function(e,t){return a[e]||(a[e]=void 0!==t?t:{})})("versions",[]).push({version:i.version,mode:r(10)?"pure":"global",copyright:"© 2020 Denis Pushkarev (zloirock.ru)"})},function(e,t,r){"use strict";var i=0,n=Math.random();e.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++i+n).toString(36))}},function(e,t,r){"use strict";var i=r(9),n=r(28);e.exports=r(7)?function(e,t,r){return i.f(e,t,n(1,r))}:function(e,t,r){return e[t]=r,e}},function(e,t,r){"use strict";e.exports=function(e){try{return!!e()}catch(e){return!0}}},function(e,t,r){"use strict";var i=r(4),n=r(0).document,a=i(n)&&i(n.createElement);e.exports=function(e){return a?n.createElement(e):{}}},function(e,t,r){"use strict";var i=r(0),n=r(14),a=r(18),s=r(13)("src"),o=r(29),u=(""+o).split("toString");r(2).inspectSource=function(e){return o.call(e)},(e.exports=function(e,t,r,o){var d="function"==typeof r;d&&(a(r,"name")||n(r,"name",t)),e[t]!==r&&(d&&(a(r,s)||n(r,s,e[t]?""+e[t]:u.join(String(t)))),e===i?e[t]=r:o?e[t]?e[t]=r:n(e,t,r):(delete e[t],n(e,t,r)))})(Function.prototype,"toString",(function(){return"function"==typeof this&&this[s]||o.call(this)}))},function(e,t,r){"use strict";var i={}.hasOwnProperty;e.exports=function(e,t){return i.call(e,t)}},function(e,t,r){"use strict";e.exports={}},function(e,t,r){"use strict";var i,n,a,s=r(5),o=r(38),u=r(39),d=r(16),l=r(0),c=l.process,h=l.setImmediate,f=l.clearImmediate,A=l.MessageChannel,p=l.Dispatch,v=0,m={},g=function(){var e=+this;if(m.hasOwnProperty(e)){var t=m[e];delete m[e],t()}},y=function(e){g.call(e.data)};h&&f||(h=function(e){for(var t=[],r=1;arguments.length>r;)t.push(arguments[r++]);return m[++v]=function(){o("function"==typeof e?e:Function(e),t)},i(v),v},f=function(e){delete m[e]},"process"==r(8)(c)?i=function(e){c.nextTick(s(g,e,1))}:p&&p.now?i=function(e){p.now(s(g,e,1))}:A?(a=(n=new A).port2,n.port1.onmessage=y,i=s(a.postMessage,a,1)):l.addEventListener&&"function"==typeof postMessage&&!l.importScripts?(i=function(e){l.postMessage(e+"","*")},l.addEventListener("message",y,!1)):i="onreadystatechange"in d("script")?function(e){u.appendChild(d("script")).onreadystatechange=function(){u.removeChild(this),g.call(e)}}:function(e){setTimeout(s(g,e,1),0)}),e.exports={set:h,clear:f}},function(e,t,r){"use strict";var i=r(6);function n(e){var t,r;this.promise=new e((function(e,i){if(void 0!==t||void 0!==r)throw TypeError("Bad Promise constructor");t=e,r=i})),this.resolve=i(t),this.reject=i(r)}e.exports.f=function(e){return new n(e)}},function(e,t,r){e.exports=r(23)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r(24);var i,n=(i=r(48))&&i.__esModule?i:{default:i};t.default={url:n.default},e.exports=t.default},function(e,t,r){"use strict";var i,n,a,s,o=r(10),u=r(0),d=r(5),l=r(11),c=r(25),h=r(4),f=r(6),A=r(30),p=r(31),v=r(37),m=r(20).set,g=r(40)(),y=r(21),b=r(41),_=r(42),E=r(43),T=u.TypeError,k=u.process,S=k&&k.versions,D=S&&S.v8||"",R=u.Promise,L="process"==l(k),C=function(){},w=n=y.f,I=!!function(){try{var e=R.resolve(1),t=(e.constructor={})[r(1)("species")]=function(e){e(C,C)};return(L||"function"==typeof PromiseRejectionEvent)&&e.then(C)instanceof t&&0!==D.indexOf("6.6")&&-1===_.indexOf("Chrome/66")}catch(e){}}(),x=function(e){var t;return!(!h(e)||"function"!=typeof(t=e.then))&&t},P=function(e,t){if(!e._n){e._n=!0;var r=e._c;g((function(){for(var i=e._v,n=1==e._s,a=0,s=function(t){var r,a,s,o=n?t.ok:t.fail,u=t.resolve,d=t.reject,l=t.domain;try{o?(n||(2==e._h&&M(e),e._h=1),!0===o?r=i:(l&&l.enter(),r=o(i),l&&(l.exit(),s=!0)),r===t.promise?d(T("Promise-chain cycle")):(a=x(r))?a.call(r,u,d):u(r)):d(i)}catch(e){l&&!s&&l.exit(),d(e)}};r.length>a;)s(r[a++]);e._c=[],e._n=!1,t&&!e._h&&F(e)}))}},F=function(e){m.call(u,(function(){var t,r,i,n=e._v,a=O(e);if(a&&(t=b((function(){L?k.emit("unhandledRejection",n,e):(r=u.onunhandledrejection)?r({promise:e,reason:n}):(i=u.console)&&i.error&&i.error("Unhandled promise rejection",n)})),e._h=L||O(e)?2:1),e._a=void 0,a&&t.e)throw t.v}))},O=function(e){return 1!==e._h&&0===(e._a||e._c).length},M=function(e){m.call(u,(function(){var t;L?k.emit("rejectionHandled",e):(t=u.onrejectionhandled)&&t({promise:e,reason:e._v})}))},B=function(e){var t=this;t._d||(t._d=!0,(t=t._w||t)._v=e,t._s=2,t._a||(t._a=t._c.slice()),P(t,!0))},G=function e(t){var r,i=this;if(!i._d){i._d=!0,i=i._w||i;try{if(i===t)throw T("Promise can't be resolved itself");(r=x(t))?g((function(){var n={_w:i,_d:!1};try{r.call(t,d(e,n,1),d(B,n,1))}catch(e){B.call(n,e)}})):(i._v=t,i._s=1,P(i,!1))}catch(e){B.call({_w:i,_d:!1},e)}}};I||(R=function(e){A(this,R,"Promise","_h"),f(e),i.call(this);try{e(d(G,this,1),d(B,this,1))}catch(e){B.call(this,e)}},(i=function(e){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=r(44)(R.prototype,{then:function(e,t){var r=w(v(this,R));return r.ok="function"!=typeof e||e,r.fail="function"==typeof t&&t,r.domain=L?k.domain:void 0,this._c.push(r),this._a&&this._a.push(r),this._s&&P(this,!1),r.promise},catch:function(e){return this.then(void 0,e)}}),a=function(){var e=new i;this.promise=e,this.resolve=d(G,e,1),this.reject=d(B,e,1)},y.f=w=function(e){return e===R||e===s?new a(e):n(e)}),c(c.G+c.W+c.F*!I,{Promise:R}),r(45)(R,"Promise"),r(46)("Promise"),s=r(2).Promise,c(c.S+c.F*!I,"Promise",{reject:function(e){var t=w(this);return(0,t.reject)(e),t.promise}}),c(c.S+c.F*(o||!I),"Promise",{resolve:function(e){return E(o&&this===s?R:this,e)}}),c(c.S+c.F*!(I&&r(47)((function(e){R.all(e).catch(C)}))),"Promise",{all:function(e){var t=this,r=w(t),i=r.resolve,n=r.reject,a=b((function(){var r=[],a=0,s=1;p(e,!1,(function(e){var o=a++,u=!1;r.push(void 0),s++,t.resolve(e).then((function(e){u||(u=!0,r[o]=e,--s||i(r))}),n)})),--s||i(r)}));return a.e&&n(a.v),r.promise},race:function(e){var t=this,r=w(t),i=r.reject,n=b((function(){p(e,!1,(function(e){t.resolve(e).then(r.resolve,i)}))}));return n.e&&i(n.v),r.promise}})},function(e,t,r){"use strict";var i=r(0),n=r(2),a=r(14),s=r(17),o=r(5),u=function e(t,r,u){var d,l,c,h,f=t&e.F,A=t&e.G,p=t&e.P,v=t&e.B,m=A?i:t&e.S?i[r]||(i[r]={}):(i[r]||{}).prototype,g=A?n:n[r]||(n[r]={}),y=g.prototype||(g.prototype={});for(d in A&&(u=r),u)c=((l=!f&&m&&void 0!==m[d])?m:u)[d],h=v&&l?o(c,i):p&&"function"==typeof c?o(Function.call,c):c,m&&s(m,d,c,t&e.U),g[d]!=c&&a(g,d,h),p&&y[d]!=c&&(y[d]=c)};i.core=n,u.F=1,u.G=2,u.S=4,u.P=8,u.B=16,u.W=32,u.U=64,u.R=128,e.exports=u},function(e,t,r){"use strict";e.exports=!r(7)&&!r(15)((function(){return 7!=Object.defineProperty(r(16)("div"),"a",{get:function(){return 7}}).a}))},function(e,t,r){"use strict";var i=r(4);e.exports=function(e,t){if(!i(e))return e;var r,n;if(t&&"function"==typeof(r=e.toString)&&!i(n=r.call(e)))return n;if("function"==typeof(r=e.valueOf)&&!i(n=r.call(e)))return n;if(!t&&"function"==typeof(r=e.toString)&&!i(n=r.call(e)))return n;throw TypeError("Can't convert object to primitive value")}},function(e,t,r){"use strict";e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t,r){"use strict";e.exports=r(12)("native-function-to-string",Function.toString)},function(e,t,r){"use strict";e.exports=function(e,t,r,i){if(!(e instanceof t)||void 0!==i&&i in e)throw TypeError(r+": incorrect invocation!");return e}},function(e,t,r){"use strict";var i=r(5),n=r(32),a=r(33),s=r(3),o=r(34),u=r(36),d={},l={},c=e.exports=function(e,t,r,c,h){var f,A,p,v,m=h?function(){return e}:u(e),g=i(r,c,t?2:1),y=0;if("function"!=typeof m)throw TypeError(e+" is not iterable!");if(a(m)){for(f=o(e.length);f>y;y++)if((v=t?g(s(A=e[y])[0],A[1]):g(e[y]))===d||v===l)return v}else for(p=m.call(e);!(A=p.next()).done;)if((v=n(p,g,A.value,t))===d||v===l)return v};c.BREAK=d,c.RETURN=l},function(e,t,r){"use strict";var i=r(3);e.exports=function(e,t,r,n){try{return n?t(i(r)[0],r[1]):t(r)}catch(t){var a=e.return;throw void 0!==a&&i(a.call(e)),t}}},function(e,t,r){"use strict";var i=r(19),n=r(1)("iterator"),a=Array.prototype;e.exports=function(e){return void 0!==e&&(i.Array===e||a[n]===e)}},function(e,t,r){"use strict";var i=r(35),n=Math.min;e.exports=function(e){return e>0?n(i(e),9007199254740991):0}},function(e,t,r){"use strict";var i=Math.ceil,n=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?n:i)(e)}},function(e,t,r){"use strict";var i=r(11),n=r(1)("iterator"),a=r(19);e.exports=r(2).getIteratorMethod=function(e){if(null!=e)return e[n]||e["@@iterator"]||a[i(e)]}},function(e,t,r){"use strict";var i=r(3),n=r(6),a=r(1)("species");e.exports=function(e,t){var r,s=i(e).constructor;return void 0===s||null==(r=i(s)[a])?t:n(r)}},function(e,t,r){"use strict";e.exports=function(e,t,r){var i=void 0===r;switch(t.length){case 0:return i?e():e.call(r);case 1:return i?e(t[0]):e.call(r,t[0]);case 2:return i?e(t[0],t[1]):e.call(r,t[0],t[1]);case 3:return i?e(t[0],t[1],t[2]):e.call(r,t[0],t[1],t[2]);case 4:return i?e(t[0],t[1],t[2],t[3]):e.call(r,t[0],t[1],t[2],t[3])}return e.apply(r,t)}},function(e,t,r){"use strict";var i=r(0).document;e.exports=i&&i.documentElement},function(e,t,r){"use strict";var i=r(0),n=r(20).set,a=i.MutationObserver||i.WebKitMutationObserver,s=i.process,o=i.Promise,u="process"==r(8)(s);e.exports=function(){var e,t,r,d=function(){var i,n;for(u&&(i=s.domain)&&i.exit();e;){n=e.fn,e=e.next;try{n()}catch(i){throw e?r():t=void 0,i}}t=void 0,i&&i.enter()};if(u)r=function(){s.nextTick(d)};else if(!a||i.navigator&&i.navigator.standalone)if(o&&o.resolve){var l=o.resolve(void 0);r=function(){l.then(d)}}else r=function(){n.call(i,d)};else{var c=!0,h=document.createTextNode("");new a(d).observe(h,{characterData:!0}),r=function(){h.data=c=!c}}return function(i){var n={fn:i,next:void 0};t&&(t.next=n),e||(e=n,r()),t=n}}},function(e,t,r){"use strict";e.exports=function(e){try{return{e:!1,v:e()}}catch(e){return{e:!0,v:e}}}},function(e,t,r){"use strict";var i=r(0).navigator;e.exports=i&&i.userAgent||""},function(e,t,r){"use strict";var i=r(3),n=r(4),a=r(21);e.exports=function(e,t){if(i(e),n(t)&&t.constructor===e)return t;var r=a.f(e);return(0,r.resolve)(t),r.promise}},function(e,t,r){"use strict";var i=r(17);e.exports=function(e,t,r){for(var n in t)i(e,n,t[n],r);return e}},function(e,t,r){"use strict";var i=r(9).f,n=r(18),a=r(1)("toStringTag");e.exports=function(e,t,r){e&&!n(e=r?e:e.prototype,a)&&i(e,a,{configurable:!0,value:t})}},function(e,t,r){"use strict";var i=r(0),n=r(9),a=r(7),s=r(1)("species");e.exports=function(e){var t=i[e];a&&t&&!t[s]&&n.f(t,s,{configurable:!0,get:function(){return this}})}},function(e,t,r){"use strict";var i=r(1)("iterator"),n=!1;try{var a=[7][i]();a.return=function(){n=!0},Array.from(a,(function(){throw 2}))}catch(e){}e.exports=function(e,t){if(!t&&!n)return!1;var r=!1;try{var a=[7],s=a[i]();s.next=function(){return{done:r=!0}},a[i]=function(){return s},e(a)}catch(e){}return r}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};t.default=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(t&&e){try{e=JSON.parse(n.default.base64decode(e))}catch(e){return Promise.reject("base64 decode error")}var s=[];for(var o in r)s.push(o+"="+r[o]);var u="//"+t+"?"+e.GetPlayInfoToken+"&ssl=true";return s.length>0&&(u+="&"+s.join("&")),new a.default({type:"json",method:"GET",url:u}).then((function(e){return e&&e.response?"string"==typeof e.response?JSON.parse(e.response).Result:"object"===i(e.response)?e.response.Result:e.response:e}))}return Promise.reject("vid, host and token can't be empty")};var n=s(r(49)),a=s(r(50));function s(e){return e&&e.__esModule?e:{default:e}}e.exports=t.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i={base64decode:function(e){var t,r,i,n,a,s,o,u=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1];for(s=e.length,a=0,o="";a<s;){do{t=u[255&e.charCodeAt(a++)]}while(a<s&&-1===t);if(-1===t)break;do{r=u[255&e.charCodeAt(a++)]}while(a<s&&-1===r);if(-1===r)break;o+=String.fromCharCode(t<<2|(48&r)>>4);do{if(61==(i=255&e.charCodeAt(a++)))return o;i=u[i]}while(a<s&&-1===i);if(-1===i)break;o+=String.fromCharCode((15&r)<<4|(60&i)>>2);do{if(61==(n=255&e.charCodeAt(a++)))return o;n=u[n]}while(a<s&&-1===n);if(-1===n)break;o+=String.fromCharCode((3&i)<<6|n)}return o}};t.default=i,e.exports=t.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.url,i=t.method,n=void 0===i?"GET":i,a=(t.type,t.data),s=void 0===a?{}:a,o=t.headers,u=void 0===o?{}:o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),new Promise((function(e,t){var i=new window.XMLHttpRequest,a=n.toUpperCase(),o=[];for(var d in s)o.push(d+"="+s[d]);if("GET"!==a)throw new Error("xhr "+a+" is not supported");for(var l in i.open(a,""+r,!0),i.responseType="",u)i.setRequestHeader(l,""+u[l]);i.send(),i.onload=function(){200===i.status||206===i.status?e(i):t(i)},i.onerror=function(){t(i)}}))},e.exports=t.default}])},function(e,t,r){var i;"undefined"!=typeof window&&(i=function(){return function(e){var t={};function r(i){if(t[i])return t[i].exports;var n=t[i]={i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=e,r.c=t,r.d=function(e,t,i){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(i,n,function(t){return e[t]}.bind(null,n));return i},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/dist/",r(r.s="./src/hls-wrapper.ts")}({"../crypt/dist/jsvmp.js":function(e,t){!function(e,t,r){function i(e,t){var r=parseInt(e.slice(t,t+2),16);return r>>>7==0?[1,r]:r>>>6==2?(r=(63&r)<<8,[2,r+=parseInt(e.slice(t+2,t+4),16)]):(r=(63&r)<<16,[3,r+=parseInt(e.slice(t+2,t+6),16)])}var n,a=0,s=[],o=[],u=parseInt(e.slice(0,8),16),d=parseInt(e.slice(8,16),16);if(1213091658!==u||1077891651!==d)throw new Error("mhe");if(0!==parseInt(e.slice(16,18),16))throw new Error("ve");for(n=0;n<4;++n)a+=(3&parseInt(e.slice(24+2*n,26+2*n),16))<<2*n;var l=parseInt(e.slice(32,40),16),c=2*parseInt(e.slice(48,56),16);for(n=56;n<c+56;n+=2)s.push(parseInt(e.slice(n,n+2),16));var h=c+56,f=parseInt(e.slice(h,h+4),16);for(h+=4,n=0;n<f;++n){var A=i(e,h);h+=2*A[0];for(var p="",v=0;v<A[1];++v){var m=i(e,h);p+=String.fromCharCode(a^m[1]),h+=2*m[0]}o.push(p)}t.p=null,function e(t,r,i,n,a){var u,d,l,c,h,f=-1,A=[],p=[0,null],v=null,m=[r];for(d=Math.min(r.length,i),l=0;l<d;++l)m.push(r[l]);m.p=n;for(var g=[];;)try{var y=s[t++];if(y<39)if(y<19)if(y<7)y<3?A[++f]=y<1||1!==y&&null:y<5?3===y?(u=s[t++],A[++f]=u<<24>>24):(u=(s[t]<<8)+s[t+1],t+=2,A[++f]=u<<16>>16):5===y?(u=((u=((u=s[t++])<<8)+s[t++])<<8)+s[t++],A[++f]=(u<<8)+s[t++]):(u=(s[t]<<8)+s[t+1],t+=2,A[++f]=+o[u]);else if(y<13)y<11?7===y?(u=(s[t]<<8)+s[t+1],t+=2,A[++f]=o[u]):A[++f]=void 0:11===y?A[++f]=a:(u=(s[t]<<8)+s[t+1],t+=2,f=f-u+1,d=A.slice(f,f+u),A[f]=d);else if(y<17)13===y?A[++f]={}:(u=(s[t]<<8)+s[t+1],t+=2,d=o[u],l=A[f--],A[f][d]=l);else if(17===y){for(d=s[t++],l=s[t++],c=m;d>0;--d)c=c.p;A[++f]=c[l]}else u=(s[t]<<8)+s[t+1],t+=2,d=o[u],A[f]=A[f][d];else if(y<26)if(y<22)if(y<20)d=A[f--],A[f]=A[f][d];else if(20===y){for(d=s[t++],l=s[t++],c=m;d>0;--d)c=c.p;c[l]=A[f--]}else u=(s[t]<<8)+s[t+1],t+=2,d=o[u],l=A[f--],c=A[f--],l[d]=c;else if(y<24)if(22===y)d=A[f--],l=A[f--],c=A[f--],l[d]=c;else{for(d=s[t++],l=s[t++],c=m,c=m;d>0;--d)c=c.p;A[++f]=c,A[++f]=l}else 24===y?(d=A[f--],A[f]+=d):(d=A[f--],A[f]-=d);else y<33?y<28?26===y?(d=A[f--],A[f]*=d):(d=A[f--],A[f]/=d):28===y?(d=A[f--],A[f]%=d):A[f]=-A[f]:y<37?33===y?(d=A[f--],l=A[f--],A[++f]=l[d]++):(d=A[f--],A[f]=A[f]==d):37===y?(d=A[f--],A[f]=A[f]===d):(d=A[f--],A[f]=A[f]!==d);else if(y<55)y<47?y<43?y<40?(d=A[f--],A[f]=A[f]<d):40===y?(d=A[f--],A[f]=A[f]<=d):(d=A[f--],A[f]=A[f]>d):y<45?43===y?(d=A[f--],A[f]=A[f]<<d):(d=A[f--],A[f]=A[f]>>d):45===y?(d=A[f--],A[f]=A[f]>>>d):(d=A[f--],A[f]=A[f]&d):y<51?y<49?47===y?(d=A[f--],A[f]=A[f]|d):A[f]=~A[f]:49===y?(d=A[f--],A[f]=A[f]^d):A[f]=!A[f]:y<53?51===y?(u=(u=(s[t]<<8)+s[t+1])<<16>>16,t+=2,A[f]?--f:t+=u):(u=(u=(s[t]<<8)+s[t+1])<<16>>16,t+=2,A[f]?t+=u:--f):53===y?(d=A[f--],(l=A[f--])[d]=A[f]):(d=A[f--],A[f]=A[f]in d);else if(y<65)if(y<60)y<58?55===y?(d=A[f--],A[f]=A[f]instanceof d):A[f]=void 0:58===y?A[f]=typeof A[f]:(u=s[t++],d=A[f--],(l=function e(){var t=e._v;return(0,e._u)(t[0],arguments,t[1],t[2],this)})._v=[d,u,m],l._u=e,A[++f]=l);else if(y<62)60===y?(u=s[t++],d=A[f--],(c=[l=function e(){var t=e._v;return(0,e._u)(t[0],arguments,t[1],t[2],this)}]).p=m,l._v=[d,u,c],l._u=e,A[++f]=l):(u=(u=(s[t]<<8)+s[t+1])<<16>>16,t+=2,(d=g[g.length-1])[1]=t+u);else{if(62!==y)throw d=A[f--];u=(u=(s[t]<<8)+s[t+1])<<16>>16,t+=2,(d=g[g.length-1])&&!d[1]?(d[0]=3,d.push(t)):g.push([1,0,t]),t+=u}else if(y<69)if(y<67)if(65===y)if(l=(d=g.pop())[0],c=p[0],1===l)t=d[1];else if(0===l)if(0===c)t=d[1];else{if(1!==c)throw p[1];if(!v)return p[1];t=v[1],a=v[2],m=v[3],g=v[4],A[++f]=p[1],p=[0,null],v=v[0]}else t=d[2],d[0]=0,g.push(d);else{for(d=A[f--],l=null;c=g.pop();)if(2===c[0]||3===c[0]){l=c;break}if(l)p=[1,d],t=l[2],l[0]=0,g.push(l);else{if(!v)return d;t=v[1],a=v[2],m=v[3],g=v[4],A[++f]=d,p=[0,null],v=v[0]}}else if(67===y)f-=u=s[t++],l=A.slice(f+1,f+u+1),d=A[f--],c=A[f--],d._u===e?(d=d._v,v=[v,t,a,m,g],t=d[0],null==c&&(c=function(){return this}()),a=c,(m=[l].concat(l)).length=Math.min(d[1],u)+1,m.p=d[2],g=[]):A[++f]=d.apply(c,l);else{for(u=s[t++],c=[void 0],h=u;h>0;--h)c[h]=A[f--];l=A[f--],d=Function.bind.apply(l,c),A[++f]=new d}else y<73?69===y?t+=2+(u=(u=(s[t]<<8)+s[t+1])<<16>>16):(u=(u=(s[t]<<8)+s[t+1])<<16>>16,t+=2,(d=A[f--])||(t+=u)):73===y?--f:(d=A[f],A[++f]=d)}catch(e){for(p=[0,null];(u=g.pop())&&!u[0];);if(!u){e:for(;v;){for(d=v[4];u=d.pop();)if(u[0])break e;v=v[0]}if(!v)throw e;t=v[1],a=v[2],m=v[3],g=v[4],v=v[0]}1===(d=u[0])?(t=u[2],u[0]=0,g.push(u),A[++f]=e):2===d?(t=u[2],u[0]=0,g.push(u),p=[3,e]):(t=u[3],u[0]=2,g.push(u),A[++f]=e)}}(l,[],0,t,r)}("484e4f4a403f524300173b244036dd81000046b6c7d07c4300004cfe070001490700021102003a2333000b0700031102001200043a2347000a050000003d3b0145000705000000423b011701013549021101011100014301421100013a421100013300080700021103003a2333000a1100011200051103002533000a110001110300120006264700060700034500041100013a421102033a07000b2633000611020312000c47000c11020312000c14010245000a05000000b03c031401021101024a1200100b1100004302420211030311000111000243021400041100043247000208421104014a12000d110004110002430214000511000512000c47002211000512000c4a12000e11000012000f030327470006110001450003110003430142110005120009421102011200061200114a12000e11000111000243023247001a021101081100014301140001110001022547000345000345ffcd110001421100023a0700022633000511000202264700091102040700124401401102014a1200131100023300061100021200060d0d1100010e0009000e0014000e00150e000543021100011500061102014a1200071100010700060d010e001443034911000247000d0211010b11000111000243024908420211010a430014000205000001c83c0042021103081102014301140001110202470025021103080b43011200051400031104034a12001611000111000011000343031400024500101100014a1200100b1100004302140002021103060b110002430242110002330018021101011100024301070017253400081100023a07000225470007110002424500131100020300382647000911020407001844014002110107110001430142110001030038254700091102050700194401401100014211020112001a47000911020112001b450007050000029c3c011401080211010811000143014211000112001c34000c1104014a12001b1100014301420211010a430047000c11020312001614010945000a05000002df3c031401091101094a12001002110000430242020c000114000411000412001d4a12001011000411000243024911040612001e4a120010110001110004430214000511000544001400061100034700100211030b110006110003120006430249110006421102033a07000b2534000711020312001632470002014211020312001612001f47000201421102073a0700022547000200423e00061400010142413d00291102081200061200204a12000e1102034a1200161102080c000005000003993b0043034301490042410842084211020112001a34000705000003bb3c0214010b0211010b11000111000243024211000211000115001c1100014211000111000237324700091102040700214401400842030014000311000311000212000f2747005011000211000313140004110004120022340001011100041500220011000415001507000911000436470007001100041500141102014a120007110001110004120023110004430349170003214945ffa308421100024700100211010d11000112000611000243024911000347000d0211010d1100011100034302491102014a1200071100010700060d010e00144303491100014205000004d53b001400010211010e1100010d0700240e002305000004e23c010e00090d0700260e002305000004f03c000e00090c00020d0700130e0023050000050b3c000e00090c0001430349110001420211020c0b11010143024908421104014a1200250b1100014302420b12000544001400011104014a1200251100010b4302491100014211000012000f14000111040911000144011400020300140003110003110001274700161100001100031311000211000316170003214945ffe0021103090b11000243024205000005db3b00140003021101041100031100014302490211010511000343011400020211010e1100030d07002c0e002305000007553c000e00090d07002e0e002305000007863c010e00090d07002f0e0023050000086c3c000e00090d0700260e002305000008b73c000e00090c00040d0700330e002305000008ed3c010e00090c00014303491100034211000012000f03002933000811000003001308264700091100000300134500030c000014000211000012000f030129330008110000030113082647000911000003011345000911000212000f03041a1400030211020c0b1101034302491101024a12000e0b430114000111000214000411000411030a3747000b11030b110004440114000411000411030c3734000711000411030d3734000711000411030e3734000711000411030f373400071100041103103734000711000411031137340007110004110312373400071100041103133747001a11030b110004120027110004120028110004120029440314000411000411030b3747006b1100041200291400050c000014000603001400071100071100052747003811000611000703022d1311000411000713031811000703041c03081a192b2f11000611000703022d3549110007030118170007354945ffbe11000611000115002a11000511000115002b45001211000211000115002a11000311000115002b1100014211000012000f03002933000811000003001308264700091100000300134500031103111400011100014a12002d0b4301420b12002a14000211000112002a1400030b12002b14000411000112002b1400050b4a12002f43004911000403041c47007003001400061100061100052747005e11000311000603022d13031811000603041c03081a192d0400ff2e1400071100021100041100061803022d1311000703181100041100061803041c03081a192b2f1100021100041100061803022d3549110006030118170006354945ff9845003503001400081100081100052747002611000311000803022d131100021100041100081803022d16110008030418170008354945ffd00b12002b110005180b07002b35490b420b12002a1400010b12002b14000211000111000203022d13060030032011000203041c03081a192b2e11000111000203022d35491104144a12003111000203041b430111000115000f0842021103020211030811020312000643010700260b43034a12000e0b43011400010b12002a4a1200320300430111000115002a110001420c000014000205000009683c01140003030014000411000411000127470050021100031100053400091104144a12003343000600341a4301140006021100064300053ade67b71a1400051100024a12001d0211000643000600341a03002f430149110004030418170004354945ffa6110203110002110001440242110001140002053ade68b114000306003014000405000009843b00420500009069110103050000ffff2e1a11010303102c181101042e140103044650110102050000ffff2e1a11010203102c181101042e14010211010303102b110102181101042e1400011100010600341b17000135491100010600351817000135491100011107144a120033430006003529470005030145000303011d1a4211000112002a14000211000112002b1400030c000014000403001400051100051100032747005c11000211000503022d13031811000503041c03081a192d0400ff2e1400061100044a12001d11000603042d4a12002c031043014301491100044a12001d110006030f2e4a12002c03104301430149110005030118170005354945ff9a1100044a12003607003743014211000112000f1400020c000014000303001400041100041100022747004711000311000403032d13021103151100014a1200381100040302430203104302031811000403081c03041a192b2f11000311000403032d3549110004030218170004354945ffaf11021011000311000203021b44024211000112002a14000211000112002b1400030c000014000403001400051100051100032747004211000211000503022d13031811000503041c03081a192d0400ff2e1400061100044a12001d1103164a12003a1100064301430149110005030118170005354945ffb41100044a12003607003743014211000112000f1400020c000014000303001400041100041100022747004111000311000403022d131100014a12003b11000443010400ff2e031811000403041c03081a192b2f11000311000403022d3549110004030118170004354945ffb51102101100031100024402423e000d14000211031907003c440140413d001a02110317021103181102124a12002d110001430143014301424108421102124a1200390211031a0211031b110001430143014301420500000ca73b00140003021101041100031100014302490211010511000343011400020211010e1100030d07003e0e00230500000ccb3c000e00090d0700410e00230500000cdc3c010e00090d0700430e00230500000d1d3c010e00090d0700260e00230500000e013c000e00090c0004430249110003420211020c0b1101034302491101024a12000e0b4301140001030011000115003d1100014211031044000b15003f03000b15004008421100011400021100023a0700422547000f1103134a12003911000243011400020b12003f4a12002e1100024301490b12004011000212002b180b070040354908420b12003f1400030b12004414000411000312002a14000511000312002b14000611000403041a1400071100061100071b1400081100014700121104144a12003111000843011400084500191104144a12004511000803002f0b12003d19030043021400081100081100041a1400091104144a12004611000903041a110006430214000a11000947004f030014000b11000b1100092747001d0b4a12004711000511000b43024911000b1100041817000b354945ffd91100054a1200480300110009430214000211000312002b11000a1911000307002b354911031011000211000a440242021103020211030811020312000643010700260b43034a12000e0b43011400010b12003f4a120026430011000115003f110001420500000ec13b01140003021101041100031100014302490211010511000343011400020211010e1100030d07003e0e00230500000f0a3c000e00090d07004b0e00230500000f323c010e00090d07004c0e00230500000f473c010e00090c00030d07004e0e00230500000f663c010e00090d07004f0e00230500000f803c010e00090c0002430349110003420211020c0b1101034302491101024a12000e0b430114000204020003201b1100021500441103014a12002511020f440011000143021100021500491100024a12003e430049110002420211030202110308110203120006430107003e0b43034a12000e0b4301490b4a12004a43004908420b4a1200411100014301490b4a1200434300490b4211000147000b0b4a1200411100014301490b4a12004d4300140002110002420500000f6e3b024211010111000244014a12004c1100014301420500000f883b024211041611010111000244024a12004c11000143014205000010043b02140003021101041100031100014302490211010511000343011400020211010e1100030d07003e0e002305000011283c000e00090d07004b0e002305000011493c010e00090d07004c0e002305000011593c010e00090c0003430249110003420211020c0b1101034302491101024a12000e0b430114000311000144001400041100041100031500501100021400051100053a0700422547000f1102134a120039110005430114000511000412004414000611000603041a14000711000512002b1100072947000f1100044a12004c11000243011400051100054a12002f4300491100054a12002643001400081100081100031500511100054a120026430014000911000911000315005211000812002a14000a11000912002a14000b030014000c11000c1100062747003811000a11000c13055c5c5c5c3111000a11000c354911000b11000c1305363636363111000b11000c354911000c03011817000c354945ffbe11000711000815002b11000711000915002b1100034a12003e430049110003420b1200501400011100014a12003e4300491100014a12004b0b12005243014908420b1200504a12004b1100014301490b420b1200501400021100024a12004c11000143011400031100024a12003e4300491100024a12004c0b1200514a12002643004a12002e11000343014301140004110004420c0000140004030014000503001400061100061100022747009211000603041c47007b1100031100014a12003b11000603011943011311000603041c03021a2b1400071100031100014a12003b110006430113030611000603041c03021a192d1400081100071100082f14000911000411000503022d13110009031811000503041c03081a192b2f11000411000503022d35491100050301181700053549110006030118170006354945ff641102104a12001311000411000543024211000112002a14000211000112002b1400030b1200531400041100014a12002f4300490c00001400050300140006110006110003274700d911000211000603022d13031811000603041c03081a192d0400ff2e14000711000211000603011803022d13031811000603011803041c03081a192d0400ff2e14000811000211000603021803022d13031811000603021803041c03081a192d0400ff2e14000911000703102b11000803082b2f1100092f14000a030014000b11000b03042733000f11000611000b0600541a18110003274700311100054a12001d1100044a12005511000a0306030311000b191a2d033f2e430143014911000b03011817000b354945ffb4110006030318170006354945ff1d1100044a1200550340430114000c11000c47001c11000512000f03041c4700101100054a12001d11000c43014945ffe41100054a12003607003743014211000112000f1400020b1200531400030b120056140004110004324700410c00000b1500560b120056140004030014000511000511000312000f274700211100051100041100034a12003b110005430116110005030118170005354945ffd21100034a1200550340430114000611000647001f1100014a120057110006430114000711000703011d26470006110007140002021102171100011100021100044303421100011100021100032e110002301100042e2f1811000518110007181400081100081100062b1100080320110006192d2f11000218421100011100021100042e110003110004302e2f1811000518110007181400081100081100062b1100080320110006192d2f110002184211000111000211000331110004311811000518110007181400081100081100062b1100080320110006192d2f1100021842110001110003110002110004302f311811000518110007181400081100081100062b1100080320110006192d2f1100021842050000158f3b00140003021101041100031100014302490211010511000343011400020211010e1100030d07004a0e002305000015a83c000e00090d0700470e002305000015c63c020e00090d07004d0e00230500001f743c000e00090d0700260e002305000020c63c000e00090c0004430249110003420211020c0b1101034302491101024a1200100b110000430242110310056745230106005b06005c05103254760c000444010b15005d0842110001140003030014000411000403102747004e110002110004181400051100011100051314000611000603082b11000603182d2f0500ff00ff2e11000603182b11000603082d2f06005e2e2f11000311000516110004030118170004354945ffa90b12005d12002a14000711000311000203001813140008110003110002030118131400091100031100020302181314000a1100031100020303181314000b1100031100020304181314000c1100031100020305181314000d1100031100020306181314000e1100031100020307181314000f1100031100020308181314001011000311000203091813140011110003110002030a1813140012110003110002030b1813140013110003110002030c1813140014110003110002030d1813140015110003110002030e1813140016110003110002030f181314001711000703001314001811000703011314001911000703021314001a11000703031314001b0211031b11001811001911001a11001b110008030711031903001343071400180211031b11001b11001811001911001a110009030c110319030113430714001b0211031b11001a11001b11001811001911000a0311110319030213430714001a0211031b11001911001a11001b11001811000b031611031903031343071400190211031b11001811001911001a11001b11000c030711031903041343071400180211031b11001b11001811001911001a11000d030c110319030513430714001b0211031b11001a11001b11001811001911000e0311110319030613430714001a0211031b11001911001a11001b11001811000f031611031903071343071400190211031b11001811001911001a11001b110010030711031903081343071400180211031b11001b11001811001911001a110011030c110319030913430714001b0211031b11001a11001b1100181100191100120311110319030a13430714001a0211031b11001911001a11001b1100181100130316110319030b1343071400190211031b11001811001911001a11001b1100140307110319030c1343071400180211031b11001b11001811001911001a110015030c110319030d13430714001b0211031b11001a11001b1100181100191100160311110319030e13430714001a0211031b11001911001a11001b1100181100170316110319030f1343071400190211031c11001811001911001a11001b110009030511031903101343071400180211031c11001b11001811001911001a11000e0309110319031113430714001b0211031c11001a11001b110018110019110013030e110319031213430714001a0211031c11001911001a11001b110018110008031411031903131343071400190211031c11001811001911001a11001b11000d030511031903141343071400180211031c11001b11001811001911001a1100120309110319031513430714001b0211031c11001a11001b110018110019110017030e110319031613430714001a0211031c11001911001a11001b11001811000c031411031903171343071400190211031c11001811001911001a11001b110011030511031903181343071400180211031c11001b11001811001911001a1100160309110319031913430714001b0211031c11001a11001b11001811001911000b030e110319031a13430714001a0211031c11001911001a11001b1100181100100314110319031b1343071400190211031c11001811001911001a11001b1100150305110319031c1343071400180211031c11001b11001811001911001a11000a0309110319031d13430714001b0211031c11001a11001b11001811001911000f030e110319031e13430714001a0211031c11001911001a11001b1100181100140314110319031f1343071400190211031d11001811001911001a11001b11000d030411031903201343071400180211031d11001b11001811001911001a110010030b110319032113430714001b0211031d11001a11001b1100181100191100130310110319032213430714001a0211031d11001911001a11001b110018110016031711031903231343071400190211031d11001811001911001a11001b110009030411031903241343071400180211031d11001b11001811001911001a11000c030b110319032513430714001b0211031d11001a11001b11001811001911000f0310110319032613430714001a0211031d11001911001a11001b110018110012031711031903271343071400190211031d11001811001911001a11001b110015030411031903281343071400180211031d11001b11001811001911001a110008030b110319032913430714001b0211031d11001a11001b11001811001911000b0310110319032a13430714001a0211031d11001911001a11001b11001811000e0317110319032b1343071400190211031d11001811001911001a11001b1100110304110319032c1343071400180211031d11001b11001811001911001a110014030b110319032d13430714001b0211031d11001a11001b1100181100191100170310110319032e13430714001a0211031d11001911001a11001b11001811000a0317110319032f1343071400190211031e11001811001911001a11001b110008030611031903301343071400180211031e11001b11001811001911001a11000f030a110319033113430714001b0211031e11001a11001b110018110019110016030f110319033213430714001a0211031e11001911001a11001b11001811000d031511031903331343071400190211031e11001811001911001a11001b110014030611031903341343071400180211031e11001b11001811001911001a11000b030a110319033513430714001b0211031e11001a11001b110018110019110012030f110319033613430714001a0211031e11001911001a11001b110018110009031511031903371343071400190211031e11001811001911001a11001b110010030611031903381343071400180211031e11001b11001811001911001a110017030a110319033913430714001b0211031e11001a11001b11001811001911000e030f110319033a13430714001a0211031e11001911001a11001b1100181100150315110319033b1343071400190211031e11001811001911001a11001b11000c0306110319033c1343071400180211031e11001b11001811001911001a110013030a110319033d13430714001b0211031e11001a11001b11001811001911000a030f110319033e13430714001a0211031e11001911001a11001b1100181100110315110319033f1343071400191100070300131100181803002f1100070300161100070301131100191803002f11000703011611000703021311001a1803002f11000703021611000703031311001b1803002f11000703031608420b12003f14000111000112002a1400020b12004003081a14000311000112002b03081a14000411000211000403052d13040080031811000403201c192b2f11000211000403052d35491104144a12005f1100030600341b430114000511000314000611000503082b11000503182d2f0500ff00ff2e11000503182b11000503082d2f06005e2e2f11000211000403401803092d03042b030f181611000603082b11000603182d2f0500ff00ff2e11000603182b11000603082d2f06005e2e2f11000211000403401803092d03042b030e181611000212000f03011803041a11000115002b0b4a1200434300490b12005d14000711000712002a14000803001400091100090304274700441100081100091314000a11000a03082b11000a03182d2f0500ff00ff2e11000a03182b11000a03082d2f06005e2e2f11000811000916110009030118170009354945ffb311000742021103020211030811020312000643010700260b43034a12000e0b43011400010b12005d4a120026430011000115005d11000142050000213f3b01140003021101041100031100014302490211010511000343011400020211010e1100030d0700630e002305000021873c020e00090c0001430249110003420211020c0b1101034302491101024a12000e0b43011400021103014a12002511020f44000d04008003201b0e006011021f0e006103010e00621100014303110002150049110002420b1200491400041100041200614a12001343001400051103104a120013430014000611000612002a14000711000412006014000811000412006214000911000712000f1100082747007b11000347000d1100054a12004b1100034301491100054a12004b11000143014a12004c11000243011400031100054a12003e430049030114000a11000a110009274700271100054a12004c11000343011400031100054a12003e43004911000a03011817000a354945ffcf1100064a12002e11000343014945ff7811000803041a11000615002b1100064205000022f93b03140003021101041100031100014302490211010511000343011400020211010e1100030d07003e0e002305000023483c000e00090d0700660e002305000023703c010e00090d07004c0e002305000023833c010e00090c00030d0700670e002305000023a23c020e00090d0700690e002305000023b43c020e00090d07004e0e002305000023c63c010e00090c0003430349110003420211020c0b1101034302491101024a12000e0b43011400041103014a12002511020f440011000343021100041500491100011100041500641100021100041500651100044a12003e430049110004420211030202110308110203120006430107003e0b43034a12000e0b4301490b4a12004a43004908420b4a1200411100014301490b4a12004343004211000147000b0b4a1200411100014301490b4a12004d4300140002110002420b4a1200130b1200681100011100024303420b4a1200130b12006a11000111000243034205000023e63c011400020d05000023f93c030e006b05000024153c030e006c421100013a0700422547000411052b42110529420211020211000243014a12006b1102011100011100021100034304420211020211000243014a12006c11020111000111000211000343044205000024883b02140003021101041100031100014302490211010511000343011400020211010e110003020d0700670e002305000024b63c020e00090d0700690e002305000024c73c020e00090c0002430349110003420211020c0b1101034302491101024a12000e0b430114000311000111000315006e11000211000315006f110003420b1200704a1200131100011100024302420b1200714a1200131100011100024302421100011400040b12006f14000611000647000e110006140005080b15006f4500070b12007214000503001400071100071100032747002d11000411000211000718131100051100071331110004110002110007183549110007030118170007354945ffc90842050000256b3b00140003021101041100031100014302490211010511000343011400020211010e1100034301420211020c0b1101034302491101024a1200100b11000043024205000025c93b00140003021101041100031100014302490211010511000343011400020211010e1100030d0700730e002305000025e23c020e00090c0001430249110003420211020c0b1101034302491101024a1200100b1100004302420b12006e1400031100031200441400041103234a12000e0b1100011100021100044304491100034a1200741100011100024302491100014a1200321100021100021100041843020b150072084205000026743b00140003021101041100031100014302490211010511000343011400020211010e1100030d0700730e0023050000268d3c020e00090c0001430249110003420211020c0b1101034302491101024a1200100b1100004302420b12006e1400031100031200441400041100014a1200321100021100021100041843021400051100034a1200751100011100024302491103234a12000e0b1100011100021100044304491100050b150072084211000203041a14000311000311000112002b1100031c1914000411000403182b11000403102b2f11000403082b2f1100042f1400050c000014000603001400071100071100042747001b1100064a12001d110005430149110007030418170007354945ffdb1102104a12001311000611000443021400081100014a12002e110008430149084211000114000211000212002a11000212002b03011903022d130400ff2e14000311000212002b1100031911000207002b3549084205000028013b03140003021101041100031100014302490211010511000343011400020211010e1100030d07003e0e002305000028483c000e00090d0700470e002305000028d23c020e00090d07004d0e002305000028e53c000e00090c0003430249110003420211020c0b1101034302491101024a12000e0b1100011100021103014a1200250d1102240e00781102250e00791100034302430414000404008003201b110004150044110004420211030202110308110203120006430107003e0b43034a12000e0b4301490b12004914000211000212007a1400031100021200781400040b1200640b1200051200682547000c11000412006714000145000f11000412006914000103010b15003d1100014a12000e1100040b11000333000611000312002a43030b15007b1100010b12007b15007c08420b12007b4a12007311000111000243024908420b1200491200791400020b1200640b120005120068254700241100024a1200760b12003f0b1200444302490b4a12004307007d3232430114000145001c0b4a12004307007d323243011400011100024a1200771100014301491100014205000029873b01140003021101041100031100014302490211010511000343011400020211010e1100030d07002c0e002305000029b03c010e00090c0001430249110003420211020c0b1101034302491101024a12000e0b43011400021100024a120024110001430149110002421100013400040b12007e4a12002d0b43014211000112007f14000311000112008014000411000447002e1102104a1200130553616c740565645f5f0c000243014a12002e11000443014a12002e11000343011400024500061100031400021100024a12002c1102184301421102184a120039110001430114000311000312002a1400041100040300130553616c742533000c1100040301130565645f5f254700381102104a1200131100044a12003203020304430243011400021100044a1200480300030443024911000312002b03101911000307002b35491102274a1200130d1100030e007f1100020e00804301420500002b083b00140003021101041100031100014302490211010511000343011400020211010e110003020d07006b0e00230500002b213c040e00090d07006c0e00230500002bad3c040e00090d0700830e00230500002c003c020e00090c0003430349110003420211020c0b1101034302491101024a1200100b1100004302421104014a12002511030f44000b12004911000443031400051100014a12006711000311000543021400061100064a12004c11000243011400071100061200491400081103274a1200130d1100070e007f1100030e002311000812007a0e007a1100010e00811100081200780e00781100081200790e00791100061200440e00441100051200820e007e4301421100021400051104014a12002511030f44000b12004911000443031400060b4a12008311000511000612008243021400051100014a12006911000311000643024a12004c11000512007f4301140007110007421100013a0700422547000e1100024a1200391100010b43024211000142110004140005110005324700111102104a120033034003081b43011400051102204a1200130d110002110003180e006043014a12006311000111000543021400061102104a12001311000612002a4a120032110002430111000303041a430214000711000203041a11000615002b1102274a1200130d1100060e00231100070e007a1100050e00804301420500002cff3b00140003021101041100031100014302490211010511000343011400020211010e110003020d07006b0e00230500002d183c040e00090d07006c0e00230500002d8a3c040e00090c0002430349110003420211020c0b1101034302491101024a1200100b1100004302421104014a12002511030f44000b12004911000443031400051100051200854a12008411000311000112006011000112006d430314000611000612007a11000515007a11032912006b4a12000e0b11000111000211000612002311000543051400071100074a120024110006430149110007421100021400051104014a12002511030f44000b12004911000443031400060b4a12008311000511000612008243021400051100061200854a12008411000311000112006011000112006d110005120080430414000711000712007a11000615007a11032912006c4a12000e0b1100011100051100071200231100064305140008110008420500002e863b00140003021101041100031100014302490211010511000343011400020211010e1100030d07004a0e00230500002e9f3c000e00090d0700740e002305000030f03c020e00090d0700750e002305000031133c020e00090d07008a0e002305000031983c080e00090c0004430249110003420211020c0b1101034302491101024a1200100b1100004302420b1200863300090b1200870b1200652547000208420b1200650b1500870b12008714000211000212002a14000311000212002b03041b1400041100040306180b1500860b12008614000511000503011803041a1400060c00000b1500880b12008814000703001400081100081100062747011a1100081100042747001111000311000813110007110008164500f1110007110008030119131400011100081100041c3247006d11000103082b11000103182d2f14000111032c11000103182d1303182b11032c11000103102d0400ff2e1303102b2f11032c11000103082d0400ff2e1303082b2f11032c1100010400ff2e132f1400011100011103401100081100041b03002f1303182b31170001354945005611000403062933000a1100081100041c03042547004011032c11000103182d1303182b11032c11000103102d0400ff2e1303102b2f11032c11000103082d0400ff2e1303082b2f11032c1100010400ff2e132f14000111000711000811000419131100013111000711000816110008030118170008354945fedc0c00000b1500890b120089140009030014000a11000a110006274700a511000611000a1914000b11000a03041c47000d11000711000b1314000145000d11000711000b0304191314000111000a03042734000611000b03042847000d11000111000911000a1645004b11033211032c11000103182d131311033311032c11000103102d0400ff2e13133111033411032c11000103082d0400ff2e13133111033511032c1100010400ff2e13133111000911000a1611000a03011817000a354945ff5108420b4a12008a1100011100020b12008811032e11032f11033011033111032c4308490842110001140003110003110002030118131400041100031100020303181311000311000203011816110004110003110002030318160b4a12008a1100031100020b12008911033211033311033411033511032d4308491100031100020301181314000411000311000203031813110003110002030118161100041100031100020303181608421100011400090b12008614000a110009110002131100030300133114000b110009110002030118131100030301133114000c110009110002030218131100030302133114000d110009110002030318131100030303133114000e030414000f030114001011001011000a2747014e11000411000b03182d1311000511000c03102d0400ff2e133111000611000d03082d0400ff2e133111000711000e0400ff2e133111000311000f133114001111000f03011817000f354911000411000c03182d1311000511000d03102d0400ff2e133111000611000e03082d0400ff2e133111000711000b0400ff2e133111000311000f133114001211000f03011817000f354911000411000d03182d1311000511000e03102d0400ff2e133111000611000b03082d0400ff2e133111000711000c0400ff2e133111000311000f133114001311000f03011817000f354911000411000e03182d1311000511000b03102d0400ff2e133111000611000c03082d0400ff2e133111000711000d0400ff2e133111000311000f133114001411000f03011817000f354911001114000b11001214000c11001314000d11001414000e110010030118170010354945fea811000811000b03182d1303182b11000811000c03102d0400ff2e1303102b2f11000811000d03082d0400ff2e1303082b2f11000811000e0400ff2e132f11000311000f133114001511000f03011817000f354911000811000c03182d1303182b11000811000d03102d0400ff2e1303102b2f11000811000e03082d0400ff2e1303082b2f11000811000b0400ff2e132f11000311000f133114001611000f03011817000f354911000811000d03182d1303182b11000811000e03102d0400ff2e1303102b2f11000811000b03082d0400ff2e1303082b2f11000811000c0400ff2e132f11000311000f133114001711000f03011817000f354911000811000e03182d1303182b11000811000b03102d0400ff2e1303102b2f11000811000c03082d0400ff2e1303082b2f11000811000d0400ff2e132f11000311000f133114001811000f03011817000f35491100151100091100021611001611000911000203011816110017110009110002030218161100181100091100020303181608421101134a12003911000243011400041101134a12003911000343011400051101184a12003911000143011400061101184a12002d11000643011400071101424a12006c1100071100040d1100050e007a43031400081100084a12002c1101134301421100013a070042254700651100014a12008b07008c430114000211000212000f0302254700481100020300131400031100034a12008d031043011400041100041100034a12008d030003104302181400051100020301131400060d1100040e007a1100050e00231100060e008e420d420d4211020a11000112000f440114000211020b1100024401140003030014000411000411000112000f2747001b1100014a12003b110004430111000311000416170004214945ffd81100024211020a4a12008f110001430147000911000112002714000111021612003a4a1200100211020b110001440143024211020b1200061200324700121100014a120032110002110003430245001d11020b1102091200061200324a12000e110001110002110003430344014205000036793b0214000105000036893b0211000112000615006c110001421100010b1500901100020b15009108420b1200904a12006c0d0700920e00930b1200910e007a11000211000143034211000112002914000211000233001711021c11000112002744014a12009411000203011943011400031100034700130211014711000103001100021100031943034211000142050000374c3b0014000105000037f13b0111000112000615009d05000038363b0011000112000615009b0500003a883b011100011200061500a10500003d6b3b011100011200061500a20500003d933b0311000112000615006c1100014203000301030203040308031003200340040080031b03360c000b0b15009511031104010044011103110401004401110311040100440111031104010044010c00040b15009611031104010044011103110401004401110311040100440111031104010044010c00040b15009711031104010044010b15009811031104010044010b150099110311030044010b15002303000b15009a03000b1500600b4a12009b430049084211031c110001440114000211031103044401140003030014000411000403042747001e1100024a12009c11000403041a430111000311000416170004214945ffd9110003420b1200981400010b1200991400020b1200961400031100030300131400041100030301131400051100030302131400061100030303131400070b12009714000811000803001314000911000803011314000a11000803021314000b11000803031314000c110311040100440114000d030014000e030014000f030014001003001700103549110010040100274700331100100400802747001011001003012b11000d1100101645001111001003012b04011b3111000d11001016170010214945ffc3030017001035491100100401002747017d11000f11000f03012b3111000f03022b3111000f03032b3111000f03042b3114001111001103082d1100110400ff2e3103633114001111001111000111000e1611000e1100021100111611000d11000e1314001211000d1100121314001311000d1100131314001411000d110011130401011a11001105010101001a3114001511001503182b11001503082d2f11000411000e1611001503102b11001503102d2f11000511000e1611001503082b11001503182d2f11000611000e1611001511000711000e1611001405010101011a11001305000100011a311100120401011a3111000e05010101001a3114001511001503182b11001503082d2f1100091100111611001503102b11001503102d2f11000a1100111611001503082b11001503182d2f11000b1100111611001511000c1100111611000e3247000c030117000f3514000e45002e11001211000d11000d11000d110014110012311313133114000e11000f11000d11000d11000f13133117000f3549170010214945fe7908420b4a12009d110001430114000200140003030014000411000411000212000f2733000311000347001b110002110004130b1200231100041325140003170004214945ffd211000347000208421100020b15002311000212000f0b0700603514000511000503042633000611000503062633000611000503082647000d11031907009e1100051844014011000503061803011803041a0b07009a3514000611031111000644010b07009f3514000911031111000644010b0700a03514000a0b12009814000b0b12009514000c0b12009714000d11000d03001314000e11000d03011314000f11000d03021314001011000d03031314001103001700073549110007110006274701191100071100052747001411000211000713110009110007351400124500f31100121400131100071100051c03002547006d11001303082b11001303182d2f14001311000b11001303182d1303182b11000b11001303102d0400ff2e1303102b2f11000b11001303082d0400ff2e1303082b2f11000b1100130400ff2e132f14001311001311000c1100071100051b03002f1303182b31170013354945005611000503062933000a1100071100051c03042547004011000b11001303182d1303182b11000b11001303102d0400ff2e1303102b2f11000b11001303082d0400ff2e1303082b2f11000b1100130400ff2e132f14001311000911000711000519131100133103002d1700123511000911000716170007214945fedd03001700083549110008110006274700b01100061100081914000711000803032e47000d1100091100071314001345000d1100091100070304191314001311000803042734000611000703042847000d11001311000a1100081645004b11000e11000b11001303182d131311000f11000b11001303102d0400ff2e13133111001011000b11001303082d0400ff2e13133111001111000b1100130400ff2e13133111000a1100081611000a1100081303002d11000a11000816170008214945ff46084211000103182b110001050000ff002e03082b2f1100010500ff00002e03082c2f11000103182d2f420b1200600306181400040b1200a01400050b1200991400060b12009714000711000703001314000811000703011314000911000703021314000a11000703031314000b0b4a12009d110003430114000c11000c03001314000d11000c03011314000e11000c03021314000f11000c030313140010110310110001440114001111031011001112000f44011400120b1200a214002111000211001112000f274703670211002111001111000213430114001b0211002111001111000203011813430114001c0211002111001111000203021813430114001d0211002111001111000203031813430114001e11001b1100050300133114001711001e1100050301133114001811001d1100050302133114001911001c1100050303133114001a030414001f030117002035491100201100042747012e11000811001703182d1311000911001803102c0400ff2e133111000a11001903082c0400ff2e133111000b11001a0400ff2e133111000511001f133114001311000811001803182d1311000911001903102c0400ff2e133111000a11001a03082c0400ff2e133111000b1100170400ff2e133111000511001f030118133114001411000811001903182d1311000911001a03102c0400ff2e133111000a11001703082c0400ff2e133111000b1100180400ff2e133111000511001f030218133114001511000811001a03182d1311000911001703102c0400ff2e133111000a11001803082c0400ff2e133111000b1100190400ff2e133111000511001f030318133114001611001314001711001414001811001514001911001614001a11001f03041814001f170020214945fec811000611001703182d1303182b11000611001803102c0400ff2e1303102b3111000611001903082c0400ff2e1303082b3111000611001a0400ff2e133111000511001f133114001311000611001803182d1303182b11000611001903102c0400ff2e1303102b3111000611001a03082c0400ff2e1303082b311100061100170400ff2e133111000511001f030118133114001411000611001903182d1303182b11000611001a03102c0400ff2e1303102b3111000611001703082c0400ff2e1303082b311100061100180400ff2e133111000511001f030218133114001511000611001a03182d1303182b11000611001703102c0400ff2e1303102b3111000611001803082c0400ff2e1303082b311100061100190400ff2e133111000511001f03031813311400160211002111001311000d314301110012110002160211002111001611000e314301110012110002030118160211002111001511000f31430111001211000203021816021100211100141100103143011100121100020303181611001b14000d11001c14000e11001d14000f11001e14001011000203041814000245fc8c1100121200274205000041c03b0214000105000041d03b001100011200061500a1110001421100010b1500901100020b15002308420b1200904a1200a30700a40b1200230d0700920e00930107006b07006c0c000243054211020b11000112000f11000212000f1844011400031100034a1200a51100014301491100034a1200a511000211000112000f4302491100034205000042ea3b03140001050000439e3b001100011200061500b205000043a53b001100011200061500b305000043ad3b0011000112000615007d05000043ed3b0011000112000615003e050000440a3b011100011200061500b405000044473b0411000112000615006c05000044a83b031100011200061500b505000045843b031100011200061500b6050000463b3b041100011200061500be05000046593b011100011200061500ba05000046a53b011100011200061500b811000142110003030038254700040d4500031100031400041100041200a61400051100050300382547000400450003110005140006000b1500a7020b150090020b1500a8020b150023020b1500a9020b1500aa020b1500ab020b1500ac1100010b1500ad1100020b1500ae1100060b1500a611000647002d3e0004140008413d002311031d1200af1400071100074700131100071200903400061100071200b00b150090410b1200900225470008000b1200ae1500b10842020b1500ad08420b1200ae1200b1420b1200ac1400011100013247000a0b4a12003e430049084211030b11000144011400020b4a12003e4300490b1200a647000a0211024911000243014211000242020b1500ac020b1500ab020b1500aa0b1200a8470005020b1500a808420211024611000143011400020211024411000243011400030211024311000312008e11000312002311000312007a4303140004021102451100044301420b1200ae1200b14700360b4a1200b511030b11000144011100021100034303490b4a12007d430014000511000547000d0211000411000512002743014945001f0b4a1200b611030b110001440111000211000343034a1200b711000443014908420b4a1200b411000243011400020b1400041100041200ab1400051100041200ac1400061100041200aa1400070b4a1200b80700b94301491100074700140211024d1100071100014302140001020b1500aa0b4a1200ba110001430114000811000812000f3247000202421100054700061100051400030b1200a81400091100093247000d11024a44000b0700a8351400091100094a1200a111000243014911000614000a1100094a12006c110008120027030011000343030b1500ac0211024711000803101d43021200270b1500ab11000a32470002024211000a420b1400040b4a1200b411000243011400020b1200901400050b120023110002263400050b1200a9324700161100020b15002311024b11000511000244020b1500a90b1200a94a1200a143004a1200b705000045eb3b0143014a0700bd1305000046253b014301421101053247001211041e4a1200bb1104190700bc440143014211034811010511010344021400021100024a12006c1101011200271100014302421101044a1200be110001110101110102110103430442000b1200ae1500b1000b1500a70b4a1200b511000211000311000443034211000114000211000112000f11000112000f11024c1c1914000311000311000112000f2647002102110247110001030011000343031400020211024711000111000343020b1500aa110002420b1200a7324700020842010b1500a7084205000000003b0114000105000000783b00140002050000010c3b0214000305000001433b0214000405000001b73b01140005050000021a3b02140006050000025f3b0114000705000002763b0114000805000002b23b0314000905000003303b0014000a050000039b3b0214000b05000003c83b0214000c05000003de3b0214000d05000004423b0314000e05000024d83b0314002305000034d33b0314004305000035353b0114004405000035a73b0114004505000035f13b01140046050000361f3b0314004705000036a83b0114004905000041f33b0214004d070000491101014a1200071101020700080d000e000943034903003811010207000a160205000004843b00430014000f02050000054f3b0111000f43011400100d0500000a023c010e002d0500000a923c010e00391400110d0500000b063c010e002d0500000b7c3c010e00391400120d0500000be73c010e002d0500000c163c010e0039140013020500000c2f3b0111000f4301140014020500000e353b011100144301140015020500000f9d3b0111000f4301140016050000119c3c031400170d05000012583c010e002d05000013a63c010e00390700580e00531400180c0000140019030014001a11001a0340274700341101144a1200591101144a12005a11001a030118430143010600341a03002f11001911001a1611001a03011817001a354945ffc305000014483c0714001b050000147e3c0714001c05000014b43c0714001d05000014e53c0714001e0205000015173b01110015430114001f0205000020fa3b0111000f430114002002050000225c3b0111001443011400210301110021150068030211002115006a04008003201b11002115006004008003201b11002115006d0205000024313b0111000f430114002202050000253e3b0111002243011400240205000025843b01110024430111002415007002050000262f3b0111002443011100241500710d05000026e03c020e007605000027663c010e007714002502050000279a3b0111002143011400260205000029423b0111000f43011400270d05000029c23c010e002d0500002a1b3c010e0039140028020500002aa03b0111000f43011400291101014a12002511000f44000d1100280e008243021100291500490d0500002c1d3c040e008414002a020500002ca83b01110029430114002b1101014a1200251100291200490d11002a0e0085430211002b1500490c000014002c0c000014002d0c000014002e0c000014002f0c00001400300c00001400310c00001400320c00001400330c00001400340c00001400350c00001400360300140037110037040100274700391100370400802747001011003703012b1100361100371645001111003703012b04011b3111003611003716110037030118170037354945ffbd03001400380300140039030014003a11003a0401002747018511003911003903012b3111003903022b3111003903032b3111003903042b3114003b11003b03082d11003b0400ff2e3103633114003b11003b11002c1100381611003811002d11003b161100361100381314003c11003611003c1314003d11003611003d1314003e11003611003b130401011a11003b05010101001a3114003f11003f03182b11003f03082d2f11002e1100381611003f03102b11003f03102d2f11002f1100381611003f03082b11003f03182d2f1100301100381611003f1100311100381611003e05010101011a11003d05000100011a3111003c0401011a3111003805010101001a3114003f11003f03182b11003f03082d2f11003211003b1611003f03102b11003f03102d2f11003311003b1611003f03082b11003f03182d2f11003411003b1611003f11003511003b161100383247000e030114003911003914003845002e11003c11003611003611003611003e11003c3113131331140038110039110036110036110039131331170039354911003a03011817003a354945fe7103000301030203040308031003200340040080031b03360c000b140040020500002e0e3b01110026430114004104010003201b1100411500601100264a12004e110041430114004202050000365b3b0043001400480205000036ee3b00430014004a0205000041a23b00430014004b031014004c02050000422c3b00430014004e11004e11010207000a1611004411004e0700391611004311004e07006c16084200bf0a2d2b3d782b2c2a313b2c17183a393a3d3477303d34283d2a2b7875782c21283d373e083e2d363b2c313736062b21353a373408312c3d2a392c372a0b3b37362b2c2a2d3b2c372a09282a372c372c21283d0e3c3d3e31363d082a37283d2a2c210a07073d2b15373c2d343d052e39342d3d073c3d3e392d342c092d363c3d3e31363d3c033f3d2c183f3d2c172f36082a37283d2a2c211c3d2b3b2a31282c372a043b39343406343d363f2c300539282834210e30392b172f36082a37283d2a2c21320b2d283d2a783d20282a3d2b2b31373678352d2b2c783d312c303d2a783a3d78362d343478372a7839783e2d363b2c313736063b2a3d392c3d082f2a312c393a343d0c3b37363e313f2d2a393a343d093b37362b2c2a2d3b2c06373a323d3b2c381c3d2a312e3d3c783b37362b2c2a2d3b2c372a2b783539217837363421782a3d2c2d2a3678373a323d3b2c78372a782d363c3d3e31363d3c392c30312b7830392b367f2c783a3d3d36783136312c313934312b3d3c7875782b2d283d2a70717830392b367f2c783a3d3d36783b3934343d3c0e2b3d2c082a372c372c21283d173e0e3f3d2c082a372c372c21283d173e090707282a372c37070704282d2b30043a31363c042b303935072e39342d3d173e211b393636372c783b3934347839783b34392b2b78392b7839783e2d363b2c3137360a3d362d353d2a393a343d03333d2105353120113606392b2b313f36053b3437363d063a2d3e3e3d2a0a3a212c3d173e3e2b3d2c0a3a212c3d143d363f2c30052f372a3c2b082b313f1a212c3d2b082c370b2c2a31363f092b2c2a31363f313e21063b37363b392c053b343935280a6c6a616c616e6f6a616d043b3d3134052b34313b3d062a39363c37350a6c6a616c616e6f6a616e0368766d043237313600062b2d3a2b2c2a0528392a2b3d0c3e2a37351b30392a1b373c3d0a3b30392a1b373c3d192c141539343e372a353d3c780d0c1e7560783c392c390e073531361a2d3e3e3d2a0b31223d052a3d2b3d2c05073c392c390b07361c392c391a212c3d2b07073928283d363c062b2c2a31363f0807282a373b3d2b2b093a34373b330b31223d03353920033531360f073c37082a373b3d2b2b1a34373b33062b2834313b3d033b3e3f08073c370a3d2b3d2c062d283c392c3d083e3136393431223d0b073c371e3136393431223d0d073b2a3d392c3d103d34283d2a11073b2a3d392c3d1035393b103d34283d2a070730392b303d2a050737133d21050731133d2104073539280468766f6d063b30392a192c0b072a3d2e3d2a2b3d1539280731363c3d20173e41191a1b1c1d1e1f101112131415161708090a0b0c0d0e0f000102393a3b3c3d3e3f303132333435363728292a2b2c2d2e2f20212268696a6b6c6d6e6f606173776503393a2b032b31360a6c686a6b6a6b6b6c696f0a6a6d6e6a6b606b69686a050730392b300a6c6a6f606a6d6d6b6e68053e3437372a07333d210b31223d0630392b303d2a0a312c3d2a392c3137362b073b3735282d2c3d0a07203e372a3515373c3d0407333d2107282a373b3d2b2b0f3b2a3d392c3d1d363b2a21282c372a0f071d161b07001e170a150715171c1d0f3b2a3d392c3d1c3d3b2a21282c372a0f071c1d1b07001e170a150715171c1d073d363b2a21282c073c3d3b2a21282c06312e0b31223d07073b3128303d2a0307312e091d363b2a21282c372a091c3d3b2a21282c372a0a07282a3d2e1a34373b330c282a373b3d2b2b1a34373b330c3d363b2a21282c1a34373b330c3c3d3b2a21282c1a34373b330328393c052d3628393c0435373c3d0728393c3c31363f02312e050735373c3d0907073b2a3d392c372a053e342d2b30093e372a35392c2c3d2a0a3b3128303d2a2c3d202c042b39342c0939343f372a312c3035063e372a35392c060728392a2b3d073d203d3b2d2c3d03333c3e0807360a372d363c2b0e07333d21082a31372a0a3d2b3d2c0c07333d210b3b303d3c2d343d0f0731362e133d210b3b303d3c2d343d0d073c371b2a21282c1a34373b33052b2834312c0162092b2d3a2b2c2a31363f073d363b1c392c3906312b0e313d2f062b2d3a2c343d05393d2b110e07191d0b751b1a1b043639353d083f3d2c0d31362c60042a3b3736062b2d3a1531200931362e0b2d3a153120042b1a37200731362e0b1a372006332b0a372f2b093136312c0c393a343d093f3d2c0d31362c6b6a182d31362c60192a2a39210c370d31362c6b6a192a2a3921071511362e3934313c78393d2b78333d21782b31223d650b333d210b3b303d3c2d343d0e31362e133d210b3b303d3c2d343d093d202839363c133d2116363d2c2f372a330c3710372b2c172a3c3d2a0b2f392809313528372a2c133d21032a392f032b3d2c122a3d35372e3d08131b0b6f08393c3c31363f0a34373f1d36393a343d3c112b373e2c2f392a3d1c3d3b2a21282c3d2a0a3e392b2c193d2b133d210d2a3d353931363c3d2a1c392c39093b2d2a2a3d362c110e0d3b2d2a2a3d362c0a3d2b2d342c08373a2b3d2a2e3d2a063b37363e313f063b2a21282c370c2f3d3a33312c0b2d3a2c343d113d36393a343d0b373e2c2f392a3d191d0b073c3d2b2c2a372106312b0b21363b11282a312e392c3d133d211c3d3b2a21282c0f2b373e2c2f392a3d1c3d3b2a21282c102f3d3a1b2a21282c371c3d3b2a21282c042c303d360734373f17363b3d0e120b78191d0b783c3d3b2a21282c0d3f3d2c0e3934313c1b302d3633062a3d323d3b2c1a2f3d3a783b2a21282c377836372c783136312c31393431223d3c053b392c3b301037360f3d3a1b2a21282c371d2a2a372a",{0:Symbol,1:Object,get 2(){return t},3:Reflect,4:TypeError,5:ReferenceError,6:Function,7:Proxy,8:Boolean,9:Array,10:ArrayBuffer,11:Uint8Array,12:Int8Array,13:Uint8ClampedArray,14:Int16Array,15:Uint16Array,16:Int32Array,17:Uint32Array,18:Float32Array,19:Float64Array,20:Math,21:parseInt,22:String,23:decodeURIComponent,get 24(){return escape},25:Error,get 26(){return unescape},27:encodeURIComponent,28:DataView,get 29(){return self},30:Promise},this)},"./node_modules/eventemitter3/index.js":function(e,t,r){"use strict";var i=Object.prototype.hasOwnProperty,n="~";function a(){}function s(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function o(e,t,r,i,a){if("function"!=typeof r)throw new TypeError("The listener must be a function");var o=new s(r,i||e,a),u=n?n+t:t;return e._events[u]?e._events[u].fn?e._events[u]=[e._events[u],o]:e._events[u].push(o):(e._events[u]=o,e._eventsCount++),e}function u(e,t){0==--e._eventsCount?e._events=new a:delete e._events[t]}function d(){this._events=new a,this._eventsCount=0}Object.create&&(a.prototype=Object.create(null),(new a).__proto__||(n=!1)),d.prototype.eventNames=function(){var e,t,r=[];if(0===this._eventsCount)return r;for(t in e=this._events)i.call(e,t)&&r.push(n?t.slice(1):t);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(e)):r},d.prototype.listeners=function(e){var t=n?n+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var i=0,a=r.length,s=new Array(a);i<a;i++)s[i]=r[i].fn;return s},d.prototype.listenerCount=function(e){var t=n?n+e:e,r=this._events[t];return r?r.fn?1:r.length:0},d.prototype.emit=function(e,t,r,i,a,s){var o=n?n+e:e;if(!this._events[o])return!1;var u,d,l=this._events[o],c=arguments.length;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),c){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,r),!0;case 4:return l.fn.call(l.context,t,r,i),!0;case 5:return l.fn.call(l.context,t,r,i,a),!0;case 6:return l.fn.call(l.context,t,r,i,a,s),!0}for(d=1,u=new Array(c-1);d<c;d++)u[d-1]=arguments[d];l.fn.apply(l.context,u)}else{var h,f=l.length;for(d=0;d<f;d++)switch(l[d].once&&this.removeListener(e,l[d].fn,void 0,!0),c){case 1:l[d].fn.call(l[d].context);break;case 2:l[d].fn.call(l[d].context,t);break;case 3:l[d].fn.call(l[d].context,t,r);break;case 4:l[d].fn.call(l[d].context,t,r,i);break;default:if(!u)for(h=1,u=new Array(c-1);h<c;h++)u[h-1]=arguments[h];l[d].fn.apply(l[d].context,u)}}return!0},d.prototype.on=function(e,t,r){return o(this,e,t,r,!1)},d.prototype.once=function(e,t,r){return o(this,e,t,r,!0)},d.prototype.removeListener=function(e,t,r,i){var a=n?n+e:e;if(!this._events[a])return this;if(!t)return u(this,a),this;var s=this._events[a];if(s.fn)s.fn!==t||i&&!s.once||r&&s.context!==r||u(this,a);else{for(var o=0,d=[],l=s.length;o<l;o++)(s[o].fn!==t||i&&!s[o].once||r&&s[o].context!==r)&&d.push(s[o]);d.length?this._events[a]=1===d.length?d[0]:d:u(this,a)}return this},d.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&u(this,t)):(this._events=new a,this._eventsCount=0),this},d.prototype.off=d.prototype.removeListener,d.prototype.addListener=d.prototype.on,d.prefixed=n,d.EventEmitter=d,e.exports=d},"./node_modules/url-toolkit/src/url-toolkit.js":function(e,t,r){var i,n,a,s,o;i=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,n=/^(?=([^\/?#]*))\1([^]*)$/,a=/(?:\/|^)\.(?=\/)/g,s=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,o={buildAbsoluteURL:function(e,t,r){if(r=r||{},e=e.trim(),!(t=t.trim())){if(!r.alwaysNormalize)return e;var i=o.parseURL(e);if(!i)throw new Error("Error trying to parse base URL.");return i.path=o.normalizePath(i.path),o.buildURLFromParts(i)}var a=o.parseURL(t);if(!a)throw new Error("Error trying to parse relative URL.");if(a.scheme)return r.alwaysNormalize?(a.path=o.normalizePath(a.path),o.buildURLFromParts(a)):t;var s=o.parseURL(e);if(!s)throw new Error("Error trying to parse base URL.");if(!s.netLoc&&s.path&&"/"!==s.path[0]){var u=n.exec(s.path);s.netLoc=u[1],s.path=u[2]}s.netLoc&&!s.path&&(s.path="/");var d={scheme:s.scheme,netLoc:a.netLoc,path:null,params:a.params,query:a.query,fragment:a.fragment};if(!a.netLoc&&(d.netLoc=s.netLoc,"/"!==a.path[0]))if(a.path){var l=s.path,c=l.substring(0,l.lastIndexOf("/")+1)+a.path;d.path=o.normalizePath(c)}else d.path=s.path,a.params||(d.params=s.params,a.query||(d.query=s.query));return null===d.path&&(d.path=r.alwaysNormalize?o.normalizePath(a.path):a.path),o.buildURLFromParts(d)},parseURL:function(e){var t=i.exec(e);return t?{scheme:t[1]||"",netLoc:t[2]||"",path:t[3]||"",params:t[4]||"",query:t[5]||"",fragment:t[6]||""}:null},normalizePath:function(e){for(e=e.split("").reverse().join("").replace(a,"");e.length!==(e=e.replace(s,"")).length;);return e.split("").reverse().join("")},buildURLFromParts:function(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment}},e.exports=o},"./node_modules/webworkify-webpack/index.js":function(e,t,r){function i(e){var t={};function r(i){if(t[i])return t[i].exports;var n=t[i]={i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=e,r.c=t,r.i=function(e){return e},r.d=function(e,t,i){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:i})},r.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/",r.oe=function(e){throw console.error(e),e};var i=r(r.s=ENTRY_MODULE);return i.default||i}function n(e){return(e+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function a(e,t,i){var a={};a[i]=[];var s=t.toString(),o=s.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!o)return a;for(var u,d=o[1],l=new RegExp("(\\\\n|\\W)"+n(d)+"\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)","g");u=l.exec(s);)"dll-reference"!==u[3]&&a[i].push(u[3]);for(l=new RegExp("\\("+n(d)+'\\("(dll-reference\\s([\\.|\\-|\\+|\\w|/|@]+))"\\)\\)\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)',"g");u=l.exec(s);)e[u[2]]||(a[i].push(u[1]),e[u[2]]=r(u[1]).m),a[u[2]]=a[u[2]]||[],a[u[2]].push(u[4]);for(var c,h=Object.keys(a),f=0;f<h.length;f++)for(var A=0;A<a[h[f]].length;A++)c=a[h[f]][A],isNaN(1*c)||(a[h[f]][A]=1*a[h[f]][A]);return a}function s(e){return Object.keys(e).reduce((function(t,r){return t||e[r].length>0}),!1)}e.exports=function(e,t){t=t||{};var n={main:r.m},o=t.all?{main:Object.keys(n.main)}:function(e,t){for(var r={main:[t]},i={main:[]},n={main:{}};s(r);)for(var o=Object.keys(r),u=0;u<o.length;u++){var d=o[u],l=r[d].pop();if(n[d]=n[d]||{},!n[d][l]&&e[d][l]){n[d][l]=!0,i[d]=i[d]||[],i[d].push(l);for(var c=a(e,e[d][l],d),h=Object.keys(c),f=0;f<h.length;f++)r[h[f]]=r[h[f]]||[],r[h[f]]=r[h[f]].concat(c[h[f]])}}return i}(n,e),u="";Object.keys(o).filter((function(e){return"main"!==e})).forEach((function(e){for(var t=0;o[e][t];)t++;o[e].push(t),n[e][t]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",u=u+"var "+e+" = ("+i.toString().replace("ENTRY_MODULE",JSON.stringify(t))+")({"+o[e].map((function(t){return JSON.stringify(t)+": "+n[e][t].toString()})).join(",")+"});\n"})),u=u+"new (("+i.toString().replace("ENTRY_MODULE",JSON.stringify(e))+")({"+o.main.map((function(e){return JSON.stringify(e)+": "+n.main[e].toString()})).join(",")+"}))(self);";var d=new window.Blob([u],{type:"text/javascript"});if(t.bare)return d;var l=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(d),c=new window.Worker(l);return c.objectURL=l,c}},"./repo/src/config.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"hlsDefaultConfig",(function(){return m})),r.d(t,"mergeConfig",(function(){return g})),r.d(t,"enableStreamingMode",(function(){return y}));var i=r("./repo/src/controller/abr-controller.ts"),n=r("./repo/src/empty.js"),a=r.n(n),s=r("./repo/src/controller/buffer-controller.ts"),o=r("./repo/src/controller/cap-level-controller.ts"),u=r("./repo/src/controller/fps-controller.ts"),d=r("./repo/src/utils/xhr-loader.ts"),l=r("./repo/src/utils/fetch-loader.ts"),c=r("./repo/src/utils/mediakeys-helper.ts"),h=r("./repo/src/utils/logger.ts");function f(){return(f=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function A(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,i)}return r}function p(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?A(Object(r),!0).forEach((function(t){v(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):A(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function v(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var m=p(p({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:6e7,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:d.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:i.default,bufferController:s.default,capLevelController:o.default,fpsController:u.default,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystemOptions:{},requestMediaKeySystemAccessFunc:c.requestMediaKeySystemAccess,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0},{cueHandler:a.a,enableCEA708Captions:!1,enableWebVTT:!1,enableIMSC1:!1,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}),{},{subtitleStreamController:void 0,subtitleTrackController:void 0,timelineController:void 0,audioStreamController:void 0,audioTrackController:void 0,emeController:void 0,cmcdController:void 0});function g(e,t){if((t.liveSyncDurationCount||t.liveMaxLatencyDurationCount)&&(t.liveSyncDuration||t.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(void 0!==t.liveMaxLatencyDurationCount&&(void 0===t.liveSyncDurationCount||t.liveMaxLatencyDurationCount<=t.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(void 0!==t.liveMaxLatencyDuration&&(void 0===t.liveSyncDuration||t.liveMaxLatencyDuration<=t.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');return f({},e,t)}function y(e){var t=e.loader;t!==l.default&&t!==d.default?(h.logger.log("[config]: Custom loader detected, cannot enable progressive streaming"),e.progressive=!1):Object(l.fetchSupported)()&&(e.loader=l.default,e.progressive=!0,e.enableSoftwareAES=!0,h.logger.log("[config]: Progressive streaming enabled, using FetchLoader"))}},"./repo/src/controller/abr-controller.ts":function(e,t,r){"use strict";r.r(t);var i=r("./repo/src/polyfills/number.ts"),n=r("./repo/src/utils/ewma-bandwidth-estimator.ts"),a=r("./repo/src/events.ts"),s=r("./repo/src/utils/buffer-helper.ts"),o=r("./repo/src/errors.ts"),u=r("./repo/src/types/loader.ts"),d=r("./repo/src/utils/logger.ts");function l(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var c=function(){function e(e){this.hls=void 0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=void 0,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=e;var t=e.config;this.bwEstimator=new n.default(t.abrEwmaSlowVoD,t.abrEwmaFastVoD,t.abrEwmaDefaultEstimate),this.registerListeners()}var t,r,c=e.prototype;return c.registerListeners=function(){var e=this.hls;e.on(a.Events.FRAG_LOADING,this.onFragLoading,this),e.on(a.Events.FRAG_LOADED,this.onFragLoaded,this),e.on(a.Events.FRAG_BUFFERED,this.onFragBuffered,this),e.on(a.Events.LEVEL_LOADED,this.onLevelLoaded,this),e.on(a.Events.ERROR,this.onError,this)},c.unregisterListeners=function(){var e=this.hls;e.off(a.Events.FRAG_LOADING,this.onFragLoading,this),e.off(a.Events.FRAG_LOADED,this.onFragLoaded,this),e.off(a.Events.FRAG_BUFFERED,this.onFragBuffered,this),e.off(a.Events.LEVEL_LOADED,this.onLevelLoaded,this),e.off(a.Events.ERROR,this.onError,this)},c.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null},c.onFragLoading=function(e,t){var r,i=t.frag;i.type===u.PlaylistLevelType.MAIN&&(this.timer||(this.fragCurrent=i,this.partCurrent=null!=(r=t.part)?r:null,this.timer=self.setInterval(this.onCheck,100)))},c.onLevelLoaded=function(e,t){var r=this.hls.config;t.details.live?this.bwEstimator.update(r.abrEwmaSlowLive,r.abrEwmaFastLive):this.bwEstimator.update(r.abrEwmaSlowVoD,r.abrEwmaFastVoD)},c._abandonRulesCheck=function(){var e=this.fragCurrent,t=this.partCurrent,r=this.hls,n=r.autoLevelEnabled,o=r.config,u=r.media;if(e&&u){var l=t?t.stats:e.stats,c=t?t.duration:e.duration;if(l.aborted)return d.logger.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),void(this._nextAutoLevel=-1);if(n&&!u.paused&&u.playbackRate&&u.readyState){var h=performance.now()-l.loading.start,f=Math.abs(u.playbackRate);if(!(h<=500*c/f)){var A=r.levels,p=r.minAutoLevel,v=A[e.level],m=l.total||Math.max(l.loaded,Math.round(c*v.maxBitrate/8)),g=Math.max(1,l.bwEstimate?l.bwEstimate/8:1e3*l.loaded/h),y=(m-l.loaded)/g,b=u.currentTime,_=(s.BufferHelper.bufferInfo(u,b,o.maxBufferHole).end-b)/f;if(!(_>=2*c/f||y<=_)){var E,T=Number.POSITIVE_INFINITY;for(E=e.level-1;E>p&&!((T=c*A[E].maxBitrate/(6.4*g))<_);E--);if(!(T>=y)){var k=this.bwEstimator.getEstimate();d.logger.warn("Fragment "+e.sn+(t?" part "+t.index:"")+" of level "+e.level+" is loading too slowly and will cause an underbuffer; aborting and switching to level "+E+"\n      Current BW estimate: "+(Object(i.isFiniteNumber)(k)?(k/1024).toFixed(3):"Unknown")+" Kb/s\n      Estimated load time for current fragment: "+y.toFixed(3)+" s\n      Estimated load time for the next fragment: "+T.toFixed(3)+" s\n      Time to underbuffer: "+_.toFixed(3)+" s"),r.nextLoadLevel=E,this.bwEstimator.sample(h,l.loaded),this.clearTimer(),e.loader&&(this.fragCurrent=this.partCurrent=null,e.loader.abort()),r.trigger(a.Events.FRAG_LOAD_EMERGENCY_ABORTED,{frag:e,part:t,stats:l})}}}}}},c.onFragLoaded=function(e,t){var r=t.frag,n=t.part;if(r.type===u.PlaylistLevelType.MAIN&&Object(i.isFiniteNumber)(r.sn)){var s=n?n.stats:r.stats,o=n?n.duration:r.duration;if(this.clearTimer(),this.lastLoadedFragLevel=r.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var d=this.hls.levels[r.level],l=(d.loaded?d.loaded.bytes:0)+s.loaded,c=(d.loaded?d.loaded.duration:0)+o;d.loaded={bytes:l,duration:c},d.realBitrate=Math.round(8*l/c)}if(r.bitrateTest){var h={stats:s,frag:r,part:n,id:r.type};this.onFragBuffered(a.Events.FRAG_BUFFERED,h),r.bitrateTest=!1}}},c.onFragBuffered=function(e,t){var r=t.frag,i=t.part,n=i?i.stats:r.stats;if(!n.aborted&&r.type===u.PlaylistLevelType.MAIN&&"initSegment"!==r.sn){var a=n.parsing.end-n.loading.start;this.bwEstimator.sample(a,n.loaded),n.bwEstimate=this.bwEstimator.getEstimate(),r.bitrateTest?this.bitrateTestDelay=a/1e3:this.bitrateTestDelay=0}},c.onError=function(e,t){switch(t.details){case o.ErrorDetails.FRAG_LOAD_ERROR:case o.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer()}},c.clearTimer=function(){self.clearInterval(this.timer),this.timer=void 0},c.getNextABRAutoLevel=function(){var e=this.fragCurrent,t=this.partCurrent,r=this.hls,i=r.maxAutoLevel,n=r.config,a=r.minAutoLevel,o=r.media,u=t?t.duration:e?e.duration:0,l=o?o.currentTime:0,c=o&&0!==o.playbackRate?Math.abs(o.playbackRate):1,h=this.bwEstimator?this.bwEstimator.getEstimate():n.abrEwmaDefaultEstimate,f=(s.BufferHelper.bufferInfo(o,l,n.maxBufferHole).end-l)/c,A=this.findBestLevel(h,a,i,f,n.abrBandWidthFactor,n.abrBandWidthUpFactor);if(A>=0)return A;d.logger.trace((f?"rebuffering expected":"buffer is empty")+", finding optimal quality level");var p=u?Math.min(u,n.maxStarvationDelay):n.maxStarvationDelay,v=n.abrBandWidthFactor,m=n.abrBandWidthUpFactor;if(!f){var g=this.bitrateTestDelay;g&&(p=(u?Math.min(u,n.maxLoadingDelay):n.maxLoadingDelay)-g,d.logger.trace("bitrate test took "+Math.round(1e3*g)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*p)+" ms"),v=m=1)}return A=this.findBestLevel(h,a,i,f+p,v,m),Math.max(A,0)},c.findBestLevel=function(e,t,r,i,n,a){for(var s,o=this.fragCurrent,u=this.partCurrent,l=this.lastLoadedFragLevel,c=this.hls.levels,h=c[l],f=!(null==h||null===(s=h.details)||void 0===s||!s.live),A=null==h?void 0:h.codecSet,p=u?u.duration:o?o.duration:0,v=r;v>=t;v--){var m=c[v];if(m&&(!A||m.codecSet===A)){var g,y=m.details,b=(u?null==y?void 0:y.partTarget:null==y?void 0:y.averagetargetduration)||p;g=v<=l?n*e:a*e;var _=c[v].maxBitrate,E=_*b/g;if(d.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+v+"/"+Math.round(g)+"/"+_+"/"+b+"/"+i+"/"+E),g>_&&(!E||f&&!this.bitrateTestDelay||E<i))return v}}return-1},t=e,(r=[{key:"nextAutoLevel",get:function(){var e=this._nextAutoLevel,t=this.bwEstimator;if(!(-1===e||t&&t.canEstimate()))return e;var r=this.getNextABRAutoLevel();return-1!==e&&(r=Math.min(e,r)),r},set:function(e){this._nextAutoLevel=e}}])&&l(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();t.default=c},"./repo/src/controller/base-playlist-controller.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return u}));var i=r("./repo/src/polyfills/number.ts"),n=r("./repo/src/types/level.ts"),a=r("./repo/src/controller/level-helper.ts"),s=r("./repo/src/utils/logger.ts"),o=r("./repo/src/errors.ts"),u=function(){function e(e,t){this.hls=void 0,this.timer=-1,this.canLoad=!1,this.retryCount=0,this.log=void 0,this.warn=void 0,this.log=s.logger.log.bind(s.logger,t+":"),this.warn=s.logger.warn.bind(s.logger,t+":"),this.hls=e}var t=e.prototype;return t.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},t.onError=function(e,t){t.fatal&&t.type===o.ErrorTypes.NETWORK_ERROR&&this.clearTimer()},t.clearTimer=function(){clearTimeout(this.timer),this.timer=-1},t.startLoad=function(){this.canLoad=!0,this.retryCount=0,this.loadPlaylist()},t.stopLoad=function(){this.canLoad=!1,this.clearTimer()},t.switchParams=function(e,t){var r=null==t?void 0:t.renditionReports;if(r)for(var a=0;a<r.length;a++){var s=r[a],o=""+s.URI;if(o===e.substr(-o.length)){var u=parseInt(s["LAST-MSN"]),d=parseInt(s["LAST-PART"]);if(t&&this.hls.config.lowLatencyMode){var l=Math.min(t.age-t.partTarget,t.targetduration);void 0!==d&&l>t.partTarget&&(d+=1)}if(Object(i.isFiniteNumber)(u))return new n.HlsUrlParameters(u,Object(i.isFiniteNumber)(d)?d:void 0,n.HlsSkip.No)}}},t.loadPlaylist=function(e){},t.shouldLoadTrack=function(e){return this.canLoad&&e&&!!e.url&&(!e.details||e.details.live)},t.playlistLoaded=function(e,t,r){var i=this,n=t.details,s=t.stats,o=s.loading.end?Math.max(0,self.performance.now()-s.loading.end):0;if(n.advancedDateTime=Date.now()-o,n.live||null!=r&&r.live){if(n.reloaded(r),r&&this.log("live playlist "+e+" "+(n.advanced?"REFRESHED "+n.lastPartSn+"-"+n.lastPartIndex:"MISSED")),r&&n.fragments.length>0&&Object(a.mergeDetails)(r,n),!this.canLoad||!n.live)return;var u,d=void 0,l=void 0;if(n.canBlockReload&&n.endSN&&n.advanced){var c=this.hls.config.lowLatencyMode,h=n.lastPartSn,f=n.endSN,A=n.lastPartIndex,p=h===f;-1!==A?(d=p?f+1:h,l=p?c?0:A:A+1):d=f+1;var v=n.age,m=v+n.ageHeader,g=Math.min(m-n.partTarget,1.5*n.targetduration);if(g>0){if(r&&g>r.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+r.tuneInGoal+" to: "+g+" with playlist age: "+n.age),g=0;else{var y=Math.floor(g/n.targetduration);d+=y,void 0!==l&&(l+=Math.round(g%n.targetduration/n.partTarget)),this.log("CDN Tune-in age: "+n.ageHeader+"s last advanced "+v.toFixed(2)+"s goal: "+g+" skip sn "+y+" to part "+l)}n.tuneInGoal=g}if(u=this.getDeliveryDirectives(n,t.deliveryDirectives,d,l),c||!p)return void this.loadPlaylist(u)}else u=this.getDeliveryDirectives(n,t.deliveryDirectives,d,l);var b=Object(a.computeReloadInterval)(n,s);void 0!==d&&n.canBlockReload&&(b-=n.partTarget||1),this.log("reload live playlist "+e+" in "+Math.round(b)+" ms"),this.timer=self.setTimeout((function(){return i.loadPlaylist(u)}),b)}else this.clearTimer()},t.getDeliveryDirectives=function(e,t,r,i){var a=Object(n.getSkipValue)(e,r);return null!=t&&t.skip&&e.deltaUpdateFailed&&(r=t.msn,i=t.part,a=n.HlsSkip.No),new n.HlsUrlParameters(r,i,a)},t.retryLoadingOrFail=function(e){var t,r=this,i=this.hls.config,n=this.retryCount<i.levelLoadingMaxRetry;if(n)if(this.retryCount++,e.details.indexOf("LoadTimeOut")>-1&&null!==(t=e.context)&&void 0!==t&&t.deliveryDirectives)this.warn("retry playlist loading #"+this.retryCount+' after "'+e.details+'"'),this.loadPlaylist();else{var a=Math.min(Math.pow(2,this.retryCount)*i.levelLoadingRetryDelay,i.levelLoadingMaxRetryTimeout);this.timer=self.setTimeout((function(){return r.loadPlaylist()}),a),this.warn("retry playlist loading #"+this.retryCount+" in "+a+' ms after "'+e.details+'"')}else this.warn('cannot recover from error "'+e.details+'"'),this.clearTimer(),e.fatal=!0;return n},e}()},"./repo/src/controller/base-stream-controller.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"State",(function(){return E})),r.d(t,"default",(function(){return T}));var i=r("./repo/src/polyfills/number.ts"),n=r("./repo/src/task-loop.ts"),a=r("./repo/src/controller/fragment-tracker.ts"),s=r("./repo/src/utils/buffer-helper.ts"),o=r("./repo/src/utils/logger.ts"),u=r("./repo/src/events.ts"),d=r("./repo/src/errors.ts"),l=r("./repo/src/types/transmuxer.ts"),c=r("./repo/src/utils/mp4-tools.ts"),h=r("./repo/src/utils/discontinuities.ts"),f=r("./repo/src/controller/fragment-finders.ts"),A=r("./repo/src/controller/level-helper.ts"),p=r("./repo/src/loader/fragment-loader.ts"),v=r("../crypt/dist/jsvmp.js"),m=r.n(v),g=r("./repo/src/utils/time-ranges.ts"),y=r("./repo/src/types/loader.ts");function b(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _(e,t){return(_=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var E={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",BACKTRACKING:"BACKTRACKING",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},T=function(e){var t,r;function n(t,r,i){var n;return(n=e.call(this)||this).hls=void 0,n.fragPrevious=null,n.fragCurrent=null,n.fragmentTracker=void 0,n.transmuxer=null,n._state=E.STOPPED,n.media=void 0,n.mediaBuffer=void 0,n.config=void 0,n.bitrateTest=!1,n.lastCurrentTime=0,n.nextLoadPosition=0,n.startPosition=0,n.loadedmetadata=!1,n.fragLoadError=0,n.retryDate=0,n.levels=null,n.fragmentLoader=void 0,n.levelLastLoaded=null,n.startFragRequested=!1,n.decrypter=void 0,n.initPTS=[],n.onvseeking=null,n.onvended=null,n.logPrefix="",n.log=void 0,n.warn=void 0,n.logPrefix=i,n.log=o.logger.log.bind(o.logger,i+":"),n.warn=o.logger.warn.bind(o.logger,i+":"),n.hls=t,n.fragmentLoader=new p.default(t.config),n.fragmentTracker=r,n.config=t.config,n.decrypter=new m.a(t,t.config),t.on(u.Events.KEY_LOADED,n.onKeyLoaded,function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(n)),n}r=e,(t=n).prototype=Object.create(r.prototype),t.prototype.constructor=t,_(t,r);var v,T,k=n.prototype;return k.doTick=function(){this.onTickEnd()},k.onTickEnd=function(){},k.startLoad=function(e){},k.stopLoad=function(){this.fragmentLoader.abort();var e=this.fragCurrent;e&&this.fragmentTracker.removeFragment(e),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=E.STOPPED},k._streamEnded=function(e,t){var r=this.fragCurrent,i=this.fragmentTracker;if(!t.live&&r&&r.sn>=t.endSN&&!e.nextStart){var n=t.partList;if(null!=n&&n.length){var o=n[n.length-1];return s.BufferHelper.isBuffered(this.media,o.start+o.duration/2)}var u=i.getState(r);return u===a.FragmentState.PARTIAL||u===a.FragmentState.OK}return!1},k.onMediaAttached=function(e,t){var r=this.media=this.mediaBuffer=t.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),r.addEventListener("seeking",this.onvseeking),r.addEventListener("ended",this.onvended);var i=this.config;this.levels&&i.autoStartLoad&&this.state===E.STOPPED&&this.startLoad(i.startPosition)},k.onMediaDetaching=function(){var e=this.media;null!=e&&e.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),e&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},k.onMediaSeeking=function(){var e=this.config,t=this.fragCurrent,r=this.media,n=this.mediaBuffer,a=this.state,o=r?r.currentTime:0,u=s.BufferHelper.bufferInfo(n||r,o,e.maxBufferHole);if(this.log("media seeking to "+(Object(i.isFiniteNumber)(o)?o.toFixed(3):o)+", state: "+a),a===E.ENDED)this.resetLoadingState();else if(t&&!u.len){var d=e.maxFragLookUpTolerance,l=t.start-d,c=o>t.start+t.duration+d;(o<l||c)&&(c&&t.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),t.loader.abort()),this.resetLoadingState())}r&&(this.lastCurrentTime=o),this.loadedmetadata||u.len||(this.nextLoadPosition=this.startPosition=o),this.tickImmediate()},k.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},k.onKeyLoaded=function(e,t){if(this.state===E.KEY_LOADING&&t.frag===this.fragCurrent&&this.levels){this.state=E.IDLE;var r=this.levels[t.frag.level].details;r&&this.loadFragment(t.frag,r,t.frag.start)}},k.onHandlerDestroying=function(){this.stopLoad(),e.prototype.onHandlerDestroying.call(this)},k.onHandlerDestroyed=function(){this.state=E.STOPPED,this.hls.off(u.Events.KEY_LOADED,this.onKeyLoaded,this),this.fragmentLoader&&this.fragmentLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.fragmentLoader=this.fragmentTracker=null,e.prototype.onHandlerDestroyed.call(this)},k.loadKey=function(e,t){this.log("Loading key for "+e.sn+" of ["+t.startSN+"-"+t.endSN+"], "+("[stream-controller]"===this.logPrefix?"level":"track")+" "+e.level),this.state=E.KEY_LOADING,this.fragCurrent=e,this.hls.trigger(u.Events.KEY_LOADING,{frag:e})},k.loadFragment=function(e,t,r){this._loadFragForPlayback(e,t,r)},k._loadFragForPlayback=function(e,t,r){var i=this;this._doFragLoad(e,t,r,(function(t){if(i.fragContextChanged(e))return i.warn("Fragment "+e.sn+(t.part?" p: "+t.part.index:"")+" of level "+e.level+" was dropped during download."),void i.fragmentTracker.removeFragment(e);e.stats.chunkCount++,i._handleFragmentLoadProgress(t)})).then((function(t){if(t){i.fragLoadError=0;var r=i.state;if(!i.fragContextChanged(e))return"payload"in t&&(i.log("Loaded fragment "+e.sn+" of level "+e.level),i.hls.trigger(u.Events.FRAG_LOADED,t),i.state===E.BACKTRACKING)?(i.fragmentTracker.backtrack(e,t),void i.resetFragmentLoading(e)):void i._handleFragmentLoadComplete(t);(r===E.FRAG_LOADING||r===E.BACKTRACKING||!i.fragCurrent&&r===E.PARSING)&&(i.fragmentTracker.removeFragment(e),i.state=E.IDLE)}})).catch((function(t){i.warn(t),i.resetFragmentLoading(e)}))},k.flushMainBuffer=function(e,t,r){if(void 0===r&&(r=null),e-t){var i={startOffset:e,endOffset:t,type:r};this.fragLoadError=0,this.hls.trigger(u.Events.BUFFER_FLUSHING,i)}},k._loadInitSegment=function(e){var t=this;this._doFragLoad(e).then((function(r){if(!r||t.fragContextChanged(e)||!t.levels)throw new Error("init load aborted");return r})).then((function(r){var i=t.hls,n=r.payload,a=e.decryptdata;if(n&&n.byteLength>0&&a&&a.key&&a.iv&&"AES-128"===a.method){var s=self.performance.now();return t.decrypter.webCryptoDecrypt(new Uint8Array(n),a.key.buffer,a.iv.buffer).then((function(t){var n=self.performance.now();return i.trigger(u.Events.FRAG_DECRYPTED,{frag:e,payload:t,stats:{tstart:s,tdecrypt:n}}),r.payload=t,r}))}return r})).then((function(r){var i=t.fragCurrent,n=t.hls,a=t.levels;if(!a)throw new Error("init load aborted, missing levels");var s=a[e.level].details;console.assert(s,"Level details are defined when init segment is loaded");var o=e.stats;t.state=E.IDLE,t.fragLoadError=0,e.data=new Uint8Array(r.payload),o.parsing.start=o.buffering.start=self.performance.now(),o.parsing.end=o.buffering.end=self.performance.now(),r.frag===i&&n.trigger(u.Events.FRAG_BUFFERED,{stats:o,frag:i,part:null,id:e.type}),t.tick()})).catch((function(r){t.warn(r),t.resetFragmentLoading(e)}))},k.fragContextChanged=function(e){var t=this.fragCurrent;return!e||!t||e.level!==t.level||e.sn!==t.sn||e.urlId!==t.urlId},k.fragBufferedComplete=function(e,t){var r=this.mediaBuffer?this.mediaBuffer:this.media;this.log("Buffered "+e.type+" sn: "+e.sn+(t?" part: "+t.index:"")+" of "+("[stream-controller]"===this.logPrefix?"level":"track")+" "+e.level+" "+g.default.toString(s.BufferHelper.getBuffered(r))),this.state=E.IDLE,this.tick()},k._handleFragmentLoadComplete=function(e){var t=this.transmuxer;if(t){var r=e.frag,i=e.part,n=e.partsLoaded,a=!n||0===n.length||n.some((function(e){return!e})),s=new l.ChunkMetadata(r.level,r.sn,r.stats.chunkCount+1,0,i?i.index:-1,!a);t.flush(s)}},k._handleFragmentLoadProgress=function(e){},k._doFragLoad=function(e,t,r,n){var a=this;if(void 0===r&&(r=null),!this.levels)throw new Error("frag load aborted, missing levels");if(r=Math.max(e.start,r||0),this.config.lowLatencyMode&&t){var s=t.partList;if(s&&n){r>e.end&&t.fragmentHint&&(e=t.fragmentHint);var o=this.getNextPart(s,e,r);if(o>-1){var d=s[o];return this.log("Loading part sn: "+e.sn+" p: "+d.index+" cc: "+e.cc+" of playlist ["+t.startSN+"-"+t.endSN+"] parts [0-"+o+"-"+(s.length-1)+"] "+("[stream-controller]"===this.logPrefix?"level":"track")+": "+e.level+", target: "+parseFloat(r.toFixed(3))),this.nextLoadPosition=d.start+d.duration,this.state=E.FRAG_LOADING,this.hls.trigger(u.Events.FRAG_LOADING,{frag:e,part:s[o],targetBufferTime:r}),this.doFragPartsLoad(e,s,o,n).catch((function(e){return a.handleFragLoadError(e)}))}if(!e.url||this.loadedEndOfParts(s,r))return Promise.resolve(null)}}return this.log("Loading fragment "+e.sn+" cc: "+e.cc+" "+(t?"of ["+t.startSN+"-"+t.endSN+"] ":"")+("[stream-controller]"===this.logPrefix?"level":"track")+": "+e.level+", target: "+parseFloat(r.toFixed(3))),Object(i.isFiniteNumber)(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=E.FRAG_LOADING,this.hls.trigger(u.Events.FRAG_LOADING,{frag:e,targetBufferTime:r}),this.fragmentLoader.load(e,n).catch((function(e){return a.handleFragLoadError(e)}))},k.doFragPartsLoad=function(e,t,r,i){var n=this;return new Promise((function(a,s){var o=[];!function r(d){var l=t[d];n.fragmentLoader.loadPart(e,l,i).then((function(i){o[l.index]=i;var s=i.part;n.hls.trigger(u.Events.FRAG_LOADED,i);var c=t[d+1];if(!c||c.fragment!==e)return a({frag:e,part:s,partsLoaded:o});r(d+1)})).catch(s)}(r)}))},k.handleFragLoadError=function(e){var t=e.data;return t&&t.details===d.ErrorDetails.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):this.hls.trigger(u.Events.ERROR,t),null},k._handleTransmuxerFlush=function(e){var t=this.getCurrentContext(e);if(t&&this.state===E.PARSING){var r=t.frag,i=t.part,n=t.level,a=self.performance.now();r.stats.parsing.end=a,i&&(i.stats.parsing.end=a),this.updateLevelTiming(r,i,n,e.partial)}else this.fragCurrent||(this.state=E.IDLE)},k.getCurrentContext=function(e){var t=this.levels,r=e.level,i=e.sn,n=e.part;if(!t||!t[r])return this.warn("Levels object was unset while buffering fragment "+i+" of level "+r+". The current chunk will not be buffered."),null;var a=t[r],s=n>-1?Object(A.getPartWith)(a,i,n):null,o=s?s.fragment:Object(A.getFragmentWithSN)(a,i,this.fragCurrent);return o?{frag:o,part:s,level:a}:null},k.bufferFragmentData=function(e,t,r,i){if(e&&this.state===E.PARSING){var n=e.data1,a=e.data2,s=n;if(n&&a&&(s=Object(c.appendUint8Array)(n,a)),s&&s.length){var o={type:e.type,frag:t,part:r,chunkMeta:i,parent:t.type,data:s};this.hls.trigger(u.Events.BUFFER_APPENDING,o),e.dropped&&e.independent&&!r&&this.flushBufferGap(t)}}},k.flushBufferGap=function(e){var t=this.media;if(t)if(s.BufferHelper.isBuffered(t,t.currentTime)){var r=t.currentTime,i=s.BufferHelper.bufferInfo(t,r,0),n=e.duration,a=Math.min(2*this.config.maxFragLookUpTolerance,.25*n),o=Math.max(Math.min(e.start-a,i.end-a),r+a);e.start-o>a&&this.flushMainBuffer(o,e.start)}else this.flushMainBuffer(0,e.start)},k.getFwdBufferInfo=function(e,t){var r=this.config,n=this.getLoadPosition();if(!Object(i.isFiniteNumber)(n))return null;var a=s.BufferHelper.bufferInfo(e,n,r.maxBufferHole);if(0===a.len&&void 0!==a.nextStart){var o=this.fragmentTracker.getBufferedFrag(n,t);if(o&&a.nextStart<o.end)return s.BufferHelper.bufferInfo(e,n,Math.max(a.nextStart,r.maxBufferHole))}return a},k.getMaxBufferLength=function(e){var t,r=this.config;return t=e?Math.max(8*r.maxBufferSize/e,r.maxBufferLength):r.maxBufferLength,Math.min(t,r.maxMaxBufferLength)},k.reduceMaxBufferLength=function(e){var t=this.config,r=e||t.maxBufferLength;return t.maxMaxBufferLength>=r&&(t.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+t.maxMaxBufferLength+"s"),!0)},k.getNextFragment=function(e,t){var r,i,n=t.fragments,a=n.length;if(!a)return null;var s,o=this.config,u=n[0].start;if(t.live){var d=o.initialLiveManifestSize;if(a<d)return this.warn("Not enough fragments to start playback (have: "+a+", need: "+d+")"),null;t.PTSKnown||this.startFragRequested||-1!==this.startPosition||(s=this.getInitialLiveFragment(t,n),this.startPosition=s?this.hls.liveSyncPosition||s.start:e)}else e<=u&&(s=n[0]);if(!s){var l=o.lowLatencyMode?t.partEnd:t.fragmentEnd;s=this.getFragmentAtPosition(e,l,t)}return null===(r=s)||void 0===r||!r.initSegment||null!==(i=s)&&void 0!==i&&i.initSegment.data||this.bitrateTest||(s=s.initSegment),s},k.getNextPart=function(e,t,r){for(var i=-1,n=!1,a=!0,s=0,o=e.length;s<o;s++){var u=e[s];if(a=a&&!u.independent,i>-1&&r<u.start)break;var d=u.loaded;!d&&(n||u.independent||a)&&u.fragment===t&&(i=s),n=d}return i},k.loadedEndOfParts=function(e,t){var r=e[e.length-1];return r&&t>r.start&&r.loaded},k.getInitialLiveFragment=function(e,t){var r=this.fragPrevious,i=null;if(r){if(e.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+r.programDateTime),i=Object(f.findFragmentByPDT)(t,r.endProgramDateTime,this.config.maxFragLookUpTolerance)),!i){var n=r.sn+1;if(n>=e.startSN&&n<=e.endSN){var a=t[n-e.startSN];r.cc===a.cc&&(i=a,this.log("Live playlist, switching playlist, load frag with next SN: "+i.sn))}i||(i=Object(f.findFragWithCC)(t,r.cc))&&this.log("Live playlist, switching playlist, load frag with same CC: "+i.sn)}}else{var s=this.hls.liveSyncPosition;null!==s&&(i=this.getFragmentAtPosition(s,this.bitrateTest?e.fragmentEnd:e.edge,e))}return i},k.getFragmentAtPosition=function(e,t,r){var i,n=this.config,s=this.fragPrevious,o=r.fragments,u=r.endSN,d=r.fragmentHint,l=n.maxFragLookUpTolerance,c=!!(n.lowLatencyMode&&r.partList&&d);if(c&&d&&!this.bitrateTest&&(o=o.concat(d),u=d.sn),e<t){var h=e>t-l?0:l;i=Object(f.findFragmentByPTS)(s,o,e,h)}else i=o[o.length-1];if(i){var A=i.sn-r.startSN,p=s&&i.level===s.level,v=o[A+1];if(this.fragmentTracker.getState(i)===a.FragmentState.BACKTRACKED){i=null;for(var m=A;o[m]&&this.fragmentTracker.getState(o[m])===a.FragmentState.BACKTRACKED;)i=s?o[m--]:o[--m];i||(i=v)}else s&&i.sn===s.sn&&!c&&p&&(i.sn<u&&this.fragmentTracker.getState(v)!==a.FragmentState.OK?(this.log("SN "+i.sn+" just loaded, load next one: "+v.sn),i=v):i=null)}return i},k.synchronizeToLiveEdge=function(e){var t=this.config,r=this.media;if(r){var i=this.hls.liveSyncPosition,n=r.currentTime,a=e.fragments[0].start,s=e.edge,o=n>=a-t.maxFragLookUpTolerance&&n<=s;if(null!==i&&r.duration>i&&(n<i||!o)){var u=void 0!==t.liveMaxLatencyDuration?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;(!o&&r.readyState<4||n<s-u)&&(this.loadedmetadata||(this.nextLoadPosition=i),r.readyState&&(this.warn("Playback: "+n.toFixed(3)+" is located too far from the end of live sliding playlist: "+s+", reset currentTime to : "+i.toFixed(3)),r.currentTime=i))}}},k.alignPlaylists=function(e,t){var r=this.levels,n=this.levelLastLoaded,a=this.fragPrevious,s=null!==n?r[n]:null,o=e.fragments.length;if(!o)return this.warn("No fragments in live playlist"),0;var u=e.fragments[0].start,d=!t,l=e.alignedSliding&&Object(i.isFiniteNumber)(u);if(d||!l&&!u){Object(h.alignStream)(a,s,e);var c=e.fragments[0].start;return this.log("Live playlist sliding: "+c.toFixed(2)+" start-sn: "+(t?t.startSN:"na")+"->"+e.startSN+" prev-sn: "+(a?a.sn:"na")+" fragments: "+o),c}return u},k.waitForCdnTuneIn=function(e){return e.live&&e.canBlockReload&&e.tuneInGoal>Math.max(e.partHoldBack,3*e.partTarget)},k.setStartPosition=function(e,t){var r=this.startPosition;if(r<t&&(r=-1),-1===r||-1===this.lastCurrentTime){var n=e.startTimeOffset;Object(i.isFiniteNumber)(n)?(r=t+n,n<0&&(r+=e.totalduration),r=Math.min(Math.max(t,r),t+e.totalduration),this.log("Start time offset "+n+" found in playlist, adjust startPosition to "+r),this.startPosition=r):e.live?r=this.hls.liveSyncPosition||t:this.startPosition=r=0,this.lastCurrentTime=r}this.nextLoadPosition=r},k.getLoadPosition=function(){var e=this.media,t=0;return this.loadedmetadata&&e?t=e.currentTime:this.nextLoadPosition&&(t=this.nextLoadPosition),t},k.handleFragLoadAborted=function(e,t){this.transmuxer&&"initSegment"!==e.sn&&e.stats.aborted&&(this.warn("Fragment "+e.sn+(t?" part"+t.index:"")+" of level "+e.level+" was aborted"),this.resetFragmentLoading(e))},k.resetFragmentLoading=function(e){this.fragCurrent&&this.fragContextChanged(e)||(this.state=E.IDLE)},k.onFragmentOrKeyLoadError=function(e,t){if(!t.fatal){var r=t.frag;if(r&&r.type===e){var i=this.fragCurrent;console.assert(i&&r.sn===i.sn&&r.level===i.level&&r.urlId===i.urlId,"Frag load error must match current frag to retry");var n=this.config;if(this.fragLoadError+1<=n.fragLoadingMaxRetry){if(this.resetLiveStartWhenNotLoaded(r.level))return;var a=Math.min(Math.pow(2,this.fragLoadError)*n.fragLoadingRetryDelay,n.fragLoadingMaxRetryTimeout);this.warn("Fragment "+r.sn+" of "+e+" "+r.level+" failed to load, retrying in "+a+"ms"),this.retryDate=self.performance.now()+a,this.fragLoadError++,this.state=E.FRAG_LOADING_WAITING_RETRY}else t.levelRetry?(e===y.PlaylistLevelType.AUDIO&&(this.fragCurrent=null),this.fragLoadError=0,this.state=E.IDLE):(o.logger.error(t.details+" reaches max retry, redispatch as fatal ..."),t.fatal=!0,this.hls.stopLoad(),this.state=E.ERROR)}}},k.afterBufferFlushed=function(e,t,r){if(e){var i=s.BufferHelper.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,i,r),this.state===E.ENDED&&this.resetLoadingState()}},k.resetLoadingState=function(){this.fragCurrent=null,this.fragPrevious=null,this.state=E.IDLE},k.resetLiveStartWhenNotLoaded=function(e){if(!this.loadedmetadata){this.startFragRequested=!1;var t=this.levels?this.levels[e].details:null;if(null!=t&&t.live)return this.startPosition=-1,this.setStartPosition(t,0),this.resetLoadingState(),!0;this.nextLoadPosition=this.startPosition}return!1},k.updateLevelTiming=function(e,t,r,i){var n=this,a=r.details;console.assert(!!a,"level.details must be defined"),Object.keys(e.elementaryStreams).reduce((function(t,s){var o=e.elementaryStreams[s];if(o){var d=o.endPTS-o.startPTS;if(d<=0)return n.warn("Could not parse fragment "+e.sn+" "+s+" duration reliably ("+d+") resetting transmuxer to fallback to playlist timing"),n.resetTransmuxer(),t||!1;var l=i?0:Object(A.updateFragPTSDTS)(a,e,o.startPTS,o.endPTS,o.startDTS,o.endDTS);return n.hls.trigger(u.Events.LEVEL_PTS_UPDATED,{details:a,level:r,drift:l,type:s,frag:e,start:o.startPTS,end:o.endPTS}),!0}return t}),!1)?(this.state=E.PARSED,this.hls.trigger(u.Events.FRAG_PARSED,{frag:e,part:t})):this.resetLoadingState()},k.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},v=n,(T=[{key:"state",get:function(){return this._state},set:function(e){var t=this._state;t!==e&&(this._state=e,this.log(t+"->"+e))}}])&&b(v.prototype,T),Object.defineProperty(v,"prototype",{writable:!1}),n}(n.default)},"./repo/src/controller/buffer-controller.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return f}));var i=r("./repo/src/polyfills/number.ts"),n=r("./repo/src/events.ts"),a=r("./repo/src/utils/logger.ts"),s=r("./repo/src/errors.ts"),o=r("./repo/src/utils/buffer-helper.ts"),u=r("./repo/src/utils/mediasource-helper.ts"),d=r("./repo/src/loader/fragment.ts"),l=r("./repo/src/controller/buffer-operation-queue.ts"),c=Object(u.getMediaSource)(),h=/([ha]vc.)(?:\.[^.,]+)+/,f=function(){function e(e){var t=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var e=t.hls,r=t.media,i=t.mediaSource;a.logger.log("[buffer-controller]: Media source opened"),r&&(t.updateMediaElementDuration(),e.trigger(n.Events.MEDIA_ATTACHED,{media:r})),i&&i.removeEventListener("sourceopen",t._onMediaSourceOpen),t.checkPendingTracks()},this._onMediaSourceClose=function(){a.logger.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){a.logger.log("[buffer-controller]: Media source ended")},this.hls=e,this._initSourceBuffer(),this.registerListeners()}var t=e.prototype;return t.hasSourceTypes=function(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0},t.destroy=function(){this.unregisterListeners(),this.details=null},t.registerListeners=function(){var e=this.hls;e.on(n.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(n.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(n.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.on(n.Events.BUFFER_RESET,this.onBufferReset,this),e.on(n.Events.BUFFER_APPENDING,this.onBufferAppending,this),e.on(n.Events.BUFFER_CODECS,this.onBufferCodecs,this),e.on(n.Events.BUFFER_EOS,this.onBufferEos,this),e.on(n.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(n.Events.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(n.Events.FRAG_PARSED,this.onFragParsed,this),e.on(n.Events.FRAG_CHANGED,this.onFragChanged,this)},t.unregisterListeners=function(){var e=this.hls;e.off(n.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(n.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(n.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.off(n.Events.BUFFER_RESET,this.onBufferReset,this),e.off(n.Events.BUFFER_APPENDING,this.onBufferAppending,this),e.off(n.Events.BUFFER_CODECS,this.onBufferCodecs,this),e.off(n.Events.BUFFER_EOS,this.onBufferEos,this),e.off(n.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(n.Events.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(n.Events.FRAG_PARSED,this.onFragParsed,this),e.off(n.Events.FRAG_CHANGED,this.onFragChanged,this)},t._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new l.default(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]}},t.onManifestParsed=function(e,t){var r=2;(t.audio&&!t.video||!t.altAudio)&&(r=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=r,this.details=null,a.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},t.onMediaAttaching=function(e,t){var r=this.media=t.media;if(r&&c){var i=this.mediaSource=new c;i.addEventListener("sourceopen",this._onMediaSourceOpen),i.addEventListener("sourceended",this._onMediaSourceEnded),i.addEventListener("sourceclose",this._onMediaSourceClose),r.src=self.URL.createObjectURL(i),this._objectUrl=r.src}},t.onMediaDetaching=function(){var e=this.media,t=this.mediaSource,r=this._objectUrl;if(t){if(a.logger.log("[buffer-controller]: media source detaching"),"open"===t.readyState)try{t.endOfStream()}catch(e){a.logger.warn("[buffer-controller]: onMediaDetaching: "+e.message+" while calling endOfStream")}this.onBufferReset(),t.removeEventListener("sourceopen",this._onMediaSourceOpen),t.removeEventListener("sourceended",this._onMediaSourceEnded),t.removeEventListener("sourceclose",this._onMediaSourceClose),e&&(r&&self.URL.revokeObjectURL(r),e.src===r?(e.removeAttribute("src"),e.load()):a.logger.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(n.Events.MEDIA_DETACHED,void 0)},t.onBufferReset=function(){var e=this;this.getSourceBufferTypes().forEach((function(t){var r=e.sourceBuffer[t];try{r&&(e.removeBufferListeners(t),e.mediaSource&&e.mediaSource.removeSourceBuffer(r),e.sourceBuffer[t]=void 0)}catch(e){a.logger.warn("[buffer-controller]: Failed to reset the "+t+" buffer",e)}})),this._initSourceBuffer()},t.onBufferCodecs=function(e,t){var r=this,i=this.getSourceBufferTypes().length;Object.keys(t).forEach((function(e){if(i){var n=r.tracks[e];if(n&&"function"==typeof n.buffer.changeType){var s=t[e],o=s.id,u=s.codec,d=s.levelCodec,l=s.container,c=s.metadata,f=(n.levelCodec||n.codec).replace(h,"$1"),A=(d||u).replace(h,"$1");if(f!==A){var p=l+";codecs="+(d||u);r.appendChangeType(e,p),a.logger.log("[buffer-controller]: switching codec "+f+" to "+A),r.tracks[e]={buffer:n.buffer,codec:u,container:l,levelCodec:d,metadata:c,id:o}}}}else r.pendingTracks[e]=t[e]})),i||(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&"open"===this.mediaSource.readyState&&this.checkPendingTracks())},t.appendChangeType=function(e,t){var r=this,i=this.operationQueue,n={execute:function(){var n=r.sourceBuffer[e];n&&(a.logger.log("[buffer-controller]: changing "+e+" sourceBuffer type to "+t),n.changeType(t)),i.shiftAndExecuteNext(e)},onStart:function(){},onComplete:function(){},onError:function(t){a.logger.warn("[buffer-controller]: Failed to change "+e+" SourceBuffer type",t)}};i.append(n,e)},t.onBufferAppending=function(e,t){var r=this,i=this.hls,u=this.operationQueue,d=this.tracks,l=t.data,c=t.type,h=t.frag,f=t.part,A=t.chunkMeta,p=A.buffering[c],v=self.performance.now();p.start=v;var m=h.stats.buffering,g=f?f.stats.buffering:null;0===m.start&&(m.start=v),g&&0===g.start&&(g.start=v);var y=d.audio,b="audio"===c&&1===A.id&&"audio/mpeg"===(null==y?void 0:y.container),_={execute:function(){if(p.executeStart=self.performance.now(),b){var e=r.sourceBuffer[c];if(e){var t=h.start-e.timestampOffset;Math.abs(t)>=.1&&(a.logger.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+h.start+" (delta: "+t+") sn: "+h.sn+")"),e.timestampOffset=h.start)}}r.appendExecutor(l,c)},onStart:function(){},onComplete:function(){var e=self.performance.now();p.executeEnd=p.end=e,0===m.first&&(m.first=e),g&&0===g.first&&(g.first=e);var t=r.sourceBuffer,i={};for(var a in t)i[a]=o.BufferHelper.getBuffered(t[a]);r.appendError=0,r.hls.trigger(n.Events.BUFFER_APPENDED,{type:c,frag:h,part:f,chunkMeta:A,parent:h.type,timeRanges:i})},onError:function(e){a.logger.error("[buffer-controller]: Error encountered while trying to append to the "+c+" SourceBuffer",e);var t={type:s.ErrorTypes.MEDIA_ERROR,parent:h.type,details:s.ErrorDetails.BUFFER_APPEND_ERROR,err:e,fatal:!1};e.code===DOMException.QUOTA_EXCEEDED_ERR?t.details=s.ErrorDetails.BUFFER_FULL_ERROR:(r.appendError++,t.details=s.ErrorDetails.BUFFER_APPEND_ERROR,r.appendError>i.config.appendErrorMaxRetry&&(a.logger.error("[buffer-controller]: Failed "+i.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),t.fatal=!0)),i.trigger(n.Events.ERROR,t)}};u.append(_,c)},t.onBufferFlushing=function(e,t){var r=this,i=this.operationQueue,s=function(e){return{execute:r.removeExecutor.bind(r,e,t.startOffset,t.endOffset),onStart:function(){},onComplete:function(){r.hls.trigger(n.Events.BUFFER_FLUSHED,{type:e})},onError:function(t){a.logger.warn("[buffer-controller]: Failed to remove from "+e+" SourceBuffer",t)}}};t.type?i.append(s(t.type),t.type):this.getSourceBufferTypes().forEach((function(e){i.append(s(e),e)}))},t.onFragParsed=function(e,t){var r=this,i=t.frag,s=t.part,o=[],u=s?s.elementaryStreams:i.elementaryStreams;u[d.ElementaryStreamTypes.AUDIOVIDEO]?o.push("audiovideo"):(u[d.ElementaryStreamTypes.AUDIO]&&o.push("audio"),u[d.ElementaryStreamTypes.VIDEO]&&o.push("video")),0===o.length&&a.logger.warn("Fragments must have at least one ElementaryStreamType set. type: "+i.type+" level: "+i.level+" sn: "+i.sn),this.blockBuffers((function(){var e=self.performance.now();i.stats.buffering.end=e,s&&(s.stats.buffering.end=e);var t=s?s.stats:i.stats;r.hls.trigger(n.Events.FRAG_BUFFERED,{frag:i,part:s,stats:t,id:i.type})}),o)},t.onFragChanged=function(e,t){this.flushBackBuffer()},t.onBufferEos=function(e,t){var r=this;this.getSourceBufferTypes().reduce((function(e,i){var n=r.sourceBuffer[i];return t.type&&t.type!==i||n&&!n.ended&&(n.ended=!0,a.logger.log("[buffer-controller]: "+i+" sourceBuffer now EOS")),e&&!(n&&!n.ended)}),!0)&&this.blockBuffers((function(){var e=r.mediaSource;e&&"open"===e.readyState&&e.endOfStream()}))},t.onLevelUpdated=function(e,t){var r=t.details;r.fragments.length&&(this.details=r,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},t.flushBackBuffer=function(){var e=this.hls,t=this.details,r=this.media,a=this.sourceBuffer;if(r&&null!==t){var s=this.getSourceBufferTypes();if(s.length){var u=t.live&&null!==e.config.liveBackBufferLength?e.config.liveBackBufferLength:e.config.backBufferLength;if(Object(i.isFiniteNumber)(u)&&!(u<0)){var d=r.currentTime,l=t.levelTargetDuration,c=Math.max(u,l),h=Math.floor(d/l)*l-c;s.forEach((function(r){var i=a[r];if(i){var s=o.BufferHelper.getBuffered(i);s.length>0&&h>s.start(0)&&(e.trigger(n.Events.BACK_BUFFER_REACHED,{bufferEnd:h}),t.live&&e.trigger(n.Events.LIVE_BACK_BUFFER_REACHED,{bufferEnd:h}),e.trigger(n.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:h,type:r}))}}))}}}},t.updateMediaElementDuration=function(){if(this.details&&this.media&&this.mediaSource&&"open"===this.mediaSource.readyState){var e=this.details,t=this.hls,r=this.media,n=this.mediaSource,s=e.fragments[0].start+e.totalduration,o=r.duration,u=Object(i.isFiniteNumber)(n.duration)?n.duration:0;e.live&&t.config.liveDurationInfinity?(a.logger.log("[buffer-controller]: Media Source duration is set to Infinity"),n.duration=1/0,this.updateSeekableRange(e)):(s>u&&s>o||!Object(i.isFiniteNumber)(o))&&(a.logger.log("[buffer-controller]: Updating Media Source duration to "+s.toFixed(3)),n.duration=s)}},t.updateSeekableRange=function(e){var t=this.mediaSource,r=e.fragments;if(r.length&&e.live&&null!=t&&t.setLiveSeekableRange){var i=Math.max(0,r[0].start),n=Math.max(i,i+e.totalduration);t.setLiveSeekableRange(i,n)}},t.checkPendingTracks=function(){var e=this.bufferCodecEventsExpected,t=this.operationQueue,r=this.pendingTracks,i=Object.keys(r).length;if(i&&!e||2===i){this.createSourceBuffers(r),this.pendingTracks={};var a=this.getSourceBufferTypes();if(0===a.length)return void this.hls.trigger(n.Events.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,reason:"could not create source buffer for media codec(s)"});a.forEach((function(e){t.executeNext(e)}))}},t.createSourceBuffers=function(e){var t=this.sourceBuffer,r=this.mediaSource;if(!r)throw Error("createSourceBuffers called when mediaSource was null");var i=0;for(var o in e)if(!t[o]){var u=e[o];if(!u)throw Error("source buffer exists for track "+o+", however track does not");var d=u.levelCodec||u.codec,l=u.container+";codecs="+d;a.logger.log("[buffer-controller]: creating sourceBuffer("+l+")");try{var c=t[o]=r.addSourceBuffer(l),h=o;this.addBufferListener(h,"updatestart",this._onSBUpdateStart),this.addBufferListener(h,"updateend",this._onSBUpdateEnd),this.addBufferListener(h,"error",this._onSBUpdateError),this.tracks[o]={buffer:c,codec:d,container:u.container,levelCodec:u.levelCodec,metadata:u.metadata,id:u.id},i++}catch(e){a.logger.error("[buffer-controller]: error while trying to add sourceBuffer: "+e.message),this.hls.trigger(n.Events.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:e,mimeType:l})}}i&&this.hls.trigger(n.Events.BUFFER_CREATED,{tracks:this.tracks})},t._onSBUpdateStart=function(e){this.operationQueue.current(e).onStart()},t._onSBUpdateEnd=function(e){var t=this.operationQueue;t.current(e).onComplete(),t.shiftAndExecuteNext(e)},t._onSBUpdateError=function(e,t){a.logger.error("[buffer-controller]: "+e+" SourceBuffer error",t),this.hls.trigger(n.Events.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1});var r=this.operationQueue.current(e);r&&r.onError(t)},t.removeExecutor=function(e,t,r){var n=this.media,s=this.mediaSource,o=this.operationQueue,u=this.sourceBuffer[e];if(!n||!s||!u)return a.logger.warn("[buffer-controller]: Attempting to remove from the "+e+" SourceBuffer, but it does not exist"),void o.shiftAndExecuteNext(e);var d=Object(i.isFiniteNumber)(n.duration)?n.duration:1/0,l=Object(i.isFiniteNumber)(s.duration)?s.duration:1/0,c=Math.max(0,t),h=Math.min(r,d,l);h>c?(a.logger.log("[buffer-controller]: Removing ["+c+","+h+"] from the "+e+" SourceBuffer"),console.assert(!u.updating,e+" sourceBuffer must not be updating"),u.remove(c,h)):o.shiftAndExecuteNext(e)},t.appendExecutor=function(e,t){var r=this.operationQueue,i=this.sourceBuffer[t];if(!i)return a.logger.warn("[buffer-controller]: Attempting to append to the "+t+" SourceBuffer, but it does not exist"),void r.shiftAndExecuteNext(t);i.ended=!1,console.assert(!i.updating,t+" sourceBuffer must not be updating"),i.appendBuffer(e)},t.blockBuffers=function(e,t){var r=this;if(void 0===t&&(t=this.getSourceBufferTypes()),!t.length)return a.logger.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),void Promise.resolve(e);var i=this.operationQueue,n=t.map((function(e){return i.appendBlocker(e)}));Promise.all(n).then((function(){e(),t.forEach((function(e){var t=r.sourceBuffer[e];t&&t.updating||i.shiftAndExecuteNext(e)}))}))},t.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},t.addBufferListener=function(e,t,r){var i=this.sourceBuffer[e];if(i){var n=r.bind(this,e);this.listeners[e].push({event:t,listener:n}),i.addEventListener(t,n)}},t.removeBufferListeners=function(e){var t=this.sourceBuffer[e];t&&this.listeners[e].forEach((function(e){t.removeEventListener(e.event,e.listener)}))},e}()},"./repo/src/controller/buffer-operation-queue.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return n}));var i=r("./repo/src/utils/logger.ts"),n=function(){function e(e){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=e}var t=e.prototype;return t.append=function(e,t){var r=this.queues[t];r.push(e),1===r.length&&this.buffers[t]&&this.executeNext(t)},t.insertAbort=function(e,t){this.queues[t].unshift(e),this.executeNext(t)},t.appendBlocker=function(e){var t,r=new Promise((function(e){t=e})),i={execute:t,onStart:function(){},onComplete:function(){},onError:function(){}};return this.append(i,e),r},t.executeNext=function(e){var t=this.buffers,r=this.queues,n=t[e],a=r[e];if(a.length){var s=a[0];try{s.execute()}catch(t){i.logger.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),s.onError(t),n&&n.updating||(a.shift(),this.executeNext(e))}}},t.shiftAndExecuteNext=function(e){this.queues[e].shift(),this.executeNext(e)},t.current=function(e){return this.queues[e][0]},e}()},"./repo/src/controller/cap-level-controller.ts":function(e,t,r){"use strict";r.r(t);var i=r("./repo/src/events.ts");function n(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var a=function(){function e(e){this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.hls=void 0,this.streamController=void 0,this.clientRect=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var t,r,a=e.prototype;return a.setStreamController=function(e){this.streamController=e},a.destroy=function(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},a.registerListeners=function(){var e=this.hls;e.on(i.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(i.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(i.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.on(i.Events.BUFFER_CODECS,this.onBufferCodecs,this),e.on(i.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},a.unregisterListener=function(){var e=this.hls;e.off(i.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(i.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(i.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.off(i.Events.BUFFER_CODECS,this.onBufferCodecs,this),e.off(i.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},a.onFpsDropLevelCapping=function(t,r){e.isLevelAllowed(r.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(r.droppedLevel)},a.onMediaAttaching=function(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null},a.onManifestParsed=function(e,t){var r=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,r.config.capLevelToPlayerSize&&t.video&&this.startCapping()},a.onBufferCodecs=function(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()},a.onMediaDetaching=function(){this.stopCapping()},a.detectPlayerSize=function(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){var e=this.hls.levels;if(e.length){var t=this.hls;t.autoLevelCapping=this.getMaxLevel(e.length-1),t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}},a.getMaxLevel=function(t){var r=this,i=this.hls.levels;if(!i.length)return-1;var n=i.filter((function(i,n){return e.isLevelAllowed(n,r.restrictedLevels)&&n<=t}));return this.clientRect=null,e.getMaxLevelByMediaSize(n,this.mediaWidth,this.mediaHeight)},a.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},a.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},a.getDimensions=function(){if(this.clientRect)return this.clientRect;var e=this.media,t={width:0,height:0};if(e){var r=e.getBoundingClientRect();t.width=r.width,t.height=r.height,t.width||t.height||(t.width=r.right-r.left||e.width||0,t.height=r.bottom-r.top||e.height||0)}return this.clientRect=t,t},e.isLevelAllowed=function(e,t){return void 0===t&&(t=[]),-1===t.indexOf(e)},e.getMaxLevelByMediaSize=function(e,t,r){if(!e||!e.length)return-1;for(var i,n,a=e.length-1,s=0;s<e.length;s+=1){var o=e[s];if((o.width>=t||o.height>=r)&&(i=o,!(n=e[s+1])||i.width!==n.width||i.height!==n.height)){a=s;break}}return a},t=e,(r=[{key:"mediaWidth",get:function(){return this.getDimensions().width*this.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*this.contentScaleFactor}},{key:"contentScaleFactor",get:function(){var e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch(e){}return e}}])&&n(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();t.default=a},"./repo/src/controller/fps-controller.ts":function(e,t,r){"use strict";r.r(t);var i=r("./repo/src/events.ts"),n=r("./repo/src/utils/logger.ts"),a=function(){function e(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}var t=e.prototype;return t.setStreamController=function(e){this.streamController=e},t.registerListeners=function(){this.hls.on(i.Events.MEDIA_ATTACHING,this.onMediaAttaching,this)},t.unregisterListeners=function(){this.hls.off(i.Events.MEDIA_ATTACHING,this.onMediaAttaching)},t.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},t.onMediaAttaching=function(e,t){var r=this.hls.config;if(r.capLevelOnFPSDrop){var i=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=i,i&&"function"==typeof i.getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),r.fpsDroppedMonitoringPeriod)}},t.checkFPS=function(e,t,r){var a=performance.now();if(t){if(this.lastTime){var s=a-this.lastTime,o=r-this.lastDroppedFrames,u=t-this.lastDecodedFrames,d=1e3*o/s,l=this.hls;if(l.trigger(i.Events.FPS_DROP,{currentDropped:o,currentDecoded:u,totalDroppedFrames:r}),d>0&&o>l.config.fpsDroppedMonitoringThreshold*u){var c=l.currentLevel;n.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+c),c>0&&(-1===l.autoLevelCapping||l.autoLevelCapping>=c)&&(c-=1,l.trigger(i.Events.FPS_DROP_LEVEL_CAPPING,{level:c,droppedLevel:l.currentLevel}),l.autoLevelCapping=c,this.streamController.nextLevelSwitch())}}this.lastTime=a,this.lastDroppedFrames=r,this.lastDecodedFrames=t}},t.checkFPSInterval=function(){var e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){var t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)},e}();t.default=a},"./repo/src/controller/fragment-finders.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"findFragmentByPDT",(function(){return a})),r.d(t,"findFragmentByPTS",(function(){return s})),r.d(t,"fragmentWithinToleranceTest",(function(){return o})),r.d(t,"pdtWithinToleranceTest",(function(){return u})),r.d(t,"findFragWithCC",(function(){return d}));var i=r("./repo/src/polyfills/number.ts"),n=r("./repo/src/utils/binary-search.ts");function a(e,t,r){if(null===t||!Array.isArray(e)||!e.length||!Object(i.isFiniteNumber)(t))return null;if(t<(e[0].programDateTime||0))return null;if(t>=(e[e.length-1].endProgramDateTime||0))return null;r=r||0;for(var n=0;n<e.length;++n){var a=e[n];if(u(t,r,a))return a}return null}function s(e,t,r,i){void 0===r&&(r=0),void 0===i&&(i=0);var a=null;return e?a=t[e.sn-t[0].sn+1]||null:0===r&&0===t[0].start&&(a=t[0]),a&&0===o(r,i,a)?a:n.default.search(t,o.bind(null,r,i))||a}function o(e,t,r){void 0===e&&(e=0),void 0===t&&(t=0);var i=Math.min(t,r.duration+(r.deltaPTS?r.deltaPTS:0));return r.start+r.duration-i<=e?1:r.start-i>e&&r.start?-1:0}function u(e,t,r){var i=1e3*Math.min(t,r.duration+(r.deltaPTS?r.deltaPTS:0));return(r.endProgramDateTime||0)-i>e}function d(e,t){return n.default.search(e,(function(e){return e.cc<t?1:e.cc>t?-1:0}))}},"./repo/src/controller/fragment-tracker.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"FragmentState",(function(){return i})),r.d(t,"FragmentTracker",(function(){return s}));var i,n=r("./repo/src/events.ts"),a=r("./repo/src/types/loader.ts");!function(e){e.NOT_LOADED="NOT_LOADED",e.BACKTRACKED="BACKTRACKED",e.APPENDING="APPENDING",e.PARTIAL="PARTIAL",e.OK="OK"}(i||(i={}));var s=function(){function e(e){this.activeFragment=null,this.activeParts=null,this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hls=e,this._registerListeners()}var t=e.prototype;return t._registerListeners=function(){var e=this.hls;e.on(n.Events.BUFFER_APPENDED,this.onBufferAppended,this),e.on(n.Events.FRAG_BUFFERED,this.onFragBuffered,this),e.on(n.Events.FRAG_LOADED,this.onFragLoaded,this)},t._unregisterListeners=function(){var e=this.hls;e.off(n.Events.BUFFER_APPENDED,this.onBufferAppended,this),e.off(n.Events.FRAG_BUFFERED,this.onFragBuffered,this),e.off(n.Events.FRAG_LOADED,this.onFragLoaded,this)},t.destroy=function(){this._unregisterListeners(),this.fragments=this.timeRanges=null},t.getAppendedFrag=function(e,t){if(t===a.PlaylistLevelType.MAIN){var r=this.activeFragment,i=this.activeParts;if(!r)return null;if(i)for(var n=i.length;n--;){var s=i[n],o=s?s.end:r.appendedPTS;if(s.start<=e&&void 0!==o&&e<=o)return n>9&&(this.activeParts=i.slice(n-9)),s}else if(r.start<=e&&void 0!==r.appendedPTS&&e<=r.appendedPTS)return r}return this.getBufferedFrag(e,t)},t.getBufferedFrag=function(e,t){for(var r=this.fragments,i=Object.keys(r),n=i.length;n--;){var a=r[i[n]];if((null==a?void 0:a.body.type)===t&&a.buffered){var s=a.body;if(s.start<=e&&e<=s.end)return s}}return null},t.detectEvictedFragments=function(e,t,r){var i=this;Object.keys(this.fragments).forEach((function(n){var a=i.fragments[n];if(a)if(a.buffered){var s=a.range[e];s&&s.time.some((function(e){var r=!i.isTimeBuffered(e.startPTS,e.endPTS,t);return r&&i.removeFragment(a.body),r}))}else a.body.type===r&&i.removeFragment(a.body)}))},t.detectPartialFragments=function(e){var t=this,r=this.timeRanges,i=e.frag,n=e.part;if(r&&"initSegment"!==i.sn){var a=u(i),s=this.fragments[a];s&&(Object.keys(r).forEach((function(e){var a=i.elementaryStreams[e];if(a){var o=r[e],u=null!==n||!0===a.partial;s.range[e]=t.getBufferedTimes(i,n,u,o)}})),s.backtrack=s.loaded=null,Object.keys(s.range).length?s.buffered=!0:this.removeFragment(s.body))}},t.fragBuffered=function(e){var t=u(e),r=this.fragments[t];r&&(r.backtrack=r.loaded=null,r.buffered=!0)},t.getBufferedTimes=function(e,t,r,i){for(var n={time:[],partial:r},a=t?t.start:e.start,s=t?t.end:e.end,o=e.minEndPTS||s,u=e.maxStartPTS||a,d=0;d<i.length;d++){var l=i.start(d)-this.bufferPadding,c=i.end(d)+this.bufferPadding;if(u>=l&&o<=c){n.time.push({startPTS:Math.max(a,i.start(d)),endPTS:Math.min(s,i.end(d))});break}if(a<c&&s>l)n.partial=!0,n.time.push({startPTS:Math.max(a,i.start(d)),endPTS:Math.min(s,i.end(d))});else if(s<=l)break}return n},t.getPartialFragment=function(e){var t,r,i,n=null,a=0,s=this.bufferPadding,u=this.fragments;return Object.keys(u).forEach((function(d){var l=u[d];l&&o(l)&&(r=l.body.start-s,i=l.body.end+s,e>=r&&e<=i&&(t=Math.min(e-r,i-e),a<=t&&(n=l.body,a=t)))})),n},t.getState=function(e){var t=u(e),r=this.fragments[t];return r?r.buffered?o(r)?i.PARTIAL:i.OK:r.backtrack?i.BACKTRACKED:i.APPENDING:i.NOT_LOADED},t.backtrack=function(e,t){var r=u(e),i=this.fragments[r];if(!i||i.backtrack)return null;var n=i.backtrack=t||i.loaded;return i.loaded=null,n},t.getBacktrackData=function(e){var t=u(e),r=this.fragments[t];if(r){var i,n=r.backtrack;if(null!=n&&null!==(i=n.payload)&&void 0!==i&&i.byteLength)return n;this.removeFragment(e)}return null},t.isTimeBuffered=function(e,t,r){for(var i,n,a=0;a<r.length;a++){if(i=r.start(a)-this.bufferPadding,n=r.end(a)+this.bufferPadding,e>=i&&t<=n)return!0;if(t<=i)return!1}return!1},t.onFragLoaded=function(e,t){var r=t.frag,i=t.part;if("initSegment"!==r.sn&&!r.bitrateTest&&!i){var n=u(r);this.fragments[n]={body:r,loaded:t,backtrack:null,buffered:!1,range:Object.create(null)}}},t.onBufferAppended=function(e,t){var r=this,i=t.frag,n=t.part,s=t.timeRanges;if(i.type===a.PlaylistLevelType.MAIN)if(this.activeFragment=i,n){var o=this.activeParts;o||(this.activeParts=o=[]),o.push(n)}else this.activeParts=null;this.timeRanges=s,Object.keys(s).forEach((function(e){var t=s[e];if(r.detectEvictedFragments(e,t),!n)for(var a=0;a<t.length;a++)i.appendedPTS=Math.max(t.end(a),i.appendedPTS||0)}))},t.onFragBuffered=function(e,t){this.detectPartialFragments(t)},t.hasFragment=function(e){var t=u(e);return!!this.fragments[t]},t.removeFragmentsInRange=function(e,t,r){var i=this;Object.keys(this.fragments).forEach((function(n){var a=i.fragments[n];if(a&&a.buffered){var s=a.body;s.type===r&&s.start<t&&s.end>e&&i.removeFragment(s)}}))},t.removeFragment=function(e){var t=u(e);e.stats.loaded=0,e.clearElementaryStreamInfo(),delete this.fragments[t]},t.removeAllFragments=function(){this.fragments=Object.create(null),this.activeFragment=null,this.activeParts=null},e}();function o(e){var t,r;return e.buffered&&((null===(t=e.range.video)||void 0===t?void 0:t.partial)||(null===(r=e.range.audio)||void 0===r?void 0:r.partial))}function u(e){return e.type+"_"+e.level+"_"+e.urlId+"_"+e.sn}},"./repo/src/controller/gap-controller.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"STALL_MINIMUM_DURATION_MS",(function(){return o})),r.d(t,"MAX_START_GAP_JUMP",(function(){return u})),r.d(t,"SKIP_BUFFER_HOLE_STEP_SECONDS",(function(){return d})),r.d(t,"SKIP_BUFFER_RANGE_START",(function(){return l})),r.d(t,"default",(function(){return c}));var i=r("./repo/src/utils/buffer-helper.ts"),n=r("./repo/src/errors.ts"),a=r("./repo/src/events.ts"),s=r("./repo/src/utils/logger.ts"),o=250,u=2,d=.1,l=.05,c=function(){function e(e,t,r,i){this.config=void 0,this.media=void 0,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=e,this.media=t,this.fragmentTracker=r,this.hls=i}var t=e.prototype;return t.destroy=function(){this.hls=this.fragmentTracker=this.media=null},t.poll=function(e){var t=this.config,r=this.media,n=this.stalled,a=r.currentTime,d=r.seeking,l=this.seeking&&!d,c=!this.seeking&&d;if(this.seeking=d,a===e){if((c||l)&&(this.stalled=null),!r.paused&&!r.ended&&0!==r.playbackRate&&i.BufferHelper.getBuffered(r).length){var h=i.BufferHelper.bufferInfo(r,a,0),f=h.len>0,A=h.nextStart||0;if(f||A){if(d){var p=h.len>u,v=!A||A-a>u&&!this.fragmentTracker.getPartialFragment(a);if(p||v)return;this.moved=!1}if(!this.moved&&null!==this.stalled){var m,g=Math.max(A,h.start||0)-a,y=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,b=(null==y||null===(m=y.details)||void 0===m?void 0:m.live)?2*y.details.targetduration:u;if(g>0&&g<=b)return void this._trySkipBufferHole(null)}var _=self.performance.now();if(null!==n){var E=_-n;!d&&E>=o&&this._reportStall(h.len);var T=i.BufferHelper.bufferInfo(r,a,t.maxBufferHole);this._tryFixBufferStall(T,E)}else this.stalled=_}}}else if(this.moved=!0,null!==n){if(this.stallReported){var k=self.performance.now()-n;s.logger.warn("playback not stuck anymore @"+a+", after "+Math.round(k)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}},t._tryFixBufferStall=function(e,t){var r=this.config,i=this.fragmentTracker,n=this.media.currentTime,a=i.getPartialFragment(n);a&&this._trySkipBufferHole(a)||e.len>r.maxBufferHole&&t>1e3*r.highBufferWatchdogPeriod&&(s.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())},t._reportStall=function(e){var t=this.hls,r=this.media;this.stallReported||(this.stallReported=!0,s.logger.warn("Playback stalling at @"+r.currentTime+" due to low buffer (buffer="+e+")"),t.trigger(a.Events.ERROR,{type:n.ErrorTypes.MEDIA_ERROR,details:n.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:e}))},t._trySkipBufferHole=function(e){for(var t=this.config,r=this.hls,o=this.media,u=o.currentTime,c=0,h=i.BufferHelper.getBuffered(o),f=0;f<h.length;f++){var A=h.start(f);if(u+t.maxBufferHole>=c&&u<A){var p=Math.max(A+l,o.currentTime+d);return s.logger.warn("skipping hole, adjusting currentTime from "+u+" to "+p),this.moved=!0,this.stalled=null,o.currentTime=p,e&&r.trigger(a.Events.ERROR,{type:n.ErrorTypes.MEDIA_ERROR,details:n.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+u+" to "+p,frag:e}),p}c=h.end(f)}return 0},t._tryNudgeBuffer=function(){var e=this.config,t=this.hls,r=this.media,i=this.nudgeRetry,o=r.currentTime;if(this.nudgeRetry++,i<e.nudgeMaxRetry){var u=o+(i+1)*e.nudgeOffset;s.logger.warn("Nudging 'currentTime' from "+o+" to "+u),r.currentTime=u,t.trigger(a.Events.ERROR,{type:n.ErrorTypes.MEDIA_ERROR,details:n.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else s.logger.error("Playhead still not moving while enough data buffered @"+o+" after "+e.nudgeMaxRetry+" nudges"),t.trigger(a.Events.ERROR,{type:n.ErrorTypes.MEDIA_ERROR,details:n.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})},e}()},"./repo/src/controller/id3-track-controller.ts":function(e,t,r){"use strict";r.r(t);var i=r("./repo/src/events.ts"),n=r("./repo/src/utils/texttrack-utils.ts"),a=r("./repo/src/demux/id3.ts"),s=function(){function e(e){this.hls=void 0,this.id3Track=null,this.media=null,this.hls=e,this._registerListeners()}var t=e.prototype;return t.destroy=function(){this._unregisterListeners()},t._registerListeners=function(){var e=this.hls;e.on(i.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(i.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(i.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(i.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},t._unregisterListeners=function(){var e=this.hls;e.off(i.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(i.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(i.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(i.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},t.onMediaAttached=function(e,t){this.media=t.media},t.onMediaDetaching=function(){this.id3Track&&(Object(n.clearCurrentCues)(this.id3Track),this.id3Track=null,this.media=null)},t.getID3Track=function(e){if(this.media){for(var t=0;t<e.length;t++){var r=e[t];if("metadata"===r.kind&&"id3"===r.label)return Object(n.sendAddTrackEvent)(r,this.media),r}return this.media.addTextTrack("metadata","id3")}},t.onFragParsingMetadata=function(e,t){if(this.media){var r=t.frag,i=t.samples;this.id3Track||(this.id3Track=this.getID3Track(this.media.textTracks),this.id3Track.mode="hidden");for(var n=self.WebKitDataCue||self.VTTCue||self.TextTrackCue,s=0;s<i.length;s++){var o=a.getID3Frames(i[s].data);if(o){var u=i[s].pts,d=s<i.length-1?i[s+1].pts:r.end;d-u<=0&&(d=u+.25);for(var l=0;l<o.length;l++){var c=o[l];if(!a.isTimeStampFrame(c)){var h=new n(u,d,"");h.value=c,this.id3Track.addCue(h)}}}}}},t.onBufferFlushing=function(e,t){var r=t.startOffset,i=t.endOffset,a=t.type;if(!a||"audio"===a){var s=this.id3Track;s&&Object(n.removeCuesInRange)(s,r,i)}},e}();t.default=s},"./repo/src/controller/latency-controller.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return o}));var i=r("./repo/src/errors.ts"),n=r("./repo/src/events.ts"),a=r("./repo/src/utils/logger.ts");function s(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var o=function(){function e(e){var t=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return t.timeupdate()},this.hls=e,this.config=e.config,this.registerListeners()}var t,r,o=e.prototype;return o.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},o.registerListeners=function(){this.hls.on(n.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(n.Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(n.Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(n.Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(n.Events.ERROR,this.onError,this)},o.unregisterListeners=function(){this.hls.off(n.Events.MEDIA_ATTACHED,this.onMediaAttached),this.hls.off(n.Events.MEDIA_DETACHING,this.onMediaDetaching),this.hls.off(n.Events.MANIFEST_LOADING,this.onManifestLoading),this.hls.off(n.Events.LEVEL_UPDATED,this.onLevelUpdated),this.hls.off(n.Events.ERROR,this.onError)},o.onMediaAttached=function(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},o.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},o.onManifestLoading=function(){this.levelDetails=null,this._latency=null,this.stallCount=0},o.onLevelUpdated=function(e,t){var r=t.details;this.levelDetails=r,r.advanced&&this.timeupdate(),!r.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},o.onError=function(e,t){t.details===i.ErrorDetails.BUFFER_STALLED_ERROR&&(this.stallCount++,a.logger.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},o.timeupdate=function(){var e=this.media,t=this.levelDetails;if(e&&t){this.currentTime=e.currentTime;var r=this.computeLatency();if(null!==r){this._latency=r;var i=this.config,n=i.lowLatencyMode,a=i.maxLiveSyncPlaybackRate;if(n&&1!==a){var s=this.targetLatency;if(null!==s){var o=r-s,u=o<Math.min(this.maxLatency,s+t.targetduration);if(t.live&&u&&o>.05&&this.forwardBufferLength>1){var d=Math.min(2,Math.max(1,a)),l=Math.round(2/(1+Math.exp(-.75*o-this.edgeStalled))*20)/20;e.playbackRate=Math.min(d,Math.max(1,l))}else 1!==e.playbackRate&&0!==e.playbackRate&&(e.playbackRate=1)}}}}},o.estimateLiveEdge=function(){var e=this.levelDetails;return null===e?null:e.edge+e.age},o.computeLatency=function(){var e=this.estimateLiveEdge();return null===e?null:e-this.currentTime},t=e,(r=[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var e=this.config,t=this.levelDetails;return void 0!==e.liveMaxLatencyDuration?e.liveMaxLatencyDuration:t?e.liveMaxLatencyDurationCount*t.targetduration:0}},{key:"targetLatency",get:function(){var e=this.levelDetails;if(null===e)return null;var t=e.holdBack,r=e.partHoldBack,i=e.targetduration,n=this.config,a=n.liveSyncDuration,s=n.liveSyncDurationCount,o=n.lowLatencyMode,u=this.hls.userConfig,d=o&&r||t;(u.liveSyncDuration||u.liveSyncDurationCount||0===d)&&(d=void 0!==a?a:s*i);var l=i;return d+Math.min(1*this.stallCount,l)}},{key:"liveSyncPosition",get:function(){var e=this.estimateLiveEdge(),t=this.targetLatency,r=this.levelDetails;if(null===e||null===t||null===r)return null;var i=r.edge,n=e-t-this.edgeStalled,a=i-r.totalduration,s=i-(this.config.lowLatencyMode&&r.partTarget||r.targetduration);return Math.min(Math.max(a,n),s)}},{key:"drift",get:function(){var e=this.levelDetails;return null===e?1:e.drift}},{key:"edgeStalled",get:function(){var e=this.levelDetails;if(null===e)return 0;var t=3*(this.config.lowLatencyMode&&e.partTarget||e.targetduration);return Math.max(e.age-t,0)}},{key:"forwardBufferLength",get:function(){var e=this.media,t=this.levelDetails;if(!e||!t)return 0;var r=e.buffered.length;return(r?e.buffered.end(r-1):t.edge)-this.currentTime}}])&&s(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}()},"./repo/src/controller/level-controller.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return A}));var i=r("./repo/src/types/level.ts"),n=r("./repo/src/events.ts"),a=r("./repo/src/errors.ts"),s=r("./repo/src/utils/codecs.ts"),o=r("./repo/src/controller/level-helper.ts"),u=r("./repo/src/controller/base-playlist-controller.ts"),d=r("./repo/src/types/loader.ts");function l(){return(l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function c(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var f=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),A=function(e){var t,r;function u(t){var r;return(r=e.call(this,t,"[level-controller]")||this)._levels=[],r._firstLevel=-1,r._startLevel=void 0,r.currentLevelIndex=-1,r.manualLevelIndex=-1,r.onParsedComplete=void 0,r._registerListeners(),r}r=e,(t=u).prototype=Object.create(r.prototype),t.prototype.constructor=t,h(t,r);var A,p,v=u.prototype;return v._registerListeners=function(){var e=this.hls;e.on(n.Events.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(n.Events.LEVEL_LOADED,this.onLevelLoaded,this),e.on(n.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(n.Events.FRAG_LOADED,this.onFragLoaded,this),e.on(n.Events.ERROR,this.onError,this)},v._unregisterListeners=function(){var e=this.hls;e.off(n.Events.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(n.Events.LEVEL_LOADED,this.onLevelLoaded,this),e.off(n.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(n.Events.FRAG_LOADED,this.onFragLoaded,this),e.off(n.Events.ERROR,this.onError,this)},v.destroy=function(){this._unregisterListeners(),this.manualLevelIndex=-1,this._levels.length=0,e.prototype.destroy.call(this)},v.startLoad=function(){this._levels.forEach((function(e){e.loadError=0})),e.prototype.startLoad.call(this)},v.onManifestLoaded=function(e,t){var r,u,d=[],l=[],c=[],h={},A=!1,p=!1,v=!1;if(t.levels.forEach((function(e){var t=e.attrs;A=A||!(!e.width||!e.height),p=p||!!e.videoCodec,v=v||!!e.audioCodec,f&&e.audioCodec&&-1!==e.audioCodec.indexOf("mp4a.40.34")&&(e.audioCodec=void 0);var r=e.bitrate+"-"+e.attrs.RESOLUTION+"-"+e.attrs.CODECS;(u=h[r])?u.url.push(e.url):(u=new i.Level(e),h[r]=u,d.push(u)),t&&(t.AUDIO&&Object(o.addGroupId)(u,"audio",t.AUDIO),t.SUBTITLES&&Object(o.addGroupId)(u,"text",t.SUBTITLES))})),(A||p)&&v&&(d=d.filter((function(e){var t=e.videoCodec,r=e.width,i=e.height;return!!t||!(!r||!i)}))),d=d.filter((function(e){var t=e.audioCodec,r=e.videoCodec;return(!t||Object(s.isCodecSupportedInMp4)(t,"audio"))&&(!r||Object(s.isCodecSupportedInMp4)(r,"video"))})),t.audioTracks&&(l=t.audioTracks.filter((function(e){return!e.audioCodec||Object(s.isCodecSupportedInMp4)(e.audioCodec,"audio")})),Object(o.assignTrackIdsByGroup)(l)),t.subtitles&&(c=t.subtitles,Object(o.assignTrackIdsByGroup)(c)),d.length>0){r=d[0].bitrate,d.sort((function(e,t){return e.bitrate-t.bitrate})),this._levels=d;for(var m=0;m<d.length;m++)if(d[m].bitrate===r){this._firstLevel=m,this.log("manifest loaded, "+d.length+" level(s) found, first bitrate: "+r);break}var g=v&&!p,y={levels:d,audioTracks:l,subtitleTracks:c,firstLevel:this._firstLevel,stats:t.stats,audio:v,video:p,altAudio:!g&&l.some((function(e){return!!e.url}))};this.hls.trigger(n.Events.MANIFEST_PARSED,y),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else this.hls.trigger(n.Events.ERROR,{type:a.ErrorTypes.MEDIA_ERROR,details:a.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,reason:"no level with compatible codecs found in manifest"})},v.onError=function(t,r){if(e.prototype.onError.call(this,t,r),!r.fatal){var i=r.context,n=this._levels[this.currentLevelIndex];if(i&&(i.type===d.PlaylistContextType.AUDIO_TRACK&&n.audioGroupIds&&i.groupId===n.audioGroupIds[n.urlId]||i.type===d.PlaylistContextType.SUBTITLE_TRACK&&n.textGroupIds&&i.groupId===n.textGroupIds[n.urlId]))this.redundantFailover(this.currentLevelIndex);else{var s,o=!1,u=!0;switch(r.details){case a.ErrorDetails.FRAG_LOAD_ERROR:case a.ErrorDetails.FRAG_LOAD_TIMEOUT:case a.ErrorDetails.KEY_LOAD_ERROR:case a.ErrorDetails.KEY_LOAD_TIMEOUT:if(r.frag){var l=this._levels[r.frag.level];l?(l.fragmentError++,l.fragmentError>this.hls.config.fragLoadingMaxRetry&&(s=r.frag.level)):s=r.frag.level}break;case a.ErrorDetails.LEVEL_LOAD_ERROR:case a.ErrorDetails.LEVEL_LOAD_TIMEOUT:i&&(i.deliveryDirectives&&(u=!1),s=i.level),o=!0;break;case a.ErrorDetails.REMUX_ALLOC_ERROR:s=r.level,o=!0}void 0!==s&&this.recoverLevel(r,s,o,u)}}},v.recoverLevel=function(e,t,r,i){var n=e.details,a=this._levels[t];if(a.loadError++,r){if(!this.retryLoadingOrFail(e))return void(this.currentLevelIndex=-1);e.levelRetry=!0}if(i){var s=a.url.length;if(s>1&&a.loadError<s)e.levelRetry=!0,this.redundantFailover(t);else if(-1===this.manualLevelIndex){var o=0===t?this._levels.length-1:t-1;this.currentLevelIndex!==o&&0===this._levels[o].loadError&&(this.warn(n+": switch to "+o),e.levelRetry=!0,this.hls.nextAutoLevel=o)}}},v.redundantFailover=function(e){var t=this._levels[e],r=t.url.length;if(r>1){var i=(t.urlId+1)%r;this.warn("Switching to redundant URL-id "+i),this._levels.forEach((function(e){e.urlId=i})),this.level=e}},v.onFragLoaded=function(e,t){var r=t.frag;if(void 0!==r&&r.type===d.PlaylistLevelType.MAIN){var i=this._levels[r.level];void 0!==i&&(i.fragmentError=0,i.loadError=0)}},v.onLevelLoaded=function(e,t){var r,i,n=t.level,a=t.details,s=this._levels[n];if(!s)return this.warn("Invalid level index "+n),void(null!==(i=t.deliveryDirectives)&&void 0!==i&&i.skip&&(a.deltaUpdateFailed=!0));n===this.currentLevelIndex?(0===s.fragmentError&&(s.loadError=0,this.retryCount=0),this.playlistLoaded(n,t,s.details)):null!==(r=t.deliveryDirectives)&&void 0!==r&&r.skip&&(a.deltaUpdateFailed=!0)},v.onAudioTrackSwitched=function(e,t){var r=this.hls.levels[this.currentLevelIndex];if(r&&r.audioGroupIds){for(var i=-1,n=this.hls.audioTracks[t.id].groupId,a=0;a<r.audioGroupIds.length;a++)if(r.audioGroupIds[a]===n){i=a;break}i!==r.urlId&&(r.urlId=i,this.startLoad())}},v.loadPlaylist=function(e){var t=this.currentLevelIndex,r=this._levels[t];if(this.canLoad&&r&&r.url.length>0){var i=r.urlId,a=r.url[i];if(e)try{a=e.addDirectives(a)}catch(e){this.warn("Could not construct new URL with HLS Delivery Directives: "+e)}this.log("Attempt loading level index "+t+(e?" at sn "+e.msn+" part "+e.part:"")+" with URL-id "+i+" "+a),this.clearTimer(),this.hls.trigger(n.Events.LEVEL_LOADING,{url:a,level:t,id:i,deliveryDirectives:e||null})}},v.removeLevel=function(e,t){var r=function(e,r){return r!==t},i=this._levels.filter((function(i,n){return n!==e||i.url.length>1&&void 0!==t&&(i.url=i.url.filter(r),i.audioGroupIds&&(i.audioGroupIds=i.audioGroupIds.filter(r)),i.textGroupIds&&(i.textGroupIds=i.textGroupIds.filter(r)),i.urlId=0,!0)})).map((function(e,t){var r=e.details;return null!=r&&r.fragments&&r.fragments.forEach((function(e){e.level=t})),e}));this._levels=i,this.hls.trigger(n.Events.LEVELS_UPDATED,{levels:i})},A=u,(p=[{key:"levels",get:function(){return 0===this._levels.length?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(e){var t,r=this._levels;if(0!==r.length&&(this.currentLevelIndex!==e||null===(t=r[e])||void 0===t||!t.details)){if(e<0||e>=r.length){var i=e<0;if(this.hls.trigger(n.Events.ERROR,{type:a.ErrorTypes.OTHER_ERROR,details:a.ErrorDetails.LEVEL_SWITCH_ERROR,level:e,fatal:i,reason:"invalid level idx"}),i)return;e=Math.min(e,r.length-1)}this.clearTimer();var s=this.currentLevelIndex,o=r[s],u=r[e];this.log("switching to level "+e+" from "+s),this.currentLevelIndex=e;var d=l({},u,{level:e,maxBitrate:u.maxBitrate,uri:u.uri,urlId:u.urlId});delete d._urlId,this.hls.trigger(n.Events.LEVEL_SWITCHING,d);var c=u.details;if(!c||c.live){var h=this.switchParams(u.uri,null==o?void 0:o.details);this.loadPlaylist(h)}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(e){this.manualLevelIndex=e,void 0===this._startLevel&&(this._startLevel=e),-1!==e&&(this.level=e)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(e){this._firstLevel=e}},{key:"startLevel",get:function(){if(void 0===this._startLevel){var e=this.hls.config.startLevel;return void 0!==e?e:this._firstLevel}return this._startLevel},set:function(e){this._startLevel=e}},{key:"nextLoadLevel",get:function(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(e){this.level=e,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=e)}}])&&c(A.prototype,p),Object.defineProperty(A,"prototype",{writable:!1}),u}(u.default)},"./repo/src/controller/level-helper.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"addGroupId",(function(){return a})),r.d(t,"assignTrackIdsByGroup",(function(){return s})),r.d(t,"updatePTS",(function(){return o})),r.d(t,"updateFragPTSDTS",(function(){return d})),r.d(t,"mergeDetails",(function(){return l})),r.d(t,"mapPartIntersection",(function(){return c})),r.d(t,"mapFragmentIntersection",(function(){return h})),r.d(t,"adjustSliding",(function(){return f})),r.d(t,"addSliding",(function(){return A})),r.d(t,"computeReloadInterval",(function(){return p})),r.d(t,"getFragmentWithSN",(function(){return v})),r.d(t,"getPartWith",(function(){return m}));var i=r("./repo/src/polyfills/number.ts"),n=r("./repo/src/utils/logger.ts");function a(e,t,r){switch(t){case"audio":e.audioGroupIds||(e.audioGroupIds=[]),e.audioGroupIds.push(r);break;case"text":e.textGroupIds||(e.textGroupIds=[]),e.textGroupIds.push(r)}}function s(e){var t={};e.forEach((function(e){var r=e.groupId||"";e.id=t[r]=t[r]||0,t[r]++}))}function o(e,t,r){u(e[t],e[r])}function u(e,t){var r=t.startPTS;if(Object(i.isFiniteNumber)(r)){var n,a=0;t.sn>e.sn?(a=r-e.start,n=e):(a=e.start-r,n=t),n.duration!==a&&(n.duration=a)}else t.sn>e.sn?e.cc===t.cc&&e.minEndPTS?t.start=e.start+(e.minEndPTS-e.start):t.start=e.start+e.duration:t.start=Math.max(e.start-t.duration,0)}function d(e,t,r,a,s,o){a-r<=0&&(n.logger.warn("Fragment should have a positive duration",t),a=r+t.duration,o=s+t.duration);var d=r,l=a,c=t.startPTS,h=t.endPTS;if(Object(i.isFiniteNumber)(c)){var f=Math.abs(c-r);Object(i.isFiniteNumber)(t.deltaPTS)?t.deltaPTS=Math.max(f,t.deltaPTS):t.deltaPTS=f,d=Math.max(r,c),r=Math.min(r,c),s=Math.min(s,t.startDTS),l=Math.min(a,h),a=Math.max(a,h),o=Math.max(o,t.endDTS)}t.duration=a-r;var A=r-t.start;t.appendedPTS=a,t.start=t.startPTS=r,t.maxStartPTS=d,t.startDTS=s,t.endPTS=a,t.minEndPTS=l,t.endDTS=o;var p,v=t.sn;if(!e||v<e.startSN||v>e.endSN)return 0;var m=v-e.startSN,g=e.fragments;for(g[m]=t,p=m;p>0;p--)u(g[p],g[p-1]);for(p=m;p<g.length-1;p++)u(g[p],g[p+1]);return e.fragmentHint&&u(g[g.length-1],e.fragmentHint),e.PTSKnown=e.alignedSliding=!0,A}function l(e,t){for(var r=null,a=e.fragments,s=a.length-1;s>=0;s--){var o=a[s].initSegment;if(o){r=o;break}}e.fragmentHint&&delete e.fragmentHint.endPTS;var u,l=0;if(h(e,t,(function(e,n){e.relurl&&(l=e.cc-n.cc),Object(i.isFiniteNumber)(e.startPTS)&&Object(i.isFiniteNumber)(e.endPTS)&&(n.start=n.startPTS=e.startPTS,n.startDTS=e.startDTS,n.appendedPTS=e.appendedPTS,n.maxStartPTS=e.maxStartPTS,n.endPTS=e.endPTS,n.endDTS=e.endDTS,n.minEndPTS=e.minEndPTS,n.duration=e.endPTS-e.startPTS,n.duration&&(u=n),t.PTSKnown=t.alignedSliding=!0),n.elementaryStreams=e.elementaryStreams,n.loader=e.loader,n.stats=e.stats,n.urlId=e.urlId,e.initSegment&&(n.initSegment=e.initSegment,r=e.initSegment)})),r&&(t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments).forEach((function(e){var t;e.initSegment&&e.initSegment.relurl!==(null===(t=r)||void 0===t?void 0:t.relurl)||(e.initSegment=r)})),t.skippedSegments&&(t.deltaUpdateFailed=t.fragments.some((function(e){return!e})),t.deltaUpdateFailed)){n.logger.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var A=t.skippedSegments;A--;)t.fragments.shift();t.startSN=t.fragments[0].sn,t.startCC=t.fragments[0].cc}var p=t.fragments;if(l){n.logger.warn("discontinuity sliding from playlist, take drift into account");for(var v=0;v<p.length;v++)p[v].cc+=l}t.skippedSegments&&(t.startCC=t.fragments[0].cc),c(e.partList,t.partList,(function(e,t){t.elementaryStreams=e.elementaryStreams,t.stats=e.stats})),u?d(t,u,u.startPTS,u.endPTS,u.startDTS,u.endDTS):f(e,t),p.length&&(t.totalduration=t.edge-p[0].start),t.driftStartTime=e.driftStartTime,t.driftStart=e.driftStart;var m=t.advancedDateTime;if(t.advanced&&m){var g=t.edge;t.driftStart||(t.driftStartTime=m,t.driftStart=g),t.driftEndTime=m,t.driftEnd=g}else t.driftEndTime=e.driftEndTime,t.driftEnd=e.driftEnd,t.advancedDateTime=e.advancedDateTime}function c(e,t,r){if(e&&t)for(var i=0,n=0,a=e.length;n<=a;n++){var s=e[n],o=t[n+i];s&&o&&s.index===o.index&&s.fragment.sn===o.fragment.sn?r(s,o):i--}}function h(e,t,r){for(var i=t.skippedSegments,n=Math.max(e.startSN,t.startSN)-t.startSN,a=(e.fragmentHint?1:0)+(i?t.endSN:Math.min(e.endSN,t.endSN))-t.startSN,s=t.startSN-e.startSN,o=t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments,u=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,d=n;d<=a;d++){var l=u[s+d],c=o[d];i&&!c&&d<i&&(c=t.fragments[d]=l),l&&c&&r(l,c)}}function f(e,t){var r=t.startSN+t.skippedSegments-e.startSN,i=e.fragments;r<0||r>=i.length||A(t,i[r].start)}function A(e,t){if(t){for(var r=e.fragments,i=e.skippedSegments;i<r.length;i++)r[i].start+=t;e.fragmentHint&&(e.fragmentHint.start+=t)}}function p(e,t){var r,i=1e3*e.levelTargetDuration,n=i/2,a=e.age,s=a>0&&a<3*i,o=t.loading.end-t.loading.start,u=e.availabilityDelay;if(!1===e.updated)if(s){var d=333*e.misses;r=Math.max(Math.min(n,2*o),d),e.availabilityDelay=(e.availabilityDelay||0)+r}else r=n;else s?(u=Math.min(u||i/2,a),e.availabilityDelay=u,r=u+i-a):r=i-o;return Math.round(r)}function v(e,t,r){if(!e||!e.details)return null;var i=e.details,n=i.fragments[t-i.startSN];return n||((n=i.fragmentHint)&&n.sn===t?n:t<i.startSN&&r&&r.sn===t?r:null)}function m(e,t,r){if(!e||!e.details)return null;var i=e.details.partList;if(i)for(var n=i.length;n--;){var a=i[n];if(a.index===r&&a.fragment.sn===t)return a}return null}},"./repo/src/controller/stream-controller.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return g}));var i=r("./repo/src/polyfills/number.ts"),n=r("./repo/src/controller/base-stream-controller.ts"),a=r("./repo/src/is-supported.ts"),s=r("./repo/src/events.ts"),o=r("./repo/src/utils/buffer-helper.ts"),u=r("./repo/src/controller/fragment-tracker.ts"),d=r("./repo/src/types/loader.ts"),l=r("./repo/src/loader/fragment.ts"),c=r("./repo/src/demux/transmuxer-interface.ts"),h=r("./repo/src/types/transmuxer.ts"),f=r("./repo/src/controller/gap-controller.ts"),A=r("./repo/src/errors.ts"),p=r("./repo/src/utils/logger.ts");function v(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function m(e,t){return(m=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var g=function(e){var t,r;function g(t,r){var i;return(i=e.call(this,t,r,"[stream-controller]")||this).audioCodecSwap=!1,i.gapController=null,i.level=-1,i._forceStartLoad=!1,i.altAudio=!1,i.audioOnly=!1,i.fragPlaying=null,i.onvplaying=null,i.onvseeked=null,i.fragLastKbps=0,i.stalled=!1,i.couldBacktrack=!1,i.audioCodecSwitch=!1,i.videoBuffer=null,i._registerListeners(),i}r=e,(t=g).prototype=Object.create(r.prototype),t.prototype.constructor=t,m(t,r);var y,b,_=g.prototype;return _._registerListeners=function(){var e=this.hls;e.on(s.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(s.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(s.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(s.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.on(s.Events.LEVEL_LOADING,this.onLevelLoading,this),e.on(s.Events.LEVEL_LOADED,this.onLevelLoaded,this),e.on(s.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(s.Events.ERROR,this.onError,this),e.on(s.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(s.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(s.Events.BUFFER_CREATED,this.onBufferCreated,this),e.on(s.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(s.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(s.Events.FRAG_BUFFERED,this.onFragBuffered,this)},_._unregisterListeners=function(){var e=this.hls;e.off(s.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(s.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(s.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(s.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.off(s.Events.LEVEL_LOADED,this.onLevelLoaded,this),e.off(s.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(s.Events.ERROR,this.onError,this),e.off(s.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(s.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(s.Events.BUFFER_CREATED,this.onBufferCreated,this),e.off(s.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(s.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(s.Events.FRAG_BUFFERED,this.onFragBuffered,this)},_.onHandlerDestroying=function(){this._unregisterListeners(),this.onMediaDetaching()},_.startLoad=function(e){if(this.levels){var t=this.lastCurrentTime,r=this.hls;if(this.stopLoad(),this.setInterval(100),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var i=r.startLevel;-1===i&&(r.config.testBandwidth?(i=0,this.bitrateTest=!0):i=r.nextAutoLevel),this.level=r.nextLoadLevel=i,this.loadedmetadata=!1}t>0&&-1===e&&(this.log("Override startPosition with lastCurrentTime @"+t.toFixed(3)),e=t),this.state=n.State.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}else this._forceStartLoad=!0,this.state=n.State.STOPPED},_.stopLoad=function(){this._forceStartLoad=!1,e.prototype.stopLoad.call(this)},_.doTick=function(){switch(this.state){case n.State.IDLE:this.doTickIdle();break;case n.State.WAITING_LEVEL:var e,t=this.levels,r=this.level,i=null==t||null===(e=t[r])||void 0===e?void 0:e.details;if(i&&(!i.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(i))break;this.state=n.State.IDLE;break}break;case n.State.FRAG_LOADING_WAITING_RETRY:var a,s=self.performance.now(),o=this.retryDate;(!o||s>=o||null!==(a=this.media)&&void 0!==a&&a.seeking)&&(this.log("retryDate reached, switch back to IDLE state"),this.state=n.State.IDLE)}this.onTickEnd()},_.onTickEnd=function(){e.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},_.doTickIdle=function(){var e,t,r=this.hls,i=this.levelLastLoaded,a=this.levels,o=this.media,c=r.config,h=r.nextLoadLevel;if(null!==i&&(o||!this.startFragRequested&&c.startFragPrefetch)&&(!this.altAudio||!this.audioOnly)&&a&&a[h]){var f=a[h];this.level=r.nextLoadLevel=h;var A=f.details;if(!A||this.state===n.State.WAITING_LEVEL||A.live&&this.levelLastLoaded!==h)this.state=n.State.WAITING_LEVEL;else{var p=this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:o,d.PlaylistLevelType.MAIN);if(null!==p&&!(p.len>=this.getMaxBufferLength(f.maxBitrate))){if(this._streamEnded(p,A)){var v={};return this.altAudio&&(v.type="video"),this.hls.trigger(s.Events.BUFFER_EOS,v),void(this.state=n.State.ENDED)}var m=p.end,g=this.getNextFragment(m,A);if(this.couldBacktrack&&!this.fragPrevious&&g&&"initSegment"!==g.sn){var y=g.sn-A.startSN;y>1&&(g=A.fragments[y-1],this.fragmentTracker.removeFragment(g))}if(g&&this.fragmentTracker.getState(g)===u.FragmentState.OK&&this.nextLoadPosition>m){var b=this.audioOnly&&!this.altAudio?l.ElementaryStreamTypes.AUDIO:l.ElementaryStreamTypes.VIDEO;this.afterBufferFlushed(o,b,d.PlaylistLevelType.MAIN),g=this.getNextFragment(this.nextLoadPosition,A)}g&&(!g.initSegment||g.initSegment.data||this.bitrateTest||(g=g.initSegment),"identity"!==(null===(e=g.decryptdata)||void 0===e?void 0:e.keyFormat)||null!==(t=g.decryptdata)&&void 0!==t&&t.key?this.loadFragment(g,A,m):this.loadKey(g,A))}}}},_.loadFragment=function(t,r,i){var n,a=this.fragmentTracker.getState(t);if(this.fragCurrent=t,a===u.FragmentState.BACKTRACKED){var s=this.fragmentTracker.getBacktrackData(t);if(s)return this._handleFragmentLoadProgress(s),void this._handleFragmentLoadComplete(s);a=u.FragmentState.NOT_LOADED}a===u.FragmentState.NOT_LOADED||a===u.FragmentState.PARTIAL?"initSegment"===t.sn?this._loadInitSegment(t):this.bitrateTest?(t.bitrateTest=!0,this.log("Fragment "+t.sn+" of level "+t.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(t)):(this.startFragRequested=!0,e.prototype.loadFragment.call(this,t,r,i)):a===u.FragmentState.APPENDING?this.reduceMaxBufferLength(t.duration)&&this.fragmentTracker.removeFragment(t):0===(null===(n=this.media)||void 0===n?void 0:n.buffered.length)&&this.fragmentTracker.removeAllFragments()},_.getAppendedFrag=function(e){var t=this.fragmentTracker.getAppendedFrag(e,d.PlaylistLevelType.MAIN);return t&&"fragment"in t?t.fragment:t},_.getBufferedFrag=function(e){return this.fragmentTracker.getBufferedFrag(e,d.PlaylistLevelType.MAIN)},_.followingBufferedFrag=function(e){return e?this.getBufferedFrag(e.end+.5):null},_.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},_.nextLevelSwitch=function(){var e=this.levels,t=this.media;if(null!=t&&t.readyState){var r,i=this.getAppendedFrag(t.currentTime);if(i&&i.start>1&&this.flushMainBuffer(0,i.start-1),!t.paused&&e){var n=e[this.hls.nextLoadLevel],a=this.fragLastKbps;r=a&&this.fragCurrent?this.fragCurrent.duration*n.maxBitrate/(1e3*a)+1:0}else r=0;var s=this.getBufferedFrag(t.currentTime+r);if(s){var o=this.followingBufferedFrag(s);if(o){this.abortCurrentFrag();var u=o.maxStartPTS?o.maxStartPTS:o.start,d=o.duration,l=Math.max(s.end,u+Math.min(Math.max(d-this.config.maxFragLookUpTolerance,.5*d),.75*d));this.flushMainBuffer(l,Number.POSITIVE_INFINITY)}}}},_.abortCurrentFrag=function(){var e=this.fragCurrent;this.fragCurrent=null,null!=e&&e.loader&&e.loader.abort(),this.state===n.State.KEY_LOADING&&(this.state=n.State.IDLE),this.nextLoadPosition=this.getLoadPosition()},_.flushMainBuffer=function(t,r){e.prototype.flushMainBuffer.call(this,t,r,this.altAudio?"video":null)},_.onMediaAttached=function(t,r){e.prototype.onMediaAttached.call(this,t,r);var i=r.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),i.addEventListener("playing",this.onvplaying),i.addEventListener("seeked",this.onvseeked),this.gapController=new f.default(this.config,i,this.fragmentTracker,this.hls)},_.onMediaDetaching=function(){var t=this.media;t&&(t.removeEventListener("playing",this.onvplaying),t.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),e.prototype.onMediaDetaching.call(this)},_.onMediaPlaying=function(){this.tick()},_.onMediaSeeked=function(){var e=this.media,t=e?e.currentTime:null;Object(i.isFiniteNumber)(t)&&this.log("Media seeked to "+t.toFixed(3)),this.tick()},_.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(s.Events.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=this.stalled=!1,this.startPosition=this.lastCurrentTime=0,this.fragPlaying=null},_.onManifestParsed=function(e,t){var r,i=!1,n=!1;t.levels.forEach((function(e){(r=e.audioCodec)&&(-1!==r.indexOf("mp4a.40.2")&&(i=!0),-1!==r.indexOf("mp4a.40.5")&&(n=!0))})),this.audioCodecSwitch=i&&n&&!Object(a.changeTypeSupported)(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1},_.onLevelLoading=function(e,t){var r=this.levels;if(r&&this.state===n.State.IDLE){var i=r[t.level];(!i.details||i.details.live&&this.levelLastLoaded!==t.level||this.waitForCdnTuneIn(i.details))&&(this.state=n.State.WAITING_LEVEL)}},_.onLevelLoaded=function(e,t){var r,i=this.levels,a=t.level,o=t.details,u=o.totalduration;if(i){this.log("Level "+a+" loaded ["+o.startSN+","+o.endSN+"], cc ["+o.startCC+", "+o.endCC+"] duration:"+u);var d=this.fragCurrent;!d||this.state!==n.State.FRAG_LOADING&&this.state!==n.State.FRAG_LOADING_WAITING_RETRY||d.level!==t.level&&d.loader&&(this.state=n.State.IDLE,d.loader.abort());var l=i[a],c=0;if(o.live||null!==(r=l.details)&&void 0!==r&&r.live){if(o.fragments[0]||(o.deltaUpdateFailed=!0),o.deltaUpdateFailed)return;c=this.alignPlaylists(o,l.details)}if(l.details=o,this.levelLastLoaded=a,this.hls.trigger(s.Events.LEVEL_UPDATED,{details:o,level:a}),this.state===n.State.WAITING_LEVEL){if(this.waitForCdnTuneIn(o))return;this.state=n.State.IDLE}this.startFragRequested?o.live&&this.synchronizeToLiveEdge(o):this.setStartPosition(o,c),this.tick()}else this.warn("Levels were reset while loading level "+a)},_._handleFragmentLoadProgress=function(e){var t,r=e.frag,i=e.part,n=e.payload,a=this.levels;if(a){var s=a[r.level],o=s.details;if(o){var u=s.videoCodec,l=o.PTSKnown||!o.live,f=null===(t=r.initSegment)||void 0===t?void 0:t.data,A=this._getAudioCodec(s),p=this.transmuxer=this.transmuxer||new c.default(this.hls,d.PlaylistLevelType.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),v=i?i.index:-1,m=-1!==v,g=new h.ChunkMetadata(r.level,r.sn,r.stats.chunkCount,n.byteLength,v,m),y=this.initPTS[r.cc];p.push(n,f,A,u,r,i,o.totalduration,l,g,y)}else this.warn("Dropping fragment "+r.sn+" of level "+r.level+" after level details were reset")}else this.warn("Levels were reset while fragment load was in progress. Fragment "+r.sn+" of level "+r.level+" will not be buffered")},_.onAudioTrackSwitching=function(e,t){var r=this.altAudio,i=!!t.url,n=t.id;if(!i){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var a=this.fragCurrent;null!=a&&a.loader&&(this.log("Switching to main audio track, cancel main fragment load"),a.loader.abort()),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var o=this.hls;r&&o.trigger(s.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),o.trigger(s.Events.AUDIO_TRACK_SWITCHED,{id:n})}},_.onAudioTrackSwitched=function(e,t){var r=t.id,i=!!this.hls.audioTracks[r].url;if(i){var n=this.videoBuffer;n&&this.mediaBuffer!==n&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=n)}this.altAudio=i,this.tick()},_.onBufferCreated=function(e,t){var r,i,n=t.tracks,a=!1;for(var s in n){var o=n[s];if("main"===o.id){if(i=s,r=o,"video"===s){var u=n[s];u&&(this.videoBuffer=u.buffer)}}else a=!0}a&&r?(this.log("Alternate track found, use "+i+".buffered to schedule main fragment loading"),this.mediaBuffer=r.buffer):this.mediaBuffer=this.media},_.onFragBuffered=function(e,t){var r=t.frag,i=t.part;if(!r||r.type===d.PlaylistLevelType.MAIN){if(this.fragContextChanged(r))return this.warn("Fragment "+r.sn+(i?" p: "+i.index:"")+" of level "+r.level+" finished buffering, but was aborted. state: "+this.state),void(this.state===n.State.PARSED&&(this.state=n.State.IDLE));var a=i?i.stats:r.stats;this.fragLastKbps=Math.round(8*a.total/(a.buffering.end-a.loading.first)),"initSegment"!==r.sn&&(this.fragPrevious=r),this.fragBufferedComplete(r,i)}},_.onError=function(e,t){switch(t.details){case A.ErrorDetails.FRAG_LOAD_ERROR:case A.ErrorDetails.FRAG_LOAD_TIMEOUT:case A.ErrorDetails.KEY_LOAD_ERROR:case A.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(d.PlaylistLevelType.MAIN,t);break;case A.ErrorDetails.LEVEL_LOAD_ERROR:case A.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==n.State.ERROR&&(t.fatal?(this.warn(""+t.details),this.state=n.State.ERROR):t.levelRetry||this.state!==n.State.WAITING_LEVEL||(this.state=n.State.IDLE));break;case A.ErrorDetails.BUFFER_FULL_ERROR:if("main"===t.parent&&(this.state===n.State.PARSING||this.state===n.State.PARSED)){var r=!0,i=this.getFwdBufferInfo(this.media,d.PlaylistLevelType.MAIN);i&&i.len>.5&&(r=!this.reduceMaxBufferLength(i.len)),r&&(this.warn("buffer full error also media.currentTime is not buffered, flush main"),this.immediateLevelSwitch()),this.resetLoadingState()}}},_.checkBuffer=function(){var e=this.media,t=this.gapController;if(e&&t&&e.readyState){var r=o.BufferHelper.getBuffered(e);!this.loadedmetadata&&r.length?(this.loadedmetadata=!0,this.seekToStartPos()):t.poll(this.lastCurrentTime),this.lastCurrentTime=e.currentTime}},_.onFragLoadEmergencyAborted=function(){this.state=n.State.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},_.onBufferFlushed=function(e,t){var r=t.type;if(r!==l.ElementaryStreamTypes.AUDIO||this.audioOnly&&!this.altAudio){var i=(r===l.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(i,r,d.PlaylistLevelType.MAIN)}},_.onLevelsUpdated=function(e,t){this.levels=t.levels},_.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},_.seekToStartPos=function(){var e=this.media,t=e.currentTime,r=this.startPosition;if(r>=0&&t<r){if(e.seeking)return void p.logger.log("could not seek to "+r+", already seeking at "+t);var i=o.BufferHelper.getBuffered(e),n=(i.length?i.start(0):0)-r;n>0&&(n<this.config.maxBufferHole||n<this.config.maxFragLookUpTolerance)&&(p.logger.log("adjusting start position by "+n+" to match buffer start"),r+=n,this.startPosition=r),this.log("seek to target start position "+r+" from current time "+t),e.currentTime=r}},_._getAudioCodec=function(e){var t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t=-1!==t.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),t},_._loadBitrateTestFrag=function(e){var t=this;this._doFragLoad(e).then((function(r){var i=t.hls;if(r&&!i.nextLoadLevel&&!t.fragContextChanged(e)){t.fragLoadError=0,t.state=n.State.IDLE,t.startFragRequested=!1,t.bitrateTest=!1;var a=e.stats;a.parsing.start=a.parsing.end=a.buffering.start=a.buffering.end=self.performance.now(),i.trigger(s.Events.FRAG_LOADED,r)}}))},_._handleTransmuxComplete=function(e){var t,r="main",a=this.hls,o=e.remuxResult,u=e.chunkMeta,d=this.getCurrentContext(u);if(!d)return this.warn("The loading context changed while buffering fragment "+u.sn+" of level "+u.level+". This chunk will not be buffered."),void this.resetLiveStartWhenNotLoaded(u.level);var c=d.frag,h=d.part,f=d.level,A=o.video,p=o.text,v=o.id3,m=o.initSegment,g=this.altAudio?void 0:o.audio;if(!this.fragContextChanged(c)){if(this.state=n.State.PARSING,m){m.tracks&&(this._bufferInitSegment(f,m.tracks,c,u),a.trigger(s.Events.FRAG_PARSING_INIT_SEGMENT,{frag:c,id:r,tracks:m.tracks}));var y=m.initPTS,b=m.timescale;Object(i.isFiniteNumber)(y)&&(this.initPTS[c.cc]=y,a.trigger(s.Events.INIT_PTS_FOUND,{frag:c,id:r,initPTS:y,timescale:b}))}if(A&&!1!==o.independent){if(f.details){var _=A.startPTS,E=A.endPTS,T=A.startDTS,k=A.endDTS;if(h)h.elementaryStreams[A.type]={startPTS:_,endPTS:E,startDTS:T,endDTS:k};else if(A.firstKeyFrame&&A.independent&&(this.couldBacktrack=!0),A.dropped&&A.independent){if(this.getLoadPosition()+this.config.maxBufferHole<_)return void this.backtrack(c);c.setElementaryStreamInfo(A.type,c.start,E,c.start,k,!0)}c.setElementaryStreamInfo(A.type,_,E,T,k),this.bufferFragmentData(A,c,h,u)}}else if(!1===o.independent)return void this.backtrack(c);if(g){var S=g.startPTS,D=g.endPTS,R=g.startDTS,L=g.endDTS;h&&(h.elementaryStreams[l.ElementaryStreamTypes.AUDIO]={startPTS:S,endPTS:D,startDTS:R,endDTS:L}),c.setElementaryStreamInfo(l.ElementaryStreamTypes.AUDIO,S,D,R,L),this.bufferFragmentData(g,c,h,u)}if(null!=v&&null!==(t=v.samples)&&void 0!==t&&t.length){var C={frag:c,id:r,samples:v.samples};a.trigger(s.Events.FRAG_PARSING_METADATA,C)}if(p){var w={frag:c,id:r,samples:p.samples};a.trigger(s.Events.FRAG_PARSING_USERDATA,w)}}},_._bufferInitSegment=function(e,t,r,i){var a=this;if(this.state===n.State.PARSING){this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&delete t.audio;var o=t.audio,u=t.video,d=t.audiovideo;if(o){var l=e.audioCodec,c=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(l&&(l=-1!==l.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),1!==o.metadata.channelCount&&-1===c.indexOf("firefox")&&(l="mp4a.40.5")),-1!==c.indexOf("android")&&"audio/mpeg"!==o.container&&(l="mp4a.40.2",this.log("Android: force audio codec to "+l)),e.audioCodec&&e.audioCodec!==l&&this.log('Swapping manifest audio codec "'+e.audioCodec+'" for "'+l+'"'),o.levelCodec=l,o.id="main",this.log("Init audio buffer, container:"+o.container+", codecs[selected/level/parsed]=["+(l||"")+"/"+(e.audioCodec||"")+"/"+o.codec+"]")}u&&(u.levelCodec=e.videoCodec,u.id="main",this.log("Init video buffer, container:"+u.container+", codecs[level/parsed]=["+(e.videoCodec||"")+"/"+u.codec+"]")),d&&this.log("Init audiovideo buffer, container:"+d.container+", codecs[level/parsed]=["+(e.attrs.CODECS||"")+"/"+d.codec+"]"),this.hls.trigger(s.Events.BUFFER_CODECS,t),Object.keys(t).forEach((function(e){var n=t[e].initSegment;null!=n&&n.byteLength&&a.hls.trigger(s.Events.BUFFER_APPENDING,{type:e,data:n,frag:r,part:null,chunkMeta:i,parent:r.type})})),this.tick()}},_.backtrack=function(e){this.couldBacktrack=!0,this.resetTransmuxer(),this.flushBufferGap(e);var t=this.fragmentTracker.backtrack(e);this.fragPrevious=null,this.nextLoadPosition=e.start,t?this.resetFragmentLoading(e):this.state=n.State.BACKTRACKING},_.checkFragmentChanged=function(){var e=this.media,t=null;if(e&&e.readyState>1&&!1===e.seeking){var r=e.currentTime;if(o.BufferHelper.isBuffered(e,r)?t=this.getAppendedFrag(r):o.BufferHelper.isBuffered(e,r+.1)&&(t=this.getAppendedFrag(r+.1)),t){var i=this.fragPlaying,n=t.level;i&&t.sn===i.sn&&i.level===n&&t.urlId===i.urlId||(this.hls.trigger(s.Events.FRAG_CHANGED,{frag:t}),i&&i.level===n||this.hls.trigger(s.Events.LEVEL_SWITCHED,{level:n}),this.fragPlaying=t)}}},y=g,(b=[{key:"nextLevel",get:function(){var e=this.nextBufferedFrag;return e?e.level:-1}},{key:"currentLevel",get:function(){var e=this.media;if(e){var t=this.getAppendedFrag(e.currentTime);if(t)return t.level}return-1}},{key:"nextBufferedFrag",get:function(){var e=this.media;if(e){var t=this.getAppendedFrag(e.currentTime);return this.followingBufferedFrag(t)}return null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}])&&v(y.prototype,b),Object.defineProperty(y,"prototype",{writable:!1}),g}(n.default)},"./repo/src/demux/aacdemuxer.ts":function(e,t,r){"use strict";r.r(t);var i=r("./repo/src/demux/base-audio-demuxer.ts"),n=r("./repo/src/demux/adts.ts"),a=r("./repo/src/utils/logger.ts"),s=r("./repo/src/demux/id3.ts");function o(e,t){return(o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var u=function(e){var t,r;function i(t,r){var i;return(i=e.call(this)||this).observer=void 0,i.config=void 0,i.observer=t,i.config=r,i}r=e,(t=i).prototype=Object.create(r.prototype),t.prototype.constructor=t,o(t,r);var u=i.prototype;return u.resetInitSegment=function(t,r,i,n){e.prototype.resetInitSegment.call(this,t,r,i,n),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,isAAC:!0,samples:[],manifestCodec:r,duration:n,inputTimeScale:9e4,dropped:0}},i.probe=function(e){if(!e)return!1;for(var t=(s.getID3Data(e,0)||[]).length,r=e.length;t<r;t++)if(n.probe(e,t))return a.logger.log("ADTS sync word found !"),!0;return!1},u.canParse=function(e,t){return n.canParse(e,t)},u.appendFrame=function(e,t,r){n.initTrackConfig(e,this.observer,t,r,e.manifestCodec);var i=n.appendFrame(e,t,r,this.initPTS,this.frameIndex);if(i&&0===i.missing)return i},i}(i.default);u.minProbeByteLength=9,t.default=u},"./repo/src/demux/adts.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"getAudioConfig",(function(){return s})),r.d(t,"isHeaderPattern",(function(){return o})),r.d(t,"getHeaderLength",(function(){return u})),r.d(t,"getFullFrameLength",(function(){return d})),r.d(t,"canGetFrameLength",(function(){return l})),r.d(t,"isHeader",(function(){return c})),r.d(t,"canParse",(function(){return h})),r.d(t,"probe",(function(){return f})),r.d(t,"initTrackConfig",(function(){return A})),r.d(t,"getFrameDuration",(function(){return p})),r.d(t,"parseFrameHeader",(function(){return v})),r.d(t,"appendFrame",(function(){return m}));var i=r("./repo/src/utils/logger.ts"),n=r("./repo/src/errors.ts"),a=r("./repo/src/events.ts");function s(e,t,r,s){var o,u,d,l,c=navigator.userAgent.toLowerCase(),h=s,f=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];o=1+((192&t[r+2])>>>6);var A=(60&t[r+2])>>>2;if(!(A>f.length-1))return d=(1&t[r+2])<<2,d|=(192&t[r+3])>>>6,i.logger.log("manifest codec:"+s+", ADTS type:"+o+", samplingIndex:"+A),/firefox/i.test(c)?A>=6?(o=5,l=new Array(4),u=A-3):(o=2,l=new Array(2),u=A):-1!==c.indexOf("android")?(o=2,l=new Array(2),u=A):(o=5,l=new Array(4),s&&(-1!==s.indexOf("mp4a.40.29")||-1!==s.indexOf("mp4a.40.5"))||!s&&A>=6?u=A-3:((s&&-1!==s.indexOf("mp4a.40.2")&&(A>=6&&1===d||/vivaldi/i.test(c))||!s&&1===d)&&(o=2,l=new Array(2)),u=A)),l[0]=o<<3,l[0]|=(14&A)>>1,l[1]|=(1&A)<<7,l[1]|=d<<3,5===o&&(l[1]|=(14&u)>>1,l[2]=(1&u)<<7,l[2]|=8,l[3]=0),{config:l,samplerate:f[A],channelCount:d,codec:"mp4a.40."+o,manifestCodec:h};e.trigger(a.Events.ERROR,{type:n.ErrorTypes.MEDIA_ERROR,details:n.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+A})}function o(e,t){return 255===e[t]&&240==(246&e[t+1])}function u(e,t){return 1&e[t+1]?7:9}function d(e,t){return(3&e[t+3])<<11|e[t+4]<<3|(224&e[t+5])>>>5}function l(e,t){return t+5<e.length}function c(e,t){return t+1<e.length&&o(e,t)}function h(e,t){return l(e,t)&&o(e,t)&&d(e,t)<=e.length-t}function f(e,t){if(c(e,t)){var r=u(e,t);if(t+r>=e.length)return!1;var i=d(e,t);if(i<=r)return!1;var n=t+i;return n===e.length||c(e,n)}return!1}function A(e,t,r,n,a){if(!e.samplerate){var o=s(t,r,n,a);if(!o)return;e.config=o.config,e.samplerate=o.samplerate,e.channelCount=o.channelCount,e.codec=o.codec,e.manifestCodec=o.manifestCodec,i.logger.log("parsed codec:"+e.codec+", rate:"+o.samplerate+", channels:"+o.channelCount)}}function p(e){return 9216e4/e}function v(e,t,r,i,n){var a=u(e,t),s=d(e,t);if((s-=a)>0)return{headerLength:a,frameLength:s,stamp:r+i*n}}function m(e,t,r,i,n){var a=v(t,r,i,n,p(e.samplerate));if(a){var s,o=a.frameLength,u=a.headerLength,d=a.stamp,l=u+o,c=Math.max(0,r+l-t.length);c?(s=new Uint8Array(l-u)).set(t.subarray(r+u,t.length),0):s=t.subarray(r+u,r+l);var h={unit:s,pts:d};return c||e.samples.push(h),{sample:h,length:l,missing:c}}}},"./repo/src/demux/base-audio-demuxer.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"initPTSFn",(function(){return d}));var i=r("./repo/src/polyfills/number.ts"),n=r("./repo/src/demux/id3.ts"),a=r("./repo/src/demux/dummy-demuxed-track.ts"),s=r("./repo/src/utils/mp4-tools.ts"),o=r("./repo/src/utils/typed-array.ts"),u=function(){function e(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.initPTS=null}var t=e.prototype;return t.resetInitSegment=function(e,t,r,i){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},t.resetTimeStamp=function(){},t.resetContiguity=function(){},t.canParse=function(e,t){return!1},t.appendFrame=function(e,t,r){},t.demux=function(e,t){this.cachedData&&(e=Object(s.appendUint8Array)(this.cachedData,e),this.cachedData=null);var r,i,u=n.getID3Data(e,0),l=u?u.length:0,c=this._audioTrack,h=this._id3Track,f=u?n.getTimeStamp(u):void 0,A=e.length;for(0!==this.frameIndex&&null!==this.initPTS||(this.initPTS=d(f,t)),u&&u.length>0&&h.samples.push({pts:this.initPTS,dts:this.initPTS,data:u}),i=this.initPTS;l<A;){if(this.canParse(e,l)){var p=this.appendFrame(c,e,l);p?(this.frameIndex++,i=p.sample.pts,r=l+=p.length):l=A}else n.canParse(e,l)?(u=n.getID3Data(e,l),h.samples.push({pts:i,dts:i,data:u}),r=l+=u.length):l++;if(l===A&&r!==A){var v=Object(o.sliceUint8)(e,r);this.cachedData?this.cachedData=Object(s.appendUint8Array)(this.cachedData,v):this.cachedData=v}}return{audioTrack:c,videoTrack:Object(a.dummyTrack)(),id3Track:h,textTrack:Object(a.dummyTrack)()}},t.demuxSampleAes=function(e,t,r){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},t.flush=function(e){var t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),this.frameIndex=0,{audioTrack:this._audioTrack,videoTrack:Object(a.dummyTrack)(),id3Track:this._id3Track,textTrack:Object(a.dummyTrack)()}},t.destroy=function(){},e}(),d=function(e,t){return Object(i.isFiniteNumber)(e)?90*e:9e4*t};t.default=u},"./repo/src/demux/chunk-cache.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return i}));var i=function(){function e(){this.chunks=[],this.dataLength=0}var t=e.prototype;return t.push=function(e){this.chunks.push(e),this.dataLength+=e.length},t.flush=function(){var e,t=this.chunks,r=this.dataLength;return t.length?(e=1===t.length?t[0]:function(e,t){for(var r=new Uint8Array(t),i=0,n=0;n<e.length;n++){var a=e[n];r.set(a,i),i+=a.length}return r}(t,r),this.reset(),e):new Uint8Array(0)},t.reset=function(){this.chunks.length=0,this.dataLength=0},e}()},"./repo/src/demux/dummy-demuxed-track.ts":function(e,t,r){"use strict";function i(e,t){return void 0===e&&(e=""),void 0===t&&(t=9e4),{type:e,id:-1,pid:-1,inputTimeScale:t,sequenceNumber:-1,samples:[],dropped:0}}r.r(t),r.d(t,"dummyTrack",(function(){return i}))},"./repo/src/demux/exp-golomb.ts":function(e,t,r){"use strict";r.r(t);var i=r("./repo/src/utils/logger.ts"),n=function(){function e(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}var t=e.prototype;return t.loadWord=function(){var e=this.data,t=this.bytesAvailable,r=e.byteLength-t,i=new Uint8Array(4),n=Math.min(4,t);if(0===n)throw new Error("no bytes available");i.set(e.subarray(r,r+n)),this.word=new DataView(i.buffer).getUint32(0),this.bitsAvailable=8*n,this.bytesAvailable-=n},t.skipBits=function(e){var t;this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,e-=(t=e>>3)>>3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)},t.readBits=function(e){var t=Math.min(this.bitsAvailable,e),r=this.word>>>32-t;return e>32&&i.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0?this.word<<=t:this.bytesAvailable>0&&this.loadWord(),(t=e-t)>0&&this.bitsAvailable?r<<t|this.readBits(t):r},t.skipLZ=function(){var e;for(e=0;e<this.bitsAvailable;++e)if(this.word&2147483648>>>e)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()},t.skipUEG=function(){this.skipBits(1+this.skipLZ())},t.skipEG=function(){this.skipBits(1+this.skipLZ())},t.readUEG=function(){var e=this.skipLZ();return this.readBits(e+1)-1},t.readEG=function(){var e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)},t.readBoolean=function(){return 1===this.readBits(1)},t.readUByte=function(){return this.readBits(8)},t.readUShort=function(){return this.readBits(16)},t.readUInt=function(){return this.readBits(32)},t.skipScalingList=function(e){for(var t=8,r=8,i=0;i<e;i++)0!==r&&(r=(t+this.readEG()+256)%256),t=0===r?t:r},t.readSPS=function(){var e,t,r,i=0,n=0,a=0,s=0,o=this.readUByte.bind(this),u=this.readBits.bind(this),d=this.readUEG.bind(this),l=this.readBoolean.bind(this),c=this.skipBits.bind(this),h=this.skipEG.bind(this),f=this.skipUEG.bind(this),A=this.skipScalingList.bind(this);o();var p=o();if(u(5),c(3),o(),f(),100===p||110===p||122===p||244===p||44===p||83===p||86===p||118===p||128===p){var v=d();if(3===v&&c(1),f(),f(),c(1),l())for(t=3!==v?8:12,r=0;r<t;r++)l()&&A(r<6?16:64)}f();var m=d();if(0===m)d();else if(1===m)for(c(1),h(),h(),e=d(),r=0;r<e;r++)h();f(),c(1);var g=d(),y=d(),b=u(1);0===b&&c(1),c(1),l()&&(i=d(),n=d(),a=d(),s=d());var _=[1,1];if(l()&&l())switch(o()){case 1:_=[1,1];break;case 2:_=[12,11];break;case 3:_=[10,11];break;case 4:_=[16,11];break;case 5:_=[40,33];break;case 6:_=[24,11];break;case 7:_=[20,11];break;case 8:_=[32,11];break;case 9:_=[80,33];break;case 10:_=[18,11];break;case 11:_=[15,11];break;case 12:_=[64,33];break;case 13:_=[160,99];break;case 14:_=[4,3];break;case 15:_=[3,2];break;case 16:_=[2,1];break;case 255:_=[o()<<8|o(),o()<<8|o()]}return{width:Math.ceil(16*(g+1)-2*i-2*n),height:(2-b)*(y+1)*16-(b?2:4)*(a+s),pixelRatio:_}},t.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},e}();t.default=n},"./repo/src/demux/id3.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"isHeader",(function(){return n})),r.d(t,"isFooter",(function(){return a})),r.d(t,"getID3Data",(function(){return s})),r.d(t,"canParse",(function(){return u})),r.d(t,"getTimeStamp",(function(){return d})),r.d(t,"isTimeStampFrame",(function(){return l})),r.d(t,"getID3Frames",(function(){return h})),r.d(t,"decodeFrame",(function(){return f})),r.d(t,"utf8ArrayToStr",(function(){return g})),r.d(t,"testables",(function(){return y}));var i,n=function(e,t){return t+10<=e.length&&73===e[t]&&68===e[t+1]&&51===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128},a=function(e,t){return t+10<=e.length&&51===e[t]&&68===e[t+1]&&73===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128},s=function(e,t){for(var r=t,i=0;n(e,t);)i+=10,i+=o(e,t+6),a(e,t+10)&&(i+=10),t+=i;if(i>0)return e.subarray(r,r+i)},o=function(e,t){var r=0;return r=(127&e[t])<<21,r|=(127&e[t+1])<<14,(r|=(127&e[t+2])<<7)|127&e[t+3]},u=function(e,t){return n(e,t)&&o(e,t+6)+10<=e.length-t},d=function(e){for(var t=h(e),r=0;r<t.length;r++){var i=t[r];if(l(i))return m(i)}},l=function(e){return e&&"PRIV"===e.key&&"com.apple.streaming.transportStreamTimestamp"===e.info},c=function(e){var t=String.fromCharCode(e[0],e[1],e[2],e[3]),r=o(e,4);return{type:t,size:r,data:e.subarray(10,10+r)}},h=function(e){for(var t=0,r=[];n(e,t);){for(var i=o(e,t+6),s=(t+=10)+i;t+8<s;){var u=c(e.subarray(t)),d=f(u);d&&r.push(d),t+=u.size+10}a(e,t)&&(t+=10)}return r},f=function(e){return"PRIV"===e.type?A(e):"W"===e.type[0]?v(e):p(e)},A=function(e){if(!(e.size<2)){var t=g(e.data,!0),r=new Uint8Array(e.data.subarray(t.length+1));return{key:e.type,info:t,data:r.buffer}}},p=function(e){if(!(e.size<2)){if("TXXX"===e.type){var t=1,r=g(e.data.subarray(t),!0);t+=r.length+1;var i=g(e.data.subarray(t));return{key:e.type,info:r,data:i}}var n=g(e.data.subarray(1));return{key:e.type,data:n}}},v=function(e){if("WXXX"===e.type){if(e.size<2)return;var t=1,r=g(e.data.subarray(t),!0);t+=r.length+1;var i=g(e.data.subarray(t));return{key:e.type,info:r,data:i}}var n=g(e.data);return{key:e.type,data:n}},m=function(e){if(8===e.data.byteLength){var t=new Uint8Array(e.data),r=1&t[3],i=(t[4]<<23)+(t[5]<<15)+(t[6]<<7)+t[7];return i/=45,r&&(i+=47721858.84),Math.round(i)}},g=function(e,t){void 0===t&&(t=!1);var r=b();if(r){var i=r.decode(e);if(t){var n=i.indexOf("\0");return-1!==n?i.substring(0,n):i}return i.replace(/\0/g,"")}for(var a,s,o,u=e.length,d="",l=0;l<u;){if(0===(a=e[l++])&&t)return d;if(0!==a&&3!==a)switch(a>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:d+=String.fromCharCode(a);break;case 12:case 13:s=e[l++],d+=String.fromCharCode((31&a)<<6|63&s);break;case 14:s=e[l++],o=e[l++],d+=String.fromCharCode((15&a)<<12|(63&s)<<6|63&o)}}return d},y={decodeTextFrame:p};function b(){return i||void 0===self.TextDecoder||(i=new self.TextDecoder("utf-8")),i}},"./repo/src/demux/mp3demuxer.ts":function(e,t,r){"use strict";r.r(t);var i=r("./repo/src/demux/base-audio-demuxer.ts"),n=r("./repo/src/demux/id3.ts"),a=r("./repo/src/utils/logger.ts"),s=r("./repo/src/demux/mpegaudio.ts");function o(e,t){return(o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var u=function(e){var t,r;function i(){return e.apply(this,arguments)||this}r=e,(t=i).prototype=Object.create(r.prototype),t.prototype.constructor=t,o(t,r);var u=i.prototype;return u.resetInitSegment=function(t,r,i,n){e.prototype.resetInitSegment.call(this,t,r,i,n),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,isAAC:!1,samples:[],manifestCodec:r,duration:n,inputTimeScale:9e4,dropped:0}},i.probe=function(e){if(!e)return!1;for(var t=(n.getID3Data(e,0)||[]).length,r=e.length;t<r;t++)if(s.probe(e,t))return a.logger.log("MPEG Audio sync word found !"),!0;return!1},u.canParse=function(e,t){return s.canParse(e,t)},u.appendFrame=function(e,t,r){if(null!==this.initPTS)return s.appendFrame(e,t,r,this.initPTS,this.frameIndex)},i}(i.default);u.minProbeByteLength=4,t.default=u},"./repo/src/demux/mp4demuxer.ts":function(e,t,r){"use strict";r.r(t);var i=r("./repo/src/polyfills/number.ts"),n=r("./repo/src/utils/mp4-tools.ts"),a=r("./repo/src/demux/dummy-demuxed-track.ts"),s=/\/emsg[-/]ID3/i,o=function(){function e(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}var t=e.prototype;return t.resetTimeStamp=function(){},t.resetInitSegment=function(e,t,r,i){var s=Object(n.parseInitSegment)(e),o=this.videoTrack=Object(a.dummyTrack)("video",1),u=this.audioTrack=Object(a.dummyTrack)("audio",1),d=this.txtTrack=Object(a.dummyTrack)("text",1);if(this.id3Track=Object(a.dummyTrack)("id3",1),this.timeOffset=0,s.video){var l=s.video,c=l.id,h=l.timescale,f=l.codec;o.id=c,o.timescale=d.timescale=h,o.codec=f}if(s.audio){var A=s.audio,p=A.id,v=A.timescale,m=A.codec;u.id=p,u.timescale=v,u.codec=m}d.id=n.RemuxerTrackIdConfig.text,o.sampleDuration=0,o.duration=u.duration=i},t.resetContiguity=function(){},e.probe=function(e){return e=e.length>16384?e.subarray(0,16384):e,Object(n.findBox)(e,["moof"]).length>0},t.demux=function(e,t){this.timeOffset=t;var r=e,i=this.videoTrack,a=this.txtTrack;if(this.config.progressive){this.remainderData&&(r=Object(n.appendUint8Array)(this.remainderData,e));var s=Object(n.segmentValidRange)(r);this.remainderData=s.remainder,i.samples=s.valid||new Uint8Array}else i.samples=r;var o=this.extractID3Track(i,t);return a.samples=Object(n.parseSamples)(t,i),{videoTrack:i,audioTrack:this.audioTrack,id3Track:o,textTrack:this.txtTrack}},t.flush=function(){var e=this.timeOffset,t=this.videoTrack,r=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;var i=this.extractID3Track(t,this.timeOffset);return r.samples=Object(n.parseSamples)(e,t),{videoTrack:t,audioTrack:Object(a.dummyTrack)(),id3Track:i,textTrack:Object(a.dummyTrack)()}},t.extractID3Track=function(e,t){var r=this.id3Track;if(e.samples.length){var a=Object(n.findBox)(e.samples,["emsg"]);a&&a.forEach((function(e){var a=Object(n.parseEmsg)(e);if(s.test(a.schemeIdUri)){var o=Object(i.isFiniteNumber)(a.presentationTime)?a.presentationTime/a.timeScale:t+a.presentationTimeDelta/a.timeScale,u=a.payload;r.samples.push({data:u,len:u.byteLength,dts:o,pts:o})}}))}return r},t.demuxSampleAes=function(e,t,r){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},t.destroy=function(){},e}();o.minProbeByteLength=1024,t.default=o},"./repo/src/demux/mpegaudio.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"appendFrame",(function(){return u})),r.d(t,"parseHeader",(function(){return d})),r.d(t,"isHeaderPattern",(function(){return l})),r.d(t,"isHeader",(function(){return c})),r.d(t,"canParse",(function(){return h})),r.d(t,"probe",(function(){return f}));var i=null,n=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],a=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],s=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],o=[0,1,1,4];function u(e,t,r,i,n){if(!(r+24>t.length)){var a=d(t,r);if(a&&r+a.frameLength<=t.length){var s=i+n*(9e4*a.samplesPerFrame/a.sampleRate),o={unit:t.subarray(r,r+a.frameLength),pts:s,dts:s};return e.config=[],e.channelCount=a.channelCount,e.samplerate=a.sampleRate,e.samples.push(o),{sample:o,length:a.frameLength,missing:0}}}}function d(e,t){var r=e[t+1]>>3&3,u=e[t+1]>>1&3,d=e[t+2]>>4&15,l=e[t+2]>>2&3;if(1!==r&&0!==d&&15!==d&&3!==l){var c=e[t+2]>>1&1,h=e[t+3]>>6,f=1e3*n[14*(3===r?3-u:3===u?3:4)+d-1],A=a[3*(3===r?0:2===r?1:2)+l],p=3===h?1:2,v=s[r][u],m=o[u],g=8*v*m,y=Math.floor(v*f/A+c)*m;if(null===i){var b=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);i=b?parseInt(b[1]):0}return!!i&&i<=87&&2===u&&f>=224e3&&0===h&&(e[t+3]=128|e[t+3]),{sampleRate:A,channelCount:p,frameLength:y,samplesPerFrame:g}}}function l(e,t){return!(255!==e[t]||224&~e[t+1]||!(6&e[t+1]))}function c(e,t){return t+1<e.length&&l(e,t)}function h(e,t){return l(e,t)&&4<=e.length-t}function f(e,t){if(t+1<e.length&&l(e,t)){var r=d(e,t),i=4;null!=r&&r.frameLength&&(i=r.frameLength);var n=t+i;return n===e.length||c(e,n)}return!1}},"./repo/src/demux/sample-aes.ts":function(e,t,r){"use strict";r.r(t);var i=r("../crypt/dist/jsvmp.js"),n=r.n(i),a=r("./repo/src/demux/tsdemuxer.ts"),s=function(){function e(e,t,r){this.keyData=void 0,this.decrypter=void 0,this.keyData=r,this.decrypter=new n.a(e,t,{removePKCS7Padding:!1})}var t=e.prototype;return t.decryptBuffer=function(e,t){this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer,t)},t.decryptAacSample=function(e,t,r,i){var n=e[t].unit;if(!(n.length<=16)){var a=n.subarray(16,n.length-n.length%16),s=a.buffer.slice(a.byteOffset,a.byteOffset+a.length),o=this;this.decryptBuffer(s,(function(a){var s=new Uint8Array(a);n.set(s,16),i||o.decryptAacSamples(e,t+1,r)}))}},t.decryptAacSamples=function(e,t,r){for(;;t++){if(t>=e.length)return void r();if(!(e[t].unit.length<32)){var i=this.decrypter.isSync();if(this.decryptAacSample(e,t,r,i),!i)return}}},t.getAvcEncryptedData=function(e){for(var t=16*Math.floor((e.length-48)/160)+16,r=new Int8Array(t),i=0,n=32;n<e.length-16;n+=160,i+=16)r.set(e.subarray(n,n+16),i);return r},t.getAvcDecryptedUnit=function(e,t){for(var r=new Uint8Array(t),i=0,n=32;n<e.length-16;n+=160,i+=16)e.set(r.subarray(i,i+16),n);return e},t.decryptAvcSample=function(e,t,r,i,n,s){var o=Object(a.discardEPB)(n.data),u=this.getAvcEncryptedData(o),d=this;this.decryptBuffer(u.buffer,(function(a){n.data=d.getAvcDecryptedUnit(o,a),s||d.decryptAvcSamples(e,t,r+1,i)}))},t.decryptAvcSamples=function(e,t,r,i){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,r=0){if(t>=e.length)return void i();for(var n=e[t].units;!(r>=n.length);r++){var a=n[r];if(!(a.data.length<=48||1!==a.type&&5!==a.type)){var s=this.decrypter.isSync();if(this.decryptAvcSample(e,t,r,i,a,s),!s)return}}}},e}();t.default=s},"./repo/src/demux/transmuxer-interface.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return c}));var i=r("./node_modules/webworkify-webpack/index.js"),n=r("./repo/src/events.ts"),a=r("./repo/src/demux/transmuxer.ts"),s=r("./repo/src/utils/logger.ts"),o=r("./repo/src/errors.ts"),u=r("./repo/src/utils/mediasource-helper.ts"),d=r("./node_modules/eventemitter3/index.js"),l=Object(u.getMediaSource)()||{isTypeSupported:function(){return!1}},c=function(){function e(e,t,r,u){var c=this;this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.worker=void 0,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.hls=e,this.id=t,this.onTransmuxComplete=r,this.onFlush=u;var h=e.config,f=function(t,r){(r=r||{}).frag=c.frag,r.id=c.id,e.trigger(t,r)};this.observer=new d.EventEmitter,this.observer.on(n.Events.FRAG_DECRYPTED,f),this.observer.on(n.Events.ERROR,f);var A={mp4:l.isTypeSupported("video/mp4"),mpeg:l.isTypeSupported("audio/mpeg"),mp3:l.isTypeSupported('audio/mp4; codecs="mp3"')},p=navigator.vendor;if(h.enableWorker&&"undefined"!=typeof Worker){var v;s.logger.log("demuxing in webworker");try{v=this.worker=i("./repo/src/demux/transmuxer-worker.ts"),this.onwmsg=this.onWorkerMessage.bind(this),v.addEventListener("message",this.onwmsg),v.onerror=function(t){e.trigger(n.Events.ERROR,{type:o.ErrorTypes.OTHER_ERROR,details:o.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",error:new Error(t.message+"  ("+t.filename+":"+t.lineno+")")})},v.postMessage({cmd:"init",typeSupported:A,vendor:p,id:t,config:JSON.stringify(h)})}catch(e){s.logger.warn("Error in worker:",e),s.logger.error("Error while initializing DemuxerWorker, fallback to inline"),v&&self.URL.revokeObjectURL(v.objectURL),this.transmuxer=new a.default(this.observer,A,h,p,t),this.worker=null}}else this.transmuxer=new a.default(this.observer,A,h,p,t)}var t=e.prototype;return t.destroy=function(){var e=this.worker;if(e)e.removeEventListener("message",this.onwmsg),e.terminate(),this.worker=null;else{var t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}var r=this.observer;r&&r.removeAllListeners(),this.observer=null},t.push=function(e,t,r,i,n,o,u,d,l,c){var h,f,A=this;l.transmuxing.start=self.performance.now();var p=this.transmuxer,v=this.worker,m=o?o.start:n.start,g=n.decryptdata,y=this.frag,b=!(y&&n.cc===y.cc),_=!(y&&l.level===y.level),E=y?l.sn-y.sn:-1,T=this.part?l.part-this.part.index:1,k=!_&&(1===E||0===E&&1===T),S=self.performance.now();(_||E||0===n.stats.parsing.start)&&(n.stats.parsing.start=S),!o||!T&&k||(o.stats.parsing.start=S);var D=!(y&&(null===(h=n.initSegment)||void 0===h?void 0:h.url)===(null===(f=y.initSegment)||void 0===f?void 0:f.url)),R=new a.TransmuxState(b,k,d,_,m,D);if(!k||b||D){s.logger.log("[transmuxer-interface, "+n.type+"]: Starting new transmux session for sn: "+l.sn+" p: "+l.part+" level: "+l.level+" id: "+l.id+"\n        discontinuity: "+b+"\n        trackSwitch: "+_+"\n        contiguous: "+k+"\n        accurateTimeOffset: "+d+"\n        timeOffset: "+m+"\n        initSegmentChange: "+D);var L=new a.TransmuxConfig(r,i,t,u,c);this.configureTransmuxer(L)}if(this.frag=n,this.part=o,v)v.postMessage({cmd:"demux",data:e,decryptdata:g,chunkMeta:l,state:R},e instanceof ArrayBuffer?[e]:[]);else if(p){var C=p.push(e,g,l,R);Object(a.isPromise)(C)?C.then((function(e){A.handleTransmuxComplete(e)})):this.handleTransmuxComplete(C)}},t.flush=function(e){var t=this;e.transmuxing.start=self.performance.now();var r=this.transmuxer,i=this.worker;if(i)i.postMessage({cmd:"flush",chunkMeta:e});else if(r){var n=r.flush(e);Object(a.isPromise)(n)?n.then((function(r){t.handleFlushResult(r,e)})):this.handleFlushResult(n,e)}},t.handleFlushResult=function(e,t){var r=this;e.forEach((function(e){r.handleTransmuxComplete(e)})),this.onFlush(t)},t.onWorkerMessage=function(e){var t=e.data,r=this.hls;switch(t.event){case"init":self.URL.revokeObjectURL(this.worker.objectURL);break;case"transmuxComplete":this.handleTransmuxComplete(t.data);break;case"flush":this.onFlush(t.data);break;default:t.data=t.data||{},t.data.frag=this.frag,t.data.id=this.id,r.trigger(t.event,t.data)}},t.configureTransmuxer=function(e){var t=this.worker,r=this.transmuxer;t?t.postMessage({cmd:"configure",config:e}):r&&r.configure(e)},t.handleTransmuxComplete=function(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)},e}()},"./repo/src/demux/transmuxer-worker.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return o}));var i=r("./repo/src/demux/transmuxer.ts"),n=r("./repo/src/events.ts"),a=r("./repo/src/utils/logger.ts"),s=r("./node_modules/eventemitter3/index.js");function o(e){var t=new s.EventEmitter,r=function(t,r){e.postMessage({event:t,data:r})};t.on(n.Events.FRAG_DECRYPTED,r),t.on(n.Events.ERROR,r),e.addEventListener("message",(function(n){var s=n.data;switch(s.cmd){case"init":var o=JSON.parse(s.config);e.transmuxer=new i.default(t,s.typeSupported,o,s.vendor,s.id),Object(a.enableLogs)(o.debug),r("init",null);break;case"configure":e.transmuxer.configure(s.config);break;case"demux":var d=e.transmuxer.push(s.data,s.decryptdata,s.chunkMeta,s.state);Object(i.isPromise)(d)?d.then((function(t){u(e,t)})):u(e,d);break;case"flush":var c=s.chunkMeta,h=e.transmuxer.flush(c);Object(i.isPromise)(h)?h.then((function(t){l(e,t,c)})):l(e,h,c)}}))}function u(e,t){if((r=t.remuxResult).audio||r.video||r.text||r.id3||r.initSegment){var r,i=[],n=t.remuxResult,a=n.audio,s=n.video;a&&d(i,a),s&&d(i,s),e.postMessage({event:"transmuxComplete",data:t},i)}}function d(e,t){t.data1&&e.push(t.data1.buffer),t.data2&&e.push(t.data2.buffer)}function l(e,t,r){t.forEach((function(t){u(e,t)})),e.postMessage({event:"flush",data:r})}},"./repo/src/demux/transmuxer.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return y})),r.d(t,"isPromise",(function(){return _})),r.d(t,"TransmuxConfig",(function(){return E})),r.d(t,"TransmuxState",(function(){return T}));var i,n=r("./repo/src/events.ts"),a=r("./repo/src/errors.ts"),s=r("../crypt/dist/jsvmp.js"),o=r.n(s),u=r("./repo/src/demux/aacdemuxer.ts"),d=r("./repo/src/demux/mp4demuxer.ts"),l=r("./repo/src/demux/tsdemuxer.ts"),c=r("./repo/src/demux/mp3demuxer.ts"),h=r("./repo/src/remux/mp4-remuxer.ts"),f=r("./repo/src/remux/passthrough-remuxer.ts"),A=r("./repo/src/demux/chunk-cache.ts"),p=r("./repo/src/utils/mp4-tools.ts"),v=r("./repo/src/utils/logger.ts");try{i=self.performance.now.bind(self.performance)}catch(e){v.logger.debug("Unable to use Performance API on this environment"),i=self.Date.now}var m=[{demux:l.default,remux:h.default},{demux:d.default,remux:f.default},{demux:u.default,remux:h.default},{demux:c.default,remux:h.default}],g=1024;m.forEach((function(e){var t=e.demux;g=Math.max(g,t.minProbeByteLength)}));var y=function(){function e(e,t,r,i,n){this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.cache=new A.default,this.observer=e,this.typeSupported=t,this.config=r,this.vendor=i,this.id=n}var t=e.prototype;return t.configure=function(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()},t.push=function(e,t,r,n){var a=this,s=r.transmuxing;s.executeStart=i();var o=new Uint8Array(e),u=this.cache,d=this.config,l=this.currentTransmuxState,c=this.transmuxConfig;n&&(this.currentTransmuxState=n);var h=function(e,t){var r=null;return e.byteLength>0&&null!=t&&null!=t.key&&null!==t.iv&&null!=t.method&&(r=t),r}(o,t);if(h&&"AES-128"===h.method){var f=this.getDecrypter();if(!d.enableSoftwareAES)return this.decryptionPromise=f.webCryptoDecrypt(o,h.key.buffer,h.iv.buffer).then((function(e){var t=a.push(e,null,r);return a.decryptionPromise=null,t})),this.decryptionPromise;var A=f.softwareDecrypt(o,h.key.buffer,h.iv.buffer);if(!A)return s.executeEnd=i(),b(r);o=new Uint8Array(A)}var v=n||l,m=v.contiguous,g=v.discontinuity,y=v.trackSwitch,_=v.accurateTimeOffset,E=v.timeOffset,T=v.initSegmentChange,k=c.audioCodec,S=c.videoCodec,D=c.defaultInitPts,R=c.duration,L=c.initSegmentData;if((g||y||T)&&this.resetInitSegment(L,k,S,R),(g||T)&&this.resetInitialTimestamp(D),m||this.resetContiguity(),this.needsProbing(o,g,y)){if(u.dataLength){var C=u.flush();o=Object(p.appendUint8Array)(C,o)}this.configureTransmuxer(o,c)}var w=this.transmux(o,h,E,_,r),I=this.currentTransmuxState;return I.contiguous=!0,I.discontinuity=!1,I.trackSwitch=!1,s.executeEnd=i(),w},t.flush=function(e){var t=this,r=e.transmuxing;r.executeStart=i();var s=this.decrypter,o=this.cache,u=this.currentTransmuxState,d=this.decryptionPromise;if(d)return d.then((function(){return t.flush(e)}));var l=[],c=u.timeOffset;if(s){var h=s.flush();h&&l.push(this.push(h,null,e))}var f=o.dataLength;o.reset();var A=this.demuxer,p=this.remuxer;if(!A||!p)return f>=g&&this.observer.emit(n.Events.ERROR,n.Events.ERROR,{type:a.ErrorTypes.MEDIA_ERROR,details:a.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"}),r.executeEnd=i(),[b(e)];var v=A.flush(c);return _(v)?v.then((function(r){return t.flushRemux(l,r,e),l})):(this.flushRemux(l,v,e),l)},t.flushRemux=function(e,t,r){var n=t.audioTrack,a=t.videoTrack,s=t.id3Track,o=t.textTrack,u=this.currentTransmuxState,d=u.accurateTimeOffset,l=u.timeOffset;v.logger.log("[transmuxer.ts]: Flushed fragment "+r.sn+(r.part>-1?" p: "+r.part:"")+" of level "+r.level);var c=this.remuxer.remux(n,a,s,o,l,d,!0,this.id);e.push({remuxResult:c,chunkMeta:r}),r.transmuxing.executeEnd=i()},t.resetInitialTimestamp=function(e){var t=this.demuxer,r=this.remuxer;t&&r&&(t.resetTimeStamp(e),r.resetTimeStamp(e))},t.resetContiguity=function(){var e=this.demuxer,t=this.remuxer;e&&t&&(e.resetContiguity(),t.resetNextTimestamp())},t.resetInitSegment=function(e,t,r,i){var n=this.demuxer,a=this.remuxer;n&&a&&(n.resetInitSegment(e,t,r,i),a.resetInitSegment(e,t,r))},t.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},t.transmux=function(e,t,r,i,n){return t&&"SAMPLE-AES"===t.method?this.transmuxSampleAes(e,t,r,i,n):this.transmuxUnencrypted(e,r,i,n)},t.transmuxUnencrypted=function(e,t,r,i){var n=this.demuxer.demux(e,t,!1,!this.config.progressive),a=n.audioTrack,s=n.videoTrack,o=n.id3Track,u=n.textTrack;return{remuxResult:this.remuxer.remux(a,s,o,u,t,r,!1,this.id),chunkMeta:i}},t.transmuxSampleAes=function(e,t,r,i,n){var a=this;return this.demuxer.demuxSampleAes(e,t,r).then((function(e){return{remuxResult:a.remuxer.remux(e.audioTrack,e.videoTrack,e.id3Track,e.textTrack,r,i,!1,a.id),chunkMeta:n}}))},t.configureTransmuxer=function(e,t){for(var r,i=this.config,n=this.observer,a=this.typeSupported,s=this.vendor,o=t.audioCodec,u=t.defaultInitPts,l=t.duration,c=t.initSegmentData,h=t.videoCodec,A=0,p=m.length;A<p;A++)if(m[A].demux.probe(e)){r=m[A];break}r||(v.logger.warn("Failed to find demuxer by probing frag, treating as mp4 passthrough"),r={demux:d.default,remux:f.default});var g=this.demuxer,y=this.remuxer,b=r.remux,_=r.demux;y&&y instanceof b||(this.remuxer=new b(n,i,a,s)),g&&g instanceof _||(this.demuxer=new _(n,i,a),this.probe=_.probe),this.resetInitSegment(c,o,h,l),this.resetInitialTimestamp(u)},t.needsProbing=function(e,t,r){return!this.demuxer||!this.remuxer||t||r},t.getDecrypter=function(){var e=this.decrypter;return e||(e=this.decrypter=new o.a(this.observer,this.config)),e},e}(),b=function(e){return{remuxResult:{},chunkMeta:e}};function _(e){return"then"in e&&e.then instanceof Function}var E=function(e,t,r,i,n){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=r,this.duration=i,this.defaultInitPts=n},T=function(e,t,r,i,n,a){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=r,this.trackSwitch=i,this.timeOffset=n,this.initSegmentChange=a}},"./repo/src/demux/tsdemuxer.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"discardEPB",(function(){return m}));var i=r("./repo/src/demux/adts.ts"),n=r("./repo/src/demux/mpegaudio.ts"),a=r("./repo/src/demux/exp-golomb.ts"),s=r("./repo/src/demux/sample-aes.ts"),o=r("./repo/src/events.ts"),u=r("./repo/src/utils/mp4-tools.ts"),d=r("./repo/src/utils/logger.ts"),l=r("./repo/src/errors.ts"),c=function(){function e(e,t,r){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=e,this.config=t,this.typeSupported=r}e.probe=function(t){var r=e.syncOffset(t);return!(r<0||(r&&d.logger.warn("MPEG2-TS detected but first sync word found @ offset "+r+", junk ahead ?"),0))},e.syncOffset=function(e){for(var t=Math.min(1e3,e.length-564),r=0;r<t;){if(71===e[r]&&71===e[r+188]&&71===e[r+376])return r;r++}return-1},e.createTrack=function(e,t){return{container:"video"===e||"audio"===e?"video/mp2t":void 0,type:e,id:u.RemuxerTrackIdConfig[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:"audio"===e?t:void 0}};var t=e.prototype;return t.resetInitSegment=function(t,r,i,n){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=e.createTrack("video"),this._audioTrack=e.createTrack("audio",n),this._id3Track=e.createTrack("id3"),this._txtTrack=e.createTrack("text"),this._audioTrack.isAAC=!0,this.aacOverFlow=null,this.avcSample=null,this.audioCodec=r,this.videoCodec=i,this._duration=n},t.resetTimeStamp=function(){},t.resetContiguity=function(){var e=this._audioTrack,t=this._avcTrack,r=this._id3Track;e&&(e.pesData=null),t&&(t.pesData=null),r&&(r.pesData=null),this.aacOverFlow=null},t.demux=function(t,r,i,n){var a;void 0===i&&(i=!1),void 0===n&&(n=!1),i||(this.sampleAes=null);var s=this._avcTrack,c=this._audioTrack,h=this._id3Track,v=this._txtTrack,m=s.pid,g=s.pesData,y=c.pid,b=h.pid,_=c.pesData,E=h.pesData,T=!1,k=this.pmtParsed,S=this._pmtId,D=t.length;if(this.remainderData&&(D=(t=Object(u.appendUint8Array)(this.remainderData,t)).length,this.remainderData=null),D<188&&!n)return this.remainderData=t,{audioTrack:c,videoTrack:s,id3Track:h,textTrack:v};var R=Math.max(0,e.syncOffset(t));(D-=(D+R)%188)<t.byteLength&&!n&&(this.remainderData=new Uint8Array(t.buffer,D,t.buffer.byteLength-D));for(var L=0,C=R;C<D;C+=188)if(71===t[C]){var w=!!(64&t[C+1]),I=((31&t[C+1])<<8)+t[C+2],x=void 0;if((48&t[C+3])>>4>1){if((x=C+5+t[C+4])===C+188)continue}else x=C+4;switch(I){case m:w&&(g&&(a=p(g))&&this.parseAVCPES(s,v,a,!1),g={data:[],size:0}),g&&(g.data.push(t.subarray(x,C+188)),g.size+=C+188-x);break;case y:w&&(_&&(a=p(_))&&(c.isAAC?this.parseAACPES(c,a):this.parseMPEGPES(c,a)),_={data:[],size:0}),_&&(_.data.push(t.subarray(x,C+188)),_.size+=C+188-x);break;case b:w&&(E&&(a=p(E))&&this.parseID3PES(h,a),E={data:[],size:0}),E&&(E.data.push(t.subarray(x,C+188)),E.size+=C+188-x);break;case 0:w&&(x+=t[x]+1),S=this._pmtId=f(t,x);break;case S:w&&(x+=t[x]+1);var P=A(t,x,!0===this.typeSupported.mpeg||!0===this.typeSupported.mp3,i);(m=P.avc)>0&&(s.pid=m),(y=P.audio)>0&&(c.pid=y,c.isAAC=P.isAAC),(b=P.id3)>0&&(h.pid=b),T&&!k&&(d.logger.log("reparse from beginning"),T=!1,C=R-188),k=this.pmtParsed=!0;break;case 17:case 8191:break;default:T=!0}}else L++;L>0&&this.observer.emit(o.Events.ERROR,o.Events.ERROR,{type:l.ErrorTypes.MEDIA_ERROR,details:l.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"Found "+L+" TS packet/s that do not start with 0x47"}),s.pesData=g,c.pesData=_,h.pesData=E;var F={audioTrack:c,videoTrack:s,id3Track:h,textTrack:v};return n&&this.extractRemainingSamples(F),F},t.flush=function(){var e,t=this.remainderData;return this.remainderData=null,e=t?this.demux(t,-1,!1,!0):{videoTrack:this._avcTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(e),this.sampleAes?this.decrypt(e,this.sampleAes):e},t.extractRemainingSamples=function(e){var t,r=e.audioTrack,i=e.videoTrack,n=e.id3Track,a=e.textTrack,s=i.pesData,o=r.pesData,u=n.pesData;s&&(t=p(s))?(this.parseAVCPES(i,a,t,!0),i.pesData=null):i.pesData=s,o&&(t=p(o))?(r.isAAC?this.parseAACPES(r,t):this.parseMPEGPES(r,t),r.pesData=null):(null!=o&&o.size&&d.logger.log("last AAC PES packet truncated,might overlap between fragments"),r.pesData=o),u&&(t=p(u))?(this.parseID3PES(n,t),n.pesData=null):n.pesData=u},t.demuxSampleAes=function(e,t,r){var i=this.demux(e,r,!0,!this.config.progressive),n=this.sampleAes=new s.default(this.observer,this.config,t);return this.decrypt(i,n)},t.decrypt=function(e,t){return new Promise((function(r){var i=e.audioTrack,n=e.videoTrack;i.samples&&i.isAAC?t.decryptAacSamples(i.samples,0,(function(){n.samples?t.decryptAvcSamples(n.samples,0,0,(function(){r(e)})):r(e)})):n.samples&&t.decryptAvcSamples(n.samples,0,0,(function(){r(e)}))}))},t.destroy=function(){this._duration=0},t.parseAVCPES=function(e,t,r,i){var n,s=this,o=this.parseAVCNALu(e,r.data),d=this.avcSample,l=!1;r.data=null,d&&o.length&&!e.audFound&&(v(d,e),d=this.avcSample=h(!1,r.pts,r.dts,"")),o.forEach((function(i){switch(i.type){case 1:n=!0,d||(d=s.avcSample=h(!0,r.pts,r.dts,"")),d.frame=!0;var o=i.data;if(l&&o.length>4){var c=new a.default(o).readSliceType();2!==c&&4!==c&&7!==c&&9!==c||(d.key=!0)}break;case 5:n=!0,d||(d=s.avcSample=h(!0,r.pts,r.dts,"")),d.key=!0,d.frame=!0;break;case 6:n=!0,Object(u.parseSEIMessageFromNALu)(m(i.data),r.pts,t.samples);break;case 7:if(n=!0,l=!0,!e.sps){var f=new a.default(i.data).readSPS();e.width=f.width,e.height=f.height,e.pixelRatio=f.pixelRatio,e.sps=[i.data],e.duration=s._duration;for(var A=i.data.subarray(1,4),p="avc1.",g=0;g<3;g++){var y=A[g].toString(16);y.length<2&&(y="0"+y),p+=y}e.codec=p}break;case 8:n=!0,e.pps||(e.pps=[i.data]);break;case 9:n=!1,e.audFound=!0,d&&v(d,e),d=s.avcSample=h(!1,r.pts,r.dts,"");break;case 12:n=!1;break;default:n=!1,d&&(d.debug+="unknown NAL "+i.type+" ")}d&&n&&d.units.push(i)})),i&&d&&(v(d,e),this.avcSample=null)},t.getLastNalUnit=function(e){var t,r,i=this.avcSample;if(i&&0!==i.units.length||(i=e[e.length-1]),null!==(t=i)&&void 0!==t&&t.units){var n=i.units;r=n[n.length-1]}return r},t.parseAVCNALu=function(e,t){var r,i,n=t.byteLength,a=e.naluState||0,s=a,o=[],u=0,d=-1,l=0;for(-1===a&&(d=0,l=31&t[0],a=0,u=1);u<n;)if(r=t[u++],a)if(1!==a)if(r)if(1===r){if(d>=0){var c={data:t.subarray(d,u-a-1),type:l};o.push(c)}else{var h=this.getLastNalUnit(e.samples);if(h&&(s&&u<=4-s&&h.state&&(h.data=h.data.subarray(0,h.data.byteLength-s)),(i=u-a-1)>0)){var f=new Uint8Array(h.data.byteLength+i);f.set(h.data,0),f.set(t.subarray(0,i),h.data.byteLength),h.data=f,h.state=0}}u<n?(d=u,l=31&t[u],a=0):a=-1}else a=0;else a=3;else a=r?0:2;else a=r?0:1;if(d>=0&&a>=0){var A={data:t.subarray(d,n),type:l,state:a};o.push(A)}if(0===o.length){var p=this.getLastNalUnit(e.samples);if(p){var v=new Uint8Array(p.data.byteLength+t.byteLength);v.set(p.data,0),v.set(t,p.data.byteLength),p.data=v}}return e.naluState=a,o},t.parseAACPES=function(e,t){var r,n,a,s,u,c=0,h=this.aacOverFlow,f=t.data;if(h){this.aacOverFlow=null;var A=h.sample.unit.byteLength,p=Math.min(h.missing,A),v=A-p;h.sample.unit.set(f.subarray(0,p),v),e.samples.push(h.sample),c=h.missing}for(r=c,n=f.length;r<n-1&&!i.isHeader(f,r);r++);if(r===c||(r<n-1?(a="AAC PES did not start with ADTS header,offset:"+r,s=!1):(a="no ADTS header found in AAC PES",s=!0),d.logger.warn("parsing error:"+a),this.observer.emit(o.Events.ERROR,o.Events.ERROR,{type:l.ErrorTypes.MEDIA_ERROR,details:l.ErrorDetails.FRAG_PARSING_ERROR,fatal:s,reason:a}),!s)){if(i.initTrackConfig(e,this.observer,f,r,this.audioCodec),void 0!==t.pts)u=t.pts;else{if(!h)return void d.logger.warn("[tsdemuxer]: AAC PES unknown PTS");var m=i.getFrameDuration(e.samplerate);u=h.sample.pts+m}for(var g=0;r<n;){if(i.isHeader(f,r)){if(r+5<n){var y=i.appendFrame(e,f,r,u,g);if(y){if(!y.missing){r+=y.length,g++;continue}this.aacOverFlow=y}}break}r++}}},t.parseMPEGPES=function(e,t){var r=t.data,i=r.length,a=0,s=0,o=t.pts;if(void 0!==o)for(;s<i;)if(n.isHeader(r,s)){var u=n.appendFrame(e,r,s,o,a);if(!u)break;s+=u.length,a++}else s++;else d.logger.warn("[tsdemuxer]: MPEG PES unknown PTS")},t.parseID3PES=function(e,t){void 0!==t.pts?e.samples.push(t):d.logger.warn("[tsdemuxer]: ID3 PES unknown PTS")},e}();function h(e,t,r,i){return{key:e,frame:!1,pts:t,dts:r,units:[],debug:i,length:0}}function f(e,t){return(31&e[t+10])<<8|e[t+11]}function A(e,t,r,i){var n={audio:-1,avc:-1,id3:-1,isAAC:!0},a=t+3+((15&e[t+1])<<8|e[t+2])-4;for(t+=12+((15&e[t+10])<<8|e[t+11]);t<a;){var s=(31&e[t+1])<<8|e[t+2];switch(e[t]){case 207:if(!i){d.logger.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:-1===n.audio&&(n.audio=s);break;case 21:-1===n.id3&&(n.id3=s);break;case 219:if(!i){d.logger.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:-1===n.avc&&(n.avc=s);break;case 3:case 4:r?-1===n.audio&&(n.audio=s,n.isAAC=!1):d.logger.log("MPEG audio found, not supported in this browser");break;case 36:d.logger.warn("Unsupported HEVC stream type found")}t+=5+((15&e[t+3])<<8|e[t+4])}return n}function p(e){var t,r,i,n,a,s=0,o=e.data;if(!e||0===e.size)return null;for(;o[0].length<19&&o.length>1;){var u=new Uint8Array(o[0].length+o[1].length);u.set(o[0]),u.set(o[1],o[0].length),o[0]=u,o.splice(1,1)}if(1===((t=o[0])[0]<<16)+(t[1]<<8)+t[2]){if((r=(t[4]<<8)+t[5])&&r>e.size-6)return null;var l=t[7];192&l&&(n=536870912*(14&t[9])+4194304*(255&t[10])+16384*(254&t[11])+128*(255&t[12])+(254&t[13])/2,64&l?n-(a=536870912*(14&t[14])+4194304*(255&t[15])+16384*(254&t[16])+128*(255&t[17])+(254&t[18])/2)>54e5&&(d.logger.warn(Math.round((n-a)/9e4)+"s delta between PTS and DTS, align them"),n=a):a=n);var c=(i=t[8])+9;if(e.size<=c)return null;e.size-=c;for(var h=new Uint8Array(e.size),f=0,A=o.length;f<A;f++){var p=(t=o[f]).byteLength;if(c){if(c>p){c-=p;continue}t=t.subarray(c),p-=c,c=0}h.set(t,s),s+=p}return r&&(r-=i+3),{data:h,pts:n,dts:a,len:r}}return null}function v(e,t){if(e.units.length&&e.frame){if(void 0===e.pts){var r=t.samples,i=r.length;if(!i)return void t.dropped++;var n=r[i-1];e.pts=n.pts,e.dts=n.dts}t.samples.push(e)}e.debug.length&&d.logger.log(e.pts+"/"+e.dts+":"+e.debug)}function m(e){for(var t=e.byteLength,r=[],i=1;i<t-2;)0===e[i]&&0===e[i+1]&&3===e[i+2]?(r.push(i+2),i+=2):i++;if(0===r.length)return e;var n=t-r.length,a=new Uint8Array(n),s=0;for(i=0;i<n;s++,i++)s===r[0]&&(s++,r.shift()),a[i]=e[s];return a}c.minProbeByteLength=188,t.default=c},"./repo/src/empty.js":function(e,t){e.exports=void 0},"./repo/src/errors.ts":function(e,t,r){"use strict";var i,n;r.r(t),r.d(t,"ErrorTypes",(function(){return i})),r.d(t,"ErrorDetails",(function(){return n})),function(e){e.NETWORK_ERROR="networkError",e.MEDIA_ERROR="mediaError",e.KEY_SYSTEM_ERROR="keySystemError",e.MUX_ERROR="muxError",e.OTHER_ERROR="otherError"}(i||(i={})),function(e){e.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",e.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",e.KEY_SYSTEM_NO_SESSION="keySystemNoSession",e.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",e.KEY_SYSTEM_NO_INIT_DATA="keySystemNoInitData",e.MANIFEST_LOAD_ERROR="manifestLoadError",e.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",e.MANIFEST_PARSING_ERROR="manifestParsingError",e.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",e.LEVEL_EMPTY_ERROR="levelEmptyError",e.LEVEL_LOAD_ERROR="levelLoadError",e.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",e.LEVEL_SWITCH_ERROR="levelSwitchError",e.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",e.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",e.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",e.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",e.FRAG_LOAD_ERROR="fragLoadError",e.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",e.FRAG_DECRYPT_ERROR="fragDecryptError",e.FRAG_PARSING_ERROR="fragParsingError",e.REMUX_ALLOC_ERROR="remuxAllocError",e.KEY_LOAD_ERROR="keyLoadError",e.KEY_LOAD_TIMEOUT="keyLoadTimeOut",e.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",e.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",e.BUFFER_APPEND_ERROR="bufferAppendError",e.BUFFER_APPENDING_ERROR="bufferAppendingError",e.BUFFER_STALLED_ERROR="bufferStalledError",e.BUFFER_FULL_ERROR="bufferFullError",e.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",e.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",e.INTERNAL_EXCEPTION="internalException",e.INTERNAL_ABORTED="aborted",e.UNKNOWN="unknown"}(n||(n={}))},"./repo/src/events.ts":function(e,t,r){"use strict";var i;r.r(t),r.d(t,"Events",(function(){return i})),function(e){e.MEDIA_ATTACHING="hlsMediaAttaching",e.MEDIA_ATTACHED="hlsMediaAttached",e.MEDIA_DETACHING="hlsMediaDetaching",e.MEDIA_DETACHED="hlsMediaDetached",e.BUFFER_RESET="hlsBufferReset",e.BUFFER_CODECS="hlsBufferCodecs",e.BUFFER_CREATED="hlsBufferCreated",e.BUFFER_APPENDING="hlsBufferAppending",e.BUFFER_APPENDED="hlsBufferAppended",e.BUFFER_EOS="hlsBufferEos",e.BUFFER_FLUSHING="hlsBufferFlushing",e.BUFFER_FLUSHED="hlsBufferFlushed",e.MANIFEST_LOADING="hlsManifestLoading",e.MANIFEST_LOADED="hlsManifestLoaded",e.MANIFEST_PARSED="hlsManifestParsed",e.LEVEL_SWITCHING="hlsLevelSwitching",e.LEVEL_SWITCHED="hlsLevelSwitched",e.LEVEL_LOADING="hlsLevelLoading",e.LEVEL_LOADED="hlsLevelLoaded",e.LEVEL_UPDATED="hlsLevelUpdated",e.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",e.LEVELS_UPDATED="hlsLevelsUpdated",e.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",e.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",e.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",e.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",e.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",e.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",e.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",e.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",e.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",e.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",e.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",e.CUES_PARSED="hlsCuesParsed",e.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",e.INIT_PTS_FOUND="hlsInitPtsFound",e.FRAG_LOADING="hlsFragLoading",e.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",e.FRAG_LOADED="hlsFragLoaded",e.FRAG_DECRYPTED="hlsFragDecrypted",e.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",e.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",e.FRAG_PARSING_METADATA="hlsFragParsingMetadata",e.FRAG_PARSED="hlsFragParsed",e.FRAG_BUFFERED="hlsFragBuffered",e.FRAG_CHANGED="hlsFragChanged",e.FPS_DROP="hlsFpsDrop",e.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",e.ERROR="hlsError",e.DESTROYING="hlsDestroying",e.KEY_LOADING="hlsKeyLoading",e.KEY_LOADED="hlsKeyLoaded",e.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",e.BACK_BUFFER_REACHED="hlsBackBufferReached"}(i||(i={}))},"./repo/src/hls.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return g}));var i=r("./node_modules/url-toolkit/src/url-toolkit.js"),n=r("./repo/src/loader/playlist-loader.ts"),a=r("./repo/src/loader/key-loader.ts"),s=r("./repo/src/controller/id3-track-controller.ts"),o=r("./repo/src/controller/latency-controller.ts"),u=r("./repo/src/controller/level-controller.ts"),d=r("./repo/src/controller/fragment-tracker.ts"),l=r("./repo/src/controller/stream-controller.ts"),c=r("./repo/src/is-supported.ts"),h=r("./repo/src/utils/logger.ts"),f=r("./repo/src/config.ts"),A=r("./node_modules/eventemitter3/index.js"),p=r("./repo/src/events.ts"),v=r("./repo/src/errors.ts");function m(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var g=function(){function e(t){void 0===t&&(t={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new A.EventEmitter,this._autoLevelCapping=void 0,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null;var r=this.config=Object(f.mergeConfig)(e.DefaultConfig,t);this.userConfig=t,Object(h.enableLogs)(r.debug),this._autoLevelCapping=-1,r.progressive&&Object(f.enableStreamingMode)(r);var i=r.abrController,c=r.bufferController,p=r.capLevelController,v=r.fpsController,m=this.abrController=new i(this),g=this.bufferController=new c(this),y=this.capLevelController=new p(this),b=new v(this),_=new n.default(this),E=new a.default(this),T=new s.default(this),k=this.levelController=new u.default(this),S=new d.FragmentTracker(this),D=this.streamController=new l.default(this,S);y.setStreamController(D),b.setStreamController(D);var R=[k,D];this.networkControllers=R;var L=[_,E,m,g,y,b,T,S];this.audioTrackController=this.createController(r.audioTrackController,null,R),this.createController(r.audioStreamController,S,R),this.subtitleTrackController=this.createController(r.subtitleTrackController,null,R),this.createController(r.subtitleStreamController,S,R),this.createController(r.timelineController,null,L),this.emeController=this.createController(r.emeController,null,L),this.cmcdController=this.createController(r.cmcdController,null,L),this.latencyController=this.createController(o.default,null,L),this.coreComponents=L}e.isSupported=function(){return Object(c.isSupported)()};var t,r,g,y=e.prototype;return y.createController=function(e,t,r){if(e){var i=t?new e(this,t):new e(this);return r&&r.push(i),i}return null},y.on=function(e,t,r){void 0===r&&(r=this),this._emitter.on(e,t,r)},y.once=function(e,t,r){void 0===r&&(r=this),this._emitter.once(e,t,r)},y.removeAllListeners=function(e){this._emitter.removeAllListeners(e)},y.off=function(e,t,r,i){void 0===r&&(r=this),this._emitter.off(e,t,r,i)},y.listeners=function(e){return this._emitter.listeners(e)},y.emit=function(e,t,r){return this._emitter.emit(e,t,r)},y.trigger=function(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(t){h.logger.error("An internal error happened while handling event "+e+'. Error message: "'+t.message+'". Here is a stacktrace:',t),this.trigger(p.Events.ERROR,{type:v.ErrorTypes.OTHER_ERROR,details:v.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:e,error:t})}return!1},y.listenerCount=function(e){return this._emitter.listenerCount(e)},y.destroy=function(){h.logger.log("destroy"),this.trigger(p.Events.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach((function(e){return e.destroy()})),this.networkControllers.length=0,this.coreComponents.forEach((function(e){return e.destroy()})),this.coreComponents.length=0},y.attachMedia=function(e){h.logger.log("attachMedia"),this._media=e,this.trigger(p.Events.MEDIA_ATTACHING,{media:e})},y.detachMedia=function(){h.logger.log("detachMedia"),this.trigger(p.Events.MEDIA_DETACHING,void 0),this._media=null},y.loadSource=function(e){this.stopLoad();var t=this.media,r=this.url,n=this.url=i.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});h.logger.log("loadSource:"+n),t&&r&&r!==n&&this.bufferController.hasSourceTypes()&&(this.detachMedia(),this.attachMedia(t)),this.trigger(p.Events.MANIFEST_LOADING,{url:e})},y.startLoad=function(e){void 0===e&&(e=-1),h.logger.log("startLoad("+e+")"),this.networkControllers.forEach((function(t){t.startLoad(e)}))},y.stopLoad=function(){h.logger.log("stopLoad"),this.networkControllers.forEach((function(e){e.stopLoad()}))},y.swapAudioCodec=function(){h.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},y.recoverMediaError=function(){h.logger.log("recoverMediaError");var e=this._media;this.detachMedia(),e&&this.attachMedia(e)},y.removeLevel=function(e,t){void 0===t&&(t=0),this.levelController.removeLevel(e,t)},t=e,g=[{key:"version",get:function(){}},{key:"Events",get:function(){return p.Events}},{key:"ErrorTypes",get:function(){return v.ErrorTypes}},{key:"ErrorDetails",get:function(){return v.ErrorDetails}},{key:"DefaultConfig",get:function(){return e.defaultConfig?e.defaultConfig:f.hlsDefaultConfig},set:function(t){e.defaultConfig=t}}],(r=[{key:"levels",get:function(){return this.levelController.levels||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(e){h.logger.log("set currentLevel:"+e),this.loadLevel=e,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(e){h.logger.log("set nextLevel:"+e),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(e){h.logger.log("set loadLevel:"+e),this.levelController.manualLevel=e}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(e){this.levelController.nextLoadLevel=e}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(e){h.logger.log("set firstLevel:"+e),this.levelController.firstLevel=e}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(e){h.logger.log("set startLevel:"+e),-1!==e&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(e){var t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(e){this._autoLevelCapping!==e&&(h.logger.log("set autoLevelCapping:"+e),this._autoLevelCapping=e)}},{key:"bandwidthEstimate",get:function(){var e=this.abrController.bwEstimator;return e?e.getEstimate():NaN}},{key:"autoLevelEnabled",get:function(){return-1===this.levelController.manualLevel}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var e=this.levels,t=this.config.minAutoBitrate;if(!e)return 0;for(var r=e.length,i=0;i<r;i++)if(e[i].maxBitrate>=t)return i;return 0}},{key:"maxAutoLevel",get:function(){var e=this.levels,t=this.autoLevelCapping;return-1===t&&e&&e.length?e.length-1:t}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(e){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,e)}},{key:"audioTracks",get:function(){var e=this.audioTrackController;return e?e.audioTracks:[]}},{key:"audioTrack",get:function(){var e=this.audioTrackController;return e?e.audioTrack:-1},set:function(e){var t=this.audioTrackController;t&&(t.audioTrack=e)}},{key:"subtitleTracks",get:function(){var e=this.subtitleTrackController;return e?e.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var e=this.subtitleTrackController;return e?e.subtitleTrack:-1},set:function(e){var t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var e=this.subtitleTrackController;return!!e&&e.subtitleDisplay},set:function(e){var t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(e){this.config.lowLatencyMode=e}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}])&&m(t.prototype,r),g&&m(t,g),Object.defineProperty(t,"prototype",{writable:!1}),e}();g.defaultConfig=void 0},"./repo/src/is-supported.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"isSupported",(function(){return a})),r.d(t,"changeTypeSupported",(function(){return s}));var i=r("./repo/src/utils/mediasource-helper.ts");function n(){return self.SourceBuffer||self.WebKitSourceBuffer}function a(){var e=Object(i.getMediaSource)();if(!e)return!1;var t=n(),r=e&&"function"==typeof e.isTypeSupported&&e.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),a=!t||t.prototype&&"function"==typeof t.prototype.appendBuffer&&"function"==typeof t.prototype.remove;return!!r&&!!a}function s(){var e,t=n();return"function"==typeof(null==t||null===(e=t.prototype)||void 0===e?void 0:e.changeType)}},"./repo/src/loader/fragment-loader.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return l})),r.d(t,"LoadError",(function(){return h}));var i=r("./repo/src/polyfills/number.ts"),n=r("./repo/src/errors.ts");function a(e){var t="function"==typeof Map?new Map:void 0;return(a=function(e){if(null===e||(r=e,-1===Function.toString.call(r).indexOf("[native code]")))return e;var r;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,i)}function i(){return s(e,arguments,u(this).constructor)}return i.prototype=Object.create(e.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),o(i,e)})(e)}function s(e,t,r){return(s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}()?Reflect.construct:function(e,t,r){var i=[null];i.push.apply(i,t);var n=new(Function.bind.apply(e,i));return r&&o(n,r.prototype),n}).apply(null,arguments)}function o(e,t){return(o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var d=Math.pow(2,17),l=function(){function e(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}var t=e.prototype;return t.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},t.abort=function(){this.loader&&this.loader.abort()},t.load=function(e,t){var r=this,i=e.url;if(!i)return Promise.reject(new h({type:n.ErrorTypes.NETWORK_ERROR,details:n.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:e,networkDetails:null},"Fragment does not have a "+(i?"part list":"url")));this.abort();var a=this.config,s=a.fLoader,o=a.loader;return new Promise((function(i,u){r.loader&&r.loader.destroy();var l=r.loader=e.loader=s?new s(a):new o(a),f=c(e),A={timeout:a.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:a.fragLoadingMaxRetryTimeout,highWaterMark:"initSegment"===e.sn?1/0:d};e.stats=l.stats,l.load(f,A,{onSuccess:function(t,n,a,s){r.resetLoader(e,l),i({frag:e,part:null,payload:t.data,networkDetails:s})},onError:function(t,i,a){r.resetLoader(e,l),u(new h({type:n.ErrorTypes.NETWORK_ERROR,details:n.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:t,networkDetails:a}))},onAbort:function(t,i,a){r.resetLoader(e,l),u(new h({type:n.ErrorTypes.NETWORK_ERROR,details:n.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:e,networkDetails:a}))},onTimeout:function(t,i,a){r.resetLoader(e,l),u(new h({type:n.ErrorTypes.NETWORK_ERROR,details:n.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,networkDetails:a}))},onProgress:function(r,i,n,a){t&&t({frag:e,part:null,payload:n,networkDetails:a})}})}))},t.loadPart=function(e,t,r){var i=this;this.abort();var a=this.config,s=a.fLoader,o=a.loader;return new Promise((function(u,l){i.loader&&i.loader.destroy();var f=i.loader=e.loader=s?new s(a):new o(a),A=c(e,t),p={timeout:a.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:a.fragLoadingMaxRetryTimeout,highWaterMark:d};t.stats=f.stats,f.load(A,p,{onSuccess:function(n,a,s,o){i.resetLoader(e,f),i.updateStatsFromPart(e,t);var d={frag:e,part:t,payload:n.data,networkDetails:o};r(d),u(d)},onError:function(r,a,s){i.resetLoader(e,f),l(new h({type:n.ErrorTypes.NETWORK_ERROR,details:n.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:r,networkDetails:s}))},onAbort:function(r,a,s){e.stats.aborted=t.stats.aborted,i.resetLoader(e,f),l(new h({type:n.ErrorTypes.NETWORK_ERROR,details:n.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,networkDetails:s}))},onTimeout:function(r,a,s){i.resetLoader(e,f),l(new h({type:n.ErrorTypes.NETWORK_ERROR,details:n.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,networkDetails:s}))}})}))},t.updateStatsFromPart=function(e,t){var r=e.stats,i=t.stats,n=i.total;if(r.loaded+=i.loaded,n){var a=Math.round(e.duration/t.duration),s=Math.min(Math.round(r.loaded/n),a),o=(a-s)*Math.round(r.loaded/s);r.total=r.loaded+o}else r.total=Math.max(r.loaded,r.total);var u=r.loading,d=i.loading;u.start?u.first+=d.first-d.start:(u.start=d.start,u.first=d.first),u.end=d.end},t.resetLoader=function(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()},e}();function c(e,t){void 0===t&&(t=null);var r=t||e,n={frag:e,part:t,responseType:"arraybuffer",url:r.url,headers:{},rangeStart:0,rangeEnd:0},a=r.byteRangeStartOffset,s=r.byteRangeEndOffset;return Object(i.isFiniteNumber)(a)&&Object(i.isFiniteNumber)(s)&&(n.rangeStart=a,n.rangeEnd=s),n}var h=function(e){var t,r;function i(t){for(var r,i=arguments.length,n=new Array(i>1?i-1:0),a=1;a<i;a++)n[a-1]=arguments[a];return(r=e.call.apply(e,[this].concat(n))||this).data=void 0,r.data=t,r}return r=e,(t=i).prototype=Object.create(r.prototype),t.prototype.constructor=t,o(t,r),i}(a(Error))},"./repo/src/loader/fragment.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"ElementaryStreamTypes",(function(){return i})),r.d(t,"BaseSegment",(function(){return f})),r.d(t,"Fragment",(function(){return A})),r.d(t,"Part",(function(){return p}));var i,n=r("./repo/src/polyfills/number.ts"),a=r("./node_modules/url-toolkit/src/url-toolkit.js"),s=r("./repo/src/utils/logger.ts"),o=r("./repo/src/loader/level-key.ts"),u=r("./repo/src/loader/load-stats.ts");function d(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,l(e,t)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function c(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function h(e,t,r){return t&&c(e.prototype,t),r&&c(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}!function(e){e.AUDIO="audio",e.VIDEO="video",e.AUDIOVIDEO="audiovideo"}(i||(i={}));var f=function(){function e(e){var t;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=((t={})[i.AUDIO]=null,t[i.VIDEO]=null,t[i.AUDIOVIDEO]=null,t),this.baseurl=e}return e.prototype.setByteRange=function(e,t){var r=e.split("@",2),i=[];1===r.length?i[0]=t?t.byteRangeEndOffset:0:i[0]=parseInt(r[1]),i[1]=parseInt(r[0])+i[0],this._byteRange=i},h(e,[{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Object(a.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(e){this._url=e}}]),e}(),A=function(e){function t(t,r){var i;return(i=e.call(this,r)||this)._decryptdata=null,i.rawProgramDateTime=null,i.programDateTime=null,i.tagList=[],i.duration=0,i.sn=0,i.levelkey=void 0,i.type=void 0,i.loader=null,i.level=-1,i.cc=0,i.startPTS=void 0,i.endPTS=void 0,i.appendedPTS=void 0,i.startDTS=void 0,i.endDTS=void 0,i.start=0,i.deltaPTS=void 0,i.maxStartPTS=void 0,i.minEndPTS=void 0,i.stats=new u.LoadStats,i.urlId=0,i.data=void 0,i.bitrateTest=!1,i.title=null,i.initSegment=null,i.type=t,i}d(t,e);var r=t.prototype;return r.createInitializationVector=function(e){for(var t=new Uint8Array(16),r=12;r<16;r++)t[r]=e>>8*(15-r)&255;return t},r.setDecryptDataFromLevelKey=function(e,t){var r=e;return"AES-128"===(null==e?void 0:e.method)&&e.uri&&!e.iv&&((r=o.LevelKey.fromURI(e.uri)).method=e.method,r.iv=this.createInitializationVector(t),r.keyFormat="identity"),r},r.setElementaryStreamInfo=function(e,t,r,i,n,a){void 0===a&&(a=!1);var s=this.elementaryStreams,o=s[e];o?(o.startPTS=Math.min(o.startPTS,t),o.endPTS=Math.max(o.endPTS,r),o.startDTS=Math.min(o.startDTS,i),o.endDTS=Math.max(o.endDTS,n)):s[e]={startPTS:t,endPTS:r,startDTS:i,endDTS:n,partial:a}},r.clearElementaryStreamInfo=function(){var e=this.elementaryStreams;e[i.AUDIO]=null,e[i.VIDEO]=null,e[i.AUDIOVIDEO]=null},h(t,[{key:"decryptdata",get:function(){if(!this.levelkey&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkey){var e=this.sn;"number"!=typeof e&&(this.levelkey&&"AES-128"===this.levelkey.method&&!this.levelkey.iv&&s.logger.warn('missing IV for initialization segment with method="'+this.levelkey.method+'" - compliance issue'),e=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,e)}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(null===this.programDateTime)return null;if(!Object(n.isFiniteNumber)(this.programDateTime))return null;var e=Object(n.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+1e3*e}},{key:"encrypted",get:function(){var e;return!(null===(e=this.decryptdata)||void 0===e||!e.keyFormat||!this.decryptdata.uri)}}]),t}(f),p=function(e){function t(t,r,i,n,a){var s;(s=e.call(this,i)||this).fragOffset=0,s.duration=0,s.gap=!1,s.independent=!1,s.relurl=void 0,s.fragment=void 0,s.index=void 0,s.stats=new u.LoadStats,s.duration=t.decimalFloatingPoint("DURATION"),s.gap=t.bool("GAP"),s.independent=t.bool("INDEPENDENT"),s.relurl=t.enumeratedString("URI"),s.fragment=r,s.index=n;var o=t.enumeratedString("BYTERANGE");return o&&s.setByteRange(o,a),a&&(s.fragOffset=a.fragOffset+a.duration),s}return d(t,e),h(t,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var e=this.elementaryStreams;return!!(e.audio||e.video||e.audiovideo)}}]),t}(f)},"./repo/src/loader/key-loader.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return s}));var i=r("./repo/src/events.ts"),n=r("./repo/src/errors.ts"),a=r("./repo/src/utils/logger.ts"),s=function(){function e(e){this.hls=void 0,this.loaders={},this.decryptkey=null,this.decrypturl=null,this.hls=e,this._registerListeners()}var t=e.prototype;return t._registerListeners=function(){this.hls.on(i.Events.KEY_LOADING,this.onKeyLoading,this)},t._unregisterListeners=function(){this.hls.off(i.Events.KEY_LOADING,this.onKeyLoading)},t.destroy=function(){for(var e in this._unregisterListeners(),this.loaders){var t=this.loaders[e];t&&t.destroy()}this.loaders={}},t.onKeyLoading=function(e,t){var r=t.frag,n=r.type,s=this.loaders[n];if(r.decryptdata){var o=r.decryptdata.uri;if(o!==this.decrypturl||null===this.decryptkey){var u=this.hls.config;if(s&&(a.logger.warn("abort previous key loader for type:"+n),s.abort()),!o)return void a.logger.warn("key uri is falsy");var d=u.loader,l=r.loader=this.loaders[n]=new d(u);this.decrypturl=o,this.decryptkey=null;var c={url:o,frag:r,responseType:"arraybuffer"},h={timeout:u.fragLoadingTimeOut,maxRetry:0,retryDelay:u.fragLoadingRetryDelay,maxRetryDelay:u.fragLoadingMaxRetryTimeout,highWaterMark:0},f={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};l.load(c,h,f)}else this.decryptkey&&(r.decryptdata.key=this.decryptkey,this.hls.trigger(i.Events.KEY_LOADED,{frag:r}))}else a.logger.warn("Missing decryption data on fragment in onKeyLoading")},t.loadsuccess=function(e,t,r){var n=r.frag;n.decryptdata?(this.decryptkey=n.decryptdata.key=new Uint8Array(e.data),n.loader=null,delete this.loaders[n.type],this.hls.trigger(i.Events.KEY_LOADED,{frag:n})):a.logger.error("after key load, decryptdata unset")},t.loaderror=function(e,t){var r=t.frag,a=r.loader;a&&a.abort(),delete this.loaders[r.type],this.hls.trigger(i.Events.ERROR,{type:n.ErrorTypes.NETWORK_ERROR,details:n.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:r,response:e})},t.loadtimeout=function(e,t){var r=t.frag,a=r.loader;a&&a.abort(),delete this.loaders[r.type],this.hls.trigger(i.Events.ERROR,{type:n.ErrorTypes.NETWORK_ERROR,details:n.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:r})},e}()},"./repo/src/loader/level-details.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"LevelDetails",(function(){return a}));var i=r("./repo/src/polyfills/number.ts");function n(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var a=function(){function e(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.fragments=[],this.url=e}var t,r;return e.prototype.reloaded=function(e){if(!e)return this.advanced=!0,void(this.updated=!0);var t=this.lastPartSn-e.lastPartSn,r=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!r||!!t,this.advanced=this.endSN>e.endSN||t>0||0===t&&r>0,this.updated||this.advanced?this.misses=Math.floor(.6*e.misses):this.misses=e.misses+1,this.availabilityDelay=e.availabilityDelay},t=e,(r=[{key:"hasProgramDateTime",get:function(){return!!this.fragments.length&&Object(i.isFiniteNumber)(this.fragments[this.fragments.length-1].programDateTime)}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||10}},{key:"drift",get:function(){var e=this.driftEndTime-this.driftStartTime;return e>0?1e3*(this.driftEnd-this.driftStart)/e:1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var e;return null!==(e=this.partList)&&void 0!==e&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var e;return null!==(e=this.fragments)&&void 0!==e&&e.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var e;return null!==(e=this.partList)&&void 0!==e&&e.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var e;return null!==(e=this.partList)&&void 0!==e&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}])&&n(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}()},"./repo/src/loader/level-key.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"LevelKey",(function(){return a}));var i=r("./node_modules/url-toolkit/src/url-toolkit.js");function n(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var a=function(){function e(e,t){this._uri=null,this.method=null,this.keyFormat=null,this.keyFormatVersions=null,this.keyID=null,this.key=null,this.iv=null,this._uri=t?Object(i.buildAbsoluteURL)(e,t,{alwaysNormalize:!0}):e}var t,r;return e.fromURL=function(t,r){return new e(t,r)},e.fromURI=function(t){return new e(t)},t=e,(r=[{key:"uri",get:function(){return this._uri}}])&&n(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}()},"./repo/src/loader/load-stats.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"LoadStats",(function(){return i}));var i=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}},"./repo/src/loader/m3u8-parser.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return v}));var i=r("./repo/src/polyfills/number.ts"),n=r("./node_modules/url-toolkit/src/url-toolkit.js"),a=r("./repo/src/loader/fragment.ts"),s=r("./repo/src/loader/level-details.ts"),o=r("./repo/src/loader/level-key.ts"),u=r("./repo/src/utils/attr-list.ts"),d=r("./repo/src/utils/logger.ts"),l=r("./repo/src/utils/codecs.ts"),c=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-SESSION-DATA:([^\r\n]*)[\r\n]+/g,h=/#EXT-X-MEDIA:(.*)/g,f=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),A=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(PLAYLIST-TYPE):(.+)/.source,/#EXT-X-(MEDIA-SEQUENCE): *(\d+)/.source,/#EXT-X-(SKIP):(.+)/.source,/#EXT-X-(TARGETDURATION): *(\d+)/.source,/#EXT-X-(KEY):(.+)/.source,/#EXT-X-(START):(.+)/.source,/#EXT-X-(ENDLIST)/.source,/#EXT-X-(DISCONTINUITY-SEQ)UENCE: *(\d+)/.source,/#EXT-X-(DIS)CONTINUITY/.source,/#EXT-X-(VERSION):(\d+)/.source,/#EXT-X-(MAP):(.+)/.source,/#EXT-X-(SERVER-CONTROL):(.+)/.source,/#EXT-X-(PART-INF):(.+)/.source,/#EXT-X-(GAP)/.source,/#EXT-X-(BITRATE):\s*(\d+)/.source,/#EXT-X-(PART):(.+)/.source,/#EXT-X-(PRELOAD-HINT):(.+)/.source,/#EXT-X-(RENDITION-REPORT):(.+)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),p=/\.(mp4|m4s|m4v|m4a)$/i,v=function(){function e(){}return e.findGroup=function(e,t){for(var r=0;r<e.length;r++){var i=e[r];if(i.id===t)return i}},e.convertAVC1ToAVCOTI=function(e){var t=e.split(".");if(t.length>2){var r=t.shift()+".";return(r+=parseInt(t.shift()).toString(16))+("000"+parseInt(t.shift()).toString(16)).substr(-4)}return e},e.resolve=function(e,t){return n.buildAbsoluteURL(t,e,{alwaysNormalize:!0})},e.parseMasterPlaylist=function(t,r){var i,n=[],a={},s=!1;for(c.lastIndex=0;null!=(i=c.exec(t));)if(i[1]){var o=new u.AttrList(i[1]),d={attrs:o,bitrate:o.decimalInteger("AVERAGE-BANDWIDTH")||o.decimalInteger("BANDWIDTH"),name:o.NAME,url:e.resolve(i[2],r)},l=o.decimalResolution("RESOLUTION");l&&(d.width=l.width,d.height=l.height),m((o.CODECS||"").split(/[ ,]+/).filter((function(e){return e})),d),d.videoCodec&&-1!==d.videoCodec.indexOf("avc1")&&(d.videoCodec=e.convertAVC1ToAVCOTI(d.videoCodec)),n.push(d)}else if(i[3]){var h=new u.AttrList(i[3]);h["DATA-ID"]&&(s=!0,a[h["DATA-ID"]]=h)}return{levels:n,sessionData:s?a:null}},e.parseMasterPlaylistMedia=function(t,r,i,n){var a;void 0===n&&(n=[]);var s=[],o=0;for(h.lastIndex=0;null!==(a=h.exec(t));){var d=new u.AttrList(a[1]);if(d.TYPE===i){var l={attrs:d,bitrate:0,id:o++,groupId:d["GROUP-ID"],instreamId:d["INSTREAM-ID"],name:d.NAME||d.LANGUAGE||"",type:i,default:d.bool("DEFAULT"),autoselect:d.bool("AUTOSELECT"),forced:d.bool("FORCED"),lang:d.LANGUAGE,url:d.URI?e.resolve(d.URI,r):""};if(n.length){var c=e.findGroup(n,l.groupId)||n[0];g(l,c,"audioCodec"),g(l,c,"textCodec")}s.push(l)}}return s},e.parseLevelPlaylist=function(e,t,r,l,c){var h,v,m,g=new s.LevelDetails(t),b=g.fragments,_=null,E=0,T=0,k=0,S=0,D=null,R=new a.Fragment(l,t),L=-1,C=!1;for(f.lastIndex=0,g.m3u8=e;null!==(h=f.exec(e));){C&&(C=!1,(R=new a.Fragment(l,t)).start=k,R.sn=E,R.cc=S,R.level=r,_&&(R.initSegment=_,R.rawProgramDateTime=_.rawProgramDateTime,_.rawProgramDateTime=null));var w=h[1];if(w){R.duration=parseFloat(w);var I=(" "+h[2]).slice(1);R.title=I||null,R.tagList.push(I?["INF",w,I]:["INF",w])}else if(h[3])Object(i.isFiniteNumber)(R.duration)&&(R.start=k,m&&(R.levelkey=m),R.sn=E,R.level=r,R.cc=S,R.urlId=c,b.push(R),R.relurl=(" "+h[3]).slice(1),y(R,D),D=R,k+=R.duration,E++,T=0,C=!0);else if(h[4]){var x=(" "+h[4]).slice(1);D?R.setByteRange(x,D):R.setByteRange(x)}else if(h[5])R.rawProgramDateTime=(" "+h[5]).slice(1),R.tagList.push(["PROGRAM-DATE-TIME",R.rawProgramDateTime]),-1===L&&(L=b.length);else{if(!(h=h[0].match(A))){d.logger.warn("No matches on slow regex match for level playlist!");continue}for(v=1;v<h.length&&void 0===h[v];v++);var P=(" "+h[v]).slice(1),F=(" "+h[v+1]).slice(1),O=h[v+2]?(" "+h[v+2]).slice(1):"";switch(P){case"PLAYLIST-TYPE":g.type=F.toUpperCase();break;case"MEDIA-SEQUENCE":E=g.startSN=parseInt(F);break;case"SKIP":var M=new u.AttrList(F),B=M.decimalInteger("SKIPPED-SEGMENTS");if(Object(i.isFiniteNumber)(B)){g.skippedSegments=B;for(var G=B;G--;)b.unshift(null);E+=B}var N=M.enumeratedString("RECENTLY-REMOVED-DATERANGES");N&&(g.recentlyRemovedDateranges=N.split("\t"));break;case"TARGETDURATION":g.targetduration=parseFloat(F);break;case"VERSION":g.version=parseInt(F);break;case"EXTM3U":break;case"ENDLIST":g.live=!1;break;case"#":(F||O)&&R.tagList.push(O?[F,O]:[F]);break;case"DIS":S++;case"GAP":R.tagList.push([P]);break;case"BITRATE":R.tagList.push([P,F]);break;case"DISCONTINUITY-SEQ":S=parseInt(F);break;case"KEY":var V,U=new u.AttrList(F),Z=U.enumeratedString("METHOD"),W=U.URI,j=U.hexadecimalInteger("IV"),X=U.enumeratedString("KEYFORMATVERSIONS"),Y=U.enumeratedString("KEYID"),H=null!=(V=U.enumeratedString("KEYFORMAT"))?V:"identity";if(["com.apple.streamingkeydelivery","com.microsoft.playready","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed","com.widevine"].indexOf(H)>-1){d.logger.warn("Keyformat "+H+" is not supported from the manifest");continue}if("identity"!==H)continue;Z&&(m=o.LevelKey.fromURL(t,W),W&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(Z)>=0&&(m.method=Z,m.keyFormat=H,Y&&(m.keyID=Y),X&&(m.keyFormatVersions=X),m.iv=j));break;case"START":var Q=new u.AttrList(F).decimalFloatingPoint("TIME-OFFSET");Object(i.isFiniteNumber)(Q)&&(g.startTimeOffset=Q);break;case"MAP":var K=new u.AttrList(F);R.relurl=K.URI,K.BYTERANGE&&R.setByteRange(K.BYTERANGE),R.level=r,R.sn="initSegment",m&&(R.levelkey=m),R.initSegment=null,_=R,C=!0;break;case"SERVER-CONTROL":var z=new u.AttrList(F);g.canBlockReload=z.bool("CAN-BLOCK-RELOAD"),g.canSkipUntil=z.optionalFloat("CAN-SKIP-UNTIL",0),g.canSkipDateRanges=g.canSkipUntil>0&&z.bool("CAN-SKIP-DATERANGES"),g.partHoldBack=z.optionalFloat("PART-HOLD-BACK",0),g.holdBack=z.optionalFloat("HOLD-BACK",0);break;case"PART-INF":var J=new u.AttrList(F);g.partTarget=J.decimalFloatingPoint("PART-TARGET");break;case"PART":var q=g.partList;q||(q=g.partList=[]);var $=T>0?q[q.length-1]:void 0,ee=T++,te=new a.Part(new u.AttrList(F),R,t,ee,$);q.push(te),R.duration+=te.duration;break;case"PRELOAD-HINT":var re=new u.AttrList(F);g.preloadHint=re;break;case"RENDITION-REPORT":var ie=new u.AttrList(F);g.renditionReports=g.renditionReports||[],g.renditionReports.push(ie);break;default:d.logger.warn("line parsed but not handled: "+h)}}}D&&!D.relurl?(b.pop(),k-=D.duration,g.partList&&(g.fragmentHint=D)):g.partList&&(y(R,D),R.cc=S,g.fragmentHint=R);var ne=b.length,ae=b[0],se=b[ne-1];if((k+=g.skippedSegments*g.targetduration)>0&&ne&&se){g.averagetargetduration=k/ne;var oe=se.sn;g.endSN="initSegment"!==oe?oe:0,ae&&(g.startCC=ae.cc,ae.initSegment||g.fragments.every((function(e){return e.relurl&&(t=e.relurl,p.test(null!=(r=null===(i=n.parseURL(t))||void 0===i?void 0:i.path)?r:""));var t,r,i}))&&(d.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),(R=new a.Fragment(l,t)).relurl=se.relurl,R.level=r,R.sn="initSegment",ae.initSegment=R,g.needSidxRanges=!0))}else g.endSN=0,g.startCC=0;return g.fragmentHint&&(k+=g.fragmentHint.duration),g.totalduration=k,g.endCC=S,L>0&&function(e,t){for(var r=e[t],i=t;i--;){var n=e[i];if(!n)return;n.programDateTime=r.programDateTime-1e3*n.duration,r=n}}(b,L),g},e}();function m(e,t){["video","audio","text"].forEach((function(r){var i=e.filter((function(e){return Object(l.isCodecType)(e,r)}));if(i.length){var n=i.filter((function(e){return 0===e.lastIndexOf("avc1",0)||0===e.lastIndexOf("mp4a",0)}));t[r+"Codec"]=n.length>0?n[0]:i[0],e=e.filter((function(e){return-1===i.indexOf(e)}))}})),t.unknownCodecs=e}function g(e,t,r){var i=t[r];i&&(e[r]=i)}function y(e,t){e.rawProgramDateTime?e.programDateTime=Date.parse(e.rawProgramDateTime):null!=t&&t.programDateTime&&(e.programDateTime=t.endProgramDateTime),Object(i.isFiniteNumber)(e.programDateTime)||(e.programDateTime=null,e.rawProgramDateTime=null)}},"./repo/src/loader/playlist-loader.ts":function(e,t,r){"use strict";r.r(t);var i=r("./repo/src/polyfills/number.ts"),n=r("./repo/src/events.ts"),a=r("./repo/src/errors.ts"),s=r("./repo/src/utils/logger.ts"),o=r("./repo/src/utils/mp4-tools.ts"),u=r("./repo/src/loader/m3u8-parser.ts"),d=r("./repo/src/types/loader.ts"),l=r("./repo/src/utils/attr-list.ts");function c(e,t){var r=e.url;return void 0!==r&&0!==r.indexOf("data:")||(r=t.url),r}var h=function(){function e(e){this.hls=void 0,this.loaders=Object.create(null),this.hls=e,this.registerListeners()}var t=e.prototype;return t.registerListeners=function(){var e=this.hls;e.on(n.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(n.Events.LEVEL_LOADING,this.onLevelLoading,this),e.on(n.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(n.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},t.unregisterListeners=function(){var e=this.hls;e.off(n.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(n.Events.LEVEL_LOADING,this.onLevelLoading,this),e.off(n.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(n.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},t.createInternalLoader=function(e){var t=this.hls.config,r=t.pLoader,i=t.loader,n=new(r||i)(t);return e.loader=n,this.loaders[e.type]=n,n},t.getInternalLoader=function(e){return this.loaders[e.type]},t.resetInternalLoader=function(e){this.loaders[e]&&delete this.loaders[e]},t.destroyInternalLoaders=function(){for(var e in this.loaders){var t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}},t.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},t.onManifestLoading=function(e,t){var r=t.url;this.load({id:null,groupId:null,level:0,responseType:"text",type:d.PlaylistContextType.MANIFEST,url:r,deliveryDirectives:null})},t.onLevelLoading=function(e,t){var r=t.id,i=t.level,n=t.url,a=t.deliveryDirectives;this.load({id:r,groupId:null,level:i,responseType:"text",type:d.PlaylistContextType.LEVEL,url:n,deliveryDirectives:a})},t.onAudioTrackLoading=function(e,t){var r=t.id,i=t.groupId,n=t.url,a=t.deliveryDirectives;this.load({id:r,groupId:i,level:null,responseType:"text",type:d.PlaylistContextType.AUDIO_TRACK,url:n,deliveryDirectives:a})},t.onSubtitleTrackLoading=function(e,t){var r=t.id,i=t.groupId,n=t.url,a=t.deliveryDirectives;this.load({id:r,groupId:i,level:null,responseType:"text",type:d.PlaylistContextType.SUBTITLE_TRACK,url:n,deliveryDirectives:a})},t.load=function(e){var t,r,i,n,a,o,u=this.hls.config,l=this.getInternalLoader(e);if(l){var c=l.context;if(c&&c.url===e.url)return void s.logger.trace("[playlist-loader]: playlist request ongoing");s.logger.log("[playlist-loader]: aborting previous loader for type: "+e.type),l.abort()}switch(e.type){case d.PlaylistContextType.MANIFEST:r=u.manifestLoadingMaxRetry,i=u.manifestLoadingTimeOut,n=u.manifestLoadingRetryDelay,a=u.manifestLoadingMaxRetryTimeout;break;case d.PlaylistContextType.LEVEL:case d.PlaylistContextType.AUDIO_TRACK:case d.PlaylistContextType.SUBTITLE_TRACK:r=0,i=u.levelLoadingTimeOut;break;default:r=u.levelLoadingMaxRetry,i=u.levelLoadingTimeOut,n=u.levelLoadingRetryDelay,a=u.levelLoadingMaxRetryTimeout}if(l=this.createInternalLoader(e),null!==(t=e.deliveryDirectives)&&void 0!==t&&t.part&&(e.type===d.PlaylistContextType.LEVEL&&null!==e.level?o=this.hls.levels[e.level].details:e.type===d.PlaylistContextType.AUDIO_TRACK&&null!==e.id?o=this.hls.audioTracks[e.id].details:e.type===d.PlaylistContextType.SUBTITLE_TRACK&&null!==e.id&&(o=this.hls.subtitleTracks[e.id].details),o)){var h=o.partTarget,f=o.targetduration;h&&f&&(i=Math.min(1e3*Math.max(3*h,.8*f),i))}var A={timeout:i,maxRetry:r,retryDelay:n,maxRetryDelay:a,highWaterMark:0},p={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};l.load(e,A,p)},t.loadsuccess=function(e,t,r,i){if(void 0===i&&(i=null),r.isSidxRequest)return this.handleSidxRequest(e,r),void this.handlePlaylistLoaded(e,t,r,i);this.resetInternalLoader(r.type);var n=e.data;0===n.indexOf("#EXTM3U")?(t.parsing.start=performance.now(),n.indexOf("#EXTINF:")>0||n.indexOf("#EXT-X-TARGETDURATION:")>0?this.handleTrackOrLevelPlaylist(e,t,r,i):this.handleMasterPlaylist(e,t,r,i)):this.handleManifestParsingError(e,r,"no EXTM3U delimiter",i)},t.loaderror=function(e,t,r){void 0===r&&(r=null),this.handleNetworkError(t,r,!1,e)},t.loadtimeout=function(e,t,r){void 0===r&&(r=null),this.handleNetworkError(t,r,!0)},t.handleMasterPlaylist=function(e,t,r,i){var a=this.hls,o=e.data,d=c(e,r),h=u.default.parseMasterPlaylist(o,d),f=h.levels,A=h.sessionData;if(f.length){var p=f.map((function(e){return{id:e.attrs.AUDIO,audioCodec:e.audioCodec}})),v=f.map((function(e){return{id:e.attrs.SUBTITLES,textCodec:e.textCodec}})),m=u.default.parseMasterPlaylistMedia(o,d,"AUDIO",p),g=u.default.parseMasterPlaylistMedia(o,d,"SUBTITLES",v),y=u.default.parseMasterPlaylistMedia(o,d,"CLOSED-CAPTIONS");m.length&&(m.some((function(e){return!e.url}))||!f[0].audioCodec||f[0].attrs.AUDIO||(s.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),m.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new l.AttrList({}),bitrate:0,url:""}))),a.trigger(n.Events.MANIFEST_LOADED,{levels:f,audioTracks:m,subtitles:g,captions:y,url:d,stats:t,networkDetails:i,sessionData:A})}else this.handleManifestParsingError(e,r,"no level found in manifest",i)},t.handleTrackOrLevelPlaylist=function(e,t,r,s){var o=this.hls,h=r.id,f=r.level,A=r.type,p=c(e,r),v=Object(i.isFiniteNumber)(h)?h:0,m=Object(i.isFiniteNumber)(f)?f:v,g=function(e){switch(e.type){case d.PlaylistContextType.AUDIO_TRACK:return d.PlaylistLevelType.AUDIO;case d.PlaylistContextType.SUBTITLE_TRACK:return d.PlaylistLevelType.SUBTITLE;default:return d.PlaylistLevelType.MAIN}}(r),y=u.default.parseLevelPlaylist(e.data,p,m,g,v);if(y.fragments.length){if(A===d.PlaylistContextType.MANIFEST){var b={attrs:new l.AttrList({}),bitrate:0,details:y,name:"",url:p};o.trigger(n.Events.MANIFEST_LOADED,{levels:[b],audioTracks:[],url:p,stats:t,networkDetails:s,sessionData:null})}if(t.parsing.end=performance.now(),y.needSidxRanges){var _,E=null===(_=y.fragments[0].initSegment)||void 0===_?void 0:_.url;this.load({url:E,isSidxRequest:!0,type:A,level:f,levelDetails:y,id:h,groupId:null,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer",deliveryDirectives:null})}else r.levelDetails=y,this.handlePlaylistLoaded(e,t,r,s)}else o.trigger(n.Events.ERROR,{type:a.ErrorTypes.NETWORK_ERROR,details:a.ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:p,reason:"no fragments found in level",level:"number"==typeof r.level?r.level:void 0})},t.handleSidxRequest=function(e,t){var r=Object(o.parseSegmentIndex)(new Uint8Array(e.data));if(r){var i=r.references,n=t.levelDetails;i.forEach((function(e,t){var i=e.info,a=n.fragments[t];0===a.byteRange.length&&a.setByteRange(String(1+i.end-i.start)+"@"+String(i.start)),a.initSegment&&a.initSegment.setByteRange(String(r.moovEndOffset)+"@0")}))}},t.handleManifestParsingError=function(e,t,r,i){this.hls.trigger(n.Events.ERROR,{type:a.ErrorTypes.NETWORK_ERROR,details:a.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:t.type===d.PlaylistContextType.MANIFEST,url:e.url,reason:r,response:e,context:t,networkDetails:i})},t.handleNetworkError=function(e,t,r,i){void 0===r&&(r=!1),s.logger.warn("[playlist-loader]: A network "+(r?"timeout":"error")+" occurred while loading "+e.type+" level: "+e.level+" id: "+e.id+' group-id: "'+e.groupId+'"');var o=a.ErrorDetails.UNKNOWN,u=!1,l=this.getInternalLoader(e);switch(e.type){case d.PlaylistContextType.MANIFEST:o=r?a.ErrorDetails.MANIFEST_LOAD_TIMEOUT:a.ErrorDetails.MANIFEST_LOAD_ERROR,u=!0;break;case d.PlaylistContextType.LEVEL:o=r?a.ErrorDetails.LEVEL_LOAD_TIMEOUT:a.ErrorDetails.LEVEL_LOAD_ERROR,u=!1;break;case d.PlaylistContextType.AUDIO_TRACK:o=r?a.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:a.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,u=!1;break;case d.PlaylistContextType.SUBTITLE_TRACK:o=r?a.ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:a.ErrorDetails.SUBTITLE_LOAD_ERROR,u=!1}l&&this.resetInternalLoader(e.type);var c={type:a.ErrorTypes.NETWORK_ERROR,details:o,fatal:u,url:e.url,loader:l,context:e,networkDetails:t};i&&(c.response=i),this.hls.trigger(n.Events.ERROR,c)},t.handlePlaylistLoaded=function(e,t,r,i){var a=r.type,s=r.level,o=r.id,u=r.groupId,l=r.loader,c=r.levelDetails,h=r.deliveryDirectives;if(null!=c&&c.targetduration){if(l)switch(c.live&&(l.getCacheAge&&(c.ageHeader=l.getCacheAge()||0),l.getCacheAge&&!isNaN(c.ageHeader)||(c.ageHeader=0)),a){case d.PlaylistContextType.MANIFEST:case d.PlaylistContextType.LEVEL:this.hls.trigger(n.Events.LEVEL_LOADED,{details:c,level:s||0,id:o||0,stats:t,networkDetails:i,deliveryDirectives:h});break;case d.PlaylistContextType.AUDIO_TRACK:this.hls.trigger(n.Events.AUDIO_TRACK_LOADED,{details:c,id:o||0,groupId:u||"",stats:t,networkDetails:i,deliveryDirectives:h});break;case d.PlaylistContextType.SUBTITLE_TRACK:this.hls.trigger(n.Events.SUBTITLE_TRACK_LOADED,{details:c,id:o||0,groupId:u||"",stats:t,networkDetails:i,deliveryDirectives:h})}}else this.handleManifestParsingError(e,r,"invalid target duration",i)},e}();t.default=h},"./repo/src/polyfills/number.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"isFiniteNumber",(function(){return i})),r.d(t,"MAX_SAFE_INTEGER",(function(){return n}));var i=Number.isFinite||function(e){return"number"==typeof e&&isFinite(e)},n=Number.MAX_SAFE_INTEGER||9007199254740991},"./repo/src/remux/aac-helper.ts":function(e,t,r){"use strict";r.r(t);var i=function(){function e(){}return e.getSilentFrame=function(e,t){if("mp4a.40.2"===e){if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}},e}();t.default=i},"./repo/src/remux/mp4-generator.ts":function(e,t,r){"use strict";r.r(t);var i=Math.pow(2,32)-1,n=function(){function e(){}return e.init=function(){var t;for(t in e.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},e.types)e.types.hasOwnProperty(t)&&(e.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);var r=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),i=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);e.HDLR_TYPES={video:r,audio:i};var n=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),a=new Uint8Array([0,0,0,0,0,0,0,0]);e.STTS=e.STSC=e.STCO=a,e.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),e.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),e.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),e.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var s=new Uint8Array([105,115,111,109]),o=new Uint8Array([97,118,99,49]),u=new Uint8Array([0,0,0,1]);e.FTYP=e.box(e.types.ftyp,s,u,s,o),e.DINF=e.box(e.types.dinf,e.box(e.types.dref,n))},e.box=function(e){for(var t=8,r=arguments.length,i=new Array(r>1?r-1:0),n=1;n<r;n++)i[n-1]=arguments[n];for(var a=i.length,s=a;a--;)t+=i[a].byteLength;var o=new Uint8Array(t);for(o[0]=t>>24&255,o[1]=t>>16&255,o[2]=t>>8&255,o[3]=255&t,o.set(e,4),a=0,t=8;a<s;a++)o.set(i[a],t),t+=i[a].byteLength;return o},e.hdlr=function(t){return e.box(e.types.hdlr,e.HDLR_TYPES[t])},e.mdat=function(t){return e.box(e.types.mdat,t)},e.mdhd=function(t,r){r*=t;var n=Math.floor(r/(i+1)),a=Math.floor(r%(i+1));return e.box(e.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,n>>24,n>>16&255,n>>8&255,255&n,a>>24,a>>16&255,a>>8&255,255&a,85,196,0,0]))},e.mdia=function(t){return e.box(e.types.mdia,e.mdhd(t.timescale,t.duration),e.hdlr(t.type),e.minf(t))},e.mfhd=function(t){return e.box(e.types.mfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]))},e.minf=function(t){return"audio"===t.type?e.box(e.types.minf,e.box(e.types.smhd,e.SMHD),e.DINF,e.stbl(t)):e.box(e.types.minf,e.box(e.types.vmhd,e.VMHD),e.DINF,e.stbl(t))},e.moof=function(t,r,i){return e.box(e.types.moof,e.mfhd(t),e.traf(i,r))},e.moov=function(t){for(var r=t.length,i=[];r--;)i[r]=e.trak(t[r]);return e.box.apply(null,[e.types.moov,e.mvhd(t[0].timescale,t[0].duration)].concat(i).concat(e.mvex(t)))},e.mvex=function(t){for(var r=t.length,i=[];r--;)i[r]=e.trex(t[r]);return e.box.apply(null,[e.types.mvex].concat(i))},e.mvhd=function(t,r){r*=t;var n=Math.floor(r/(i+1)),a=Math.floor(r%(i+1)),s=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,n>>24,n>>16&255,n>>8&255,255&n,a>>24,a>>16&255,a>>8&255,255&a,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return e.box(e.types.mvhd,s)},e.sdtp=function(t){var r,i,n=t.samples||[],a=new Uint8Array(4+n.length);for(r=0;r<n.length;r++)i=n[r].flags,a[r+4]=i.dependsOn<<4|i.isDependedOn<<2|i.hasRedundancy;return e.box(e.types.sdtp,a)},e.stbl=function(t){return e.box(e.types.stbl,e.stsd(t),e.box(e.types.stts,e.STTS),e.box(e.types.stsc,e.STSC),e.box(e.types.stsz,e.STSZ),e.box(e.types.stco,e.STCO))},e.avc1=function(t){var r,i,n,a=[],s=[];for(r=0;r<t.sps.length;r++)n=(i=t.sps[r]).byteLength,a.push(n>>>8&255),a.push(255&n),a=a.concat(Array.prototype.slice.call(i));for(r=0;r<t.pps.length;r++)n=(i=t.pps[r]).byteLength,s.push(n>>>8&255),s.push(255&n),s=s.concat(Array.prototype.slice.call(i));var o=e.box(e.types.avcC,new Uint8Array([1,a[3],a[4],a[5],255,224|t.sps.length].concat(a).concat([t.pps.length]).concat(s))),u=t.width,d=t.height,l=t.pixelRatio[0],c=t.pixelRatio[1];return e.box(e.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,u>>8&255,255&u,d>>8&255,255&d,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),o,e.box(e.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),e.box(e.types.pasp,new Uint8Array([l>>24,l>>16&255,l>>8&255,255&l,c>>24,c>>16&255,c>>8&255,255&c])))},e.esds=function(e){var t=e.config.length;return new Uint8Array([0,0,0,0,3,23+t,0,1,0,4,15+t,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([t]).concat(e.config).concat([6,1,2]))},e.mp4a=function(t){var r=t.samplerate;return e.box(e.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,r>>8&255,255&r,0,0]),e.box(e.types.esds,e.esds(t)))},e.mp3=function(t){var r=t.samplerate;return e.box(e.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,r>>8&255,255&r,0,0]))},e.stsd=function(t){return"audio"===t.type?t.isAAC||"mp3"!==t.codec?e.box(e.types.stsd,e.STSD,e.mp4a(t)):e.box(e.types.stsd,e.STSD,e.mp3(t)):e.box(e.types.stsd,e.STSD,e.avc1(t))},e.tkhd=function(t){var r=t.id,n=t.duration*t.timescale,a=t.width,s=t.height,o=Math.floor(n/(i+1)),u=Math.floor(n%(i+1));return e.box(e.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,r>>24&255,r>>16&255,r>>8&255,255&r,0,0,0,0,o>>24,o>>16&255,o>>8&255,255&o,u>>24,u>>16&255,u>>8&255,255&u,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,a>>8&255,255&a,0,0,s>>8&255,255&s,0,0]))},e.traf=function(t,r){var n=e.sdtp(t),a=t.id,s=Math.floor(r/(i+1)),o=Math.floor(r%(i+1));return e.box(e.types.traf,e.box(e.types.tfhd,new Uint8Array([0,0,0,0,a>>24,a>>16&255,a>>8&255,255&a])),e.box(e.types.tfdt,new Uint8Array([1,0,0,0,s>>24,s>>16&255,s>>8&255,255&s,o>>24,o>>16&255,o>>8&255,255&o])),e.trun(t,n.length+16+20+8+16+8+8),n)},e.trak=function(t){return t.duration=t.duration||4294967295,e.box(e.types.trak,e.tkhd(t),e.mdia(t))},e.trex=function(t){var r=t.id;return e.box(e.types.trex,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},e.trun=function(t,r){var i,n,a,s,o,u,d=t.samples||[],l=d.length,c=12+16*l,h=new Uint8Array(c);for(r+=8+c,h.set([0,0,15,1,l>>>24&255,l>>>16&255,l>>>8&255,255&l,r>>>24&255,r>>>16&255,r>>>8&255,255&r],0),i=0;i<l;i++)a=(n=d[i]).duration,s=n.size,o=n.flags,u=n.cts,h.set([a>>>24&255,a>>>16&255,a>>>8&255,255&a,s>>>24&255,s>>>16&255,s>>>8&255,255&s,o.isLeading<<2|o.dependsOn,o.isDependedOn<<6|o.hasRedundancy<<4|o.paddingValue<<1|o.isNonSync,61440&o.degradPrio,15&o.degradPrio,u>>>24&255,u>>>16&255,u>>>8&255,255&u],12+16*i);return e.box(e.types.trun,h)},e.initSegment=function(t){e.types||e.init();var r=e.moov(t),i=new Uint8Array(e.FTYP.byteLength+r.byteLength);return i.set(e.FTYP),i.set(r,e.FTYP.byteLength),i},e}();n.types=void 0,n.HDLR_TYPES=void 0,n.STTS=void 0,n.STSC=void 0,n.STCO=void 0,n.STSZ=void 0,n.VMHD=void 0,n.SMHD=void 0,n.STSD=void 0,n.FTYP=void 0,n.DINF=void 0,t.default=n},"./repo/src/remux/mp4-remuxer.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return p})),r.d(t,"normalizePts",(function(){return v})),r.d(t,"flushTextTrackMetadataCueSamples",(function(){return m})),r.d(t,"flushTextTrackUserdataCueSamples",(function(){return g}));var i=r("./repo/src/polyfills/number.ts"),n=r("./repo/src/remux/aac-helper.ts"),a=r("./repo/src/remux/mp4-generator.ts"),s=r("./repo/src/events.ts"),o=r("./repo/src/errors.ts"),u=r("./repo/src/utils/logger.ts"),d=r("./repo/src/types/loader.ts"),l=r("./repo/src/utils/timescale-conversion.ts");function c(){return(c=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}var h=null,f=null,A=!1,p=function(){function e(e,t,r,i){if(void 0===i&&(i=""),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=void 0,this._initDTS=void 0,this.nextAvcDts=null,this.nextAudioPts=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=e,this.config=t,this.typeSupported=r,this.ISGenerated=!1,null===h){var n=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);h=n?parseInt(n[1]):0}if(null===f){var a=navigator.userAgent.match(/Safari\/(\d+)/i);f=a?parseInt(a[1]):0}A=!!h&&h<75||!!f&&f<600}var t=e.prototype;return t.destroy=function(){},t.resetTimeStamp=function(e){u.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=e},t.resetNextTimestamp=function(){u.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},t.resetInitSegment=function(){u.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1},t.getVideoStartPts=function(e){var t=!1,r=e.reduce((function(e,r){var i=r.pts-e;return i<-4294967296?(t=!0,v(e,r.pts)):i>0?e:r.pts}),e[0].pts);return t&&u.logger.debug("PTS rollover detected"),r},t.remux=function(e,t,r,i,n,a,s,o){var l,c,h,f,A,p,y=n,b=n,_=e.pid>-1,E=t.pid>-1,T=t.samples.length,k=e.samples.length>0,S=T>1;if((!_||k)&&(!E||S)||this.ISGenerated||s){this.ISGenerated||(h=this.generateIS(e,t,n));var D=this.isVideoContiguous,R=-1;if(S&&(R=function(e){for(var t=0;t<e.length;t++)if(e[t].key)return t;return-1}(t.samples),!D&&this.config.forceKeyFrameOnDiscontinuity))if(p=!0,R>0){u.logger.warn("[mp4-remuxer]: Dropped "+R+" out of "+T+" video samples due to a missing keyframe");var L=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(R),t.dropped+=R,b+=(t.samples[0].pts-L)/(t.timescale||9e4)}else-1===R&&(u.logger.warn("[mp4-remuxer]: No keyframe found out of "+T+" video samples"),p=!1);if(this.ISGenerated){if(k&&S){var C=this.getVideoStartPts(t.samples),w=(v(e.samples[0].pts,C)-C)/t.inputTimeScale;y+=Math.max(0,w),b+=Math.max(0,-w)}if(k){if(e.samplerate||(u.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),h=this.generateIS(e,t,n)),c=this.remuxAudio(e,y,this.isAudioContiguous,a,E||S||o===d.PlaylistLevelType.AUDIO?b:void 0),S){var I=c?c.endPTS-c.startPTS:0;t.inputTimeScale||(u.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),h=this.generateIS(e,t,n)),l=this.remuxVideo(t,b,D,I)}}else S&&(l=this.remuxVideo(t,b,D,0));l&&(l.firstKeyFrame=R,l.independent=-1!==R)}}return this.ISGenerated&&(r.samples.length&&(A=m(r,n,this._initPTS,this._initDTS)),i.samples.length&&(f=g(i,n,this._initPTS))),{audio:c,video:l,initSegment:h,independent:p,text:f,id3:A}},t.generateIS=function(e,t,r){var n,s,o,u=e.samples,d=t.samples,l=this.typeSupported,c={},h=!Object(i.isFiniteNumber)(this._initPTS),f="audio/mp4";if(h&&(n=s=1/0),e.config&&u.length&&(e.timescale=e.samplerate,e.isAAC||(l.mpeg?(f="audio/mpeg",e.codec=""):l.mp3&&(e.codec="mp3")),c.audio={id:"audio",container:f,codec:e.codec,initSegment:!e.isAAC&&l.mpeg?new Uint8Array(0):a.default.initSegment([e]),metadata:{channelCount:e.channelCount}},h&&(o=e.inputTimeScale,n=s=u[0].pts-Math.round(o*r))),t.sps&&t.pps&&d.length&&(t.timescale=t.inputTimeScale,c.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:a.default.initSegment([t]),metadata:{width:t.width,height:t.height}},h)){o=t.inputTimeScale;var A=this.getVideoStartPts(d),p=Math.round(o*r);s=Math.min(s,v(d[0].dts,A)-p),n=Math.min(n,A-p)}if(Object.keys(c).length)return this.ISGenerated=!0,h&&(this._initPTS=n,this._initDTS=s),{tracks:c,initPTS:n,timescale:o}},t.remuxVideo=function(e,t,r,i){var n,d,f,p=e.inputTimeScale,m=e.samples,g=[],b=m.length,_=this._initPTS,E=this.nextAvcDts,T=8,k=Number.POSITIVE_INFINITY,S=Number.NEGATIVE_INFINITY,D=0,R=!1;r&&null!==E||(E=t*p-(m[0].pts-v(m[0].dts,m[0].pts)));for(var L=0;L<b;L++){var C=m[L];C.pts=v(C.pts-_,E),C.dts=v(C.dts-_,E),C.dts>C.pts&&(D=Math.max(Math.min(D,C.pts-C.dts),-18e3)),C.dts<m[L>0?L-1:L].dts&&(R=!0)}R&&m.sort((function(e,t){var r=e.dts-t.dts,i=e.pts-t.pts;return r||i})),d=m[0].dts,f=m[m.length-1].dts;var w=Math.round((f-d)/(b-1));if(D<0){if(D<-2*w){u.logger.warn("PTS < DTS detected in video samples, offsetting DTS from PTS by "+Object(l.toMsFromMpegTsClock)(-w,!0)+" ms");for(var I=D,x=0;x<b;x++)m[x].dts=I=Math.max(I,m[x].pts-w),m[x].pts=Math.max(I,m[x].pts)}else{u.logger.warn("PTS < DTS detected in video samples, shifting DTS by "+Object(l.toMsFromMpegTsClock)(D,!0)+" ms to overcome this issue");for(var P=0;P<b;P++)m[P].dts=m[P].dts+D}d=m[0].dts}if(r){var F=d-E,O=F>w;if(O||F<-1){O?u.logger.warn("AVC: "+Object(l.toMsFromMpegTsClock)(F,!0)+" ms ("+F+"dts) hole between fragments detected, filling it"):u.logger.warn("AVC: "+Object(l.toMsFromMpegTsClock)(-F,!0)+" ms ("+F+"dts) overlapping between fragments detected"),d=E;var M=m[0].pts-F;m[0].dts=d,m[0].pts=M,u.logger.log("Video: First PTS/DTS adjusted: "+Object(l.toMsFromMpegTsClock)(M,!0)+"/"+Object(l.toMsFromMpegTsClock)(d,!0)+", delta: "+Object(l.toMsFromMpegTsClock)(F,!0)+" ms")}}A&&(d=Math.max(0,d));for(var B=0,G=0,N=0;N<b;N++){for(var V=m[N],U=V.units,Z=U.length,W=0,j=0;j<Z;j++)W+=U[j].data.length;G+=W,B+=Z,V.length=W,V.dts=Math.max(V.dts,d),V.pts=Math.max(V.pts,V.dts,0),k=Math.min(V.pts,k),S=Math.max(V.pts,S)}f=m[b-1].dts;var X,Y=G+4*B+8;try{X=new Uint8Array(Y)}catch(e){return void this.observer.emit(s.Events.ERROR,s.Events.ERROR,{type:o.ErrorTypes.MUX_ERROR,details:o.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:Y,reason:"fail allocating video mdat "+Y})}var H=new DataView(X.buffer);H.setUint32(0,Y),X.set(a.default.types.mdat,4);for(var Q=0;Q<b;Q++){for(var K=m[Q],z=K.units,J=0,q=0,$=z.length;q<$;q++){var ee=z[q],te=ee.data,re=ee.data.byteLength;H.setUint32(T,re),T+=4,X.set(te,T),T+=re,J+=4+re}if(Q<b-1)n=m[Q+1].dts-K.dts;else{var ie=this.config,ne=K.dts-m[Q>0?Q-1:Q].dts;if(ie.stretchShortVideoTrack&&null!==this.nextAudioPts){var ae=Math.floor(ie.maxBufferHole*p),se=(i?k+i*p:this.nextAudioPts)-K.pts;se>ae?((n=se-ne)<0&&(n=ne),u.logger.log("[mp4-remuxer]: It is approximately "+se/90+" ms to the next segment; using duration "+n/90+" ms for the last video frame.")):n=ne}else n=ne}var oe=Math.round(K.pts-K.dts);g.push(new y(K.key,n,J,oe))}if(g.length&&h&&h<70){var ue=g[0].flags;ue.dependsOn=2,ue.isNonSync=0}console.assert(void 0!==n,"mp4SampleDuration must be computed"),this.nextAvcDts=E=f+n,this.isVideoContiguous=!0;var de={data1:a.default.moof(e.sequenceNumber++,d,c({},e,{samples:g})),data2:X,startPTS:k/p,endPTS:(S+n)/p,startDTS:d/p,endDTS:E/p,type:"video",hasAudio:!1,hasVideo:!0,nb:g.length,dropped:e.dropped};return e.samples=[],e.dropped=0,console.assert(X.length,"MDAT length must not be zero"),de},t.remuxAudio=function(e,t,r,i,d){var l=e.inputTimeScale,h=l/(e.samplerate?e.samplerate:l),f=e.isAAC?1024:1152,A=f*h,p=this._initPTS,m=!e.isAAC&&this.typeSupported.mpeg,g=[],b=e.samples,_=m?0:8,E=this.nextAudioPts||-1,T=t*l;if(this.isAudioContiguous=r=r||b.length&&E>0&&(i&&Math.abs(T-E)<9e3||Math.abs(v(b[0].pts-p,T)-E)<20*A),b.forEach((function(e){e.pts=v(e.pts-p,T)})),!r||E<0){if(!(b=b.filter((function(e){return e.pts>=0}))).length)return;E=0===d?0:i?Math.max(0,T):b[0].pts}if(e.isAAC)for(var k=void 0!==d,S=this.config.maxAudioFramesDrift,D=0,R=E;D<b.length;D++){var L=b[D],C=L.pts,w=C-R,I=Math.abs(1e3*w/l);if(w<=-S*A&&k)0===D&&(u.logger.warn("Audio frame @ "+(C/l).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*w/l)+" ms."),this.nextAudioPts=E=R=C);else if(w>=S*A&&I<1e4&&k){var x=Math.round(w/A);(R=C-x*A)<0&&(x--,R+=A),0===D&&(this.nextAudioPts=E=R),u.logger.warn("[mp4-remuxer]: Injecting "+x+" audio frame @ "+(R/l).toFixed(3)+"s due to "+Math.round(1e3*w/l)+" ms gap.");for(var P=0;P<x;P++){var F=Math.max(R,0),O=n.default.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);O||(u.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),O=L.unit.subarray()),b.splice(D,0,{unit:O,pts:F}),R+=A,D++}}L.pts=R,R+=A}for(var M,B=null,G=null,N=0,V=b.length;V--;)N+=b[V].unit.byteLength;for(var U=0,Z=b.length;U<Z;U++){var W=b[U],j=W.unit,X=W.pts;if(null!==G)g[U-1].duration=Math.round((X-G)/h);else{if(r&&e.isAAC&&(X=E),B=X,!(N>0))return;N+=_;try{M=new Uint8Array(N)}catch(e){return void this.observer.emit(s.Events.ERROR,s.Events.ERROR,{type:o.ErrorTypes.MUX_ERROR,details:o.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:N,reason:"fail allocating audio mdat "+N})}m||(new DataView(M.buffer).setUint32(0,N),M.set(a.default.types.mdat,4))}M.set(j,_);var Y=j.byteLength;_+=Y,g.push(new y(!0,f,Y,0)),G=X}var H=g.length;if(H){var Q=g[g.length-1];this.nextAudioPts=E=G+h*Q.duration;var K=m?new Uint8Array(0):a.default.moof(e.sequenceNumber++,B/h,c({},e,{samples:g}));e.samples=[];var z=B/l,J=E/l,q={data1:K,data2:M,startPTS:z,endPTS:J,startDTS:z,endDTS:J,type:"audio",hasAudio:!0,hasVideo:!1,nb:H};return this.isAudioContiguous=!0,console.assert(M.length,"MDAT length must not be zero"),q}},t.remuxEmptyAudio=function(e,t,r,i){var a=e.inputTimeScale,s=a/(e.samplerate?e.samplerate:a),o=this.nextAudioPts,d=(null!==o?o:i.startDTS*a)+this._initDTS,l=i.endDTS*a+this._initDTS,c=1024*s,h=Math.ceil((l-d)/c),f=n.default.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);if(u.logger.warn("[mp4-remuxer]: remux empty Audio"),f){for(var A=[],p=0;p<h;p++){var v=d+p*c;A.push({unit:f,pts:v,dts:v})}return e.samples=A,this.remuxAudio(e,t,r,!1)}u.logger.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec")},e}();function v(e,t){var r;if(null===t)return e;for(r=t<e?-8589934592:8589934592;Math.abs(e-t)>4294967296;)e+=r;return e}function m(e,t,r,i){var n=e.samples.length;if(n){for(var a=e.inputTimeScale,s=0;s<n;s++){var o=e.samples[s];o.pts=v(o.pts-r,t*a)/a,o.dts=v(o.dts-i,t*a)/a}var u=e.samples;return e.samples=[],{samples:u}}}function g(e,t,r){var i=e.samples.length;if(i){for(var n=e.inputTimeScale,a=0;a<i;a++){var s=e.samples[a];s.pts=v(s.pts-r,t*n)/n}e.samples.sort((function(e,t){return e.pts-t.pts}));var o=e.samples;return e.samples=[],{samples:o}}}var y=function(e,t,r,i){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=t,this.size=r,this.cts=i,this.flags=new b(e)},b=function(e){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=e?2:1,this.isNonSync=e?0:1}},"./repo/src/remux/passthrough-remuxer.ts":function(e,t,r){"use strict";r.r(t);var i=r("./repo/src/polyfills/number.ts"),n=r("./repo/src/remux/mp4-remuxer.ts"),a=r("./repo/src/utils/mp4-tools.ts"),s=r("./repo/src/loader/fragment.ts"),o=r("./repo/src/utils/logger.ts"),u=function(){function e(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=void 0,this.initTracks=void 0,this.lastEndDTS=null}var t=e.prototype;return t.destroy=function(){},t.resetTimeStamp=function(e){this.initPTS=e,this.lastEndDTS=null},t.resetNextTimestamp=function(){this.lastEndDTS=null},t.resetInitSegment=function(e,t,r){this.audioCodec=t,this.videoCodec=r,this.generateInitSegment(e),this.emitInitSegment=!0},t.generateInitSegment=function(e){var t=this.audioCodec,r=this.videoCodec;if(!e||!e.byteLength)return this.initTracks=void 0,void(this.initData=void 0);var i=this.initData=Object(a.parseInitSegment)(e);t||(t=l(i.audio,s.ElementaryStreamTypes.AUDIO)),r||(r=l(i.video,s.ElementaryStreamTypes.VIDEO));var n={};i.audio&&i.video?n.audiovideo={container:"video/mp4",codec:t+","+r,initSegment:e,id:"main"}:i.audio?n.audio={container:"audio/mp4",codec:t,initSegment:e,id:"audio"}:i.video?n.video={container:"video/mp4",codec:r,initSegment:e,id:"main"}:o.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=n},t.remux=function(e,t,r,s,u){var l,c=this.initPTS,h=this.lastEndDTS,f={audio:void 0,video:void 0,text:s,id3:r,initSegment:void 0};Object(i.isFiniteNumber)(h)||(h=this.lastEndDTS=u||0);var A=t.samples;if(!A||!A.length)return f;var p={initPTS:void 0,timescale:1},v=this.initData;if(v&&v.length||(this.generateInitSegment(A),v=this.initData),!v||!v.length)return o.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),f;this.emitInitSegment&&(p.tracks=this.initTracks,this.emitInitSegment=!1),Object(i.isFiniteNumber)(c)||(this.initPTS=p.initPTS=c=d(v,A,h));var m=Object(a.getDuration)(A,v),g=h,y=m+g;Object(a.offsetStartDTS)(v,A,c),m>0?this.lastEndDTS=y:(o.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var b=!!v.audio,_=!!v.video,E="";b&&(E+="audio"),_&&(E+="video");var T={data1:A,startPTS:g,startDTS:g,endPTS:y,endDTS:y,type:E,hasAudio:b,hasVideo:_,nb:1,dropped:0};f.audio="audio"===T.type?T:void 0,f.video="audio"!==T.type?T:void 0,f.initSegment=p;var k=null!=(l=this.initPTS)?l:0;return f.id3=Object(n.flushTextTrackMetadataCueSamples)(r,u,k,k),s.samples.length&&(f.text=Object(n.flushTextTrackUserdataCueSamples)(s,u,k)),f},e}(),d=function(e,t,r){return Object(a.getStartDTS)(e,t)-r};function l(e,t){var r=null==e?void 0:e.codec;return r&&r.length>4?r:"hvc1"===r?"hvc1.1.c.L120.90":"av01"===r?"av01.0.04M.08":"avc1"===r||t===s.ElementaryStreamTypes.VIDEO?"avc1.42e01e":"mp4a.40.5"}t.default=u},"./repo/src/task-loop.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return i}));var i=function(){function e(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}var t=e.prototype;return t.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},t.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},t.onHandlerDestroyed=function(){},t.hasInterval=function(){return!!this._tickInterval},t.hasNextTick=function(){return!!this._tickTimer},t.setInterval=function(e){return!this._tickInterval&&(this._tickInterval=self.setInterval(this._boundTick,e),!0)},t.clearInterval=function(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)},t.clearNextTick=function(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)},t.tick=function(){this._tickCallCount++,1===this._tickCallCount&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},t.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},t.doTick=function(){},e}()},"./repo/src/types/level.ts":function(e,t,r){"use strict";function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var n;function a(e,t){var r=e.canSkipUntil,i=e.canSkipDateRanges,a=e.endSN;return r&&(void 0!==t?t-a:0)<r?i?n.v2:n.Yes:n.No}r.r(t),r.d(t,"HlsSkip",(function(){return n})),r.d(t,"getSkipValue",(function(){return a})),r.d(t,"HlsUrlParameters",(function(){return s})),r.d(t,"Level",(function(){return o})),function(e){e.No="",e.Yes="YES",e.v2="v2"}(n||(n={}));var s=function(){function e(e,t,r){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=r}return e.prototype.addDirectives=function(e){var t=new self.URL(e);return void 0!==this.msn&&t.searchParams.set("_HLS_msn",this.msn.toString()),void 0!==this.part&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.toString()},e}(),o=function(){function e(e){this.attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[e.url],this.attrs=e.attrs,this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.unknownCodecs=e.unknownCodecs,this.codecSet=[e.videoCodec,e.audioCodec].filter((function(e){return e})).join(",").replace(/\.[^.,]+/g,"")}var t,r;return t=e,(r=[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"uri",get:function(){return this.url[this._urlId]||""}},{key:"urlId",get:function(){return this._urlId},set:function(e){var t=e%this.url.length;this._urlId!==t&&(this.details=void 0,this._urlId=t)}}])&&i(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}()},"./repo/src/types/loader.ts":function(e,t,r){"use strict";var i,n;r.r(t),r.d(t,"PlaylistContextType",(function(){return i})),r.d(t,"PlaylistLevelType",(function(){return n})),function(e){e.MANIFEST="manifest",e.LEVEL="level",e.AUDIO_TRACK="audioTrack",e.SUBTITLE_TRACK="subtitleTrack"}(i||(i={})),function(e){e.MAIN="main",e.AUDIO="audio",e.SUBTITLE="subtitle"}(n||(n={}))},"./repo/src/types/transmuxer.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"ChunkMetadata",(function(){return i}));var i=function(e,t,r,i,n,a){void 0===i&&(i=0),void 0===n&&(n=-1),void 0===a&&(a=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing={start:0,executeStart:0,executeEnd:0,end:0},this.buffering={audio:{start:0,executeStart:0,executeEnd:0,end:0},video:{start:0,executeStart:0,executeEnd:0,end:0},audiovideo:{start:0,executeStart:0,executeEnd:0,end:0}},this.level=e,this.sn=t,this.id=r,this.size=i,this.part=n,this.partial=a}},"./repo/src/utils/attr-list.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"AttrList",(function(){return a}));var i=/^(\d+)x(\d+)$/,n=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,a=function(){function e(t){for(var r in"string"==typeof t&&(t=e.parseAttrList(t)),t)t.hasOwnProperty(r)&&(this[r]=t[r])}var t=e.prototype;return t.decimalInteger=function(e){var t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t},t.hexadecimalInteger=function(e){if(this[e]){var t=(this[e]||"0x").slice(2);t=(1&t.length?"0":"")+t;for(var r=new Uint8Array(t.length/2),i=0;i<t.length/2;i++)r[i]=parseInt(t.slice(2*i,2*i+2),16);return r}return null},t.hexadecimalIntegerAsNumber=function(e){var t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t},t.decimalFloatingPoint=function(e){return parseFloat(this[e])},t.optionalFloat=function(e,t){var r=this[e];return r?parseFloat(r):t},t.enumeratedString=function(e){return this[e]},t.bool=function(e){return"YES"===this[e]},t.decimalResolution=function(e){var t=i.exec(this[e]);if(null!==t)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}},e.parseAttrList=function(e){var t,r={};for(n.lastIndex=0;null!==(t=n.exec(e));){var i=t[2];0===i.indexOf('"')&&i.lastIndexOf('"')===i.length-1&&(i=i.slice(1,-1)),r[t[1]]=i}return r},e}()},"./repo/src/utils/binary-search.ts":function(e,t,r){"use strict";r.r(t),t.default={search:function(e,t){for(var r=0,i=e.length-1,n=null,a=null;r<=i;){var s=t(a=e[n=(r+i)/2|0]);if(s>0)r=n+1;else{if(!(s<0))return a;i=n-1}}return null}}},"./repo/src/utils/buffer-helper.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"BufferHelper",(function(){return a}));var i=r("./repo/src/utils/logger.ts"),n={length:0,start:function(){return 0},end:function(){return 0}},a=function(){function e(){}return e.isBuffered=function(t,r){try{if(t)for(var i=e.getBuffered(t),n=0;n<i.length;n++)if(r>=i.start(n)&&r<=i.end(n))return!0}catch(e){}return!1},e.bufferInfo=function(t,r,i){try{if(t){var n,a=e.getBuffered(t),s=[];for(n=0;n<a.length;n++)s.push({start:a.start(n),end:a.end(n)});return this.bufferedInfo(s,r,i)}}catch(e){}return{len:0,start:r,end:r,nextStart:void 0}},e.bufferedInfo=function(e,t,r){t=Math.max(0,t),e.sort((function(e,t){return e.start-t.start||t.end-e.end}));var i=[];if(r)for(var n=0;n<e.length;n++){var a=i.length;if(a){var s=i[a-1].end;e[n].start-s<r?e[n].end>s&&(i[a-1].end=e[n].end):i.push(e[n])}else i.push(e[n])}else i=e;for(var o,u=0,d=t,l=t,c=0;c<i.length;c++){var h=i[c].start,f=i[c].end;if(t+r>=h&&t<f)d=h,u=(l=f)-t;else if(t+r<h){o=h;break}}return{len:u,start:d||0,end:l||0,nextStart:o}},e.getBuffered=function(e){try{return e.buffered}catch(e){return i.logger.log("failed to get media.buffered",e),n}},e}()},"./repo/src/utils/codecs.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"isCodecType",(function(){return n})),r.d(t,"isCodecSupportedInMp4",(function(){return a}));var i={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}};function n(e,t){var r=i[t];return!!r&&!0===r[e.slice(0,4)]}function a(e,t){return MediaSource.isTypeSupported((t||"video")+'/mp4;codecs="'+e+'"')}},"./repo/src/utils/discontinuities.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"findFirstFragWithCC",(function(){return s})),r.d(t,"shouldAlignOnDiscontinuities",(function(){return o})),r.d(t,"findDiscontinuousReferenceFrag",(function(){return u})),r.d(t,"adjustSlidingStart",(function(){return l})),r.d(t,"alignStream",(function(){return c})),r.d(t,"alignPDT",(function(){return h})),r.d(t,"alignFragmentByPDTDelta",(function(){return f})),r.d(t,"alignMediaPlaylistByPDT",(function(){return A}));var i=r("./repo/src/polyfills/number.ts"),n=r("./repo/src/utils/logger.ts"),a=r("./repo/src/controller/level-helper.ts");function s(e,t){for(var r=null,i=0,n=e.length;i<n;i++){var a=e[i];if(a&&a.cc===t){r=a;break}}return r}function o(e,t,r){return!(!t.details||!(r.endCC>r.startCC||e&&e.cc<r.startCC))}function u(e,t){var r=e.fragments,i=t.fragments;if(i.length&&r.length){var a=s(r,i[0].cc);if(a&&(!a||a.startPTS))return a;n.logger.log("No frag in previous level to align on")}else n.logger.log("No fragments to align")}function d(e,t){if(e){var r=e.start+t;e.start=e.startPTS=r,e.endPTS=r+e.duration}}function l(e,t){for(var r=t.fragments,i=0,n=r.length;i<n;i++)d(r[i],e);t.fragmentHint&&d(t.fragmentHint,e),t.alignedSliding=!0}function c(e,t,r){t&&(function(e,t,r){if(o(e,r,t)){var a=u(r.details,t);a&&Object(i.isFiniteNumber)(a.start)&&(n.logger.log("Adjusting PTS using last level due to CC increase within current level "+t.url),l(a.start,t))}}(e,r,t),!r.alignedSliding&&t.details&&h(r,t.details),r.alignedSliding||!t.details||r.skippedSegments||Object(a.adjustSliding)(t.details,r))}function h(e,t){if(t.fragments.length&&e.hasProgramDateTime&&t.hasProgramDateTime){var r=t.fragments[0].programDateTime,a=e.fragments[0].programDateTime,s=(a-r)/1e3+t.fragments[0].start;s&&Object(i.isFiniteNumber)(s)&&(n.logger.log("Adjusting PTS using programDateTime delta "+(a-r)+"ms, sliding:"+s.toFixed(3)+" "+e.url+" "),l(s,e))}}function f(e,t){var r=e.programDateTime;if(r){var i=(r-t)/1e3;e.start=e.startPTS=i,e.endPTS=i+e.duration}}function A(e,t){if(t.fragments.length&&e.hasProgramDateTime&&t.hasProgramDateTime){var r=t.fragments[0].programDateTime-1e3*t.fragments[0].start;e.fragments.forEach((function(e){f(e,r)})),e.fragmentHint&&f(e.fragmentHint,r),e.alignedSliding=!0}}},"./repo/src/utils/ewma-bandwidth-estimator.ts":function(e,t,r){"use strict";r.r(t);var i=r("./repo/src/utils/ewma.ts"),n=function(){function e(e,t,r){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultEstimate_=r,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new i.default(e),this.fast_=new i.default(t)}var t=e.prototype;return t.update=function(e,t){var r=this.slow_,n=this.fast_;this.slow_.halfLife!==e&&(this.slow_=new i.default(e,r.getEstimate(),r.getTotalWeight())),this.fast_.halfLife!==t&&(this.fast_=new i.default(t,n.getEstimate(),n.getTotalWeight()))},t.sample=function(e,t){var r=(e=Math.max(e,this.minDelayMs_))/1e3,i=8*t/r;this.fast_.sample(r,i),this.slow_.sample(r,i)},t.canEstimate=function(){var e=this.fast_;return e&&e.getTotalWeight()>=this.minWeight_},t.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},t.destroy=function(){},e}();t.default=n},"./repo/src/utils/ewma.ts":function(e,t,r){"use strict";r.r(t);var i=function(){function e(e,t,r){void 0===t&&(t=0),void 0===r&&(r=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=r}var t=e.prototype;return t.sample=function(e,t){var r=Math.pow(this.alpha_,e);this.estimate_=t*(1-r)+r*this.estimate_,this.totalWeight_+=e},t.getTotalWeight=function(){return this.totalWeight_},t.getEstimate=function(){if(this.alpha_){var e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_},e}();t.default=i},"./repo/src/utils/fetch-loader.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"fetchSupported",(function(){return c}));var i=r("./repo/src/polyfills/number.ts"),n=r("./repo/src/loader/load-stats.ts"),a=r("./repo/src/demux/chunk-cache.ts");function s(e){var t="function"==typeof Map?new Map:void 0;return(s=function(e){if(null===e||(r=e,-1===Function.toString.call(r).indexOf("[native code]")))return e;var r;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,i)}function i(){return o(e,arguments,d(this).constructor)}return i.prototype=Object.create(e.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),u(i,e)})(e)}function o(e,t,r){return(o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}()?Reflect.construct:function(e,t,r){var i=[null];i.push.apply(i,t);var n=new(Function.bind.apply(e,i));return r&&u(n,r.prototype),n}).apply(null,arguments)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(){return(l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function c(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch(e){}return!1}var h=function(){function e(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||f,this.controller=new self.AbortController,this.stats=new n.LoadStats}var t=e.prototype;return t.destroy=function(){this.loader=this.callbacks=null,this.abortInternal()},t.abortInternal=function(){var e=this.response;e&&e.ok||(this.stats.aborted=!0,this.controller.abort())},t.abort=function(){var e;this.abortInternal(),null!==(e=this.callbacks)&&void 0!==e&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},t.load=function(e,t,r){var n=this,a=this.stats;if(a.loading.start)throw new Error("Loader can only be used once.");a.loading.start=self.performance.now();var s=function(e,t){var r={method:"GET",mode:"cors",credentials:"same-origin",signal:t,headers:new self.Headers(l({},e.headers))};return e.rangeEnd&&r.headers.set("Range","bytes="+e.rangeStart+"-"+String(e.rangeEnd-1)),r}(e,this.controller.signal),o=r.onProgress,u="arraybuffer"===e.responseType,d=u?"byteLength":"length";this.context=e,this.config=t,this.callbacks=r,this.request=this.fetchSetup(e,s),self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout((function(){n.abortInternal(),r.onTimeout(a,e,n.response)}),t.timeout),self.fetch(this.request).then((function(r){if(n.response=n.loader=r,!r.ok){var s=r.status,d=r.statusText;throw new A(d||"fetch, bad network response",s,r)}return a.loading.first=Math.max(self.performance.now(),a.loading.start),a.total=parseInt(r.headers.get("Content-Length")||"0"),o&&Object(i.isFiniteNumber)(t.highWaterMark)?n.loadProgressively(r,a,e,t.highWaterMark,o):u?r.arrayBuffer():r.text()})).then((function(s){var u=n.response;self.clearTimeout(n.requestTimeout),a.loading.end=Math.max(self.performance.now(),a.loading.first),a.loaded=a.total=s[d];var l={url:u.url,data:s};o&&!Object(i.isFiniteNumber)(t.highWaterMark)&&o(a,e,s,u),r.onSuccess(l,a,e,u)})).catch((function(t){if(self.clearTimeout(n.requestTimeout),!a.aborted){var i=t.code||0;r.onError({code:i,text:t.message},e,t.details)}}))},t.getCacheAge=function(){var e=null;if(this.response){var t=this.response.headers.get("age");e=t?parseFloat(t):null}return e},t.loadProgressively=function(e,t,r,i,n){void 0===i&&(i=0);var s=new a.default,o=e.body.getReader();return function a(){return o.read().then((function(o){if(o.done)return s.dataLength&&n(t,r,s.flush(),e),Promise.resolve(new ArrayBuffer(0));var u=o.value,d=u.length;return t.loaded+=d,d<i||s.dataLength?(s.push(u),s.dataLength>=i&&n(t,r,s.flush(),e)):n(t,r,u,e),a()})).catch((function(){return Promise.reject()}))}()},e}();function f(e,t){return new self.Request(e.url,t)}var A=function(e){var t,r;function i(t,r,i){var n;return(n=e.call(this,t)||this).code=void 0,n.details=void 0,n.code=r,n.details=i,n}return r=e,(t=i).prototype=Object.create(r.prototype),t.prototype.constructor=t,u(t,r),i}(s(Error));t.default=h},"./repo/src/utils/logger.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"enableLogs",(function(){return o})),r.d(t,"logger",(function(){return u}));var i=function(){},n={trace:i,debug:i,log:i,warn:i,info:i,error:i},a=n;function s(e){var t=self.console[e];return t?t.bind(self.console,"["+e+"] >"):i}function o(e){if(self.console&&!0===e||"object"==typeof e){!function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];r.forEach((function(t){a[t]=e[t]?e[t].bind(e):s(t)}))}(e,"debug","log","info","warn","error");try{a.log()}catch(e){a=n}}else a=n}var u=n},"./repo/src/utils/mediakeys-helper.ts":function(e,t,r){"use strict";var i;r.r(t),r.d(t,"KeySystems",(function(){return i})),r.d(t,"requestMediaKeySystemAccess",(function(){return n})),function(e){e.WIDEVINE="com.widevine.alpha",e.PLAYREADY="com.microsoft.playready"}(i||(i={}));var n="undefined"!=typeof self&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null},"./repo/src/utils/mediasource-helper.ts":function(e,t,r){"use strict";function i(){return self.MediaSource||self.WebKitMediaSource}r.r(t),r.d(t,"getMediaSource",(function(){return i}))},"./repo/src/utils/mp4-tools.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"RemuxerTrackIdConfig",(function(){return u})),r.d(t,"bin2str",(function(){return d})),r.d(t,"readUint16",(function(){return l})),r.d(t,"readUint32",(function(){return c})),r.d(t,"readSint32",(function(){return h})),r.d(t,"writeUint32",(function(){return f})),r.d(t,"findBox",(function(){return A})),r.d(t,"parseSegmentIndex",(function(){return p})),r.d(t,"parseInitSegment",(function(){return v})),r.d(t,"getStartDTS",(function(){return m})),r.d(t,"getDuration",(function(){return g})),r.d(t,"computeRawDurationFromSamples",(function(){return y})),r.d(t,"offsetStartDTS",(function(){return b})),r.d(t,"segmentValidRange",(function(){return _})),r.d(t,"appendUint8Array",(function(){return E})),r.d(t,"parseSamples",(function(){return T})),r.d(t,"parseSEIMessageFromNALu",(function(){return S})),r.d(t,"parseEmsg",(function(){return D}));var i=r("./repo/src/utils/typed-array.ts"),n=r("./repo/src/loader/fragment.ts"),a=r("./repo/src/demux/id3.ts"),s=Math.pow(2,32)-1,o=[].push,u={video:1,audio:2,id3:3,text:4};function d(e){return String.fromCharCode.apply(null,e)}function l(e,t){var r=e[t]<<8|e[t+1];return r<0?65536+r:r}function c(e,t){var r=h(e,t);return r<0?4294967296+r:r}function h(e,t){return e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]}function f(e,t,r){e[t]=r>>24,e[t+1]=r>>16&255,e[t+2]=r>>8&255,e[t+3]=255&r}function A(e,t){var r=[];if(!t.length)return r;for(var i=e.byteLength,n=0;n<i;){var a=c(e,n),s=a>1?n+a:i;if(d(e.subarray(n+4,n+8))===t[0])if(1===t.length)r.push(e.subarray(n+8,s));else{var u=A(e.subarray(n+8,s),t.slice(1));u.length&&o.apply(r,u)}n=s}return r}function p(e){var t=A(e,["moov"])[0],r=t?t.length:null,i=A(e,["sidx"]);if(!i||!i[0])return null;var n=[],a=i[0],s=a[0],o=0===s?8:16,u=c(a,o);o+=4,o+=0===s?8:16,o+=2;var d=a.length+0,h=l(a,o);o+=2;for(var f=0;f<h;f++){var p=o,v=c(a,p);p+=4;var m=2147483647&v;if(1==(2147483648&v)>>>31)return console.warn("SIDX has hierarchical references (not supported)"),null;var g=c(a,p);p+=4,n.push({referenceSize:m,subsegmentDuration:g,info:{duration:g/u,start:d,end:d+m-1}}),d+=m,o=p+=4}return{earliestPresentationTime:0,timescale:u,version:s,referencesCount:h,references:n,moovEndOffset:r}}function v(e){for(var t=[],r=A(e,["moov","trak"]),i=0;i<r.length;i++){var a=r[i],s=A(a,["tkhd"])[0];if(s){var o=s[0],u=0===o?12:20,l=c(s,u),h=A(a,["mdia","mdhd"])[0];if(h){var f=c(h,u=0===(o=h[0])?12:20),p=A(a,["mdia","hdlr"])[0];if(p){var v=d(p.subarray(8,12)),m={soun:n.ElementaryStreamTypes.AUDIO,vide:n.ElementaryStreamTypes.VIDEO}[v];if(m){var g=A(a,["mdia","minf","stbl","stsd"])[0],y=void 0;g&&(y=d(g.subarray(12,16))),t[l]={timescale:f,type:m},t[m]={timescale:f,id:l,codec:y}}}}}}return A(e,["moov","mvex","trex"]).forEach((function(e){var r=c(e,4),i=t[r];i&&(i.default={duration:c(e,12),flags:c(e,20)})})),t}function m(e,t){return A(t,["moof","traf"]).reduce((function(t,r){var i=A(r,["tfdt"])[0],n=i[0],a=A(r,["tfhd"]).reduce((function(t,r){var a=c(r,4),s=e[a];if(s){var o=c(i,4);1===n&&(o*=Math.pow(2,32),o+=c(i,8));var u=o/(s.timescale||9e4);if(isFinite(u)&&(null===t||u<t))return u}return t}),null);return null!==a&&isFinite(a)&&(null===t||a<t)?a:t}),null)||0}function g(e,t){for(var r=0,i=0,a=0,s=A(e,["moof","traf"]),o=0;o<s.length;o++){var u=s[o],d=A(u,["tfhd"])[0],l=t[c(d,4)];if(l){var h=l.default,f=c(d,0)|(null==h?void 0:h.flags),v=null==h?void 0:h.duration;8&f&&(v=c(d,2&f?12:8));for(var m=l.timescale||9e4,g=A(u,["trun"]),b=0;b<g.length;b++)!(r=y(g[b]))&&v&&(r=v*c(g[b],4)),l.type===n.ElementaryStreamTypes.VIDEO?i+=r/m:l.type===n.ElementaryStreamTypes.AUDIO&&(a+=r/m)}}if(0===i&&0===a){var _=p(e);if(null!=_&&_.references)return _.references.reduce((function(e,t){return e+t.info.duration||0}),0)}return i||a}function y(e){var t=c(e,0),r=8;1&t&&(r+=4),4&t&&(r+=4);for(var i=0,n=c(e,4),a=0;a<n;a++)256&t&&(i+=c(e,r),r+=4),512&t&&(r+=4),1024&t&&(r+=4),2048&t&&(r+=4);return i}function b(e,t,r){A(t,["moof","traf"]).forEach((function(t){A(t,["tfhd"]).forEach((function(i){var n=c(i,4),a=e[n];if(a){var o=a.timescale||9e4;A(t,["tfdt"]).forEach((function(e){var t=e[0],i=c(e,4);if(0===t)f(e,4,i-r*o);else{i*=Math.pow(2,32),i+=c(e,8),i-=r*o,i=Math.max(i,0);var n=Math.floor(i/(s+1)),a=Math.floor(i%(s+1));f(e,4,n),f(e,8,a)}}))}}))}))}function _(e){var t={valid:null,remainder:null},r=A(e,["moof"]);if(!r)return t;if(r.length<2)return t.remainder=e,t;var n=r[r.length-1];return t.valid=Object(i.sliceUint8)(e,0,n.byteOffset-8),t.remainder=Object(i.sliceUint8)(e,n.byteOffset-8),t}function E(e,t){var r=new Uint8Array(e.length+t.length);return r.set(e),r.set(t,e.length),r}function T(e,t){var r=[],i=t.samples,a=t.timescale,s=t.id,o=!1;return A(i,["moof"]).map((function(u){var d=u.byteOffset-8;A(u,["traf"]).map((function(u){var l=A(u,["tfdt"]).map((function(e){var t=e[0],r=c(e,4);return 1===t&&(r*=Math.pow(2,32),r+=c(e,8)),r/a}))[0];return void 0!==l&&(e=l),A(u,["tfhd"]).map((function(l){var f=c(l,4),p=16777215&c(l,0),v=0,m=!!(16&p),g=0,y=!!(32&p),b=8;f===s&&(!!(1&p)&&(b+=8),!!(2&p)&&(b+=4),!!(8&p)&&(v=c(l,b),b+=4),m&&(g=c(l,b),b+=4),y&&(b+=4),"video"===t.type&&(o=function(e){if(!e)return!1;var t=e.indexOf("."),r=t<0?e:e.substring(0,t);return"hvc1"===r||"hev1"===r||"dvh1"===r||"dvhe"===r}(t.codec)),A(u,["trun"]).map((function(s){var u=s[0],l=16777215&c(s,0),f=!!(1&l),A=0,p=!!(4&l),m=!!(256&l),y=0,b=!!(512&l),_=0,E=!!(1024&l),T=!!(2048&l),D=0,R=c(s,4),L=8;f&&(A=c(s,L),L+=4),p&&(L+=4);for(var C=A+d,w=0;w<R;w++){if(m?(y=c(s,L),L+=4):y=v,b?(_=c(s,L),L+=4):_=g,E&&(L+=4),T&&(D=0===u?c(s,L):h(s,L),L+=4),t.type===n.ElementaryStreamTypes.VIDEO)for(var I=0;I<_;){var x=c(i,C),P=31&i[C+=4];k(o,P)&&S(i.subarray(C,C+x),e+D/a,r),C+=x,I+=x+4}e+=y/a}})))}))}))})),r}function k(e,t){return e?39===t||40===t:6===t}function S(e,t,r){var i=function(e){for(var t=e.byteLength,r=[],i=1;i<t-2;)0===e[i]&&0===e[i+1]&&3===e[i+2]?(r.push(i+2),i+=2):i++;if(0===r.length)return e;var n=t-r.length,a=new Uint8Array(n),s=0;for(i=0;i<n;s++,i++)s===r[0]&&(s++,r.shift()),a[i]=e[s];return a}(e),n=0;n++;for(var s=0,o=0,u=!1,d=0;n<i.length;){s=0;do{if(n>=i.length)break;s+=d=i[n++]}while(255===d);o=0;do{if(n>=i.length)break;o+=d=i[n++]}while(255===d);var h=i.length-n;if(!u&&4===s&&n<i.length){if(u=!0,181===i[n++]){var f=l(i,n);if(n+=2,49===f){var A=c(i,n);if(n+=4,1195456820===A){var p=i[n++];if(3===p){var v=i[n++],m=64&v,g=m?2+3*(31&v):0,y=new Uint8Array(g);if(m){y[0]=v;for(var b=1;b<g;b++)y[b]=i[n++]}r.push({type:p,payloadType:s,pts:t,bytes:y})}}}}}else if(5===s&&o<h){if(u=!0,o>16){for(var _=[],E=0;E<16;E++){var T=i[n++].toString(16);_.push(1==T.length?"0"+T:T),3!==E&&5!==E&&7!==E&&9!==E||_.push("-")}for(var k=o-16,S=new Uint8Array(k),D=0;D<k;D++)S[D]=i[n++];r.push({payloadType:s,pts:t,uuid:_.join(""),userData:Object(a.utf8ArrayToStr)(S),userDataBytes:S})}}else if(o<h)n+=o;else if(o>h)break}}function D(e){var t=e[0],r="",i="",n=0,a=0,s=0,o=0,u=0,l=0;if(0===t){for(;"\0"!==d(e.subarray(l,l+1));)r+=d(e.subarray(l,l+1)),l+=1;for(r+=d(e.subarray(l,l+1)),l+=1;"\0"!==d(e.subarray(l,l+1));)i+=d(e.subarray(l,l+1)),l+=1;i+=d(e.subarray(l,l+1)),l+=1,n=c(e,12),a=c(e,16),o=c(e,20),u=c(e,24),l=28}else if(1===t){n=c(e,l+=4);var h=c(e,l+=4),f=c(e,l+=4);for(l+=4,s=Math.pow(2,32)*h+f,Number.isSafeInteger(s)||(s=Number.MAX_SAFE_INTEGER,console.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),o=c(e,l),u=c(e,l+=4),l+=4;"\0"!==d(e.subarray(l,l+1));)r+=d(e.subarray(l,l+1)),l+=1;for(r+=d(e.subarray(l,l+1)),l+=1;"\0"!==d(e.subarray(l,l+1));)i+=d(e.subarray(l,l+1)),l+=1;i+=d(e.subarray(l,l+1)),l+=1}return{schemeIdUri:r,value:i,timeScale:n,presentationTime:s,presentationTimeDelta:a,eventDuration:o,id:u,payload:e.subarray(l,e.byteLength)}}},"./repo/src/utils/texttrack-utils.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"sendAddTrackEvent",(function(){return n})),r.d(t,"addCueToTrack",(function(){return a})),r.d(t,"clearCurrentCues",(function(){return s})),r.d(t,"removeCuesInRange",(function(){return o})),r.d(t,"getCuesInRange",(function(){return u}));var i=r("./repo/src/utils/logger.ts");function n(e,t){var r;try{r=new Event("addtrack")}catch(e){(r=document.createEvent("Event")).initEvent("addtrack",!1,!1)}r.track=e,t.dispatchEvent(r)}function a(e,t){var r=e.mode;if("disabled"===r&&(e.mode="hidden"),e.cues&&!e.cues.getCueById(t.id))try{if(e.addCue(t),!e.cues.getCueById(t.id))throw new Error("addCue is failed for: "+t)}catch(r){i.logger.debug("[texttrack-utils]: "+r);var n=new self.TextTrackCue(t.startTime,t.endTime,t.text);n.id=t.id,e.addCue(n)}"disabled"===r&&(e.mode=r)}function s(e){var t=e.mode;if("disabled"===t&&(e.mode="hidden"),e.cues)for(var r=e.cues.length;r--;)e.removeCue(e.cues[r]);"disabled"===t&&(e.mode=t)}function o(e,t,r){var i=e.mode;if("disabled"===i&&(e.mode="hidden"),e.cues&&e.cues.length>0)for(var n=u(e.cues,t,r),a=0;a<n.length;a++)e.removeCue(n[a]);"disabled"===i&&(e.mode=i)}function u(e,t,r){var i=[],n=function(e,t){if(t<e[0].startTime)return 0;var r=e.length-1;if(t>e[r].endTime)return-1;for(var i=0,n=r;i<=n;){var a=Math.floor((n+i)/2);if(t<e[a].startTime)n=a-1;else{if(!(t>e[a].startTime&&i<r))return a;i=a+1}}return e[i].startTime-t<t-e[n].startTime?i:n}(e,t);if(n>-1)for(var a=n,s=e.length;a<s;a++){var o=e[a];if(o.startTime>=t&&o.endTime<=r)i.push(o);else if(o.startTime>r)return i}return i}},"./repo/src/utils/time-ranges.ts":function(e,t,r){"use strict";r.r(t),t.default={toString:function(e){for(var t="",r=e.length,i=0;i<r;i++)t+="["+e.start(i).toFixed(3)+","+e.end(i).toFixed(3)+"]";return t}}},"./repo/src/utils/timescale-conversion.ts":function(e,t,r){"use strict";function i(e,t,r,i){void 0===r&&(r=1),void 0===i&&(i=!1);var n=e*t*r;return i?Math.round(n):n}function n(e,t,r,n){return void 0===r&&(r=1),void 0===n&&(n=!1),i(e,t,1/r,n)}function a(e,t){return void 0===t&&(t=!1),i(e,1e3,1/9e4,t)}function s(e,t){return void 0===t&&(t=1),i(e,9e4,1/t)}r.r(t),r.d(t,"toTimescaleFromBase",(function(){return i})),r.d(t,"toTimescaleFromScale",(function(){return n})),r.d(t,"toMsFromMpegTsClock",(function(){return a})),r.d(t,"toMpegTsClockFromTimescale",(function(){return s}))},"./repo/src/utils/typed-array.ts":function(e,t,r){"use strict";function i(e,t,r){return Uint8Array.prototype.slice?e.slice(t,r):new Uint8Array(Array.prototype.slice.call(e,t,r))}r.r(t),r.d(t,"sliceUint8",(function(){return i}))},"./repo/src/utils/xhr-loader.ts":function(e,t,r){"use strict";r.r(t);var i=r("./repo/src/utils/logger.ts"),n=r("./repo/src/loader/load-stats.ts"),a=/^age:\s*[\d.]+\s*$/m,s=function(){function e(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=e?e.xhrSetup:null,this.stats=new n.LoadStats,this.retryDelay=0}var t=e.prototype;return t.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null},t.abortInternal=function(){var e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,4!==e.readyState&&(this.stats.aborted=!0,e.abort()))},t.abort=function(){var e;this.abortInternal(),null!==(e=this.callbacks)&&void 0!==e&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},t.load=function(e,t,r){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=r,this.retryDelay=t.retryDelay,this.loadInternal()},t.loadInternal=function(){var e=this.config,t=this.context;if(e){var r=this.loader=new self.XMLHttpRequest,i=this.stats;i.loading.first=0,i.loaded=0;var n=this.xhrSetup;try{if(n)try{n(r,t.url)}catch(e){r.open("GET",t.url,!0),n(r,t.url)}r.readyState||r.open("GET",t.url,!0);var a=this.context.headers;if(a)for(var s in a)r.setRequestHeader(s,a[s])}catch(e){return void this.callbacks.onError({code:r.status,text:e.message},t,r)}t.rangeEnd&&r.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),r.onreadystatechange=this.readystatechange.bind(this),r.onprogress=this.loadprogress.bind(this),r.responseType=t.responseType,self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),e.timeout),r.send()}},t.readystatechange=function(){var e=this.context,t=this.loader,r=this.stats;if(e&&t){var n=t.readyState,a=this.config;if(!r.aborted&&n>=2)if(self.clearTimeout(this.requestTimeout),0===r.loading.first&&(r.loading.first=Math.max(self.performance.now(),r.loading.start)),4===n){t.onreadystatechange=null,t.onprogress=null;var s=t.status;if(s>=200&&s<300){var o,u;if(r.loading.end=Math.max(self.performance.now(),r.loading.first),u="arraybuffer"===e.responseType?(o=t.response).byteLength:(o=t.responseText).length,r.loaded=r.total=u,!this.callbacks)return;var d=this.callbacks.onProgress;if(d&&d(r,e,o,t),!this.callbacks)return;var l={url:t.responseURL,data:o};this.callbacks.onSuccess(l,r,e,t)}else r.retry>=a.maxRetry||s>=400&&s<499?(i.logger.error(s+" while loading "+e.url),this.callbacks.onError({code:s,text:t.statusText},e,t)):(i.logger.warn(s+" while loading "+e.url+", retrying in "+this.retryDelay+"..."),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,a.maxRetryDelay),r.retry++)}else self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),a.timeout)}},t.loadtimeout=function(){i.logger.warn("timeout while loading "+this.context.url);var e=this.callbacks;e&&(this.abortInternal(),e.onTimeout(this.stats,this.context,this.loader))},t.loadprogress=function(e){var t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)},t.getCacheAge=function(){var e=null;if(this.loader&&a.test(this.loader.getAllResponseHeaders())){var t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e},e}();t.default=s},"./src/hls-wrapper.ts":function(e,t,r){"use strict";r.r(t);var i=r("./repo/src/hls.ts"),n=r("../crypt/dist/jsvmp.js"),a=r.n(n);for(var s in n)["default"].indexOf(s)<0&&function(e){r.d(t,e,(function(){return n[e]}))}(s);i.default._=a.a,t.default=i.default}}).default},e.exports=i())},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MAX_TIMESTAMP=5e9,t.MIN_EXPIRE_INTERVAL=300},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i={getBrowserVersion:function(){var e=navigator.userAgent;if(e.toLowerCase().indexOf("mobile")>-1)return"Unknown";if(e.indexOf("Firefox")>-1)return"Firefox "+e.match(/firefox\/[\d.]+/gi)[0].match(/[\d]+/)[0];if(e.indexOf("Edge")>-1)return"Edge "+e.match(/edge\/[\d.]+/gi)[0].match(/[\d]+/)[0];if(e.indexOf("rv:11")>-1)return"IE 11";if(e.indexOf("Opera")>-1||e.indexOf("OPR")>-1){if(e.indexOf("Opera")>-1)return"Opera "+e.match(/opera\/[\d.]+/gi)[0].match(/[\d]+/)[0];if(e.indexOf("OPR")>-1)return"Opera "+e.match(/opr\/[\d.]+/gi)[0].match(/[\d]+/)[0]}else{if(e.indexOf("Chrome")>-1)return"Chrome "+e.match(/chrome\/[\d.]+/gi)[0].match(/[\d]+/)[0];if(e.indexOf("Safari")>-1)return"Safari "+e.match(/safari\/[\d.]+/gi)[0].match(/[\d]+/)[0];if(!(e.indexOf("MSIE")>-1||e.indexOf("Trident")>-1))return"Unknown";if(e.indexOf("MSIE")>-1)return"IE "+e.match(/msie [\d.]+/gi)[0].match(/[\d]+/)[0];if(e.indexOf("Trident")>-1){var t=e.match(/trident\/[\d.]+/gi)[0].match(/[\d]+/)[0];return"IE "+(parseInt(t)+4)}}},parseUrl:function(e){var t=e.split("?")[1],r={};return t&&t.split("&").forEach((function(e){e=e.split("="),r[e[0]]=decodeURIComponent(e[1])})),r},isBase64:function(e){return/^([A-Za-z0-9+/]{4})*([A-Za-z0-9+/]{4}|[A-Za-z0-9+/]{3}=|[A-Za-z0-9+/]{2}==)$/.test(e)},isRelativeURL:function(e){return!/^(?:[a-z]+:)?\/\//.test(e)},getAbsoluteURL:function(e){var t=new Image;return t.src=e,t.src},checkMediaSourceSupport:function(){var e=window.MediaSource=window.MediaSource||window.WebKitMediaSource;return e&&"function"==typeof e.isTypeSupported},offInDestroy:function(e,t,r,i){e.once(i,(function n(){e.off(t,r),e.off(i,n)}))},on:function(e,t,r,n){n?(e.on(t,r),i.offInDestroy(e,t,r,n)):e.on(t,(function i(n){r(n),e.off(t,i)}))},once:function(e,t,r,n){n?(e.once(t,r),i.offInDestroy(e,t,r,n)):e.once(t,(function i(n){r(n),e.off(t,i)}))}};t.default=i,e.exports=t.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.timeID=null,this.func=null}return i(e,[{key:"repeat",value:function(e,t){var r=this;null===this.func&&(this.func=e),this.func===e&&(this.timeID=setTimeout((function(){e(),r.repeat(e,t)}),t))}},{key:"clear",value:function(){clearTimeout(this.timeID)}}]),e}();t.default=n,e.exports=t.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getMediaSource=function(){return self.MediaSource||WebKitMediaSource},t.getSourceBuffer=function(){return self.SourceBuffer}},function(e,t){!function(e,t,r){function i(e,t){var r=parseInt(e.slice(t,t+2),16);return r>>>7==0?[1,r]:r>>>6==2?(r=(63&r)<<8,[2,r+=parseInt(e.slice(t+2,t+4),16)]):(r=(63&r)<<16,[3,r+=parseInt(e.slice(t+2,t+6),16)])}var n,a=0,s=[],o=[],u=parseInt(e.slice(0,8),16),d=parseInt(e.slice(8,16),16);if(1213091658!==u||1077891651!==d)throw new Error("mhe");if(0!==parseInt(e.slice(16,18),16))throw new Error("ve");for(n=0;n<4;++n)a+=(3&parseInt(e.slice(24+2*n,26+2*n),16))<<2*n;var l=parseInt(e.slice(32,40),16),c=2*parseInt(e.slice(48,56),16);for(n=56;n<c+56;n+=2)s.push(parseInt(e.slice(n,n+2),16));var h=c+56,f=parseInt(e.slice(h,h+4),16);for(h+=4,n=0;n<f;++n){var A=i(e,h);h+=2*A[0];for(var p="",v=0;v<A[1];++v){var m=i(e,h);p+=String.fromCharCode(a^m[1]),h+=2*m[0]}o.push(p)}t.p=null,function e(t,r,i,n,a){var u,d,l,c,h,f=-1,A=[],p=null,v=[r];for(d=Math.min(r.length,i),l=0;l<d;++l)v.push(r[l]);v.p=n;for(var m=[];;)try{var g=s[t++];if(g<24)if(g<13)g<5?A[++f]=g<1||1!==g&&null:g<7?(u=((u=((u=s[t++])<<8)+s[t++])<<8)+s[t++],A[++f]=(u<<8)+s[t++]):7===g?(u=(s[t]<<8)+s[t+1],t+=2,A[++f]=o[u]):A[++f]=void 0;else if(g<18)if(g<14)A[++f]={};else if(14===g)u=(s[t]<<8)+s[t+1],t+=2,d=o[u],l=A[f--],A[f][d]=l;else{for(d=s[t++],l=s[t++],c=v;d>0;--d)c=c.p;A[++f]=c[l]}else if(g<20)u=(s[t]<<8)+s[t+1],t+=2,d=o[u],A[f]=A[f][d];else if(20===g){for(d=s[t++],l=s[t++],c=v;d>0;--d)c=c.p;c[l]=A[f--]}else u=(s[t]<<8)+s[t+1],t+=2,d=o[u],l=A[f--],c=A[f--],l[d]=c;else if(g<67)if(g<58)g<37?(d=A[f--],A[f]+=d):37===g?(d=A[f--],A[f]=A[f]===d):(u=(u=(s[t]<<8)+s[t+1])<<16>>16,t+=2,A[f]?--f:t+=u);else if(g<59)A[f]=typeof A[f];else if(59===g)u=s[t++],d=A[f--],(l=function e(){var t=e._v;return(0,e._u)(t[0],arguments,t[1],t[2],this)})._v=[d,u,v],l._u=e,A[++f]=l;else{for(d=A[f--],l=null;c=m.pop();)if(2===c[0]||3===c[0]){l=c;break}if(l)t=l[2],l[0]=0,m.push(l);else{if(!p)return d;t=p[1],a=p[2],v=p[3],m=p[4],A[++f]=d,p=p[0]}}else if(g<71)if(g<68)f-=u=s[t++],l=A.slice(f+1,f+u+1),d=A[f--],c=A[f--],d._u===e?(d=d._v,p=[p,t,a,v,m],t=d[0],null==c&&(c=function(){return this}()),a=c,(v=[l].concat(l)).length=Math.min(d[1],u)+1,v.p=d[2],m=[]):A[++f]=d.apply(c,l);else if(68===g){for(u=s[t++],c=[void 0],h=u;h>0;--h)c[h]=A[f--];l=A[f--],d=Function.bind.apply(l,c),A[++f]=new d}else t+=2+(u=(u=(s[t]<<8)+s[t+1])<<16>>16);else g<73?(u=(u=(s[t]<<8)+s[t+1])<<16>>16,t+=2,(d=A[f--])||(t+=u)):73===g?--f:(d=A[f],A[++f]=d)}catch(e){for(;(u=m.pop())&&!u[0];);if(!u){e:for(;p;){for(d=p[4];u=d.pop();)if(u[0])break e;p=p[0]}if(!p)throw e;t=p[1],a=p[2],v=p[3],m=p[4],p=p[0]}1===(d=u[0])?(t=u[2],u[0]=0,m.push(u),A[++f]=e):2===d?(t=u[2],u[0]=0,m.push(u)):(t=u[3],u[0]=2,m.push(u),A[++f]=e)}}(l,[],0,t,r)}("484e4f4a403f524300391f27f2d56b31000000a9b2f4c6f6000000ef001400021102034a12000711000143014700191100014a12000805000000993b021100024302140002450069021102040700090211020511010143014a12000a11020407000b07000c440207000d43024a12000a11020407000e07000c440207000f4302180700101843011400031100013a070011254700181100034a1200121101024a1200131100014301430145000101140002110002421100013300090211020311000243014205000000003b01140003070000491101004a1200011101010700020d000e0003430349110003110101150004110100120005120006140001110102120005120006140002084200140a030513560502041f15020e1213101f1813260419061304020f0a292913053b1912031a130500171a03130c1f053817021f001330031815090604190219020f06130802192502041f1811071f05370404170f060413120315130128070413061a171513142d585c5d4928520d0b5e5f0a2d2a2b2a592a2a2b0111032a52502f02192502041f18110a5e10031815021f19185f585c495e494b2a2a2a5e5f0a5610190456585d495e494b2a2a2a2b5f055247585c4901520810031815021f191804021305020415171a1a",{0:Object,get 1(){return t},2:Function,3:Array,4:RegExp,5:String},this)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.url,i=t.method,n=void 0===i?"GET":i,a=t.type,s=void 0===a?"arraybuffer":a,o=t.timeout,u=void 0===o?1e4:o,d=t.data,l=void 0===d?{}:d,c=t.xhrSetup,h=void 0===c?null:c;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),new Promise((function(e,t){var i=new window.XMLHttpRequest,a=n.toUpperCase(),o=[];for(var d in s&&(i.responseType=s),u&&(i.timeout=u),h&&"function"==typeof h&&h(i),l)o.push("k="+l[d]);if(i.onload=function(){200===i.status||206===i.status?e(i):t(i)},i.onerror=function(){t(i)},i.ontimeout=function(){t(i)},i.onabort=function(){t(i)},"GET"===a)i.open(a,""+r),i.send();else{if("post"!==a)throw new Error("xhr "+a+" is not supported");i.open(a,r),i.setRequestHeader("Content-type","application/x-www-form-urlencoded"),i.send(o.join("&"))}}))},e.exports=t.default}]))},26152:(e,t,r)=>{"use strict";function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,i)}return r}function n(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){c(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function a(){a=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,i=Object.defineProperty||function(e,t,r){e[t]=r.value},n="function"==typeof Symbol?Symbol:{},s=n.iterator||"@@iterator",o=n.asyncIterator||"@@asyncIterator",u=n.toStringTag||"@@toStringTag";function d(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{d({},"")}catch(e){d=function(e,t,r){return e[t]=r}}function l(e,t,r,n){var a=t&&t.prototype instanceof f?t:f,s=Object.create(a.prototype),o=new D(n||[]);return i(s,"_invoke",{value:E(e,r,o)}),s}function c(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=l;var h={};function f(){}function A(){}function p(){}var v={};d(v,s,(function(){return this}));var m=Object.getPrototypeOf,g=m&&m(m(R([])));g&&g!==t&&r.call(g,s)&&(v=g);var y=p.prototype=f.prototype=Object.create(v);function b(e){["next","throw","return"].forEach((function(t){d(e,t,(function(e){return this._invoke(t,e)}))}))}function _(e,t){function n(i,a,s,o){var u=c(e[i],e,a);if("throw"!==u.type){var d=u.arg,l=d.value;return l&&"object"==typeof l&&r.call(l,"__await")?t.resolve(l.__await).then((function(e){n("next",e,s,o)}),(function(e){n("throw",e,s,o)})):t.resolve(l).then((function(e){d.value=e,s(d)}),(function(e){return n("throw",e,s,o)}))}o(u.arg)}var a;i(this,"_invoke",{value:function(e,r){function i(){return new t((function(t,i){n(e,r,t,i)}))}return a=a?a.then(i,i):i()}})}function E(e,t,r){var i="suspendedStart";return function(n,a){if("executing"===i)throw new Error("Generator is already running");if("completed"===i){if("throw"===n)throw a;return{value:void 0,done:!0}}for(r.method=n,r.arg=a;;){var s=r.delegate;if(s){var o=T(s,r);if(o){if(o===h)continue;return o}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===i)throw i="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i="executing";var u=c(e,t,r);if("normal"===u.type){if(i=r.done?"completed":"suspendedYield",u.arg===h)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(i="completed",r.method="throw",r.arg=u.arg)}}}function T(e,t){var r=t.method,i=e.iterator[r];if(void 0===i)return t.delegate=null,"throw"===r&&e.iterator.return&&(t.method="return",t.arg=void 0,T(e,t),"throw"===t.method)||"return"!==r&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+r+"' method")),h;var n=c(i,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,h;var a=n.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,h):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,h)}function k(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function S(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function D(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(k,this),this.reset(!0)}function R(e){if(e){var t=e[s];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,n=function t(){for(;++i<e.length;)if(r.call(e,i))return t.value=e[i],t.done=!1,t;return t.value=void 0,t.done=!0,t};return n.next=n}}return{next:L}}function L(){return{value:void 0,done:!0}}return A.prototype=p,i(y,"constructor",{value:p,configurable:!0}),i(p,"constructor",{value:A,configurable:!0}),A.displayName=d(p,u,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===A||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,d(e,u,"GeneratorFunction")),e.prototype=Object.create(y),e},e.awrap=function(e){return{__await:e}},b(_.prototype),d(_.prototype,o,(function(){return this})),e.AsyncIterator=_,e.async=function(t,r,i,n,a){void 0===a&&(a=Promise);var s=new _(l(t,r,i,n),a);return e.isGeneratorFunction(r)?s:s.next().then((function(e){return e.done?e.value:s.next()}))},b(y),d(y,u,"Generator"),d(y,s,(function(){return this})),d(y,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),r=[];for(var i in t)r.push(i);return r.reverse(),function e(){for(;r.length;){var i=r.pop();if(i in t)return e.value=i,e.done=!1,e}return e.done=!0,e}},e.values=R,D.prototype={constructor:D,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(S),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function i(r,i){return s.type="throw",s.arg=e,t.next=r,i&&(t.method="next",t.arg=void 0),!!i}for(var n=this.tryEntries.length-1;n>=0;--n){var a=this.tryEntries[n],s=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var o=r.call(a,"catchLoc"),u=r.call(a,"finallyLoc");if(o&&u){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(o){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(e,t){for(var i=this.tryEntries.length-1;i>=0;--i){var n=this.tryEntries[i];if(n.tryLoc<=this.prev&&r.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var a=n;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var s=a?a.completion:{};return s.type=e,s.arg=t,a?(this.method="next",this.next=a.finallyLoc,h):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),S(r),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var i=r.completion;if("throw"===i.type){var n=i.arg;S(r)}return n}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:R(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),h}},e}function s(e,t,r,i,n,a,s){try{var o=e[a](s),u=o.value}catch(e){return void r(e)}o.done?t(u):Promise.resolve(u).then(i,n)}function o(e){return function(){var t=this,r=arguments;return new Promise((function(i,n){var a=e.apply(t,r);function o(e){s(a,i,n,o,u,"next",e)}function u(e){s(a,i,n,o,u,"throw",e)}o(void 0)}))}}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function d(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,_(i.key),i)}}function l(e,t,r){return t&&d(e.prototype,t),r&&d(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function c(e,t,r){return(t=_(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function h(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&A(e,t)}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function A(e,t){return(A=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function p(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function v(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,i=f(e);if(t){var n=f(this).constructor;r=Reflect.construct(i,arguments,n)}else r=i.apply(this,arguments);return function(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return p(e)}(this,r)}}function m(){return m="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=f(e)););return e}(e,t);if(i){var n=Object.getOwnPropertyDescriptor(i,t);return n.get?n.get.call(arguments.length<3?e:r):n.value}},m.apply(this,arguments)}function g(e){return function(e){if(Array.isArray(e))return b(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||y(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function y(e,t){if(e){if("string"==typeof e)return b(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?b(e,t):void 0}}function b(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function _(e){var t=function(e){if("object"!=typeof e||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}r.r(t),r.d(t,{default:()=>ir});var E,T=function(){return"undefined"!=typeof navigator&&parseFloat((""+(/CPU.*OS ([0-9_]{3,4})[0-9_]{0,1}|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent)||[0,""])[1]).replace("undefined","3_2").replace("_",".").replace("_",""))<10&&!window.MSStream},k=function(){return"wakeLock"in navigator},S=function(){function e(){var t=this;u(this,e),this.enabled=!1,k()?(this._wakeLock=null,this.handleVisibilityChange=function(){null!==t._wakeLock&&t.visible&&t.enable()},document.addEventListener("visibilitychange",this.handleVisibilityChange),document.addEventListener("fullscreenchange",this.handleVisibilityChange)):T()?this.noSleepTimer=null:(this.noSleepVideo=document.createElement("video"),this.noSleepVideo.setAttribute("playsinline",""),this._addSourceToVideo(this.noSleepVideo,"mp4","data:video/mp4;base64, AAAAHGZ0eXBNNFYgAAACAGlzb21pc28yYXZjMQAAAAhmcmVlAAAGF21kYXTeBAAAbGliZmFhYyAxLjI4AABCAJMgBDIARwAAArEGBf//rdxF6b3m2Ui3lizYINkj7u94MjY0IC0gY29yZSAxNDIgcjIgOTU2YzhkOCAtIEguMjY0L01QRUctNCBBVkMgY29kZWMgLSBDb3B5bGVmdCAyMDAzLTIwMTQgLSBodHRwOi8vd3d3LnZpZGVvbGFuLm9yZy94MjY0Lmh0bWwgLSBvcHRpb25zOiBjYWJhYz0wIHJlZj0zIGRlYmxvY2s9MTowOjAgYW5hbHlzZT0weDE6MHgxMTEgbWU9aGV4IHN1Ym1lPTcgcHN5PTEgcHN5X3JkPTEuMDA6MC4wMCBtaXhlZF9yZWY9MSBtZV9yYW5nZT0xNiBjaHJvbWFfbWU9MSB0cmVsbGlzPTEgOHg4ZGN0PTAgY3FtPTAgZGVhZHpvbmU9MjEsMTEgZmFzdF9wc2tpcD0xIGNocm9tYV9xcF9vZmZzZXQ9LTIgdGhyZWFkcz02IGxvb2thaGVhZF90aHJlYWRzPTEgc2xpY2VkX3RocmVhZHM9MCBucj0wIGRlY2ltYXRlPTEgaW50ZXJsYWNlZD0wIGJsdXJheV9jb21wYXQ9MCBjb25zdHJhaW5lZF9pbnRyYT0wIGJmcmFtZXM9MCB3ZWlnaHRwPTAga2V5aW50PTI1MCBrZXlpbnRfbWluPTI1IHNjZW5lY3V0PTQwIGludHJhX3JlZnJlc2g9MCByY19sb29rYWhlYWQ9NDAgcmM9Y3JmIG1idHJlZT0xIGNyZj0yMy4wIHFjb21wPTAuNjAgcXBtaW49MCBxcG1heD02OSBxcHN0ZXA9NCB2YnZfbWF4cmF0ZT03NjggdmJ2X2J1ZnNpemU9MzAwMCBjcmZfbWF4PTAuMCBuYWxfaHJkPW5vbmUgZmlsbGVyPTAgaXBfcmF0aW89MS40MCBhcT0xOjEuMDAAgAAAAFZliIQL8mKAAKvMnJycnJycnJycnXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXiEASZACGQAjgCEASZACGQAjgAAAAAdBmjgX4GSAIQBJkAIZACOAAAAAB0GaVAX4GSAhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZpgL8DJIQBJkAIZACOAIQBJkAIZACOAAAAABkGagC/AySEASZACGQAjgAAAAAZBmqAvwMkhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZrAL8DJIQBJkAIZACOAAAAABkGa4C/AySEASZACGQAjgCEASZACGQAjgAAAAAZBmwAvwMkhAEmQAhkAI4AAAAAGQZsgL8DJIQBJkAIZACOAIQBJkAIZACOAAAAABkGbQC/AySEASZACGQAjgCEASZACGQAjgAAAAAZBm2AvwMkhAEmQAhkAI4AAAAAGQZuAL8DJIQBJkAIZACOAIQBJkAIZACOAAAAABkGboC/AySEASZACGQAjgAAAAAZBm8AvwMkhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZvgL8DJIQBJkAIZACOAAAAABkGaAC/AySEASZACGQAjgCEASZACGQAjgAAAAAZBmiAvwMkhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZpAL8DJIQBJkAIZACOAAAAABkGaYC/AySEASZACGQAjgCEASZACGQAjgAAAAAZBmoAvwMkhAEmQAhkAI4AAAAAGQZqgL8DJIQBJkAIZACOAIQBJkAIZACOAAAAABkGawC/AySEASZACGQAjgAAAAAZBmuAvwMkhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZsAL8DJIQBJkAIZACOAAAAABkGbIC/AySEASZACGQAjgCEASZACGQAjgAAAAAZBm0AvwMkhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZtgL8DJIQBJkAIZACOAAAAABkGbgCvAySEASZACGQAjgCEASZACGQAjgAAAAAZBm6AnwMkhAEmQAhkAI4AhAEmQAhkAI4AhAEmQAhkAI4AhAEmQAhkAI4AAAAhubW9vdgAAAGxtdmhkAAAAAAAAAAAAAAAAAAAD6AAABDcAAQAAAQAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAzB0cmFrAAAAXHRraGQAAAADAAAAAAAAAAAAAAABAAAAAAAAA+kAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAALAAAACQAAAAAAAkZWR0cwAAABxlbHN0AAAAAAAAAAEAAAPpAAAAAAABAAAAAAKobWRpYQAAACBtZGhkAAAAAAAAAAAAAAAAAAB1MAAAdU5VxAAAAAAALWhkbHIAAAAAAAAAAHZpZGUAAAAAAAAAAAAAAABWaWRlb0hhbmRsZXIAAAACU21pbmYAAAAUdm1oZAAAAAEAAAAAAAAAAAAAACRkaW5mAAAAHGRyZWYAAAAAAAAAAQAAAAx1cmwgAAAAAQAAAhNzdGJsAAAAr3N0c2QAAAAAAAAAAQAAAJ9hdmMxAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAALAAkABIAAAASAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGP//AAAALWF2Y0MBQsAN/+EAFWdCwA3ZAsTsBEAAAPpAADqYA8UKkgEABWjLg8sgAAAAHHV1aWRraEDyXyRPxbo5pRvPAyPzAAAAAAAAABhzdHRzAAAAAAAAAAEAAAAeAAAD6QAAABRzdHNzAAAAAAAAAAEAAAABAAAAHHN0c2MAAAAAAAAAAQAAAAEAAAABAAAAAQAAAIxzdHN6AAAAAAAAAAAAAAAeAAADDwAAAAsAAAALAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAAiHN0Y28AAAAAAAAAHgAAAEYAAANnAAADewAAA5gAAAO0AAADxwAAA+MAAAP2AAAEEgAABCUAAARBAAAEXQAABHAAAASMAAAEnwAABLsAAATOAAAE6gAABQYAAAUZAAAFNQAABUgAAAVkAAAFdwAABZMAAAWmAAAFwgAABd4AAAXxAAAGDQAABGh0cmFrAAAAXHRraGQAAAADAAAAAAAAAAAAAAACAAAAAAAABDcAAAAAAAAAAAAAAAEBAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAkZWR0cwAAABxlbHN0AAAAAAAAAAEAAAQkAAADcAABAAAAAAPgbWRpYQAAACBtZGhkAAAAAAAAAAAAAAAAAAC7gAAAykBVxAAAAAAALWhkbHIAAAAAAAAAAHNvdW4AAAAAAAAAAAAAAABTb3VuZEhhbmRsZXIAAAADi21pbmYAAAAQc21oZAAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAADT3N0YmwAAABnc3RzZAAAAAAAAAABAAAAV21wNGEAAAAAAAAAAQAAAAAAAAAAAAIAEAAAAAC7gAAAAAAAM2VzZHMAAAAAA4CAgCIAAgAEgICAFEAVBbjYAAu4AAAADcoFgICAAhGQBoCAgAECAAAAIHN0dHMAAAAAAAAAAgAAADIAAAQAAAAAAQAAAkAAAAFUc3RzYwAAAAAAAAAbAAAAAQAAAAEAAAABAAAAAgAAAAIAAAABAAAAAwAAAAEAAAABAAAABAAAAAIAAAABAAAABgAAAAEAAAABAAAABwAAAAIAAAABAAAACAAAAAEAAAABAAAACQAAAAIAAAABAAAACgAAAAEAAAABAAAACwAAAAIAAAABAAAADQAAAAEAAAABAAAADgAAAAIAAAABAAAADwAAAAEAAAABAAAAEAAAAAIAAAABAAAAEQAAAAEAAAABAAAAEgAAAAIAAAABAAAAFAAAAAEAAAABAAAAFQAAAAIAAAABAAAAFgAAAAEAAAABAAAAFwAAAAIAAAABAAAAGAAAAAEAAAABAAAAGQAAAAIAAAABAAAAGgAAAAEAAAABAAAAGwAAAAIAAAABAAAAHQAAAAEAAAABAAAAHgAAAAIAAAABAAAAHwAAAAQAAAABAAAA4HN0c3oAAAAAAAAAAAAAADMAAAAaAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAACMc3RjbwAAAAAAAAAfAAAALAAAA1UAAANyAAADhgAAA6IAAAO+AAAD0QAAA+0AAAQAAAAEHAAABC8AAARLAAAEZwAABHoAAASWAAAEqQAABMUAAATYAAAE9AAABRAAAAUjAAAFPwAABVIAAAVuAAAFgQAABZ0AAAWwAAAFzAAABegAAAX7AAAGFwAAAGJ1ZHRhAAAAWm1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAG1kaXJhcHBsAAAAAAAAAAAAAAAALWlsc3QAAAAlqXRvbwAAAB1kYXRhAAAAAQAAAABMYXZmNTUuMzMuMTAw"),this._addSourceToVideo(this.noSleepVideo,"webm","data:video/webm;base64,GkXfowEAAAAAAAAfQoaBAUL3gQFC8oEEQvOBCEKChHdlYm1Ch4EEQoWBAhhTgGcBAAAAAAAVkhFNm3RALE27i1OrhBVJqWZTrIHfTbuMU6uEFlSua1OsggEwTbuMU6uEHFO7a1OsghV17AEAAAAAAACkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVSalmAQAAAAAAAEUq17GDD0JATYCNTGF2ZjU1LjMzLjEwMFdBjUxhdmY1NS4zMy4xMDBzpJBlrrXf3DCDVB8KcgbMpcr+RImIQJBgAAAAAAAWVK5rAQAAAAAAD++uAQAAAAAAADLXgQFzxYEBnIEAIrWcg3VuZIaFVl9WUDiDgQEj44OEAmJaAOABAAAAAAAABrCBsLqBkK4BAAAAAAAPq9eBAnPFgQKcgQAitZyDdW5khohBX1ZPUkJJU4OBAuEBAAAAAAAAEZ+BArWIQOdwAAAAAABiZIEgY6JPbwIeVgF2b3JiaXMAAAAAAoC7AAAAAAAAgLUBAAAAAAC4AQN2b3JiaXMtAAAAWGlwaC5PcmcgbGliVm9yYmlzIEkgMjAxMDExMDEgKFNjaGF1ZmVudWdnZXQpAQAAABUAAABlbmNvZGVyPUxhdmM1NS41Mi4xMDIBBXZvcmJpcyVCQ1YBAEAAACRzGCpGpXMWhBAaQlAZ4xxCzmvsGUJMEYIcMkxbyyVzkCGkoEKIWyiB0JBVAABAAACHQXgUhIpBCCGEJT1YkoMnPQghhIg5eBSEaUEIIYQQQgghhBBCCCGERTlokoMnQQgdhOMwOAyD5Tj4HIRFOVgQgydB6CCED0K4moOsOQghhCQ1SFCDBjnoHITCLCiKgsQwuBaEBDUojILkMMjUgwtCiJqDSTX4GoRnQXgWhGlBCCGEJEFIkIMGQcgYhEZBWJKDBjm4FITLQagahCo5CB+EIDRkFQCQAACgoiiKoigKEBqyCgDIAAAQQFEUx3EcyZEcybEcCwgNWQUAAAEACAAAoEiKpEiO5EiSJFmSJVmSJVmS5omqLMuyLMuyLMsyEBqyCgBIAABQUQxFcRQHCA1ZBQBkAAAIoDiKpViKpWiK54iOCISGrAIAgAAABAAAEDRDUzxHlETPVFXXtm3btm3btm3btm3btm1blmUZCA1ZBQBAAAAQ0mlmqQaIMAMZBkJDVgEACAAAgBGKMMSA0JBVAABAAACAGEoOogmtOd+c46BZDppKsTkdnEi1eZKbirk555xzzsnmnDHOOeecopxZDJoJrTnnnMSgWQqaCa0555wnsXnQmiqtOeeccc7pYJwRxjnnnCateZCajbU555wFrWmOmkuxOeecSLl5UptLtTnnnHPOOeecc84555zqxekcnBPOOeecqL25lpvQxTnnnE/G6d6cEM4555xzzjnnnHPOOeecIDRkFQAABABAEIaNYdwpCNLnaCBGEWIaMulB9+gwCRqDnELq0ehopJQ6CCWVcVJKJwgNWQUAAAIAQAghhRRSSCGFFFJIIYUUYoghhhhyyimnoIJKKqmooowyyyyzzDLLLLPMOuyssw47DDHEEEMrrcRSU2011lhr7jnnmoO0VlprrbVSSimllFIKQkNWAQAgAAAEQgYZZJBRSCGFFGKIKaeccgoqqIDQkFUAACAAgAAAAABP8hzRER3RER3RER3RER3R8RzPESVREiVREi3TMjXTU0VVdWXXlnVZt31b2IVd933d933d+HVhWJZlWZZlWZZlWZZlWZZlWZYgNGQVAAACAAAghBBCSCGFFFJIKcYYc8w56CSUEAgNWQUAAAIACAAAAHAUR3EcyZEcSbIkS9IkzdIsT/M0TxM9URRF0zRV0RVdUTdtUTZl0zVdUzZdVVZtV5ZtW7Z125dl2/d93/d93/d93/d93/d9XQdCQ1YBABIAADqSIymSIimS4ziOJElAaMgqAEAGAEAAAIriKI7jOJIkSZIlaZJneZaomZrpmZ4qqkBoyCoAABAAQAAAAAAAAIqmeIqpeIqoeI7oiJJomZaoqZoryqbsuq7ruq7ruq7ruq7ruq7ruq7ruq7ruq7ruq7ruq7ruq7ruq4LhIasAgAkAAB0JEdyJEdSJEVSJEdygNCQVQCADACAAAAcwzEkRXIsy9I0T/M0TxM90RM901NFV3SB0JBVAAAgAIAAAAAAAAAMybAUy9EcTRIl1VItVVMt1VJF1VNVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVN0zRNEwgNWQkAkAEAkBBTLS3GmgmLJGLSaqugYwxS7KWxSCpntbfKMYUYtV4ah5RREHupJGOKQcwtpNApJq3WVEKFFKSYYyoVUg5SIDRkhQAQmgHgcBxAsixAsiwAAAAAAAAAkDQN0DwPsDQPAAAAAAAAACRNAyxPAzTPAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABA0jRA8zxA8zwAAAAAAAAA0DwP8DwR8EQRAAAAAAAAACzPAzTRAzxRBAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABA0jRA8zxA8zwAAAAAAAAAsDwP8EQR0DwRAAAAAAAAACzPAzxRBDzRAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAEOAAABBgIRQasiIAiBMAcEgSJAmSBM0DSJYFTYOmwTQBkmVB06BpME0AAAAAAAAAAAAAJE2DpkHTIIoASdOgadA0iCIAAAAAAAAAAAAAkqZB06BpEEWApGnQNGgaRBEAAAAAAAAAAAAAzzQhihBFmCbAM02IIkQRpgkAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAGHAAAAgwoQwUGrIiAIgTAHA4imUBAIDjOJYFAACO41gWAABYliWKAABgWZooAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAYcAAACDChDBQashIAiAIAcCiKZQHHsSzgOJYFJMmyAJYF0DyApgFEEQAIAAAocAAACLBBU2JxgEJDVgIAUQAABsWxLE0TRZKkaZoniiRJ0zxPFGma53meacLzPM80IYqiaJoQRVE0TZimaaoqME1VFQAAUOAAABBgg6bE4gCFhqwEAEICAByKYlma5nmeJ4qmqZokSdM8TxRF0TRNU1VJkqZ5niiKommapqqyLE3zPFEURdNUVVWFpnmeKIqiaaqq6sLzPE8URdE0VdV14XmeJ4qiaJqq6roQRVE0TdNUTVV1XSCKpmmaqqqqrgtETxRNU1Vd13WB54miaaqqq7ouEE3TVFVVdV1ZBpimaaqq68oyQFVV1XVdV5YBqqqqruu6sgxQVdd1XVmWZQCu67qyLMsCAAAOHAAAAoygk4wqi7DRhAsPQKEhKwKAKAAAwBimFFPKMCYhpBAaxiSEFEImJaXSUqogpFJSKRWEVEoqJaOUUmopVRBSKamUCkIqJZVSAADYgQMA2IGFUGjISgAgDwCAMEYpxhhzTiKkFGPOOScRUoox55yTSjHmnHPOSSkZc8w556SUzjnnnHNSSuacc845KaVzzjnnnJRSSuecc05KKSWEzkEnpZTSOeecEwAAVOAAABBgo8jmBCNBhYasBABSAQAMjmNZmuZ5omialiRpmud5niiapiZJmuZ5nieKqsnzPE8URdE0VZXneZ4oiqJpqirXFUXTNE1VVV2yLIqmaZqq6rowTdNUVdd1XZimaaqq67oubFtVVdV1ZRm2raqq6rqyDFzXdWXZloEsu67s2rIAAPAEBwCgAhtWRzgpGgssNGQlAJABAEAYg5BCCCFlEEIKIYSUUggJAAAYcAAACDChDBQashIASAUAAIyx1lprrbXWQGettdZaa62AzFprrbXWWmuttdZaa6211lJrrbXWWmuttdZaa6211lprrbXWWmuttdZaa6211lprrbXWWmuttdZaa6211lprrbXWWmstpZRSSimllFJKKaWUUkoppZRSSgUA+lU4APg/2LA6wknRWGChISsBgHAAAMAYpRhzDEIppVQIMeacdFRai7FCiDHnJKTUWmzFc85BKCGV1mIsnnMOQikpxVZjUSmEUlJKLbZYi0qho5JSSq3VWIwxqaTWWoutxmKMSSm01FqLMRYjbE2ptdhqq7EYY2sqLbQYY4zFCF9kbC2m2moNxggjWywt1VprMMYY3VuLpbaaizE++NpSLDHWXAAAd4MDAESCjTOsJJ0VjgYXGrISAAgJACAQUooxxhhzzjnnpFKMOeaccw5CCKFUijHGnHMOQgghlIwx5pxzEEIIIYRSSsaccxBCCCGEkFLqnHMQQgghhBBKKZ1zDkIIIYQQQimlgxBCCCGEEEoopaQUQgghhBBCCKmklEIIIYRSQighlZRSCCGEEEIpJaSUUgohhFJCCKGElFJKKYUQQgillJJSSimlEkoJJYQSUikppRRKCCGUUkpKKaVUSgmhhBJKKSWllFJKIYQQSikFAAAcOAAABBhBJxlVFmGjCRcegEJDVgIAZAAAkKKUUiktRYIipRikGEtGFXNQWoqocgxSzalSziDmJJaIMYSUk1Qy5hRCDELqHHVMKQYtlRhCxhik2HJLoXMOAAAAQQCAgJAAAAMEBTMAwOAA4XMQdAIERxsAgCBEZohEw0JweFAJEBFTAUBigkIuAFRYXKRdXECXAS7o4q4DIQQhCEEsDqCABByccMMTb3jCDU7QKSp1IAAAAAAADADwAACQXAAREdHMYWRobHB0eHyAhIiMkAgAAAAAABcAfAAAJCVAREQ0cxgZGhscHR4fICEiIyQBAIAAAgAAAAAggAAEBAQAAAAAAAIAAAAEBB9DtnUBAAAAAAAEPueBAKOFggAAgACjzoEAA4BwBwCdASqwAJAAAEcIhYWIhYSIAgIABhwJ7kPfbJyHvtk5D32ych77ZOQ99snIe+2TkPfbJyHvtk5D32ych77ZOQ99YAD+/6tQgKOFggADgAqjhYIAD4AOo4WCACSADqOZgQArADECAAEQEAAYABhYL/QACIBDmAYAAKOFggA6gA6jhYIAT4AOo5mBAFMAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCAGSADqOFggB6gA6jmYEAewAxAgABEBAAGAAYWC/0AAiAQ5gGAACjhYIAj4AOo5mBAKMAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCAKSADqOFggC6gA6jmYEAywAxAgABEBAAGAAYWC/0AAiAQ5gGAACjhYIAz4AOo4WCAOSADqOZgQDzADECAAEQEAAYABhYL/QACIBDmAYAAKOFggD6gA6jhYIBD4AOo5iBARsAEQIAARAQFGAAYWC/0AAiAQ5gGACjhYIBJIAOo4WCATqADqOZgQFDADECAAEQEAAYABhYL/QACIBDmAYAAKOFggFPgA6jhYIBZIAOo5mBAWsAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCAXqADqOFggGPgA6jmYEBkwAxAgABEBAAGAAYWC/0AAiAQ5gGAACjhYIBpIAOo4WCAbqADqOZgQG7ADECAAEQEAAYABhYL/QACIBDmAYAAKOFggHPgA6jmYEB4wAxAgABEBAAGAAYWC/0AAiAQ5gGAACjhYIB5IAOo4WCAfqADqOZgQILADECAAEQEAAYABhYL/QACIBDmAYAAKOFggIPgA6jhYICJIAOo5mBAjMAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCAjqADqOFggJPgA6jmYECWwAxAgABEBAAGAAYWC/0AAiAQ5gGAACjhYICZIAOo4WCAnqADqOZgQKDADECAAEQEAAYABhYL/QACIBDmAYAAKOFggKPgA6jhYICpIAOo5mBAqsAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCArqADqOFggLPgA6jmIEC0wARAgABEBAUYABhYL/QACIBDmAYAKOFggLkgA6jhYIC+oAOo5mBAvsAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCAw+ADqOZgQMjADECAAEQEAAYABhYL/QACIBDmAYAAKOFggMkgA6jhYIDOoAOo5mBA0sAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCA0+ADqOFggNkgA6jmYEDcwAxAgABEBAAGAAYWC/0AAiAQ5gGAACjhYIDeoAOo4WCA4+ADqOZgQObADECAAEQEAAYABhYL/QACIBDmAYAAKOFggOkgA6jhYIDuoAOo5mBA8MAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCA8+ADqOFggPkgA6jhYID+oAOo4WCBA+ADhxTu2sBAAAAAAAAEbuPs4EDt4r3gQHxghEr8IEK"),this.noSleepVideo.addEventListener("loadedmetadata",(function(){t.noSleepVideo&&(t.noSleepVideo.duration<=1?t.noSleepVideo.setAttribute("loop",""):(t.onTimeupdate=function(){t.noSleepVideo.currentTime>.5&&(t.noSleepVideo.currentTime=Math.random())},t.noSleepVideo.addEventListener("timeupdate",t.onTimeupdate)))})))}return l(e,[{key:"_addSourceToVideo",value:function(e,t,r){var i=document.createElement("source");i.src=r,i.type="video/".concat(t),e.appendChild(i)}},{key:"visible",get:function(){return"visible"===document.visibilityState}},{key:"isEnabled",get:function(){return this.enabled}},{key:"enable",value:function(){var e,t=this;if(k()&&this.visible)return navigator.wakeLock.request("screen").then((function(e){t._wakeLock=e,t.enabled=!0,t._wakeLock.addEventListener("release",(function(){}))})).catch((function(){t.enabled=!1}));if(T())return this.disable(),this.noSleepTimer=window.setInterval((function(){document.hidden||(window.location.href=window.location.href.split("#")[0],window.setTimeout(window.stop,0))}),15e3),this.enabled=!0,Promise.resolve();if(null!==(e=this.noSleepVideo)&&void 0!==e&&e.paused){var r=this.noSleepVideo.play();return r&&r.then((function(e){return t.enabled=!0,e})).catch((function(e){t.enabled=!1}))}}},{key:"disable",value:function(){k()?(this._wakeLock&&this._wakeLock.release(),this._wakeLock=null):T()?this.noSleepTimer&&(window.clearInterval(this.noSleepTimer),this.noSleepTimer=null):this.noSleepVideo.pause(),this.enabled=!1}},{key:"toPlay",value:function(){if(this.noSleepVideo&&this.noSleepVideo.paused){var e=performance.now();this.lastTs||(this.lastTs=e),e-this.lastTs>1e4&&(this.enable(),this.lastTs=e)}}},{key:"destroy",value:function(){this.disable(),this.handleVisibilityChange&&(document.removeEventListener("visibilitychange",this.handleVisibilityChange),document.removeEventListener("fullscreenchange",this.handleVisibilityChange)),this.onTimeupdate&&this.noSleepVideo.removeEventListener("timeupdate",this.onTimeupdate),this.noSleepVideo=null}}]),e}();function D(){if(!document.querySelector("#hackAudioPP")){var e=document.createElement("div");e.innerHTML="<audio id='hackAudioPP'></audio>",document.body.appendChild(e);var t=e.children.item(0);t.controls=!1,t.preload="auto",t.innerHTML="<source src=".concat("data:audio/mpeg;base64,//uQxAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAACAAACcQCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA//////////////////////////////////////////////////////////////////8AAABhTEFNRTMuMTAwA8MAAAAAAAAAABQgJAUHQQAB9AAAAnGMHkkIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//sQxAADgnABGiAAQBCqgCRMAAgEAH///////////////7+n/9FTuQsQH//////2NG0jWUGlio5gLQTOtIoeR2WX////X4s9Atb/JRVCbBUpeRUq//////////////////9RUi0f2jn/+xDECgPCjAEQAABN4AAANIAAAAQVTEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVQ==",' type="audio/mpeg"></source>'),t.muted=!0,t.loop=!0,t.play().catch((function(){}))}}function R(){var e=E||(E=document.querySelector("#hackAudioPP"));e?!1===e.paused&&!1===e.muted||(e.muted=!1,e.play().catch((function(e){console.log("bgAudio: ",e.message)}))):D()}var L=new(function(){function e(){var t=this;u(this,e);try{var r=/xgd=(\d)/.exec(document.cookie);this._status=!!r,this._level=r&&r[1]}catch(e){this._status=!1}["group","groupEnd","log","warn","error"].forEach((function(e){t[e]=function(r,i,n,a,s,o,u,d,l,c){var h;if(t._status){var f=r,A=[i,n,a,s,o,u,d,l,c].filter((function(e){return void 0!==e}));(h=console)[e].apply(h,["["+f+"]:"].concat(g(A)))}}}))}return l(e,[{key:"enable",get:function(){return this._status}},{key:"long",get:function(){return"2"===this._level}}]),e}());function C(e,t){if(e&&t){var r=new Uint8Array(e.byteLength+t.byteLength+11);r[0]=1,r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=255,r[5]=225;var i=6;return r.set(new Uint8Array([e.byteLength>>>8&255,255&e.byteLength]),i),i+=2,r.set(e,i),r[i+=e.byteLength]=1,i++,r.set(new Uint8Array([t.byteLength>>>8&255,255&t.byteLength]),i),i+=2,r.set(t,i),r}}var w="xg-video",I=!1;try{I=WebAssembly&&WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11]))}catch(e){}var x={preloadDecoder:"",reuseWasmDecoder:!0,reuseMseForAudio:!1,preciseSeek:0,h264WithWebcodec:!0,lowDecodeThreshold:100,lowDecodeFpsDelta:10,wasmFallbackToAsm:!1,audioWithMse:!0,canUseThreadMode:!1,disabledWhenErrorOccur:!0,disabledDuration:43200,evaluateVVCount:0,disabledByLowdecodePrecent:.5,maxDecodeOnceWasm:I?6:8,maxDecodeOnceFirstTime:8,maxDecodeOnceWebcodec:20};function P(){return w}function F(){return x}function O(){var e="undefined"!=typeof customElements&&customElements.get(w);return e?{H264_DECODER_URL:e.h264Url,ASM_H264_DECODER_URL:e.h264AsmUrl,H265_DECODER_URL:e.h265Url,H265_THREAD_DECODER_URL:e.h265ThreadUrl,H265_SIMD_DECODER_URL:e.h265SimdUrl,ASM_H265_DECODER_URL:e.h265AsmUrl}:{}}function M(){if("undefined"==typeof customElements)return!1;var e=customElements.get(w);return I&&!(null==e||!e.h265SimdUrl)}function B(){if("undefined"==typeof customElements)return!1;var e=customElements.get(w);return!!window.SharedArrayBuffer&&!(null==e||!e.h265ThreadUrl)}var G=!1;try{var N,V;G="1"===(null===(N=localStorage)||void 0===N||null===(V=N.getItem)||void 0===V?void 0:V.call(N,"_sds"))}catch(e){}var U=0,Z=0,W=0,j=!1;function X(e){localStorage.setItem("xgv_dis",e),2===e&&localStorage.setItem("xgv_dist",(new Date).getTime())}function Y(){localStorage.removeItem("xgv_dist"),localStorage.removeItem("xgv_dis")}var H=r(42990),Q=r.n(H),K=0,z=1,J=3,q=4,$=5,ee=6,te=7,re=8,ie=9,ne=10,ae=11,se=12,oe=13,ue=14,de=15,le=18,ce=19,he=20,fe=["waiting","canplay","play","playing","pause","seeking","seeked","loadeddata","loadedmetadata","timeupdate","durationchange","volumechange","progress","error","ended","resize","loadstart","decodefps","lowdecode","largeavgap","firstframe"],Ae="audio_ready",pe="audio_not_allowed_autoplay",ve="audio_waiting",me="video_decode_init",ge="video_ready",ye="video_waiting",be="auto_run",_e="decode_low_fps",Ee="update_video_filltype",Te="update_video_cover_position",ke="play_event",Se="set_metadata",De="append_chunks",Re="start_render",Le="do_play",Ce="do_pause",we="do_seek",Ie="set_playbackrate",xe="sync_dts",Pe="reset_base_dts",Fe="update_volume",Oe="single_track",Me="destroy",Be="ready",Ge="update_gl_options",Ne="set_video_duration",Ve="set_play_mode",Ue="inner_degrade",Ze="chase_frame",We="end_of_stream",je="update_segment_end",Xe="decoderready",Ye="remux",He="playfailed",Qe="fragmentEnd",Ke="appendVideo",ze="firstFrame",Je="decoded",qe="chaseVideoFrame",$e="chaseVideoFrameEnd",et="chaseAudioFrame",tt=function(e){h(r,e);var t=v(r);function r(e,i){var n;return u(this,r),(n=t.call(this))._config=e,n._parent=i,n._meta=null,n._ready=!1,n._isLive=!0,n._innerDegrade=!1,n._singleTrack=-1,n}return l(r,[{key:"analyse",get:function(){return this._parent.analyse}},{key:"isLive",get:function(){return this._isLive}},{key:"innerDegrade",get:function(){return this._innerDegrade}},{key:"noAudio",get:function(){return 1===this._singleTrack||2===this._singleTrack}},{key:"noVideo",get:function(){return 3===this._singleTrack}},{key:"duration",get:function(){return this._timeRange.duration},set:function(e){this._timeRange&&(this._timeRange.duration=e)}},{key:"_bindEvents",value:function(){var e=this;this._parent.on(De,this._appendChunk.bind(this)),this._parent.on(Pe,this._resetDts.bind(this)),this._parent.on(Re,this._startRender.bind(this)),this._parent.on(Le,this._doPlay.bind(this)),this._parent.on(Ce,this._doPause.bind(this)),this._parent.on(we,this._doSeek.bind(this)),this._parent.on(Me,this._destroy.bind(this)),this._parent.on(Ze,this._doChaseFrame.bind(this)),this._parent.on(Oe,(function(t){e._singleTrack=t})),this._parent.on(Ve,(function(t){e._isLive="LIVE"===t})),this._parent.on(Ue,(function(){e._innerDegrade=!0})),this._parent.on(Ne,(function(t){e.duration=t}))}}]),r}(Q()),rt=function(){function e(t){u(this,e),this.TAG="AudioTimeRange",this._parent=t,this._buffers=[],this._duration=0,this._baseDts=0,this._lastBuffer=null}return l(e,[{key:"isLive",get:function(){return this._parent.isLive}},{key:"duration",get:function(){return this._duration},set:function(e){this._duration=e}},{key:"buffered",get:function(){var e=this;if(this.isLive)return{length:this._duration?1:0,start:function(){return 0},end:function(){return e._duration}};var t=this._mergeBufferRanges();return{length:t.length,start:function(e){var r=t[e];return r?r.start:0},end:function(e){var r=t[e];return r?r.end:1/0}}}},{key:"resetDts",value:function(e){this._baseDts=e}},{key:"_transitionSamples",value:function(e){for(var t=e.numberOfChannels,r=e.length,i=512,n=0;n<t;n++){for(var a=e.getChannelData(n),s=0;s<i;s++)a[s]=a[s]*s/i;for(var o=r-i;o<r;o++)a[o]=a[o]*(r-o)/i}}},{key:"append",value:function(e,t,r,i){-1===this._baseDts&&(this._baseDts=r),this._transitionSamples(e);var n=(r-this._baseDts)/1e3,a=n+t,s={start:n,end:a,startDts:r,source:e,duration:t,delay:i};if(L.log(this.TAG,"add new buffer range, startDts:".concat(r,", [").concat(s.start," , ").concat(s.end,"]")),!this._buffers.filter((function(e){return e.start===n})).length)return this._buffers.push(s),this.isLive&&(this._duration=a),s.start;console.error("音频重复")}},{key:"deletePassed",value:function(e){return this._buffers=this._buffers.filter((function(t){return t.start>=e})),this._buffers[0]}},{key:"canSeek",value:function(e){var t=this._buffers[this._buffers.length-1];return!(!t||t.start<e)}},{key:"_mergeBufferRanges",value:function(){var e=this._buffers.slice().sort((function(e,t){return e.start>t.start?1:-1})),t=e.length,r=[];if(!t)return r;for(var i={start:e[0].start,end:e[0].end},n=1;n<t;n++){var a=e[n];Math.abs(i.end-a.start)<.5?i.end=a.end:(r.push(i),i={start:a.start,end:a.end})}return r.push(i),r}},{key:"getBuffer",value:function(e){if(this.isLive)return this._buffers.shift();var t=this._buffers.filter((function(t){return t.start<e+.5&&t.end>e+.5}))[0];return L.log(this.TAG,"get audio buffer , currentTime:".concat(e," ,buffer:[").concat(t&&t.start," , ").concat(t&&t.end,"]")),0!==e||t?t:this._buffers[0]}},{key:"hasBuffer",value:function(){var e;return!(null===(e=this._buffers)||void 0===e||!e.length)}}]),e}(),it=[-5504,-5248,-6016,-5760,-4480,-4224,-4992,-4736,-7552,-7296,-8064,-7808,-6528,-6272,-7040,-6784,-2752,-2624,-3008,-2880,-2240,-2112,-2496,-2368,-3776,-3648,-4032,-3904,-3264,-3136,-3520,-3392,-22016,-20992,-24064,-23040,-17920,-16896,-19968,-18944,-30208,-29184,-32256,-31232,-26112,-25088,-28160,-27136,-11008,-10496,-12032,-11520,-8960,-8448,-9984,-9472,-15104,-14592,-16128,-15616,-13056,-12544,-14080,-13568,-344,-328,-376,-360,-280,-264,-312,-296,-472,-456,-504,-488,-408,-392,-440,-424,-88,-72,-120,-104,-24,-8,-56,-40,-216,-200,-248,-232,-152,-136,-184,-168,-1376,-1312,-1504,-1440,-1120,-1056,-1248,-1184,-1888,-1824,-2016,-1952,-1632,-1568,-1760,-1696,-688,-656,-752,-720,-560,-528,-624,-592,-944,-912,-1008,-976,-816,-784,-880,-848,5504,5248,6016,5760,4480,4224,4992,4736,7552,7296,8064,7808,6528,6272,7040,6784,2752,2624,3008,2880,2240,2112,2496,2368,3776,3648,4032,3904,3264,3136,3520,3392,22016,20992,24064,23040,17920,16896,19968,18944,30208,29184,32256,31232,26112,25088,28160,27136,11008,10496,12032,11520,8960,8448,9984,9472,15104,14592,16128,15616,13056,12544,14080,13568,344,328,376,360,280,264,312,296,472,456,504,488,408,392,440,424,88,72,120,104,24,8,56,40,216,200,248,232,152,136,184,168,1376,1312,1504,1440,1120,1056,1248,1184,1888,1824,2016,1952,1632,1568,1760,1696,688,656,752,720,560,528,624,592,944,912,1008,976,816,784,880,848],nt=[-32124,-31100,-30076,-29052,-28028,-27004,-25980,-24956,-23932,-22908,-21884,-20860,-19836,-18812,-17788,-16764,-15996,-15484,-14972,-14460,-13948,-13436,-12924,-12412,-11900,-11388,-10876,-10364,-9852,-9340,-8828,-8316,-7932,-7676,-7420,-7164,-6908,-6652,-6396,-6140,-5884,-5628,-5372,-5116,-4860,-4604,-4348,-4092,-3900,-3772,-3644,-3516,-3388,-3260,-3132,-3004,-2876,-2748,-2620,-2492,-2364,-2236,-2108,-1980,-1884,-1820,-1756,-1692,-1628,-1564,-1500,-1436,-1372,-1308,-1244,-1180,-1116,-1052,-988,-924,-876,-844,-812,-780,-748,-716,-684,-652,-620,-588,-556,-524,-492,-460,-428,-396,-372,-356,-340,-324,-308,-292,-276,-260,-244,-228,-212,-196,-180,-164,-148,-132,-120,-112,-104,-96,-88,-80,-72,-64,-56,-48,-40,-32,-24,-16,-8,0,32124,31100,30076,29052,28028,27004,25980,24956,23932,22908,21884,20860,19836,18812,17788,16764,15996,15484,14972,14460,13948,13436,12924,12412,11900,11388,10876,10364,9852,9340,8828,8316,7932,7676,7420,7164,6908,6652,6396,6140,5884,5628,5372,5116,4860,4604,4348,4092,3900,3772,3644,3516,3388,3260,3132,3004,2876,2748,2620,2492,2364,2236,2108,1980,1884,1820,1756,1692,1628,1564,1500,1436,1372,1308,1244,1180,1116,1052,988,924,876,844,812,780,748,716,684,652,620,588,556,524,492,460,428,396,372,356,340,324,308,292,276,260,244,228,212,196,180,164,148,132,120,112,104,96,88,80,72,64,56,48,40,32,24,16,8,0],at=new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]),st=function(e,t){if("g7110a"===t)return function(e){for(var t=new Uint8Array(2*e.length),r=0,i=0;r<e.length;){var n=it[e[r]];if(void 0===n)throw new Error("can not decode g711 alaw data!");t[i]=255&n,t[i+1]=n>>8,r+=1,i+=2}return t}(e);if("g7110m"===t)return function(e){for(var t=new Uint8Array(2*e.length),r=0,i=0;r<e.length;){var n=nt[e[r]];if(void 0===n)throw new Error("can not decode g711 ulaw data!");t[i]=255&n,t[i+1]=n>>8,r+=1,i+=2}return t}(e);throw new Error("no supported format=".concat(t," for g711"))},ot=function(e,t,r,i,n){for(var a,s=function(e,t,r){return e/t/r}(t.byteLength,r,n),o=e.createBuffer(r,s,i),u=new DataView(t),d=0;d<r;d++)for(var l=o.getChannelData(d),c=void 0,h=0;h<s;h++)c=u.getUint16(h*(2*r)+2*d,!0),l[h]=(a=c)>=32768?-(65536-a)/32768:a/32767;return{audioBuffer:o,duration:s/i}},ut=function(e,t){var r=new Uint8Array(t.data.byteLength+7),i=function(e,t){var r=e.sampleRateIndex,i=e.channelCount;r=function(e,t){var r=(7&e[0])<<1|e[1]>>>7;return r!==t?r:t}(e.config,r);var n=new Uint8Array(7);n[0]=255,n[1]=240,n[1]=1|n[1],n[2]=64,n[2]=n[2]|60&r<<2,n[2]=n[2]|1&i>>2,n[3]=192&i<<6;var a=t.byteLength+7;return n[3]=n[3]|3&a>>11,n[4]=255&a>>3,n[5]=224&a<<5,n[5]=31|n[5],n[6]=252,n}(e,t.data);return r.set(i),r.set(t.data,7),r},dt=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=0,i=0,n=e.length;i<n;i++)t&&i%t==0||(r+=e[i].byteLength);for(var a=new Uint8Array(r),s=0,o=0,u=e.length;o<u;o++)t&&o%t==0||(a.set(e[o],s),s+=e[o].byteLength);return a},lt=function(e){var t=e[0].dts,r=e.filter((function(e){return e.dts===t})).length;if(!(r<=1))for(var i=0;i<r;i++)e[i].data=at},ct=function(e){h(n,e);var t,r,i=v(n);function n(e,t){var r;return u(this,n),c(p(r=i.call(this,e,t)),"doPause",r._doPause),r.TAG="AudioRender",r._timeRange=new rt(p(r)),r._lastTimeLineTime=0,r._sampleQueue=[],r._source=null,r._audioCanAutoplay=!0,r._lastBuffer=null,r._inDecoding=!1,r._endOfStream=!1,r._delay=0,r._isSourceBufferEnd=-1,r._onSourceBufferEnded=r._onSourceBufferEnded.bind(p(r)),r._initAudioCtx(e.volume||.6),r._bindEvents(),r}return l(n,[{key:"baseDts",get:function(){return this._timeRange._baseDts}},{key:"currentTime",get:function(){return this._audioCtx?this._lastTimeLineTime+this._audioCtx.currentTime:0}},{key:"preloadTime",get:function(){return this.isLive?1:0}},{key:"timescale",get:function(){return 1e3}},{key:"buffered",get:function(){return this._timeRange.buffered}},{key:"ctxState",get:function(){return this._audioCtx.state}},{key:"audioCanAutoplay",get:function(){return this._audioCanAutoplay}},{key:"resume",value:function(){if(this._audioCtx&&"suspended"===this._audioCtx.state)return this._audioCtx.resume().catch((function(e){}))}},{key:"canSeek",value:function(e){return this._timeRange.canSeek(e)}},{key:"_assembleErr",value:function(e){var t=new Error(e);return t.code=3,t}},{key:"_emitTimelineEvents",value:function(e,t,r){var i,n;null===(i=this._parent)||void 0===i||null===(n=i.emit)||void 0===n||n.call(i,e,t,r)}},{key:"_initAudioCtx",value:function(e){var t=this;L.log(this.TAG,"init audioCtx");var r=window.AudioContext||window.webkitAudioContext;return this._audioCtx=new r,this._audioCtx?(this._gainNode=this._audioCtx.createGain(),this._gainNode.gain.value=e,this._gainNode.connect(this._audioCtx.destination),this._audioCanAutoplay="running"===this._audioCtx.state,L.log(this.TAG,"webAudio state:",this._audioCtx.state),D(),this._bindAudioCtxEvent(),this._audioCtx.suspend()):(L.warn(this.TAG,"create webaudio error!"),void setTimeout((function(){t._emitTimelineEvents(ke,oe,t._assembleErr("create new AudioContext error"))})))}},{key:"_bindAudioCtxEvent",value:function(){var e=this;this._onStateChange=function(){e._audioCtx&&"running"===e._audioCtx.state&&e._ready&&e._emitTimelineEvents(ke,J)},this._audioCtx.addEventListener("statechange",this._onStateChange)}},{key:"_bindEvents",value:function(){var e=this;m(f(n.prototype),"_bindEvents",this).call(this),this._parent.on(et,this._doChaseFrame.bind(this)),this._parent.on(Fe,(function(t){e._gainNode&&(e._gainNode.gain.value=Number.isFinite(t)?t:1,e._emitTimelineEvents(ke,ae))})),this._parent.on(We,(function(){var t;e._endOfStream=!0,e.noAudio||null!==(t=e._timeRange)&&void 0!==t&&t.hasBuffer()||null==e||e._emitTimelineEvents(ke,ue)}))}},{key:"_appendChunk",value:function(e,t){if(!this.noAudio){this._meta||(this._meta=t,L.warn(this.TAG,"audio set metadata",this._meta));var r=t.samples;if(r.length)if(this._sampleQueue=this._sampleQueue.concat(r),t.samples=[],"aac"===this._meta.codecType){if(this._inDecoding)return;this._decodeAACWrapper()}else this._decodeG711()}}},{key:"_resetDts",value:function(e,t){"video"!==t&&this._timeRange.resetDts(e)}},{key:"_doPlay",value:function(){this.noAudio||this._parent.seeking||(this._source||!this.currentTime?this.resume():this._startRender())}},{key:"_doPause",value:function(){this.noAudio||this._audioCtx.suspend()}},{key:"_reInitAudioCtx",value:function(e){var t=this;if(this._lastTimeLineTime=e,this._lastBuffer=null,this._lastAudioBufferInfo=null,this._delay=0,!this._ready||!this._audioCtx.currentTime)return Promise.resolve();var r=this._gainNode.gain.value;return this._audioCtx.close().then((function(){return t._audioCtx.removeEventListener("statechange",t._onStateChange),t._audioCtx=null,t._source&&t._source.removeEventListener("ended",t._onSourceBufferEnded),t._source=null,t._initAudioCtx(r)}))}},{key:"_doSeek",value:function(e){var t=this;this._reInitAudioCtx(e).then((function(){t._getAudioBuffer(!0)})).catch((function(e){}))}},{key:"_doChaseFrame",value:function(e){var t=this,r=e.position,i=this._timeRange.deletePassed(r);i&&(L.log(this.TAG,"_doChaseFrame","startTime:",i.start,"buffeLength:",this.buffered.end(0)-i.start),this._reInitAudioCtx(i.start).then((function(){t._startRender(),t._emitTimelineEvents(ke,ie)})).catch((function(e){})))}},{key:"_decodeAACWrapper",value:(r=o(a().mark((function e(){var t,r,i,n,s,o,u,d,l,c;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this._sampleQueue.length,r=this._sampleQueue[0],i=this._sampleQueue[t-1],!((n=(i.dts-r.dts)/this.timescale)<1)){e.next=6;break}return e.abrupt("return");case 6:for(s=parseInt(n/3-1)||1,o=parseInt(t/s),u=[],d=0;d<s;d++)d<s-1?u.push(this._sampleQueue.slice(d*o,(d+1)*o)):u.push(this._sampleQueue.slice(d*o));return this._sampleQueue=[],this._inDecoding=!0,e.prev=12,e.next=15,this._decodeCycle(u);case 15:this._isLive||(l=this._timeRange._buffers,(c=l[l.length-1])&&this._emitTimelineEvents(je,c.end)),e.next=21;break;case 18:e.prev=18,e.t0=e.catch(12),this._emitTimelineEvents(ke,oe,this._assembleErr("ERROR_MSG.DECODE_ERR:".concat(e.t0&&e.t0.message)));case 21:this._inDecoding=!1;case 22:case"end":return e.stop()}}),e,this,[[12,18]])}))),function(){return r.apply(this,arguments)})},{key:"_decodeCycle",value:(t=o(a().mark((function e(t){var r;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.shift()){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,this._decodeAAC(r);case 5:return e.next=7,this._decodeCycle(t);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"_decodeAAC",value:function(e){var t=this,r=e[0],i=0;lt(e);var n=e.map((function(e){return ut(t._meta,e)})),a=dt(n,0);return new Promise((function(e,n){var s=t._audioCtx.decodeAudioData(a.buffer,(function(n){if(t._timeRange){if(t._lastAudioBufferInfo&&t.isLive){var a=t._lastAudioBufferInfo,s=a.dts+a.duration;(i=r.dts-s)>1&&(t._timeRange._duration+=i/1e3,L.log(t.TAG,"_decodeAAC","audio data dts is not continue, last end dts:",s,",now start Dts:",r.dts,"delay:",i))}t._lastAudioBufferInfo={duration:Math.floor(1e3*n.duration),dts:r.dts};var o=t._timeRange.append(n,n.duration,r.dts,i/1e3);if(!t._ready){var u=Math.abs(o+n.duration-t.currentTime)<.5;(t.isLive||!u)&&(t._ready=!0,L.log(t.TAG,"_decodeAAC","set ready true start=",o),t.emit(Ae,o))}t._emitTimelineEvents(ke,se),t._emitTimelineEvents(ke,ne),e()}}),n);s.catch&&s.catch(n)}))}},{key:"_decodeG711",value:function(){var e=this._sampleQueue.length,t=this._sampleQueue[0];if(!((this._sampleQueue[e-1].dts-t.dts)/this.timescale<.5)){var r=this._sampleQueue.reduce((function(e,t){return e+t.data.byteLength}),0),i=new Uint8Array(r),n=0,a=0;this._sampleQueue.forEach((function(e,t){0===t&&(n=e.dts),i.set(e.data,a),a+=e.data.byteLength})),this._sampleQueue=[];try{var s=this._meta,o=s.codecType,u=s.channelCount,d=s.sampleSize,l=s.sampleRate,c=st(i,o),h=ot(this._audioCtx,c.buffer,u,l,d/8),f=h.audioBuffer,A=h.duration,p=this._timeRange.append(f,A,n,0);this._ready||(this._ready=!0,L.log(this.TAG,"_decodeG711","set ready true"),this.emit(Ae,p)),this._emitTimelineEvents(ke,se),this._emitTimelineEvents(ke,ne)}catch(e){this._emitTimelineEvents(ke,oe,this._assembleErr("ERROR_MSG.DECODE_ERR:".concat(e&&e.message)))}}}},{key:"_onSourceBufferEnded",value:function(){this._isSourceBufferEnd=!0,L.long&&L.log(this.TAG,"source play end! currentTime:".concat(this.currentTime," , duration:").concat(this.duration)),this._startRender()}},{key:"_ajustSeekTime",value:function(e){var t=this._timeRange.getBuffer(e,0);t&&(L.log(this.TAG,"ajust seek time to:",t.start),this._lastTimeLineTime=t.start)}},{key:"_getAudioBuffer",value:function(e){var t=this;if(this._timeRange){var r=this._timeRange.getBuffer(this._lastBuffer?this._lastBuffer.end:this.currentTime,0);return r?e?(this._ajustSeekTime(r.start),void this.emit(Ae)):r:(this._endOfStream||!this._isLive)&&this.currentTime-this.duration>-.5?(this._emitTimelineEvents(ke,ie),void this._emitTimelineEvents(ke,ue)):(this._ready=!1,this._audioCtx.suspend(),this.emit(ve),void(e&&(this._onAudioReady||(this._onAudioReady=function(e){t._ajustSeekTime(e)}),this.removeListener(Ae,this._onAudioReady),this.once(Ae,this._onAudioReady))))}}},{key:"_startRender",value:function(e){if(!this.noAudio){if("video"===e&&this.isLive&&this._ready&&!this._isSourceBufferEnd)return console.log(this.TAG,"_startRender, audio currentTime",this.currentTime,"from:",e,"_isSourceBufferEnd:",this._isSourceBufferEnd,"ready:",this._ready),void this._doPlay();var t=this._getAudioBuffer();if(t){"suspended"===this._audioCtx.state&&(this._audioCtx.resume().catch((function(e){})),R()),this._lastBuffer=t,this._source=null;var r=this._audioCtx.createBufferSource();r.buffer=t.source,r.loop=!1,this._source=r,r.addEventListener("ended",this._onSourceBufferEnded),r.connect(this._gainNode),t.delay&&t.delay>.001&&(this._delay+=t.delay),this.startDts=t.startDts;try{this._isSourceBufferEnd=!1,r.start()}catch(e){}t.startDts&&this._emitTimelineEvents(xe,t.startDts)}}}},{key:"_destroy",value:function(){L.log(this.TAG,"destroy audio..."),this._source&&this._source.removeEventListener("ended",this._onSourceBufferEnded),this._audioCtx&&"closed"!==this.ctxState&&this._audioCtx.close(),this._audioCtx=null,this._sampleQueue=null,this._timeRange=null,this._parent=null,this.removeAllListeners()}}]),n}(tt),ht=r(25324),ft=r(10167),At={"mp4a.40.5":1,"mp4a.40.2":2},pt=.05,vt=function(){function e(){u(this,e),c(this,"_queue",[]),"undefined"!=typeof document&&(this._tempMedia=document.createElement("video"))}return l(e,[{key:"tempMedia",get:function(){return this._tempMedia}},{key:"hasCached",get:function(){return-1!==this._queue.findIndex((function(e){return 1===e.codec}))&&-1!==this._queue.findIndex((function(e){return 2===e.codec}))}},{key:"getCachedMedia",value:function(e){var t=this._queue.findIndex((function(t){return t.codec===e}));return-1!==t?this._queue.splice(t,1)[0]:null}},{key:"cacheMedia",value:function(e){var t=e.codec,r=e.media,i=e.mse,n=At[t];if(this._queue=this._queue.filter((function(e){var t;return e.mse&&!e.mse.isOpened&&e.mse.unbindMedia(),null===(t=e.mse)||void 0===t?void 0:t.isOpened})),!t||this._queue.filter((function(e){return e.codec===n})).length>2)return null==i||i.endOfStream(),void(null==i||i.unbindMedia());this._queue.push({codec:n,media:r,mse:i})}}]),e}(),mt=new vt,gt=function(e){h(d,e);var t,r,i,s=v(d);function d(e,t){var r;return u(this,d),c(p(r=s.call(this,e,t)),"_media",void 0),c(p(r),"_isTempMedia",!1),c(p(r),"_mse",void 0),c(p(r),"_remuxer",null),c(p(r),"_codec",""),c(p(r),"_sourceCreated",!1),c(p(r),"_needInitSegment",!0),c(p(r),"_seekNoSideEffect",!1),c(p(r),"_startRendered",!1),c(p(r),"_firstTimeAppendedBuffer",!1),c(p(r),"_sampleQueue",[]),c(p(r),"_inProcessing",!1),c(p(r),"_duration",0),c(p(r),"_mediaCache",mt),c(p(r),"_resetDts",(function(){})),c(p(r),"_onCanplay",(function(){r._ready||(r._ready=!0,r.emit(Ae))})),c(p(r),"_onPlaying",(function(){r._parent.ready&&(r._audioCanAutoplay=!0,r._emitTimelineEvents(ke,J))})),c(p(r),"_onWaiting",(function(){if(!r._seekNoSideEffect){try{for(var e,t=r._media.buffered,i=r._media.currentTime,n=0,a=0,s=t.length;a<s;a++)t.start(a)<i&&t.end(a)>i&&(n=t.end(a)-i);if(Math.abs(n)>.5)return;if(Math.abs(r._media.duration-r._media.currentTime)<.3)return r._reuseMse||r._mse.endOfStream(),void(null===(e=p(r))||void 0===e||e._emitTimelineEvents(ke,ue))}catch(e){}r._ready=!1,r.emit(ve)}})),c(p(r),"_onSeeked",(function(){r._seekNoSideEffect||r._isLive?r._seekNoSideEffect=!1:(L.log(r.TAG,"seeked"),r._ready||(r._media.pause(),r._ready=!0,r.emit(Ae)))})),c(p(r),"_onProgress",(function(){if(r._media.readyState<=1){var e=r._getBufferGap();e>0&&e<1&&(r._media.currentTime+=e+pt,L.warn(r.TAG,"progress, gap=",e))}r._emitTimelineEvents(ke,se),r._emitTimelineEvents(ke,ne)})),c(p(r),"_onEnded",(function(){var e;L.log(r.TAG,"ended!"),null===(e=p(r))||void 0===e||e._emitTimelineEvents(ke,ue)})),c(p(r),"_onOnceProgress",(function(){if(r._media.buffered.length){var e=r._media.buffered.start(0);e&&(r._media.currentTime=e+pt,L.log(r.TAG,"start gap:",e)),r._media.removeEventListener("progress",r._onOnceProgress)}})),c(p(r),"_onError",(function(){var e;r._emitTimelineEvents(ke,oe,r._assembleErr("audio error: ".concat(null===(e=r._media.error)||void 0===e?void 0:e.message),3))})),c(p(r),"_appendChunk",(function(e,t){if(!r.noAudio&&t.samples.length){if(r._codec||(2!==t.objectType&&5!==t.objectType?r._codec="mp4a.40.5":r._codec=t.codec,r._isTempMedia&&r._switchMedia(r._codec)),t.samples.forEach((function(e){e.baseMediaDecodeTime=t.baseMediaDecodeTime,r._sampleQueue.push(e)})),t.samples=[],!r._meta)return r._meta=n(n({},t),{},{exist:function(){return!0},hasSample:function(){return!0},samples:[]}),L.warn(r.TAG,"audio set metadata",r._meta),void r._doAppendWrapper();r._meta.sampleRate!==t.sampleRate&&(L.warn(r.TAG,"discontinue: ".concat(r._meta.sampleRate," -> ").concat(t.sampleRate)),r._needInitSegment=!0,Object.keys(t).forEach((function(e){r._meta[e]=t[e]}))),!r._inProcessing&&r._sampleQueue.length&&r._doAppendWrapper()}})),c(p(r),"_doAppend",function(){var e=o(a().mark((function e(t){var i,n,s;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r._remuxer||(r._remuxer=new ht.s({samples:[],exist:function(){return!1}},t)),i=t.samples,r._sourceCreated){e.next=12;break}return r.analyse.addAudioMseOpenStart(),e.next=6,r._mse.open();case 6:r._sourceCreated=!0,L.log(r.TAG,"video/mp4;codecs=".concat(r._codec)),r._mse.createSource(t.type,"video/mp4;codecs=".concat(r._codec)),r.analyse.addAudioMseOpend(),L.log(r.TAG,"sb created!"),r._checkAutoPlay();case 12:if(n=r._remuxer.remux(r._needInitSegment),!r._needInitSegment||n.audioInitSegment){e.next=15;break}return e.abrupt("return");case 15:return r._needInitSegment=!1,s=[],n.audioInitSegment&&s.push(r._mse.append(t.type,n.audioInitSegment)),n.audioSegment&&s.push(r._mse.append(t.type,n.audioSegment)),e.abrupt("return",Promise.all(s).then((function(){return i[i.length-1].dts/1e3})).then((function(){r._firstTimeAppendedBuffer||(r._firstTimeAppendedBuffer=!0,r.analyse.addAudioFirstTimeAppended())})));case 20:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),c(p(r),"_doPlay",(function(){r._media.play().catch((function(){}))})),c(p(r),"_doPause",(function(){r._media.pause()})),c(p(r),"_doSeek",(function(e){r._ready=!1,r._media.currentTime=e})),c(p(r),"_doChaseFrame",(function(e){var t=e.position;r._seekNoSideEffect=!0,r._media.currentTime=t})),c(p(r),"_startRender",(function(){L.log(r.TAG,"start render"),r._startRendered=!0,r._media.play().catch((function(){}))})),r.TAG="AudioMseRender",r._reuseMse=F().reuseMseForAudio,r._initMedia(),r}return l(d,[{key:"isMse",get:function(){return!0}},{key:"media",get:function(){return this._media}},{key:"currentTime",get:function(){return this._media.currentTime}},{key:"buffered",get:function(){return this._media.buffered}},{key:"duration",get:function(){return Number.isNaN(this._media.duration)?1/0:this._media.duration},set:function(e){this._duration=e,this._updateDuration(e)}},{key:"audioCanAutoplay",get:function(){return this._audioCanAutoplay||this.noAudio}},{key:"_initMedia",value:function(){if(!this._reuseMse||!mt.hasCached)return L.log(this.TAG,"init media and mse directly"),this._media=document.createElement("video"),this._media.autoplay=!0,this._mse=new ft.Ub,this._bindEvents(),this._bindMediaEvents(),void this._mse.bindMedia(this._media);L.log(this.TAG,"bind media temporary"),this._media=mt.tempMedia,this._bindEvents(),this._isTempMedia=!0}},{key:"_switchMedia",value:function(e){var t=this._media,r=mt.getCachedMedia(At[e]);r?(L.warn(this.TAG,"switch to cached media for audio play! codec=".concat(e)),this._media=r.media,this._mse=r.mse,this._bindMediaEvents(),this._updateDuration(this._duration),this._media.currentTime=pt,this._sourceCreated=!0,this._audioCanAutoplay=!0,this.analyse.addAudioMseOpend()):this._initMedia(),this._media.volume=t.volume,this._media.playbackRate=t.playbackRate,this._isTempMedia=!1}},{key:"_getBufferGap",value:function(){for(var e=this.buffered,t=0,r=e.length;t<r;t++)if(!(e.end(t)<this.currentTime))return e.start(t)-this.currentTime;return 0}},{key:"canSeek",value:function(){return!0}},{key:"resume",value:function(){return this._media.play()}},{key:"pause",value:function(){return this._media.pause()}},{key:"seekNoSideEffect",value:function(e){this._doChaseFrame(e)}},{key:"dump",value:function(){}},{key:"_emitTimelineEvents",value:function(e,t,r){var i,n;null===(i=this._parent)||void 0===i||null===(n=i.emit)||void 0===n||n.call(i,e,t,r)}},{key:"_assembleErr",value:function(e,t){var r=new Error(e);return r.code=3,r.subCode=t,r}},{key:"_bindEvents",value:function(){var e=this;m(f(d.prototype),"_bindEvents",this).call(this),this._parent.on(et,this._doChaseFrame),this._parent.on(Fe,(function(t){e._media.volume=t,e._emitTimelineEvents(ke,ae)})),this._parent.on(We,(function(){var t;e.reuseMseForAudio||!e._media.readyState?null==e||e._emitTimelineEvents(ke,ue):null===(t=e._mse)||void 0===t||t.endOfStream()})),this._parent.on(Ie,(function(t){L.log(e.TAG,"change playbackrate, ",t),e._media.playbackRate=t}))}},{key:"_bindMediaEvents",value:function(){this._media.addEventListener("canplay",this._onCanplay),this._media.addEventListener("playing",this._onPlaying),this._media.addEventListener("waiting",this._onWaiting),this._media.addEventListener("seeked",this._onSeeked),this._media.addEventListener("progress",this._onProgress),this._media.addEventListener("ended",this._onEnded),this._media.addEventListener("progress",this._onOnceProgress),this._media.addEventListener("error",this._onError)}},{key:"_updateDuration",value:(i=o(a().mark((function e(t){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._mse){e.next=7;break}if(this._mse.isOpened){e.next=4;break}return e.next=4,this._mse.open();case 4:return e.next=6,this._mse.updateDuration(t);case 6:L.log(this.TAG,"update duration",t);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"_doAppendWrapper",value:(r=o(a().mark((function e(){var t;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._meta.samples=this._sampleQueue.slice(),this._meta.baseMediaDecodeTime=this._meta.samples[0].baseMediaDecodeTime,this._sampleQueue=[],e.prev=3,this._inProcessing=!0,e.next=7,this._doAppend(this._meta);case 7:if(t=e.sent,this.isLive&&this._emitTimelineEvents(je,t),this._inProcessing=!1,!this._sampleQueue.length){e.next=13;break}return e.next=13,this._doAppendWrapper();case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(3),this._emitTimelineEvents(ke,oe,this._assembleErr("audio error: ".concat(null===e.t0||void 0===e.t0?void 0:e.t0.message),3));case 18:case"end":return e.stop()}}),e,this,[[3,15]])}))),function(){return r.apply(this,arguments)})},{key:"_checkAutoPlay",value:function(){var e=this;this._media.addEventListener("canplay",(function t(){var r=e._media.volume;e._media.volume=Math.min(r,.1);var i=e._media.play();(i=i.then?i:Promise.reject()).then((function(){L.log(e.TAG,"auto play by checkAutoPlay!"),e._audioCanAutoplay=!0})).catch((function(){L.warn(e.TAG,"can’t auto play!"),e._audioCanAutoplay=!1,e.emit(pe)})).finally((function(){e._media.volume=r,e._startRendered||(e._media.pause(),L.log(e.TAG,"auto paused by checkAutoPlay!")),e._media.removeEventListener("canplay",t)}))}))}},{key:"_destroy",value:(t=o(a().mark((function e(){var t,r,i;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(L.log(this.TAG,"destroy audio render"),this._remuxer=null,this.removeAllListeners(),this._media.removeEventListener("canplay",this._onCanplay),this._media.removeEventListener("playing",this._onPlaying),this._media.removeEventListener("waiting",this._onWaiting),this._media.removeEventListener("seeked",this._onSeeked),this._media.removeEventListener("progress",this._onProgress),this._media.removeEventListener("ended",this._onEnded),this._media.removeEventListener("progress",this._onOnceProgress),this._media.removeEventListener("error",this._onError),this._reuseMse){e.next=17;break}return this._media.readyState&&(null===(r=this._mse)||void 0===r||r.endOfStream()),e.next=15,null===(t=this._mse)||void 0===t?void 0:t.unbindMedia();case 15:e.next=20;break;case 17:null===(i=this._mse)||void 0===i||i.clearAllBuffer(),mt.cacheMedia({codec:this._codec,media:this._media,mse:this._mse}),L.log(this.TAG,"cache media for audio play, codec=",this._codec);case 20:this._meta&&(this._meta.duration=0),this._mse=null,this._media=null;case 23:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}],[{key:"isSupported",value:function(){return F().audioWithMse&&!!window.MediaSource&&window.MediaSource.isTypeSupported('video/mp4; codecs="mp4a.40.5"')}}]),d}(tt),yt=function(){function e(t){u(this,e),this.TAG="VideoTimeRange",this._parent=t,this._baseDts=0,this._lastDuration=0,this._duration=0,this._bitrate=0,this._totalSize=0,this._buffers=[],this._currentFrameQueue=[],this._frameIndexInQueue=0,this._delayEstimateList=[],this._keyframeQueue=[]}return l(e,[{key:"isLive",get:function(){return this._parent.isLive}},{key:"baseDts",get:function(){return this._baseDts}},{key:"duration",get:function(){return this._duration},set:function(e){this._duration=e}},{key:"buffered",get:function(){var e=this;if(this.isLive)return{length:this._duration?1:0,start:function(){return 0},end:function(){var t;return(null===(t=e._currentFrameQueue[e._currentFrameQueue.length-1])||void 0===t?void 0:t.dts)/1e3}};var t=this._mergeBufferRanges();return{length:t.length,start:function(e){var r=t[e];return r?r.start:0},end:function(e){var r=t[e];return r?r.end:1/0}}}},{key:"bufferStart",get:function(){var e;return(null===(e=this._buffers[0])||void 0===e?void 0:e.start)||0}},{key:"frameLength",get:function(){return this._currentFrameQueue.length}},{key:"keyFrameLength",get:function(){return this._keyframeQueue.length}},{key:"totalSize",get:function(){return this._totalSize}},{key:"bitrate",get:function(){return this._bitrate},set:function(e){this._bitrate=e}},{key:"lastDuration",get:function(){return this._lastDuration}},{key:"frames",get:function(){return this._currentFrameQueue}},{key:"getCurrentTime",value:function(e){return this._lastDuration+(e-this._baseDts)/1e3}},{key:"resetDts",value:function(e){this._baseDts=e}},{key:"_mergeBufferRanges",value:function(){var e=this._buffers.sort((function(e,t){return e.start>t.start?1:-1})),t=e.length,r=[];if(!t)return r;for(var i={start:e[0].start,end:e[0].end},n=1;n<t;n++){var a=e[n];Math.abs(i.end-a.start)<.1?i.end=a.end:(r.push(i),i={start:a.start,end:a.end})}return r.push(i),r}},{key:"_caclBaseDts",value:function(e){-1===this._baseDts&&e&&(this._baseDts=e.dts,L.log(this.TAG,"set baseDts: ",this._baseDts,"frame len:",this._currentFrameQueue.length))}},{key:"_updateDuration",value:function(e){for(var t=e.length,r=e[t-1],i=0;i<t;i++){var n=e[i];if(n&&n.options&&n.options.meta){var a=e[i-1]||this._currentFrameQueue[this._currentFrameQueue.length-1];a?this._lastDuration+=(a.dts-this._baseDts)/1e3:this._lastDuration=this._duration,L.log(this.TAG,"updateBaseDts,record lastDuration:",this._lastDuration),this._baseDts=n.dts;break}}r&&(this._duration=(r.dts-this._baseDts)/1e3+this._lastDuration)}},{key:"_estimateBitRate",value:function(e){var t=e.length;if(t<=2){if(this._delayEstimateList=this._delayEstimateList.concat(e),(t=this._delayEstimateList.length)<=30)return;e=this._delayEstimateList,this._delayEstimateList=[]}for(var r=0,i=0;i<t;i++){var n=e[i];r+=n.data?n.data.length:n.units.reduce((function(e,t){return e+t.byteLength}),0)}this._totalSize+=r;var a=r/(e[t-1].dts-e[0].dts);this._bitrate=parseInt(8e3*a)}},{key:"_beforeAppendVodBuffer",value:function(e){var t=this;if(e.length){for(var r=[],i=[],n=0,a=e.length;n<a;n++)e[n].keyframe&&(r.push(i),i=[]),i.push(e[n]);i.length&&r.push(i),r.forEach((function(e){return t._appendVodBuffer(e)}))}}},{key:"_appendVodBuffer",value:function(e){if(e.length){var t=e[0],r=e[e.length-1],i=(t.dts-this._baseDts)/1e3,n=(r.dts-this._baseDts)/1e3;L.enable&&L.log(this.TAG,"add new buffer range [".concat(i," , ").concat(n,"]")),this._buffers.filter((function(e){return i>=e.start&&n<=e.end})).length||(this._buffers.push({start:i,end:n,duartion:n-i,frames:e.slice()}),this._buffers.sort((function(e,t){return e.start>t.start?1:-1})),this._afterAppendVodBuffer())}}},{key:"_afterAppendVodBuffer",value:function(){if(this._buffers.filter((function(e){var t;return!(null!==(t=e.frames[0])&&void 0!==t&&t.keyframe)})).length){for(var e=this._buffers,t=this._buffers.length,r=[],i=this._buffers[0],n=1;n<t;n++){var a;null!==(a=e[n].frames[0])&&void 0!==a&&a.keyframe?(r.push(i),i=e[n]):(i.frames=i.frames.concat(e[n].frames),i.end=e[n].end,i.duartion=i.end-i.start)}r.push(i),this._buffers=r}}},{key:"_recordKeyframes",value:function(e){var t=this;e.forEach((function(e){if(e.keyframe){var r=(e.dts-t._baseDts)/1e3;t._keyframeQueue.push({position:r,frame:e})}})),this._keyframeQueue=this._keyframeQueue.sort((function(e,t){return e.position>t.position?1:-1})),this.isLive&&this._keyframeQueue.length>40&&this._keyframeQueue.splice(0,20)}},{key:"toAnnexBNalu",value:function(e){e.forEach((function(e){var t=e.units;if(t){var r=t.reduce((function(e,t){return e+4+t.byteLength}),0),i=new Uint8Array(r),n=0;t.forEach((function(e){i.set([0,0,0,1],n),n+=4,i.set(e,n),n+=e.byteLength})),e.units=null,e.data=i}}))}},{key:"append",value:function(e,t,r){r&&this.toAnnexBNalu(e),this._caclBaseDts(e[0]),t&&this._updateDuration(e),this._estimateBitRate(e),this._recordKeyframes(e),this.isLive?this._currentFrameQueue=this._currentFrameQueue.concat(e):this._beforeAppendVodBuffer(e)}},{key:"updateSegmentEnd",value:function(e){var t=this._buffers[this._buffers.length-1];t&&(Math.abs(t.end-e)<.5||(t.end=e,t.duartion=e-t.start,L.log(this.TAG,"video data lack, reset end:",e)))}},{key:"getFrame",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(this.isLive)return this._currentFrameQueue.shift();if(!(e=this._currentFrameQueue[this._frameIndexInQueue])){if(!(e=this._currentFrameQueue[--this._frameIndexInQueue]))return;if(!this.switchBuffer((e.dts-this._baseDts)/1e3,this._frameIndexInQueue++,t))return;return this.getFrame(++t)}return this._frameIndexInQueue++,e}},{key:"getFramesForPreciseSeek",value:function(e){return this._currentFrameQueue.filter((function(t){return t.dts<=e}))}},{key:"updateFrameIndexForPreciseSeek",value:function(e){this._frameIndexInQueue=e}},{key:"switchBuffer",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!((arguments.length>2&&void 0!==arguments[2]?arguments[2]:0)>=20)){e=e||this.bufferStart;var r=this._buffers.filter((function(t){return t.start<e+.1&&t.end>=e+.1}))[0];if(!r){var i=this._buffers.find((function(t){return t.start>=e}));return i&&i.start-e<1?(this._currentFrameQueue=i.frames.slice(0),this._frameIndexInQueue=0,i):void 0}return r.frames[0].dts>=e?(this._currentFrameQueue=r.frames.slice(0),this._frameIndexInQueue=0,L.log(this.TAG,"switch video buffer, time:".concat(e," , buffer:[").concat(r.start," , ").concat(r.end,"], index=0")),r):r.frames.length>t?(this._currentFrameQueue=r.frames.slice(0),L.log(this.TAG,"switch video buffer, in the same gop and more frame got, time:".concat(e," , buffer:[").concat(r.start," , ").concat(r.end,"], index=").concat(t)),r):void L.log(this.TAG,"switch video buffer, in the same gop and no more frame got, time:".concat(e," , buffer:[").concat(r.start," , ").concat(r.end,"], index=").concat(t))}}},{key:"getSeekStartPosition",value:function(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;if(this._keyframeQueue.forEach((function(r){r.position<=e&&(t=r)})),t)return e-t.position<r?t:void 0}},{key:"nextFrame",value:function(){return this._currentFrameQueue[0]}},{key:"deletePassed",value:function(e){this._currentFrameQueue=this._currentFrameQueue.filter((function(t){return t.dts>=e}))}},{key:"getDtsOfTime",value:function(e){var t=e-this._lastDuration;return this._baseDts+1e3*t}},{key:"clean",value:function(){this._currentFrameQueue=[]}},{key:"destroy",value:function(){this._currentFrameQueue=[],this._buffers=[]}}]),e}();function bt(e){var t;(null===(t=e.buffer)||void 0===t?void 0:t.close)&&e.buffer.close()}var _t=function(){function e(t){u(this,e),this.TAG="FrameQueue",this._parent=t,this._lastGopId=0,this._frames=[]}return l(e,[{key:"currentTimeDts",get:function(){return this._parent.preciseVideoDts}},{key:"length",get:function(){return this._frames.length}},{key:"frames",get:function(){return this._frames}},{key:"append",value:function(e){e.info?this._frames.push(e):bt(e)}},{key:"appendVodFrame",value:function(e){this._frames.push(e)}},{key:"nextFrame",value:function(){var e=this._frames.length;return 1===this._parent.noAudio&&e>3&&(this._frames=this._frames.slice(e-2)),this._frames[0]}},{key:"shift",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=this._frames.shift();return this.deletePassed(e),t}},{key:"deletePassed",value:function(e){this._frames=this._frames.filter((function(t){return!!(t.info&&t.info.dts>e)||(bt(t),!1)}))}},{key:"empty",value:function(){this._frames.forEach((function(e){return bt(e)})),this._frames=[]}},{key:"destroy",value:function(){this.empty(),this._lastGopId=0}}]),e}(),Et=new(function(){function e(){u(this,e),c(this,"_queue",[]),c(this,"TAG","FrameRenderCache")}return l(e,[{key:"cacheCvs",value:function(e){this._queue.push(e),L.log(this.TAG,"cache canvas!")}},{key:"getCachedCvs",value:function(){var e=this._queue.pop();return e&&L.log(this.TAG,"get cached canvas!"),e}}]),e}()),Tt=function(){function e(t,r){u(this,e),this.TAG="FrameRender",this.configs=Object.assign({},t),this.parent=r,this.canvas=this.configs.canvas,this.canvas.glInstance=this,this.meta=Object.assign({},this.configs.meta),this.frameRenderCache=Et,this._initMeta(),this._initContextGL(),this.contextGL&&(this._initProgram(),this._initBuffers(),this._initTextures())}return l(e,[{key:"_initMeta",value:function(){this.chroma=this.meta.chromaFormat,this.height=this.meta.height,this.width=this.meta.width,this.canvas.width===this.meta.width&&this.canvas.height===this.meta.height||(this.canvas.width=this.meta.width,this.canvas.height=this.meta.height,this.parent.emitResizeEvent())}},{key:"_initContextGL",value:function(){if("2d"!==this.configs.type){for(var e=this.canvas,t=null,r=["webgl","experimental-webgl","moz-webgl","webkit-3d"],i=0;!t&&i<r.length;){var n=r[i];try{t=e.getContext(n,this.configs.glCtxOptions),L.log("FrameRender","use=",n,this.configs.glCtxOptions);break}catch(e){t=null}t&&"function"==typeof t.getParameter||(t=null),++i}this.contextGL=t}else this.ctx=this.canvas.getContext("2d")}},{key:"_initProgram",value:function(){var e=this.contextGL,t=["attribute vec4 vertexPos;","attribute vec4 texturePos;","attribute vec4 uTexturePos;","attribute vec4 vTexturePos;","varying vec2 textureCoord;","varying vec2 uTextureCoord;","varying vec2 vTextureCoord;","void main()","{","  gl_Position = vertexPos;","  textureCoord = texturePos.xy;","  uTextureCoord = uTexturePos.xy;","  vTextureCoord = vTexturePos.xy;","}"].join("\n"),r=["precision highp float;","varying highp vec2 textureCoord;","varying highp vec2 uTextureCoord;","varying highp vec2 vTextureCoord;","uniform sampler2D ySampler;","uniform sampler2D uSampler;","uniform sampler2D vSampler;","uniform mat4 YUV2RGB;","void main(void) {","  highp float y = texture2D(ySampler,  textureCoord).r;","  highp float u = texture2D(uSampler,  uTextureCoord).r;","  highp float v = texture2D(vSampler,  vTextureCoord).r;","  gl_FragColor = vec4(y, u, v, 1) * YUV2RGB;","}"].join("\n"),i=e.createShader(e.VERTEX_SHADER);e.shaderSource(i,t),e.compileShader(i),e.getShaderParameter(i,e.COMPILE_STATUS)||console.log("Vertex shader failed to compile: "+e.getShaderInfoLog(i));var n=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(n,r),e.compileShader(n),e.getShaderParameter(n,e.COMPILE_STATUS)||console.log("Fragment shader failed to compile: "+e.getShaderInfoLog(n));var a=e.createProgram();e.attachShader(a,i),e.attachShader(a,n),e.linkProgram(a),e.getProgramParameter(a,e.LINK_STATUS)||console.log("Program failed to compile: "+e.getProgramInfoLog(a)),e.useProgram(a);var s=e.getUniformLocation(a,"YUV2RGB");e.uniformMatrix4fv(s,!1,[1.16438,0,1.59603,-.87079,1.16438,-.39176,-.81297,.52959,1.16438,2.01723,0,-1.08139,0,0,0,1]),this.shaderProgram=a}},{key:"_initBuffers",value:function(){var e=this.contextGL,t=this.shaderProgram,r=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,r),e.bufferData(e.ARRAY_BUFFER,new Float32Array([1,1,-1,1,1,-1,-1,-1]),e.STATIC_DRAW);var i=e.getAttribLocation(t,"vertexPos");e.enableVertexAttribArray(i),e.vertexAttribPointer(i,2,e.FLOAT,!1,0,0);var n=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,n),e.bufferData(e.ARRAY_BUFFER,new Float32Array([1,0,0,0,1,1,0,1]),e.STATIC_DRAW);var a=e.getAttribLocation(t,"texturePos");e.enableVertexAttribArray(a),e.vertexAttribPointer(a,2,e.FLOAT,!1,0,0),this.texturePosBuffer=n;var s=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,s),e.bufferData(e.ARRAY_BUFFER,new Float32Array([1,0,0,0,1,1,0,1]),e.STATIC_DRAW);var o=e.getAttribLocation(t,"uTexturePos");e.enableVertexAttribArray(o),e.vertexAttribPointer(o,2,e.FLOAT,!1,0,0),this.uTexturePosBuffer=s;var u=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,u),e.bufferData(e.ARRAY_BUFFER,new Float32Array([1,0,0,0,1,1,0,1]),e.STATIC_DRAW);var d=e.getAttribLocation(t,"vTexturePos");e.enableVertexAttribArray(d),e.vertexAttribPointer(d,2,e.FLOAT,!1,0,0),this.vTexturePosBuffer=u}},{key:"_initTextures",value:function(){var e=this.contextGL,t=this.shaderProgram,r=this._initTexture(),i=e.getUniformLocation(t,"ySampler");e.uniform1i(i,0),this.yTextureRef=r;var n=this._initTexture(),a=e.getUniformLocation(t,"uSampler");e.uniform1i(a,1),this.uTextureRef=n;var s=this._initTexture(),o=e.getUniformLocation(t,"vSampler");e.uniform1i(o,2),this.vTextureRef=s,e.pixelStorei(e.UNPACK_ALIGNMENT,1)}},{key:"_initTexture",value:function(){var e=this.contextGL,t=e.createTexture();return e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(e.TEXTURE_2D,null),t}},{key:"_drawPictureGL",value:function(e,t,r,i,n){var a=i*r,s=n*r/2;444!==this.chroma&&422!==this.chroma||(s*=2);var o={yData:(e=new Uint8Array(e)).subarray(0,a),uData:e.subarray(a,a+s),vData:e.subarray(a+s,a+s+s)};this._drawPictureGL420(o,t,r,i,n)}},{key:"_drawPictureGL420",value:function(e,t,r,i,n){var a=this.contextGL,s=this.texturePosBuffer,o=this.uTexturePosBuffer,u=this.vTexturePosBuffer,d=this.yTextureRef,l=this.uTextureRef,c=this.vTextureRef,h=e.yData,f=e.uData,A=e.vData,p=i,v=r,m=n,g=r/2;422!==this.chroma&&444!==this.chroma||(g=r);var y=n,b=g,_=this.canvas.width/this.width,E=this.canvas.height/this.height,T=0,k=0,S=this.canvas.width,D=this.canvas.height;_<E?(D=this.height*this.canvas.width/this.width,k=parseInt((this.canvas.height-this.height*this.canvas.width/this.width)/2)):(S=this.width*this.canvas.height/this.height,T=parseInt((this.canvas.width-this.width*this.canvas.height/this.height)/2)),a.viewport(T,k,S,D);var R=new Float32Array([1,0,0,0,1,1,0,1]);a.bindBuffer(a.ARRAY_BUFFER,s),a.bufferData(a.ARRAY_BUFFER,R,a.DYNAMIC_DRAW);var L=new Float32Array([1,0,0,0,1,1,0,1]);a.bindBuffer(a.ARRAY_BUFFER,o),a.bufferData(a.ARRAY_BUFFER,L,a.DYNAMIC_DRAW);var C=new Float32Array([1,0,0,0,1,1,0,1]);a.bindBuffer(a.ARRAY_BUFFER,u),a.bufferData(a.ARRAY_BUFFER,C,a.DYNAMIC_DRAW),a.activeTexture(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,d),a.texImage2D(a.TEXTURE_2D,0,a.LUMINANCE,p,v,0,a.LUMINANCE,a.UNSIGNED_BYTE,h),a.activeTexture(a.TEXTURE1),a.bindTexture(a.TEXTURE_2D,l),a.texImage2D(a.TEXTURE_2D,0,a.LUMINANCE,m,g,0,a.LUMINANCE,a.UNSIGNED_BYTE,f),a.activeTexture(a.TEXTURE2),a.bindTexture(a.TEXTURE_2D,c),a.texImage2D(a.TEXTURE_2D,0,a.LUMINANCE,y,b,0,a.LUMINANCE,a.UNSIGNED_BYTE,A),a.drawArrays(a.TRIANGLE_STRIP,0,4)}},{key:"_drawPicture2d",value:function(e){if(e&&this.canvas){this.ctx||(this.ctx=this.canvas.getContext("2d"));var t=e.displayWidth||e.width,r=e.displayHeight||e.height;this.canvas.height===r&&this.canvas.width===t||(this.canvas.height=r,this.canvas.width=t);try{this.ctx.drawImage(e.dom||e,0,0,t,r)}catch(t){console.error(this.TAG,"_drawPicture2d",e,e.dom,t,t.message)}}}},{key:"_resize",value:function(e,t){this.width===e&&this.height===t||(this.width=e,this.height=t,this.canvas.width=e,this.canvas.height=t,this.parent.emitResizeEvent())}},{key:"render",value:function(e,t,r,i,n){this._resize(t,r),this.contextGL?this._drawPictureGL(e,t,r,i,n):this._drawPicture2d(e)}},{key:"resetMeta",value:function(e){this.meta=Object.assign({},e)}},{key:"updateBind",value:function(e,t){this.parent=e,this.resetMeta(t)}},{key:"destroy",value:function(e){this.parent=null,e&&(this.contextGL&&this.contextGL.clear(this.contextGL.DEPTH_BUFFER_BIT|this.contextGL.COLOR_BUFFER_BIT),Et.cacheCvs(this.canvas))}}]),e}(),kt=function(){function e(t){u(this,e),c(this,"_lowDecodeThreshold",F().lowDecodeThreshold/5),this.TAG="DecodeEstimate",this._needEstimate=!0,this._parent=t,this._lastDecodeDot=0,this._lastDecodeCost=0,this._lastFrameDts=0,this._dtsDeltas=[],this._decodeCosts=[],this._lowDecodeQueue=[],this._fps=0,this._decodeFps=0,this._gopLength=0,this._webcodec=!1}return l(e,[{key:"fps",get:function(){return this._fps}},{key:"decodeFps",get:function(){return this._decodeFps}},{key:"decodeCost",get:function(){return this._lastDecodeCost}},{key:"gopLength",get:function(){return this._gopLength}},{key:"webcodec",set:function(e){this._webcodec=e}},{key:"updateGopCount",value:function(){this._gopLength++}},{key:"needEstimateFps",value:function(){this._needEstimate=!0}},{key:"addDecodeInfo",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{dts:0};this._estimateDecodeFps(e),this._estimateFps(e)}},{key:"resetDecodeDot",value:function(e){this._lastDecodeDot=e||0}},{key:"reset",value:function(){this._decodeCosts=[],this._lowDecodeQueue=[]}},{key:"_estimateFps",value:function(e){if(this._needEstimate)if(this._lastFrameDts){var t=e.dts-this._lastFrameDts;if(this._lastFrameDts=e.dts,!(Math.abs(t)>200)){this._dtsDeltas.push(t);var r=this._dtsDeltas.length;r<5||(this._fps=Math.ceil(1e3/this._avg(this._dtsDeltas,r)),L.log(this.TAG,"estimate fps:",this._fps),this._needEstimate=!1)}}else this._lastFrameDts=e.dts}},{key:"_estimateDecodeFps",value:function(e){if(this._lastDecodeDot){var t=performance.now(),r=t-this._lastDecodeDot;this._lastDecodeDot=t,e.cost=r,this._lastDecodeCost=r,this._decodeCosts.push(r);var i=this._decodeCosts.length;if(!(i<5)){var n=this._avg(this._decodeCosts,i);this._decodeFps=Math.floor(1e3/n),this._decodeCosts=[],this._lowDecodeDetect()}}else this._lastDecodeDot=performance.now()}},{key:"_avg",value:function(e,t){var r=e.reduce((function(e,t){return e+t}),0);return Math.floor(r/t)||1}},{key:"_lowDecodeDetect",value:function(){this._decodeFps?(this._decodeFps<this._fps*this._parent.playbackRate+(this.webcodec?0:F().lowDecodeFpsDelta)?this._lowDecodeQueue.push(this._decodeFps):this._lowDecodeQueue.pop(),this._lowDecodeQueue.length>this._lowDecodeThreshold&&(this._lowDecodeQueue=[],L.log(this.TAG,"low decode, need degrade"),this._parent.emit(_e))):this._parent.emit(_e)}}]),e}(),St=[],Dt=function(){function e(t){var r=this;u(this,e),c(this,"_doTask",(function(){var e;null===(e=r._task)||void 0===e||e.call(r)})),this._task=t;var i=new Blob(["\n    var timer;\n\n    function initTimer (interval) {\n      destroy()\n      clearInterval(timer);\n      timer = setInterval(() => {\n          self.postMessage({type: 'NEXT_TICK'});\n      }, interval)\n    }\n\n    function destroy () {\n      clearInterval(timer);\n    }\n\n    self.onmessage = function (e) {\n      var {type,interval} = e.data;\n      switch (type) {\n          case 'START':\n            initTimer(interval);\n            break;\n          case 'DESTROY':\n            destroy();\n            break;\n      }\n    }\n"],{type:"application/javascript"});this._worker=St.pop()||new Worker(URL.createObjectURL(i)),this._bindEvent()}return l(e,[{key:"_bindEvent",value:function(){this._worker.addEventListener("message",this._doTask)}},{key:"start",value:function(e){(e=parseInt(e))<10&&(e=10),e>60?e=60:e>25&&(e=25),this._worker.postMessage({type:"START",interval:e})}},{key:"stop",value:function(){this._worker.postMessage({type:"DESTROY"})}},{key:"destroy",value:function(){this._worker&&(this._worker.postMessage({type:"DESTROY"}),this._worker.removeEventListener("message",this._doTask),St.push(this._worker),L.log("TickTimer","unbind timer event"),this._worker=null,this._task=null)}}]),e}(),Rt=function(e){h(r,e);var t=v(r);function r(e,i){var n;return u(this,r),(n=t.call(this,e,i))._timeRange=new yt(p(n)),n._decodeEstimate=new kt(p(n)),n._frameQueue=new _t(p(n)),n._lastTimeupdate=0,n._renderCost=0,n._canAutoPlay=!0,n._videoDecode=!1,n._inSeeking=!1,n._frameRender=null,n._configuration=null,n._render=n._render.bind(p(n)),n._tickTimer=new Dt(n._render),n._initCanvas(e),n._bindEvents(),n}return l(r,[{key:"canAutoPlay",get:function(){return this._canAutoPlay}},{key:"canvas",get:function(){return this._canvas}},{key:"timescale",get:function(){return 1e3}},{key:"fps",get:function(){return this._decodeEstimate.fps||this._meta&&this._meta.fpsNum/this._meta.fpsDen||24}},{key:"decodeFps",get:function(){return this._decodeEstimate.decodeFps}},{key:"decodeCost",get:function(){return this._decodeEstimate.decodeCost}},{key:"renderCost",get:function(){return this._renderCost}},{key:"totalSize",get:function(){return this._timeRange.totalSize}},{key:"bitrate",get:function(){return this._timeRange.bitrate},set:function(e){this._timeRange.bitrate=e}},{key:"gopLength",get:function(){return this._decodeEstimate.gopLength}},{key:"is540p",get:function(){return this._canvas.height<720}},{key:"buffered",get:function(){return this._timeRange.buffered}},{key:"inSeeking",get:function(){return this._inSeeking}},{key:"interval",get:function(){return Math.floor(1e3/this.fps/this.playbackRate)}},{key:"playbackRate",get:function(){return this._playbackRate||1}},{key:"baseDts",get:function(){return this._timeRange.baseDts}},{key:"currentTime",get:function(){return this._timeRange.getCurrentTime(this.preciseVideoDts)}},{key:"timelinePosition",get:function(){return this._parent.timelinePosition}},{key:"lastTimelinePosition",get:function(){return this._lastTimelinePosition||0},set:function(e){this._lastTimelinePosition=e}},{key:"audioSyncDts",get:function(){return this._audioDts||this.baseDts},set:function(e){this._audioDts=e}},{key:"preciseVideoDts",get:function(){return this.audioSyncDts+Math.floor(1e3*(this.timelinePosition-this.lastTimelinePosition))}},{key:"readyState",get:function(){var e=this._frameQueue.length||(this.currentTime?1:0);return e?e>=8?4:e>=4?3:e>=2?2:1:0}},{key:"isHevc",get:function(){return!("hev1.1.6.L93.B0"!==(this._meta||{}).codec)}},{key:"videoDecode",get:function(){return this._videoDecode}},{key:"decoderMode",get:function(){var e;return null===(e=this._decodeController)||void 0===e?void 0:e.decoderMode}},{key:"configuration",get:function(){var e,t;return this._configuration||(this._configuration=this._meta.configuration||C(null===(e=this._meta)||void 0===e?void 0:e.sps[0],null===(t=this._meta)||void 0===t?void 0:t.pps[0])),this._configuration},set:function(e){this._configuration=e.configuration||C(e.sps[0],e.pps[0])}},{key:"setSeekingStatus",value:function(e){this._inSeeking=e}},{key:"getDtsOfTime",value:function(e){return this._timeRange.getDtsOfTime(e)}},{key:"updateReady",value:function(){this._whenReady()}},{key:"forceRender",value:function(){this._render(!0)}},{key:"getSeekStartPosition",value:function(e,t){return this._timeRange.getSeekStartPosition(e,t)}},{key:"canSeek",value:function(){throw new Error("need override by children")}},{key:"emitResizeEvent",value:function(){null==this||this._emitTimelineEvents(ke,de)}},{key:"_assembleErr",value:function(e,t){var r=new Error(e);return r.code=3,r.subCode=t,r}},{key:"_emitTimelineEvents",value:function(e,t,r){var i;null===(i=this._parent)||void 0===i||i.emit(e,t,r)}},{key:"_initCanvas",value:function(e){e.canvas?this._canvas=e.canvas:this._canvas=Et.getCachedCvs()||document.createElement("canvas"),this._canvas.style.margin="auto",this._canvas.style.position="absolute",this._canvas.style.pointerEvents="none"}},{key:"_bindEvents",value:function(){var e=this;m(f(r.prototype),"_bindEvents",this).call(this);var t=function(t){var r=t.width,i=t.height,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=e._canvas,o=s.width,u=s.height,d=i*o/u,l=r*u/o,c=r-d,h=i-l,f=c*n+"px",A=h*a+"px";e._canvas.style.left=f,e._canvas.style.top=A,L.warn(e.TAG,"cvsWidth=".concat(o,", cvsHeight=").concat(u,", scaleCvsWidth=").concat(d,", scaleCvsHeight=").concat(l)),L.warn(e.TAG,"cover position: deltaX=".concat(c,", deltaY=").concat(h,", width=").concat(r,", height=").concat(i,", pX=").concat(f,", pY=").concat(A))};this._parent.on(Ee,(function(r,i){var n=i.width,a=i.height,s=e._canvas,o=s.width,u=s.height,d=!n||n/a>o/u;return L.warn(e.TAG,"UPDATE_VIDEO_FILLTYPE isGapX =",d,"type =",r,o,u,n,a),e._canvas.style.maxWidth="initial",e._canvas.style.maxHeight="initial","cover"===r?d?(e._canvas.style.left=0,e._canvas.style.top=0,e._canvas.style.height="auto",e._canvas.style.width="100%",void t({width:n,height:a},0,.5)):(e._canvas.style.left=0,e._canvas.style.top=0,e._canvas.style.width="auto",e._canvas.style.height="100%",void t({width:n,height:a},.5,0)):"fill"===r?(e._canvas.style.width="100%",void(e._canvas.style.height="100%")):(e._canvas.style.top=0,e._canvas.style.bottom=0,e._canvas.style.left=0,e._canvas.style.right=0,e._canvas.style.maxWidth="100%",e._canvas.style.maxHeight="100%",e._canvas.style.width="initial",e._canvas.style.height="initial",void(o<n&&u<a&&(o/n>u/a?e._canvas.style.width="100%":e._canvas.style.height="100%")))})),this._parent.on(Te,t),this._parent.on(xe,(function(t){var r,i=e._frameQueue.nextFrame(),n=i&&i.info&&i.info.dts;if(e.lastTimelinePosition=e.timelinePosition,e.noAudio){var a=e._timeRange.nextFrame();t=t||n||a&&a.dts||0}if(e.audioSyncDts=t,n&&n-t>500&&e._emitTimelineEvents(ke,ce,{aDts:t,vDts:n,frameLength:e._frameQueue.length,currentTime:e._parent.currentTime,duration:e._parent.duration}),L.log(e.TAG,"audio current buffer play finish, next buffer dts=",t,"currentTime:",e._parent.currentTime,"preciseVideoDts:",e.preciseVideoDts,"next video frame dts:",n,"frame length:",e._frameQueue.length),!(e._isLive||null!==(r=e._parent)&&void 0!==r&&r.seeking)){var s=e._timeRange.nextFrame();if(s){var o=(s.dts-s.baseDts)/1e3;e._parent.currentTime-o>1&&(L.warn(e.TAG,"drop frame!"),e.ajustSeekTime(e._parent.currentTime))}}})),this._parent.on(Ge,(function(t){e._config.glCtxOptions=t})),this._parent.on(je,this._updateSegmentEnd.bind(this)),this.on(be,this._startRender.bind(this)),this._parent.on(Ie,(function(t){e._playbackRate=t,e._startRender()}))}},{key:"ajustSeekTime",value:function(){throw new Error("need override by children")}},{key:"_resetDts",value:function(e,t){"audio"!==t&&this._timeRange.resetDts(e)}},{key:"_setMetadata",value:function(e,t){if("audio"!==e){L.warn(this.TAG,"video set metadata"),this._meta=t;var r=t&&t.frameRate&&t.frameRate.fps;r?L.log(this.TAG,"detect fps:",r):L.warn(this.TAG,"no detect fps,start estimate"),this._initDecoder()}}},{key:"_initDecoder",value:function(){throw new Error("need override by children")}},{key:"_whenDecoderReady",value:function(){throw new Error("need override by children")}},{key:"_appendChunk",value:function(){throw new Error("need override by children")}},{key:"_startDecode",value:function(){throw new Error("need override by children")}},{key:"_receiveFrame",value:function(e,t){if(this._parent&&this._timeRange){var r=e.info||{};if(this._decodeEstimate.addDecodeInfo(r),!this._isLive&&((r.output||r.keyframe)&&(this.setSeekingStatus(!1),L.warn(this.TAG,"set seeking status=",!1)),this.inSeeking))return L.log(this.TAG,"drop frame"),void bt(e);this._isLive?this._frameQueue.append(e):this._frameQueue.appendVodFrame(e),t&&t(),this._ready||this.readyState>=1&&this._whenReady()}}},{key:"_startRender",value:function(){L.log(this.TAG,"start render"),this._tickTimer.start(this.interval)}},{key:"_render",value:function(){throw new Error("need override by children")}},{key:"_updateSegmentEnd",value:function(){throw new Error("need override by children")}},{key:"_whenReady",value:function(){this._ready=!0,this.emit(ge),this.noAudio&&this._emitTimelineEvents(ke,J)}},{key:"_doPlay",value:function(){this._tickTimer.start()}},{key:"_doPause",value:function(){this._tickTimer.stop()}},{key:"_doSeek",value:function(){this._ready=!1,this._frameQueue.destroy()}},{key:"_doChaseFrame",value:function(){throw new Error("need override by children")}},{key:"destroy",value:function(e){var t,r,i,n;null===(t=this._tickTimer)||void 0===t||t.destroy(),null===(r=this._timeRange)||void 0===r||r.destroy(),null===(i=this._frameQueue)||void 0===i||i.destroy(),null===(n=this._frameRender)||void 0===n||n.destroy(e),this._tickTimer=null,this._canvas=null,this._timeRange=null,this._frameQueue=null,this._frameRender=null,this._decodeEstimate=null,this._parent=null,this.removeAllListeners()}}]),r}(tt),Lt=r(66836),Ct=function(e){h(r,e);var t=v(r);function r(e){var i;return u(this,r),(i=t.call(this)).TAG="VideoDecoder",i._video=i._createVideo(),i._IsInDecoding=!1,i._fps=0,i._framId=null,i._screenShotNum=0,i._allPicNum=0,i._currentBlob=null,i._basePTS=0,i._totleTime=0,i._isVideoONRun=!0,i.firstEmit=!1,i.ptsArray=[],i._currentCanvasHeight=0,i._canvasList=[],i._realFrameDuration=25,i._maxVideoHeight=e.maxVideoHeight||720,i._minFPSTime=0,i._maxFPSTime=0,i._playFailed=!1,i._isPhoneSafari=!1,i._createCanvasList(),i._bindEvents(),i}return l(r,[{key:"_createCanvasList",value:function(){this._canvas=document.createElement("canvas"),this._ctx=this._canvas.getContext("2d",{alpha:!1});for(var e=0;e<45;e++){var t=this._createCanvas(),r=t.dom,i=t.ctx;this._canvasList.push({dom:r,ctx:i})}}},{key:"_createCanvas",value:function(){var e=document.createElement("canvas"),t=e.getContext("2d");return{dom:e,ctx:t}}},{key:"_createVideo",value:function(){var e=document.createElement("video");return e.setAttribute("muted",!0),e.setAttribute("autoplay",!0),e.setAttribute("controls",!0),e.setAttribute("webkit-playsinline",!0),e.setAttribute("playsinline",!0),e.setAttribute("x5-video-player-type","h5"),e.setAttribute("x5-video-player-type","h5-page"),e.style.position="absolute",e}},{key:"_initVideo",value:function(e,t){if(e.blobUrl&&void 0!==e.dts){var r=e.blobUrl;this._currentBlob=r,this._basePTS=e.dts,this._currentDuration=e.duration;try{L.log(this.TAG,"_initVideo, basePTS:",e.dts),this._setVideoSrc(r,t),this._video.paused&&this._videoPlay("_initVideo")}catch(e){console.error(this.TAG,"_initVideo, load error",e)}}else console.error(this.TAG,"_initVideo","input info is error, blobUrl:",e.blobUrl,"dts:",e.dts)}},{key:"_setVideoSrc",value:function(e,t){try{var r=this._video;r.src=e,r.load(),r.playbackRate=2}catch(e){console.error(this.TAG,"_setVideoSrc",e)}}},{key:"_videoPlay",value:function(e){var t=this,r=this._video;if(L.log(this.TAG,"_videoPlay, video is pause:",r.paused,e),r&&r.paused){var i=r.play();void 0!==i&&i.then((function(){t._playFailed=!1,L.log(t.TAG,"_videoPlay success")})).catch((function(e){console.error(t.TAG,"_videoPlay failed,",e.message),t._playFailed=!0,t.emit(He,t.firstEmit)}))}}},{key:"_removeEvents",value:function(){var e=this._video;e.removeEventListener("playing",this._onPlaying.bind(this)),e.removeEventListener("ended",this._onEnded.bind(this)),e.removeEventListener("error",this._onError.bind(this)),e.removeEventListener("loadeddata",this._onLoadeddata.bind(this)),e.removeEventListener("timeupdate",this._onTimeUpdate.bind(this))}},{key:"_bindEvents",value:function(){var e=this,t=this._video;t?(document.addEventListener("visibilitychange",this._onVisibilityChange.bind(this)),t.addEventListener("playing",this._onPlaying.bind(this)),t.addEventListener("ended",this._onEnded.bind(this)),t.addEventListener("error",this._onError.bind(this)),t.addEventListener("loadeddata",this._onLoadeddata.bind(this)),t.addEventListener("timeupdate",this._onTimeUpdate.bind(this)),t.addEventListener("pause",(function(){L.log("on pause, currentTime, duration:",e._vCurrentTime,e._vDuration)})),this.on("outputresolutionchange",this._onChange.bind(this)),this.on("fpsreduce",(function(t){e._adaptFrameDuration(t)}))):console.error(this.TAG,"_bindEvents")}},{key:"_onTimeUpdate",value:function(){this._lastCurrentTime=this._vCurrentTime}},{key:"_onVisibilityChange",value:function(){this._isVideoONRun="visible"===document.visibilityState}},{key:"_onChange",value:function(e,t){this._width=e,this._height=t}},{key:"_onPlaying",value:function(){this._IsInDecoding&&(console.warn(this.TAG,"_onPlaying","last video not correct end"),this._framId&&(window.cancelAnimationFrame(this._framId),this._framId=null)),L.log(this.TAG,"_onPlaying, video duration:",this._vDuration,"currentTime:",this._vCurrentTime,"_lastPts:",this._lastPts),this._isInDecoding=!0,this._lastCurrentTime=this._vCurrentTime,this.ptsArray=[],this.playingTime||(this.playingTime=!0),this._getFrame()}},{key:"_onEnded",value:function(e,t){L.log(this.TAG,"_onEnded","current fmp4 duration is:",this._vDuration,"_isInDecoding:",this._isInDecoding,"_lastPts:",this._lastPts,"_realFrameDuration:",this._realFrameDuration,"from:",t),this._isInDecoding&&(this._isInDecoding=!1,this._lastMp4Duration=Math.min(this._vDuration,this._vCurrentTime),this._framId&&(L.log(this.TAG,"_onEnded","cancelAnimationFrame"),window.cancelAnimationFrame(this._framId),this._framId=null),this._decodeFPS=parseInt(this._screenShotNum/(this._vDuration/1e3)),this.emit("fps",this._screenShotNum,this._totleTime,this._vDuration,this._metaFPS,{height:this._currentCanvasHeight,relHeight:this._video.videoHeight}),L.log("_timePerFrame",this._totleTime/this._screenShotNum),this._timePerFrame=this._totleTime/this._screenShotNum,this._screenShotNum=0,this._allPicNum=0,this._totleTime=0,this._currentBlob&&(URL.revokeObjectURL(this._currentBlob),this._currentBlob=null,this._basePTS=0),this.emit(Qe,this._decodeFPS,this._video.duration))}},{key:"_onError",value:function(){this._isInDecoding=!1;var e=this._video;console.error("video error:",e.error.code,e.error.message),this.emit("error",e.error,this.firstEmit)}},{key:"_onLoadeddata",value:function(){var e=this,t=this._video;t.currentTime=.001,this.firstEmit||(this._playFailed?(t.style.visibility="hidden",this.emit(Ke,t),setTimeout((function(){L.log(e.TAG,"onloadeddata, setTimeout firstEmit:",e.firstEmit),e._getFirstFrame()}),40)):(L.log(this.TAG,"onloadeddata, firstEmit:",this.firstEmit),this._getFirstFrame()))}},{key:"_getFirstFrame",value:function(){this.firstTime=Date.now();var e=this._vCurrentTime,t=this._basePTS+e,r=this._getImageData(t).imageData;this.firstEmit=!0,this.emit(ze,r,t)}},{key:"_getFrame",value:function(){var e=this._video,t=e.videoWidth,r=e.videoHeight;if(this._allPicNum++,this._isInDecoding){if(t||r){var i=this._vCurrentTime,n=this._basePTS+i;if(this.ptsArray.push(n),this._lastCurrentTime&&this._lastCurrentTime===this._vDuration&&(L.log(this.TAG,"_getFrame, video ended, lastCurrentTime",this._lastCurrentTime,"duration:",this._vDuration,"isInDecoding:",this._isInDecoding),this._onEnded(null,"getFrame")),this._lastPts&&n<=this._lastPts)return void(this._framId=window.requestAnimationFrame(this._getFrame.bind(this)));if(this._lastPts&&n-this._lastPts<this._realFrameDuration)return void(this._framId=window.requestAnimationFrame(this._getFrame.bind(this)));this._screenShotNum++;var a,s=null,o=Date.now();try{s=(a=this._getImageData(n)).imageData}catch(e){console.error(e,a,this._canvasList.length)}this._lastPts=n;var u=Date.now()-o;return this._totleTime+=u,this.emit(Je,s,n),void(this._framId=window.requestAnimationFrame(this._getFrame.bind(this)))}this._framId=window.requestAnimationFrame(this._getFrame.bind(this))}else this._framId&&(window.cancelAnimationFrame(this._framId),this._framId=null)}},{key:"_getImageData",value:function(){var e,t=this._video,r=t.videoWidth,i=t.videoHeight,n=r,a=i;this._width&&this._height&&(n=this._width,a=this._height),a>this._maxVideoHeight&&(a=this._maxVideoHeight,n=parseInt(a*(r/i))),(e=this._canvasList.shift())||(console.warn(this.TAG,"_getImageData, _canvansList length is 0"),e=this._createCanvas()),e.width=n,e.height=a;var s=e.dom,o=e.ctx;if(this._currentCanvasHeight=a,!s)return{imageData:e};s.width!==n&&(s.width=n,s.height=a);try{i&&r&&n&&a&&o.drawImage(t,0,0,r,i,0,0,n,a)}catch(e){console.error(this.TAG,"_getImageData, drawImage:",e)}return{imageData:e}}},{key:"_adaptFrameDuration",value:function(e){e<15?this._minFPSTime++:this._minFPSTime=0,e>30?this._maxFPSTime++:this._maxFPSTime=0,this._minFPSTime>0&&this._decodeFPS<15&&(this._realFrameDuration-=this._timePerFrame,this._realFrameDuration<15&&(this._realFrameDuration=15),this._minFPSTime=0),this._maxFPSTime>0&&this._decodeFPS>30&&(this._realFrameDuration+=this._timePerFrame,this._maxFPSTime=0)}},{key:"_vDuration",get:function(){return parseInt(1e3*this._video.duration)}},{key:"_vCurrentTime",get:function(){return parseInt(1e3*this._video.currentTime)}},{key:"_reset",value:function(){this._isInDecoding=!1,this._lastPts=0,this._screenShotNum=0,this._allPicNum=0,this._totleTime=0}},{key:"reStartDecode",value:function(){this._video.pause(),this._reset();var e=this._currentBlob,t=this._basePTS;this._framId&&(window.cancelAnimationFrame(this._framId),this._framId=null),this._initVideo({blobUrl:e,dts:t})}},{key:"doSeek",value:function(e){if(this._isInDecoding){if(e<=0)return;var t=this._vCurrentTime/1e3+e>=this._vDuration/1e3?this._vDuration/1e3:this._vCurrentTime/1e3+1;console.error("doSeek",t),this._video.currentTime=t}}},{key:"pause",value:function(){this._isInDecoding&&this._video.pause()}},{key:"play",value:function(){if(this._isInDecoding&&this._video.paused)return L.log("video play",this._vCurrentTime),this._video.play()}},{key:"startDecode",value:function(e,t,r){this._initVideo(e,r),this._metaFPS=t}},{key:"stopDecode",value:function(){this._video.paused||(this._video.pause(),this._reset())}},{key:"canPlayType",value:function(e){return this._video.canPlayType(e)}},{key:"destroy",value:function(){this._isInDecoding=!1,window.cancelAnimationFrame(this._framId),this._video.pause(),this._removeEvents()}},{key:"videoWidth",get:function(){return this._video?this._video.videoWidth:0}},{key:"videoHeight",get:function(){return this._video?this._video.videoHeight:0}}]),r}(Q()),wt=[{base:720,level:1},{base:540,level:2},{base:360,level:3},{base:280,level:4}],It=function(e){h(r,e);var t=v(r);function r(e,i){var n;return u(this,r),(n=t.call(this)).TAG="VideoDecoderController",n._decoder=new Ct(e),n._remux=new Lt.C,n._bindEvents(),n._isInit=!1,n._isDataReady=!1,n._ready=!1,n._blobURLList=[],n._isInDecoding=!1,n._mediaSegmentReady=!1,n._parent=i,n._isDecodePause=!1,n._playSuccess=!0,n._isVideoOnRun=!0,n._startDts=0,n._fDuration=0,n._minFPSTime=0,n._lastPts=0,n._frameLengthPerFragment=0,n._gopBufferLength=0,n._maxGopDuration=0,n._minGopDuration=0,n._currentLevel=-1,n._endLevel=e.endLevel||2,n.currentFragmentDuration=0,n._handleKeyFrameVideo=n._handleKeyFrameVideo.bind(p(n)),n}return l(r,[{key:"_bindEvents",value:function(){var e=this;document.addEventListener("visibilitychange",this._onVisibilityChange.bind(this)),this._decoder.on(Ke,this._onAppendVideo.bind(this)),this._decoder.on(He,this._onPlayFailed.bind(this)),this._decoder.on("error",this._onError.bind(this)),this._decoder.on(Je,this._onDecoded.bind(this)),this._decoder.on(ze,this._onFirstFrame.bind(this)),this._decoder.on(Qe,this._onFragmentEnd.bind(this)),this._decoder.on("fps",(function(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];var n=[e._metaFPS].concat(r,[e._frameLengthPerFragment]);e.emit.apply(e,["fps"].concat(g(n)))})),this.on("keyFrame",this._handleKeyFrameVideo)}},{key:"_onRemuxed",value:function(e){var t={blobUrl:this._createBlobURL(e),dts:this.currentFragmentDts,duration:this.currentFragmentDuration,frameDuration:Math.floor(1e3/this._metaFPS)};this._recordGopDuration(this.currentFragmentDuration),this._pushBlob(t),L.log(this.TAG,"_onRemuxed","maxgopduration:",this._maxGopDuration,"_gopBufferLength:",this._gopBufferLength),!this._isDataReady&&this._gopBufferLength>=this._maxGopDuration&&this._checkDataReady()}},{key:"_onPlayFailed",value:function(e){this._isInDecoding=!1,this._parent.emit(He,e)}},{key:"_onAppendVideo",value:function(e){this._parent.emit(Ke,e)}},{key:"_onVisibilityChange",value:function(){this._isVideoOnRun="visible"===document.visibilityState}},{key:"_onDecoded",value:function(e,t){this._frameLengthPerFragment++;var r=this._buildFrameInfo(e,t);this._parent.emit(Je,r),this._lastPts=t}},{key:"_onFirstFrame",value:function(e,t){var r=this._buildFrameInfo(e,t);this._parent.emit(ze,r)}},{key:"_onFragmentEnd",value:function(e,t){var r=this;L.log(this.TAG,"_onFragmentEnd ,_isDecodePause:",this._isDecodePause,"decodeFPS:",e),e&&this._reduceResolution(e),this._isInDecoding=!1,this._inDecodeId=-1,this._currentInfo=null,this._frameLengthPerFragment=0,this._getBlobLength()&&!this._isDecodePause?this.startDecode():this.loadNextHandle=setInterval((function(){r._getBlobLength()&&!r._isDecodePause&&r._isVideoOnRun&&!r._isInDecoding&&(L.log(r.TAG,"_onFragmentEnd, setInterval start next mp4 decode"),r.startDecode(),clearInterval(r.loadNextHandle))}))}},{key:"_onError",value:function(e,t){this._isInDecoding=!1,this._parent.emit("error",e,t)}},{key:"_checkReady",value:function(){this._isDataReady&&this._isInit&&(this.ready=!0,L.log(this.TAG,"checkReady trigger ready"),this._parent.emit(Xe))}},{key:"_checkDataReady",value:function(){this._isDataReady=!0,this._checkReady()}},{key:"_reduceResolution",value:function(e){if(L.log(this.TAG,"_reduceResolution","currentLevel:",this._currentLevel,"endLevel:",this._endLevel),this._videoHeight>720&&(L.log(this.TAG,"_reduceResolution","trigger DECODE_LOW_FPS"),this._parent.emit(_e)),e&&e<20?(this._minFPSTime++,this._decoder.emit("fpsreduce",e)):this._minFPSTime=0,this._currentLevel>=this._endLevel)return L.log(this.TAG,"_reduceResolution","trigger DECODE_LOW_FPS",this._currentLevel,this._endLevel),void this._parent.emit(_e);if(this._minFPSTime>2){var t,r=this._videoWidth,i=this._videoHeight;if(t=this._findLevel(i,this._currentLevel)){if(this._currentLevel=t.level,4===this._currentLevel)return L.log(this.TAG,"_reduceResolution","trigger DECODE_LOW_FPS, _currentLevel: ",this._currentLevel),void this._parent.emit(_e);this.width=t.base*(r/i),this.height=t.base,this._decoder.emit("outputresolutionchange",this.width,this.height)}this._minFPSTime=0}}},{key:"_findLevel",value:function(e,t){return wt.find((function(r){return r.base<e&&r.level>t}))}},{key:"_buildFrameInfo",value:function(e,t){try{var r=e.width;return{msg:"DECODED",width:r,height:e.height,buffer:e,yLinesize:r,uvLinesize:r/2,info:{baseDts:void 0,dts:t,gopId:0,isGop:void 0,key:!1,pts:t},type:"rgb"}}catch(e){L.log(this.TAG,e)}}},{key:"_pushBlob",value:function(e){L.log("push blob",e.dts,e.duration),e&&e.duration&&(this._gopBufferLength+=e.duration),this._blobURLList.push(e)}},{key:"_shiftBlob",value:function(){var e=this._blobURLList.shift();return e&&e.duration&&(this._gopBufferLength-=e.duration),e}},{key:"_filterBlob",value:function(e){var t=this;this._blobURLList=this._blobURLList.filter((function(r){return r.dts<e&&(URL.revokeObjectURL(r.blobUrl),r.duration&&(t._gopBufferLength-=r.duration)),r.dts>=e}))}},{key:"_emptyBlobList",value:function(){this._blobURLList=[],this._gopBufferLength=0}},{key:"_getBlobLength",value:function(){return this._blobURLList.length}},{key:"_handleKeyFrameVideo",value:function(e){try{var t=this._parent._timeRange.frames||[];if(this._parent._timeRange.clean(),!t.length)return;var r=t[0].dts,i=t[t.length-1].dts,n=r-this.endDts;L.log(this.TAG,"_handleKeyFrameVideo","startDts:",r,"endDts:",i,"samples length:",t.length),this.endDts&&n>Math.floor(1e3/this._metaFPS)+1&&L.log(this.TAG,"_handleKeyFrame, keyFrame dts:",r,"sample length:",t.length,"endDts:",i,"delay:",n);var a=i-r;if(this._fDuration||(this._fDuration=a),a<1500)return void L.log(this.TAG,"_handleKeyFrame gopDuration :",a,"sample length:",t.length,"gopStartDts:",r,"gopEndDts:",i);if(this.firstDts||(this.firstDts=t[0].dts),this.currentFragmentDts=t[0].dts,this.currentFragmentDuration=this._getFragmentDuration(t),this.endDts=i,this.currentFragmentDts<this._startDts)return console.warn(this.TAG,"_handleKeyFrameVideo","currentFragmentDts < this._startDts",this.currentFragmentDts,this._startDts),void(t=[]);this.startRemux(t),t=[]}catch(e){console.error(this.TAG,"_handleKeyFrameVideo",e)}}},{key:"_getFragmentDuration",value:function(e){var t=0,r=0;return e[0].keyframe||console.error(this.TAG,"_getFragmentDuration","gop firstFrame is not keyframe"),e.forEach((function(i,n){i.keyframe&&n&&(t+=e[n-1].dts-e[r].dts,r=n)})),t+=e[e.length-1].dts-e[r].dts}},{key:"_createBlobURL",value:function(e){if(e){var t=new window.Blob([e.buffer],{type:"video/mp4"});return window.URL.createObjectURL(t)}}},{key:"_recordGopDuration",value:function(e){var t=e;this._minGopDuration||(this._minGopDuration=t),t>this._maxGopDuration&&(this._maxGopDuration=t),t<this._minGopDuration&&(this._minGopDuration=t)}},{key:"checkMaxFrames",value:function(e){"number"==typeof e&&(this._isDecodePause=e>40,this._playSuccess&&this._isDecodePause&&this._decoder.pause())}},{key:"checkMinFrames",value:function(e){var t=this;if("number"==typeof e&&(this._isDecodePause=!(e<25),!this._isDecodePause)){var r=this._decoder.play();void 0!==r?r.then((function(){t._playSuccess=!0})).catch((function(){t._playSuccess=!1})):setTimeout((function(){t._playSuccess=!0}),20)}}},{key:"frameRendend",value:function(e){if(e.dom){if(e.dom.width=0,e.dom.height=0,this._decoder._canvasList.length>40)return;this._decoder._canvasList.push(e)}else L.error(this.TAG,"_onRendend","imageObj. is error",e)}},{key:"checkValidBlob",value:function(e){this._filterBlob(e)}},{key:"chaseVideoFrame",value:function(e){L.log(this.TAG,e,e.frame.dts,this.currentFragmentDts);var t=e.frame.dts;if(this._startDts=t,t===this.currentFragmentDts){if(L.log(this.TAG,"_onChaseFrame","_inDecodeId:",this._inDecodeId,"currentFragmentDts:",this.currentFragmentDts),this._inDecodeId>0&&this._inDecodeId<t)return L.log(this.TAG,"_onChaseFrame, _inDecodeId > 0 && _inDecodeId < startDts, _inDecodeId:",this._inDecodeId,"startDts:",t),this.stopDecode(),this._filterBlob(t),void this.startDecode();if(this._inDecodeId===t)return L.log(this.TAG,"_onChaseFrame, _inDecodeId === startDts, startDts:",t),this.stopDecode(),void this.reStrartDecode(this._currentInfo);-1===this._inDecodeId&&(L.log(this.TAG,"_onChaseFrame","_inDecodeId==-1"),this.startDecode())}t>this.currentFragmentDts&&(L.log(this.TAG,"_onChaseFrame, startDts > currentFragmentDts, startDts:",t,"currentFragmentDts:",this.currentFragmentDts),this.stopDecode(),this._emptyBlobList()),t<this.currentFragmentDts&&(L.log(this.TAG,"_onChaseFrame, startDts < currentFragmentDts, startDts:",t,"currentFragmentDts:",this.currentFragmentDts),t>this._inDecodeId&&(this._filterBlob(t),this.stopDecode(),this.startDecode()))}},{key:"init",value:function(e){this._isInit||(this._metaFPS=e.fpsNum/e.fpsDen||25,this._videoWidth=e.width,this._videoHeight=e.height,this._width=this._videoWidth,this._height=this._videoHeight,this._frameDuration=parseInt(1e3/this._metaFPS),this._isInit=!0,L.log("".concat(this.TAG," has inited")),this._isInit=!0,this._checkReady())}},{key:"reStrartDecode",value:function(e){if(e)try{L.log(this.TAG,"reStrartDecode"),this._isInDecoding=!0,this._inDecodeId=e.dts,this._currentInfo=e,this._decoder.startDecode(e,this._metaFPS,this._startTime),this._startTime=0}catch(e){console.error("load error",e)}}},{key:"stopDecode",value:function(){this._isInDecoding=!1,this._inDecodeId=-1,this._currentInfo=null,this._frameLengthPerFragment=0,this._decoder.stopDecode()}},{key:"startDecode",value:function(){if(this._isInDecoding)L.log(this.TAG,"startDecode","this decoder is in decoding");else{var e=this._getBlobLength();if(this._decoder&&e){L.log(this.TAG,"startDecode","blob url length:",e);var t=this._shiftBlob()||{};try{L.log(this.TAG,"startDecode",t.dts,t.duration),this._isInDecoding=!0,this._inDecodeId=t.dts,this._currentInfo=t,this._decoder.startDecode(t,this._metaFPS)}catch(e){console.error(this.TAG,"startDecode","load error",e)}}}}},{key:"canSeek",value:function(e){var t=e.frame.dts;return!!(this.currentFragmentDts>=t&&this._isInDecoding)&&this._inDecodeId!==t&&this._inDecodeId<t}},{key:"startRemux",value:function(e){if(L.log("startRemux samples length:",e.length),e.length){var t=this._parent._meta;t.samples=e;var r=this._remux.remux(t).videoSegment;this._onRemuxed(r)}else console.error("frame length is 0")}},{key:"canPlayType",value:function(e){if(this._decoder)try{return this._decoder.canPlayType('video/mp4;codecs="'+e.codec+'"')}catch(e){console.error(e)}}},{key:"destroy",value:function(){this._blobURLList=[],this._decoder.destroy()}},{key:"empty",value:function(){if(L.log("empty"),this._decoder){var e=this._decoder._canvasList;return L.log(this.TAG,"empty >>>>>>>>>>>>>>>>>>length:",e.length),e.forEach((function(e){e.dom&&(L.log("clear >>>>>>>>>>>>>>>>>>"),e.dom.width=0,e.dom.height=0,e.dom=null)})),e.length}}},{key:"isIDLE",get:function(){return L.log(this.TAG,"isIDEL","blob length:",this._getBlobLength(),"_isInDecoding:",this._isInDecoding,"isVideoOnRun:",this._isVideoOnRun,"_isDecodePause",this._isDecodePause),!this._getBlobLength()&&!this._isInDecoding&&this._isVideoOnRun}},{key:"ready",get:function(){return this._ready},set:function(e){this._ready=e}},{key:"remux",get:function(){return this._remux}},{key:"isInit",get:function(){return this._isInit}}]),r}(Q()),xt=function(e){h(r,e);var t=v(r);function r(e,i){var n;return u(this,r),(n=t.call(this,e,i)).TAG="VideoRenderFromVideo",n._videoDecodeController=new It(e,p(n)),n._canAutoPlay=!0,n._videoDecode=e.videoDecode,n._chaseToFrame=null,n}return l(r,[{key:"videoDecode",get:function(){return this._videoDecode},set:function(e){this._videoDecode=e}},{key:"_bindEvents",value:function(){var e=this;m(f(r.prototype),"_bindEvents",this).call(this),this.on("keyFrame",this._onKeyFrame.bind(this)),this.on(Xe,this._onReady.bind(this)),this.on(Je,this._onDecoded.bind(this)),this.on(He,this._onPlayFailed.bind(this)),this.on("error",this._onError.bind(this)),this.on(Ke,this._onAppendVideo.bind(this)),this.on(ze,this._onFirstFrame.bind(this)),this._parent.on(qe,this._onChaseVideoFrame.bind(this)),this._parent.on(xe,this._onTimeLineSyncDTS.bind(this)),window.addEventListener("unload",(function(){e._empty()}))}},{key:"_onTimeLineSyncDTS",value:function(e){this._videoDecodeController.checkValidBlob(e)}},{key:"_onChaseVideoFrame",value:function(e){this._doChaseVideoFrame(e)}},{key:"_onAppendVideo",value:function(e){try{this._parent._parent.appendChild(e)}catch(e){cosole.error(this.TAG,"onAppendVideo",e)}}},{key:"_onKeyFrame",value:function(){L.log(this.TAG,"_onKeyFrame,  keyframe"),this._videoDecodeController.emit("keyFrame")}},{key:"_onError",value:function(e,t){console.error(this.TAG,"decoder error",e,t),t||this._emitTimelineEvents(ke,oe,this._assembleErr(e&&e.message))}},{key:"_onReady",value:function(){if(!this._frameRender){var e=Object.assign(this._config,{meta:this._meta,canvas:this._canvas,type:"2d"});try{this._frameRender=new Tt(e,this)}catch(e){this._emitTimelineEvents(ke,oe,this._assembleErr(e&&e.message))}}this._startDecode()}},{key:"_onFirstFrame",value:function(e){L.log(this.TAG,"onFirstFrame"),this._receiveFrame(e),this._firstFrame=!0}},{key:"_onDecoded",value:function(e){var t=this;this._inChaseFrame?(this.chaseFrameAfter++,1===this.chaseFrameAfter&&this._chaseToFrame&&(this._parent.emit($e,this._chaseToFrame),this._frameQueue.length&&this._frameQueue.frames.forEach((function(e){t._videoDecodeController.frameRendend(e.buffer)})),this._frameQueue.empty(),this._videoDecodeController.checkMinFrames(this._frameQueue.length),this._timeRange.deletePassed(this._chaseToFrame.frame.dts),this._inChaseFrame=!1,this._chaseToFrame=null,console.warn(this.TAG,"onDecoded","_inChaseFrame end"))):this.chaseFrameAfter=0,this._receiveFrame(e)}},{key:"_onPlayFailed",value:function(e){console.warn(this.TAG,"onPlayFailed, this._ready:",this._ready,",firstEmit:",e,",frame length:",this._frameQueue.length),this._ready||e||this._whenReady(),this._canAutoPlay=!1}},{key:"canSeek",value:function(e){return this._videoDecodeController.canSeek(e)}},{key:"_initDecoder",value:function(){this._isInit||(L.log(this.TAG,"_initDecoder"),this._videoDecodeController.isInit||this._videoDecodeController.init(this._meta),this._isInit=!0)}},{key:"_receiveFrame",value:function(e){m(f(r.prototype),"_receiveFrame",this).call(this,e),this._videoDecodeController.checkMaxFrames(this._frameQueue._frames.length)}},{key:"_setMetadata",value:function(e){L.warn(this.TAG,"video set metadata",e),this._meta=e;var t=e.fpsNum/e.fpsDen;t?L.log(this.TAG,"detect fps:",t):L.warn(this.TAG,"no detect fps,start estimate"),this._initDecoder(e)}},{key:"_doChaseVideoFrame",value:function(e){this._inChaseFrame=!0,this._chaseToFrame=e,this._videoDecodeController.chaseVideoFrame(e)}},{key:"_appendChunk",value:function(e){this._meta||this._setMetadata(e);for(var t=e.samples.slice(),r=t.length,i=0;i<r;i++){var n=t.shift();n.keyframe&&this.emit("keyFrame"),this._timeRange.append([n],this.noAudio,!1)}}},{key:"_startDecode",value:function(){this._videoDecodeController.startDecode()}},{key:"_checkToDecode",value:function(){this._startDecode()}},{key:"_startRender",value:function(){L.log(this.TAG,"_startRender interval",this.interval),this._tickTimer.start(this.interval)}},{key:"_render",value:function(e){var t=this,r=this._frameQueue.nextFrame(),i=this.preciseVideoDts;if(r&&this._timeRange){var n=r.info;if(!n)return this._frameQueue.shift(),void console.error("not info");this._renderDts=n.dts;var a=n.dts-i;if(a<-150){this.lastPrecise;var s=this._frameQueue.frames,o=this._getDeleteFrames(s,i),u=o.deleteFrames,d=o.useFrames;return s.splice(0),d.forEach((function(e){s.push(e)})),u.forEach((function(e){t._videoDecodeController.frameRendend(e.buffer)})),this._videoDecodeController.emit("renderDelay",a,this._frameQueue._frames.length),void this._videoDecodeController.checkMinFrames(this._frameQueue.length)}if(!(!e&&a>30&&a<6e4)){Math.abs(this._lastTimeupdate-n.dts)>250&&(this._emitTimelineEvents(ke,ie),this._lastTimeupdate=n.dts),L.long&&L.log(this.TAG,"render delay:".concat(a," , timelinePosition:").concat(i," , dts:").concat(n.dts," , cost:").concat(n.cost," , gopID:").concat(n.gopId," , rest:").concat(this._frameQueue.length,", buffer frame:").concat(this._timeRange.frameLength));var l=performance.now();this._frameRender.render(r.buffer,r.width,r.height,r.yLinesize,r.uvLinesize),this.hasFirstFrame||e||(this.hasFirstFrame=!0,this._parent.emit(ke,"firstframe")),this._videoDecodeController.frameRendend(r.buffer),this._frameQueue.shift(),this._videoDecodeController.checkMinFrames(this._frameQueue.length),this._videoDecodeController.emit("renderDelay",a,this._frameQueue._frames.length),this._renderCost=performance.now()-l,e||(this.lastTime&&(this.lastPrecise,Date.now(),this.lastTime),this.lastFrameinfo=n.dts,this.lastPrecise=i,this.lastTime=Date.now(),this.lastAudioTime=this._parent.audioRender.currentTime)}}else{if(this._videoDecodeController.checkMinFrames(this._frameQueue._frames.length),this._parent._paused)return;if(!this._firstFrame)return void L.log(this.TAG,"_render","not first frame return");var c=this._videoDecodeController;if(L.log(this.TAG,",lack frame, _inDecoding:",this._videoDecodeController._isInDecoding,this._videoDecodeController._isDecodePause,",_frameQueue.length:",this._frameQueue.length),!this._frameQueue.length&&c.isIDLE){this._ready=!1;var h=this._parent.audioRender;console.warn(this.TAG,"trigger video waiting vdecode, preciseVideoDts:",i,h.currentTime,h.duration,h.buffered.end(0),h.baseDts),this.emit(ye)}this._checkToDecode()}}},{key:"_updateSegmentEnd",value:function(){}},{key:"_destroy",value:function(e){this._empty(),m(f(r.prototype),"destroy",this).call(this,e),this._videoDecodeController.destroy()}},{key:"_doPause",value:function(){L.log(this.TAG,">>>>>>>>doPause"),this._tickTimer.stop()}},{key:"_getDeleteFrames",value:function(e,t){var r=[],i=[];return e.forEach((function(e){e.info&&e.info.dts>t?i.push(e):e.info&&e.info.dts<=t&&r.push(e)})),{deleteFrames:r,useFrames:i}}},{key:"_empty",value:function(){this._videoDecodeController&&(this._videoDecodeController.empty(),this._frameQueue.frames.forEach((function(e){e.buffer&&e.buffer.dom&&(e.buffer.dom.width=0,e.buffer.dom.height=0,e.buffer.dom=null)})))}}]),r}(Rt),Pt=function(e){h(r,e);var t=v(r);function r(e){var i;return u(this,r),c(p(i=t.call(this)),"_parent",null),c(p(i),"_decoderReady",!1),c(p(i),"_inDecoding",!1),c(p(i),"_toDecodeFirstframe",!0),c(p(i),"_id",(new Date).getMilliseconds()),c(p(i),"_workerErrorCallback",null),c(p(i),"_workerMessageCallback",null),c(p(i),"_decoderWorker",null),i._parent=e,i}return l(r,[{key:"analyse",get:function(){return this._parent.analyse}},{key:"inDecoding",get:function(){return this._inDecoding}},{key:"decoderMode",get:function(){return this._decoderMode}},{key:"decoderReady",get:function(){return this._decoderReady}},{key:"needToDecode",get:function(){return this._inDecoding?0:this._continueDecodeThreshold}},{key:"maxDecodeOnce",get:function(){return this._maxDecodeOnce}},{key:"meta",get:function(){var e;return null===(e=this._parent)||void 0===e?void 0:e._meta},set:function(e){this._parent&&(this._parent._meta=e)}},{key:"init",value:function(e,t){this._workerMessageCallback=e,this._workerErrorCallback=t,this._initWorker()}},{key:"_initWorker",value:function(){throw new Error("need override by children")}},{key:"checkToDecode",value:function(e){this.webcodec?e<=this.needToDecode&&this.doDecode():!this._inDecoding&&e<=this.needToDecode&&this.doDecode()}},{key:"doDecode",value:function(){var e=this,t=this._getFramesToDecode();t&&t.length&&this.meta&&(this._toDecodeFirstframe&&(this._toDecodeFirstframe=!1,this.analyse.addFirstFrameToDecode()),this._avccpushed||this._initDecoderWithConfiguration(this._decoderWorker,this.meta),L.enable&&L.log(this.TAG,"doDecode ".concat(t.length," frames")),t.forEach((function(t){e._doDecodeInternal(t)})),this._inDecoding=!0,this._decoderWorker.postMessage({msg:"finish_flag"}))}},{key:"preciseSeek",value:function(e){var t,r,i,n,a=this,s=1e3*e,o=null===(t=this._parent)||void 0===t||null===(r=t._timeRange)||void 0===r?void 0:r.getFramesForPreciseSeek(s),u=o.length;u<this.maxDecodeOnce?this.doDecode():(null===(i=this._parent)||void 0===i||null===(n=i._timeRange)||void 0===n||n.updateFrameIndexForPreciseSeek(u),L.enable&&L.log(this.TAG,"doDecode ".concat(o.length," frames for precise seek")),o.forEach((function(e,t){a._doDecodeInternal(e,!0,t>=u-6)})),this._inDecoding=!0,this._decoderWorker.postMessage({msg:"finish_flag"}))}},{key:"_getFramesToDecode",value:function(){var e=this._parent,t=e._timeRange,r=e._decodeEstimate;if(this._decoderReady&&t){var i=t.frameLength;if(i){var n=this._toDecodeFirstframe?F().maxDecodeOnceFirstTime:this.maxDecodeOnce;1===i&&r.resetDecodeDot(performance.now());for(var a=[];n>0;){var s=t&&t.getFrame();if(!s)break;a.push(s),s.gopId&&s.gopId-1==0&&r.updateGopCount(),n--}return a}}}},{key:"_doDecodeInternal",value:function(e,t,r){null!=e&&e.meta&&(this.meta=e.meta,L.warn(this.TAG,"detect metadata! flush decoder"),this._initDecoderWithConfiguration(this.__decoderWorker,e.meta));var i={dts:e.dts,pts:e.pts||e.dts+e.cts,keyframe:e.keyframe,gopId:e.gopId,id:this._id};t&&(i.preciseSeek=!0,i.output=r);var n=e.data.slice();this._decoderWorker.postMessage({msg:"decode",data:n,info:i},[n.buffer])}},{key:"_initDecoderWithConfiguration",value:function(){throw new Error("need override by children")}},{key:"flushDecoder",value:function(){this._decoderWorker.postMessage({msg:"flush"})}},{key:"destroy",value:function(){throw new Error("need override by children")}}]),r}(Q()),Ft="IWZ1bmN0aW9uKCl7InVzZSBzdHJpY3QiO3ZhciBlPW51bGwsdD1bXSxzPTAsYT0hMTtzZWxmLmFkZEV2ZW50TGlzdGVuZXIoIm1lc3NhZ2UiLChmdW5jdGlvbihvKXtzd2l0Y2goby5kYXRhLm1zZyl7Y2FzZSJjb25maWd1cmF0aW9uIjplPW5ldyBzZWxmLlZpZGVvRGVjb2Rlcih7b3V0cHV0OmZ1bmN0aW9uKG8pe2E9ITAscyYmY2xlYXJUaW1lb3V0KHMpO3ZhciBuPXQuc2hpZnQoKTtuP3NlbGYucG9zdE1lc3NhZ2Uoe3R5cGU6IkRFQ09ERUQiLHdpZHRoOm8uZGlzcGxheVdpZHRoLGhlaWdodDpvLmRpc3BsYXlIZWlnaHQsaW5mbzpuLGJ1ZmZlcjpvfSxbb10pOm8uY2xvc2UoKSxlLmRlY29kZVF1ZXVlU2l6ZT09PXQubGVuZ3RoJiZzZWxmLnBvc3RNZXNzYWdlKHt0eXBlOiJCQVRDSF9GSU5JU0hfRkxBRyJ9KX0sZXJyb3I6ZnVuY3Rpb24oZSl7Y29uc29sZS5sb2coIltXZWJjb2RlY1dvcmtlcl06IixlKSwiQ29kZWMgcmVjbGFpbWVkIGR1ZSB0byBpbmFjdGl2aXR5LiIhPT1lLm1lc3NhZ2UmJnNlbGYucG9zdE1lc3NhZ2Uoe3R5cGU6IkZBSUxFRCIsbWVzc2FnZTplJiZlLm1lc3NhZ2V9KX19KSxzZWxmLlZpZGVvRGVjb2Rlci5pc0NvbmZpZ1N1cHBvcnRlZChvLmRhdGEuZGF0YSkudGhlbigoZnVuY3Rpb24odCl7dC5zdXBwb3J0ZWQmJihlLmNvbmZpZ3VyZShvLmRhdGEuZGF0YSksY29uc29sZS5sb2coIltXZWJjb2RlY1dvcmtlcl06IiwiaXNDb25maWdTdXBwb3J0ZWQiLHQpKX0pKS50aGVuKChmdW5jdGlvbigpe3NlbGYucG9zdE1lc3NhZ2Uoe3R5cGU6IkRFQ09ERVJfUkVBRFkifSkscz1zZXRUaW1lb3V0KChmdW5jdGlvbigpe2F8fHNlbGYucG9zdE1lc3NhZ2Uoe3R5cGU6IkZBSUxFRCIsbWVzc2FnZToibm8gZnJhbWUgb3V0cHV0In0pfSksMmUzKX0pKS5jYXRjaCgoZnVuY3Rpb24oZSl7c2VsZi5wb3N0TWVzc2FnZSh7dHlwZToiRkFJTEVEIixtZXNzYWdlOmUmJmUubWVzc2FnZX0pfSkpO2JyZWFrO2Nhc2UiZGVjb2RlIjp2YXIgbj1vLmRhdGEuZGF0YSxpPW8uZGF0YS5pbmZvO3QucHVzaChpKTt2YXIgZD1uLmJ5dGVMZW5ndGgtNCxjPW5ldyBEYXRhVmlldyhuZXcgQXJyYXlCdWZmZXIoNCkpO2Muc2V0VWludDMyKDAsZCwhMSksbi5zZXQobmV3IFVpbnQ4QXJyYXkoYy5idWZmZXIpLDApLGkua2V5ZnJhbWUmJmUuZmx1c2goKTt2YXIgcj1uZXcgc2VsZi5FbmNvZGVkVmlkZW9DaHVuayh7dHlwZTppLmtleWZyYW1lPyJrZXkiOiJkZWx0YSIsdGltZXN0YW1wOmkucHRzLGRhdGE6bn0pO2UuZGVjb2RlKHIpO2JyZWFrO2Nhc2UiZGVzdHJveSI6ZSYmKGUuZmx1c2goKSxlLmNsb3NlKCkpLGNsZWFyVGltZW91dChzKTticmVhaztjYXNlImNoZWNrRGVjb2RlIjpzZWxmLnBvc3RNZXNzYWdlKHt0eXBlOiJDSEVDS19UT19ERUNPREUiLGRhdGE6MD09PU1hdGguYWJzKGUuZGVjb2RlUXVldWVTaXplLXQubGVuZ3RoKX0pfX0pKX0oKTsK",Ot="undefined"!=typeof window&&window.Blob&&new Blob([atob(Ft)],{type:"text/javascript;charset=utf-8"});function Mt(){var e=Ot&&(window.URL||window.webkitURL).createObjectURL(Ot);try{return e?new Worker(e,{}):new Worker("data:application/javascript;base64,"+Ft,{type:"module"})}finally{e&&(window.URL||window.webkitURL).revokeObjectURL(e)}}var Bt=F().maxDecodeOnceWebcodec,Gt=function(e){h(r,e);var t=v(r);function r(){var e;u(this,r);for(var i=arguments.length,n=new Array(i),a=0;a<i;a++)n[a]=arguments[a];return c(p(e=t.call.apply(t,[this].concat(n))),"TAG","WebCodecController"),c(p(e),"_decoderMode",5),c(p(e),"_maxDecodeOnce",Bt),c(p(e),"_continueDecodeThreshold",Bt/2),c(p(e),"_avccpushed",!1),e}return l(r,[{key:"webcodec",get:function(){return!0}},{key:"needToDecode",get:function(){return this._inDecoding?(this._checkToDecode(),0):this._continueDecodeThreshold}},{key:"_initWorker",value:function(){var e=this;L.log(this.TAG,"start init webcodec worker");var t=new Mt;t.onMessage=function(t){var r,i;switch(t.data.type){case"DECODER_READY":L.log(e.TAG,"webcodec worker ready "),e._decoderReady=!0,e._workerMessageCallback({type:"DECODER_READY"});break;case"DECODED":if(e._inDecoding=!0,(null===(r=t.data)||void 0===r||null===(i=r.info)||void 0===i?void 0:i.id)!==e._id)return;e._workerMessageCallback({type:"RECEIVE_FRAME",data:t.data});break;case"BATCH_FINISH_FLAG":if(e._inDecoding=!1,!e._workerMessageCallback)return;e._workerMessageCallback({type:"BATCH_FINISH"});break;case"CHECK_TO_DECODE":e._inDecoding=t.data.data;break;case"FAILED":e._whenError(t.data.message)}},t.onError=function(t){try{var r,i,n=null===(r=e._parent)||void 0===r||null===(i=r._parent)||void 0===i?void 0:i._parent;n&&n.removeChild(n.querySelector("canvas"))}catch(e){}e._whenError(t.message)},t.addEventListener("message",t.onMessage),t.addEventListener("error",t.onError),this._decoderWorker=t,this._initDecoderWithConfiguration(t,this._parent.configuration)}},{key:"_whenError",value:function(e){r.canUse=!1,this._workerErrorCallback(e)}},{key:"_initDecoderWithConfiguration",value:function(e,t){e.postMessage({msg:"configuration",data:{codec:this._parent._meta.codec,codedHeight:this._parent._meta.height,codedWidth:this._parent._meta.width,description:t}}),this._avccpushed=!0}},{key:"_checkToDecode",value:function(){this._decoderWorker.postMessage({msg:"checkDecode"})}},{key:"destroy",value:function(){var e=this._decoderWorker;e.removeEventListener("message",e.onMessage),e.removeEventListener("error",e.onError),e.postMessage({msg:"destroy"}),e.terminate(),this._decoderWorker=null}}],[{key:"isSupported",value:function(){return F().h264WithWebcodec&&!!window.VideoDecoder&&!1!==r.canUse}}]),r}(Pt),Nt="KGZ1bmN0aW9uKCl7InVzZSBzdHJpY3QiO2Z1bmN0aW9uIHNoaW1JbXBvcnRTY3JpcHRzKHNyYyl7cmV0dXJuIGZldGNoKHNyYykudGhlbigoZnVuY3Rpb24oZSl7cmV0dXJuIGUudGV4dCgpfSkpLnRoZW4oKGZ1bmN0aW9uKHRleHQpe3NlbGYuZXhwb3J0cz17fSxldmFsKHRleHQpLHNlbGYubT1leHBvcnRzLm19KSl9dmFyIE1BWF9TVFJFQU1fQlVGRkVSX0xFTkdUSD0zMTQ1NzI4LGluaXRUcz0wLERlY29kZXI9ZnVuY3Rpb24oZSl7dGhpcy5pbml0ZWQ9ITEsdGhpcy5pbmZvSWQ9MCx0aGlzLnNlbGY9ZSx0aGlzLm1ldGE9dGhpcy5zZWxmLm1ldGEsdGhpcy50cz0wLHRoaXMuaW5mb2xpc3Q9W10sZS5wYXJfYnJvYWR3YXlPbkJyb2Fkd2F5SW5pdGVkPXRoaXMuYnJvYWR3YXlPbkJyb2Fkd2F5SW5pdGVkLmJpbmQodGhpcyksZS5wYXJfYnJvYWR3YXlPblBpY3R1cmVEZWNvZGVkPXRoaXMuYnJvYWR3YXlPblBpY3R1cmVEZWNvZGVkLmJpbmQodGhpcyl9LGRlY29kZXI7ZnVuY3Rpb24gb25Qb3N0UnVuKCl7KGRlY29kZXI9bmV3IERlY29kZXIodGhpcykpLmluaXQoKX1EZWNvZGVyLnByb3RvdHlwZS50b1U4QXJyYXk9ZnVuY3Rpb24oZSx0KXtyZXR1cm4gTW9kdWxlLkhFQVBVOC5zdWJhcnJheShlLGUrdCl9LERlY29kZXIucHJvdG90eXBlLmluaXQ9ZnVuY3Rpb24oKXtNb2R1bGUuX2Jyb2Fkd2F5SW5pdCgwLDEpLHRoaXMub2Zmc2V0PU1vZHVsZS5fYnJvYWR3YXlDcmVhdGVTdHJlYW0oTUFYX1NUUkVBTV9CVUZGRVJfTEVOR1RIKX0sRGVjb2Rlci5wcm90b3R5cGUuYnJvYWR3YXlPblBpY3R1cmVEZWNvZGVkPWZ1bmN0aW9uKGUsdCxvLG4saSl7dmFyIHMscj10aGlzLmluZm9saXN0LnNoaWZ0KCksYT1vLGM9dCxkPXQvMjtpZihzPW8sIXJ8fCFyLnByZWNpc2VTZWVrfHxyLm91dHB1dCl7dmFyIGY9dGhpcy50b1U4QXJyYXkoZSxjKmErZCpzKjIpLHU9bmV3IFVpbnQ4QXJyYXkoZi5sZW5ndGgpO3Uuc2V0KGYpO3ZhciBsPXUuYnVmZmVyO3RoaXMuc2VsZi5wb3N0TWVzc2FnZSh7bXNnOiJERUNPREVEIix3aWR0aDp0LGhlaWdodDpvLHlMaW5lc2l6ZTpjLHV2TGluZXNpemU6ZCxpbmZvOnIsYnVmZmVyOmx9LFtsXSl9fSxEZWNvZGVyLnByb3RvdHlwZS5icm9hZHdheU9uQnJvYWR3YXlJbml0ZWQ9ZnVuY3Rpb24oKXtpZighdGhpcy5pbml0ZWQpe3RoaXMuaW5pdGVkPSEwO3ZhciBlPTA7aW5pdFRzJiYoZT1wZXJmb3JtYW5jZS5ub3coKS1pbml0VHMpLHRoaXMuc2VsZi5wb3N0TWVzc2FnZSh7bXNnOiJERUNPREVSX1JFQURZIixjb3N0OmV9KX19LERlY29kZXIucHJvdG90eXBlLmRlY29kZT1mdW5jdGlvbihlLHQpe3ZhciBvPXBhcnNlSW50KChuZXcgRGF0ZSkuZ2V0VGltZSgpKSxuPW8tMWU5Kk1hdGguZmxvb3Ioby8xZTkpO3RoaXMuaW5mb2xpc3QucHVzaCh0KSx0JiZ0LmtleWZyYW1lJiYodGhpcy5pbmZvbGlzdD1bdF0sTW9kdWxlLl9icm9hZHdheUZsdXNoU3RyZWFtKG4pKSxNb2R1bGUuSEVBUFU4LnNldChlLHRoaXMub2Zmc2V0KSxNb2R1bGUuX2Jyb2Fkd2F5UGxheVN0cmVhbShlLmxlbmd0aCx0aGlzLmluZm9JZCl9LERlY29kZXIucHJvdG90eXBlLmZsdXNoPWZ1bmN0aW9uKCl7TW9kdWxlLl9icm9hZHdheUZsdXNoU3RyZWFtKCl9LERlY29kZXIucHJvdG90eXBlLmRlc3Ryb3k9ZnVuY3Rpb24oKXtNb2R1bGUuX2Jyb2Fkd2F5RXhpdCgpfSxEZWNvZGVyLnByb3RvdHlwZS51cGRhdGVNZXRhPWZ1bmN0aW9uKGUpe3RoaXMubWV0YT1lfTt2YXIgV0FTTV9DRE5fUEFUSF9QUkVGSVg9IiI7ZnVuY3Rpb24gaW5pdChlKXtXQVNNX0NETl9QQVRIX1BSRUZJWD1lLnNwbGl0KCIvIikuc2xpY2UoMCwtMSkuam9pbigiLyIpLGluaXRUcz1wZXJmb3JtYW5jZS5ub3coKTt2YXIgdD0vYXNtLy50ZXN0KGUpO2RlY29kZXJ8fChzZWxmLmltcG9ydFNjcmlwdHM/bmV3IFByb21pc2UoKGZ1bmN0aW9uKHQsbyl7c2VsZi5jb25zb2xlfHwoc2VsZi5jb25zb2xlPXtsb2c6ZnVuY3Rpb24oKXt9LHdhcm46ZnVuY3Rpb24oKXt9LGluZm86ZnVuY3Rpb24oKXt9LGVycm9yOmZ1bmN0aW9uKCl7fX0pO3RyeXtzZWxmLmltcG9ydFNjcmlwdHMoZSksdCgpfWNhdGNoKG4pe2lmKG4ubWVzc2FnZS5pbmNsdWRlcygiTW9kdWxlIHNjcmlwdHMgZG9uJ3Qgc3VwcG9ydCBpbXBvcnRTY3JpcHRzIikpcmV0dXJuIHQoc2hpbUltcG9ydFNjcmlwdHMoZSkpO28obil9fSkpOnNoaW1JbXBvcnRTY3JpcHRzKGUpKS50aGVuKChmdW5jdGlvbigpe3JldHVybiB0Pyhjb25zb2xlLmxvZygiYXV0byBpbnN0YW5jZSBEZWNvZGVyISIpLG5ldyBQcm9taXNlKChmdW5jdGlvbihlLHQpe3NldFRpbWVvdXQoKGZ1bmN0aW9uKCl7dHJ5e29uUG9zdFJ1bi5jYWxsKHNlbGYpLGUoKX1jYXRjaChvKXt0KG8pfX0pKX0pKSk6c2VsZi5tP3NlbGYubSh7aW5zdGFudGlhdGVXYXNtOmZ1bmN0aW9uKGUsdCl7ZmV0Y2goIiIuY29uY2F0KFdBU01fQ0ROX1BBVEhfUFJFRklYLCIvZGVjb2Rlci53YXNtLmpzIikpLnRoZW4oKGZ1bmN0aW9uKGUpe3JldHVybiBlLmFycmF5QnVmZmVyKCl9KSkudGhlbigoZnVuY3Rpb24odCl7cmV0dXJuIFdlYkFzc2VtYmx5Lmluc3RhbnRpYXRlKHQsZSl9KSkudGhlbigoZnVuY3Rpb24oZSl7cmV0dXJuIHQoZS5pbnN0YW5jZSl9KSl9fSkudGhlbigoZnVuY3Rpb24oZSl7c2VsZi5Nb2R1bGU9ZSxvblBvc3RSdW4uY2FsbChzZWxmKX0pKTpuZXcgUHJvbWlzZSgoZnVuY3Rpb24oZSx0KXthZGRPblBvc3RSdW4ob25Qb3N0UnVuLmJpbmQoc2VsZikpLE1vZHVsZS5vblJ1bnRpbWVJbml0aWFsaXplZD1mdW5jdGlvbigpe2UoKX0sTW9kdWxlLm9uQWJvcnQ9ZnVuY3Rpb24oZSl7dChlJiZlLm1lc3NhZ2U/ZTpuZXcgRXJyb3IoIndhc20gaW5pdCBlcnJvciIpKX0sc2V0VGltZW91dCgoZnVuY3Rpb24oKXt0KG5ldyBFcnJvcigid2FzbSBsb2FkIHRpbWVvdXQiKSl9KSw2ZTMpfSkpfSkpLmNhdGNoKChmdW5jdGlvbihlKXtzZWxmLnBvc3RNZXNzYWdlKHttc2c6IklOSVRfRkFJTEVEIixsb2c6ZS5tZXNzYWdlfSl9KSl9c2VsZi5vbm1lc3NhZ2U9ZnVuY3Rpb24oZSl7dmFyIHQ9ZS5kYXRhO2lmKHQubXNnKXtpZigiaW5pdCIhPT10Lm1zZyYmInByZWxvYWQiIT09dC5tc2cmJiFkZWNvZGVyKXJldHVybjtzd2l0Y2godC5tc2cpe2Nhc2UicHJlbG9hZCI6aW5pdCh0LnVybCk7YnJlYWs7Y2FzZSJpbml0IjpzZWxmLm1ldGE9dC5tZXRhLGluaXQodC51cmwpO2JyZWFrO2Nhc2UidXBkYXRlbWV0YSI6c2VsZi5tZXRhPXQubWV0YSxkZWNvZGVyLnVwZGF0ZU1ldGEodC5tZXRhKTticmVhaztjYXNlImluaXREZWNvZGVyIjpkZWNvZGVyLmRlY29kZSh0LmRhdGEpO2JyZWFrO2Nhc2UiZGVjb2RlIjpkZWNvZGVyLmRlY29kZSh0LmRhdGEsdC5pbmZvKTticmVhaztjYXNlImZsdXNoIjpkZWNvZGVyLmZsdXNoKCk7YnJlYWs7Y2FzZSJmaW5pc2hfZmxhZyI6c2VsZi5wb3N0TWVzc2FnZSh7bXNnOiJCQVRDSF9GSU5JU0hfRkxBRyJ9KTticmVhaztjYXNlImRlc3RvcnkiOmRlY29kZXIuZGVzdHJveSgpfX1lbHNlIHNlbGYucG9zdE1lc3NhZ2Uoe21zZzoiRVJST1I6aW52YWxpZCBtZXNzYWdlIn0pfX0pKCk7Cg==",Vt="undefined"!=typeof window&&window.Blob&&new Blob([atob(Nt)],{type:"text/javascript;charset=utf-8"});function Ut(){var e=Vt&&(window.URL||window.webkitURL).createObjectURL(Vt);try{return e?new Worker(e,{}):new Worker("data:application/javascript;base64,"+Nt,{type:"module"})}finally{e&&(window.URL||window.webkitURL).revokeObjectURL(e)}}var Zt="KGZ1bmN0aW9uKCl7InVzZSBzdHJpY3QiO2Z1bmN0aW9uIHNoaW1JbXBvcnRTY3JpcHRzKHNyYyl7cmV0dXJuIGZldGNoKHNyYykudGhlbigoZnVuY3Rpb24oZSl7cmV0dXJuIGUudGV4dCgpfSkpLnRoZW4oKGZ1bmN0aW9uKHRleHQpe3NlbGYuZXhwb3J0cz17fSxldmFsKHRleHQpLHNlbGYubT1leHBvcnRzLm19KSl9dmFyIE1BWF9TVFJFQU1fQlVGRkVSX0xFTkdUSD01MjQyODgwLEJBVENIX0RFQ09ERV9TSVpFPTgsaW5pdFRzPTAsRGVjb2Rlcj1mdW5jdGlvbihlKXt0aGlzLmluaXRlZD0hMSx0aGlzLmluZm9JZD0wLHRoaXMuc2VsZj1lLHRoaXMubWV0YT1lLm1ldGEsdGhpcy50cz0wLHRoaXMuaW5mb2xpc3Q9W10sZS5wYXJfYnJvYWR3YXlPbkJyb2Fkd2F5SW5pdGVkPXRoaXMuYnJvYWR3YXlPbkJyb2Fkd2F5SW5pdGVkLmJpbmQodGhpcyksZS5wYXJfYnJvYWR3YXlPblBpY3R1cmVEZWNvZGVkPXRoaXMuYnJvYWR3YXlPblBpY3R1cmVEZWNvZGVkLmJpbmQodGhpcyl9LGRlY29kZXI7ZnVuY3Rpb24gb25Qb3N0UnVuKCl7KGRlY29kZXI9bmV3IERlY29kZXIodGhpcykpLmluaXQoKX1EZWNvZGVyLnByb3RvdHlwZS50b1U4QXJyYXk9ZnVuY3Rpb24oZSx0KXtyZXR1cm4gTW9kdWxlLkhFQVBVOC5zdWJhcnJheShlLGUrdCl9LERlY29kZXIucHJvdG90eXBlLmluaXQ9ZnVuY3Rpb24oKXtNb2R1bGUuX2Jyb2Fkd2F5SW5pdCgwLDIpLHRoaXMuc3RyZWFtQnVmZmVyUHRyPU1vZHVsZS5fYnJvYWR3YXlDcmVhdGVTdHJlYW0oTUFYX1NUUkVBTV9CVUZGRVJfTEVOR1RIKSx0aGlzLnN0cmVhbUJ1ZmZlcj10aGlzLnRvVThBcnJheSh0aGlzLnN0cmVhbUJ1ZmZlclB0cixNQVhfU1RSRUFNX0JVRkZFUl9MRU5HVEgpLHRoaXMuYnVmZmVyU2l6ZXNQdHI9TW9kdWxlLl9tYWxsb2MoNCpCQVRDSF9ERUNPREVfU0laRSksdGhpcy5idWZmZXJTaXplcz10aGlzLnRvVThBcnJheSh0aGlzLmJ1ZmZlclNpemVzUHRyLDQqQkFUQ0hfREVDT0RFX1NJWkUpLHRoaXMuc3RyZWFtQnVmZmVyT2Zmc2V0PTAsdGhpcy5mcmFtZUxlbnNPZmZzZXQ9MCx0aGlzLmZyYW1lTGVuc0J1ZmZlcj1uZXcgVWludDMyQXJyYXkoQkFUQ0hfREVDT0RFX1NJWkUpfSxEZWNvZGVyLnByb3RvdHlwZS5icm9hZHdheU9uUGljdHVyZURlY29kZWQ9ZnVuY3Rpb24oZSx0LHIpe3ZhciBzPXRoaXMuaW5mb2xpc3Quc2hpZnQoKSxvPXIsaT1yLzIsbj10LGY9dC8yOyF0aGlzLm1ldGF8fDQ0NCE9PXRoaXMubWV0YS5jaHJvbWFGb3JtYXQmJjQyMiE9PXRoaXMubWV0YS5jaHJvbWFGb3JtYXR8fChpPXIpO3ZhciBhPXRoaXMudG9VOEFycmF5KGUsbipvK2YqaSoyKSxjPW5ldyBVaW50OEFycmF5KGEubGVuZ3RoKTtjLnNldChhKTt2YXIgZD1jLmJ1ZmZlcjt0aGlzLnNlbGYucG9zdE1lc3NhZ2Uoe21zZzoiREVDT0RFRCIsd2lkdGg6dCxoZWlnaHQ6cix5TGluZXNpemU6bix1dkxpbmVzaXplOmYsaW5mbzpzLGJ1ZmZlcjpkfSxbZF0pfSxEZWNvZGVyLnByb3RvdHlwZS5icm9hZHdheU9uQnJvYWR3YXlJbml0ZWQ9ZnVuY3Rpb24oKXtpZighdGhpcy5pbml0ZWQpe3RoaXMuaW5pdGVkPSEwO3ZhciBlPTA7aW5pdFRzJiYoZT1wZXJmb3JtYW5jZS5ub3coKS1pbml0VHMpLHRoaXMuc2VsZi5wb3N0TWVzc2FnZSh7bXNnOiJERUNPREVSX1JFQURZIixjb3N0OmV9KX19LERlY29kZXIucHJvdG90eXBlLnN0b3JlQnVmZmVyPWZ1bmN0aW9uKGUsdCl7dCYmdC5rZXlmcmFtZSYmdGhpcy5mbHVzaCgpLHRoaXMuaW5mb2xpc3QucHVzaCh0KSx0aGlzLnN0cmVhbUJ1ZmZlci5zZXQoZSx0aGlzLnN0cmVhbUJ1ZmZlck9mZnNldCksdGhpcy5mcmFtZUxlbnNCdWZmZXJbdGhpcy5mcmFtZUxlbnNPZmZzZXRdPWUubGVuZ3RoLHRoaXMuc3RyZWFtQnVmZmVyT2Zmc2V0Kz1lLmxlbmd0aCx0aGlzLmZyYW1lTGVuc09mZnNldCs9MSx0aGlzLmJhdGNoRGVjb2RlKCl9LERlY29kZXIucHJvdG90eXBlLmJhdGNoRGVjb2RlPWZ1bmN0aW9uKGUpeyh0aGlzLmZyYW1lTGVuc09mZnNldD49QkFUQ0hfREVDT0RFX1NJWkV8fGUmJnRoaXMuZnJhbWVMZW5zT2Zmc2V0KSYmKHRoaXMuYnVmZmVyU2l6ZXMuc2V0KG5ldyBVaW50OEFycmF5KHRoaXMuZnJhbWVMZW5zQnVmZmVyLmJ1ZmZlciksMCksTW9kdWxlLl9icm9hZHdheVBsYXlTdHJlYW0xKHRoaXMuYnVmZmVyU2l6ZXNQdHIsdGhpcy5mcmFtZUxlbnNPZmZzZXQpLHRoaXMuZnJhbWVMZW5zT2Zmc2V0PTAsdGhpcy5zdHJlYW1CdWZmZXJPZmZzZXQ9MCl9LERlY29kZXIucHJvdG90eXBlLmRlY29kZT1mdW5jdGlvbihlKXt0aGlzLnN0cmVhbUJ1ZmZlci5zZXQoZSksTW9kdWxlLl9icm9hZHdheVBsYXlTdHJlYW0oZS5sZW5ndGgsMCl9LERlY29kZXIucHJvdG90eXBlLmZsdXNoPWZ1bmN0aW9uKCl7dGhpcy5iYXRjaERlY29kZSghMCksTW9kdWxlLl9icm9hZHdheUZsdXNoU3RyZWFtKCl9LERlY29kZXIucHJvdG90eXBlLmRlc3Ryb3k9ZnVuY3Rpb24oKXtNb2R1bGUuX2Jyb2Fkd2F5RXhpdCgpfSxEZWNvZGVyLnByb3RvdHlwZS51cGRhdGVNZXRhPWZ1bmN0aW9uKGUpe3RoaXMubWV0YT1lfTt2YXIgV0FTTV9DRE5fUEFUSF9QUkVGSVg9IiI7ZnVuY3Rpb24gaW5pdChlKXsoV0FTTV9DRE5fUEFUSF9QUkVGSVg9ZS5zcGxpdCgiLyIpLnNsaWNlKDAsLTEpLmpvaW4oIi8iKSxpbml0VHM9cGVyZm9ybWFuY2Uubm93KCksZGVjb2Rlcil8fChzZWxmLmltcG9ydFNjcmlwdHM/bmV3IFByb21pc2UoKGZ1bmN0aW9uKHQscil7c2VsZi5jb25zb2xlfHwoc2VsZi5jb25zb2xlPXtsb2c6ZnVuY3Rpb24oKXt9LHdhcm46ZnVuY3Rpb24oKXt9LGluZm86ZnVuY3Rpb24oKXt9LGVycm9yOmZ1bmN0aW9uKCl7fX0pO3RyeXtzZWxmLmltcG9ydFNjcmlwdHMoZSksdCgpfWNhdGNoKHMpe2lmKHMubWVzc2FnZS5pbmNsdWRlcygiTW9kdWxlIHNjcmlwdHMgZG9uJ3Qgc3VwcG9ydCBpbXBvcnRTY3JpcHRzIikpcmV0dXJuIHQoc2hpbUltcG9ydFNjcmlwdHMoZSkpO3Iocyl9fSkpOnNoaW1JbXBvcnRTY3JpcHRzKGUpKS50aGVuKChmdW5jdGlvbigpe3JldHVybiBmZXRjaChXQVNNX0NETl9QQVRIX1BSRUZJWCsiL2RlY29kZXIud29ya2VyLmpzIikudGhlbigoZnVuY3Rpb24oZSl7cmV0dXJuIGUuYmxvYigpfSkpLnRoZW4oKGZ1bmN0aW9uKGUpe3JldHVybiBzZWxmLm0oe2xvY2F0ZUZpbGU6ZnVuY3Rpb24odCl7cmV0dXJuL1wud29ya2VyXC5qcyQvLnRlc3QodCk/VVJMLmNyZWF0ZU9iamVjdFVSTChlKTovXC53YXNtJC8udGVzdCh0KT9XQVNNX0NETl9QQVRIX1BSRUZJWCsiL2RlY29kZXIud2FzbSI6L1wubWVtJC8udGVzdCh0KT9XQVNNX0NETl9QQVRIX1BSRUZJWCsiL2RlY29kZXIuanMubWVtIjp2b2lkIDB9LG1haW5TY3JpcHRVcmxPckJsb2I6V0FTTV9DRE5fUEFUSF9QUkVGSVgrIi9kZWNvZGVyLmpzIn0pfSkpLnRoZW4oKGZ1bmN0aW9uKGUpe3NlbGYuTW9kdWxlPWUsb25Qb3N0UnVuLmNhbGwoc2VsZil9KSl9KSkuY2F0Y2goKGZ1bmN0aW9uKGUpe3NlbGYucG9zdE1lc3NhZ2Uoe21zZzoiSU5JVF9GQUlMRUQiLGxvZzplLm1lc3NhZ2V9KX0pKX1zZWxmLm9ubWVzc2FnZT1mdW5jdGlvbihlKXt2YXIgdD1lLmRhdGE7aWYoImluaXQiPT09dC5tc2d8fCJwcmVsb2FkIj09PXQubXNnfHxkZWNvZGVyKXN3aXRjaCh0Lm1zZyl7Y2FzZSJwcmVsb2FkIjppbml0KHQudXJsKSxCQVRDSF9ERUNPREVfU0laRT10LmJhdGNoRGVjb2RlQ291bnQ7YnJlYWs7Y2FzZSJpbml0IjpzZWxmLm1ldGE9dC5tZXRhLEJBVENIX0RFQ09ERV9TSVpFPXQuYmF0Y2hEZWNvZGVDb3VudCxpbml0KHQudXJsKTticmVhaztjYXNlInVwZGF0ZW1ldGEiOnNlbGYubWV0YT10Lm1ldGEsZGVjb2Rlci51cGRhdGVNZXRhKHQubWV0YSk7YnJlYWs7Y2FzZSJpbml0RGVjb2RlciI6ZGVjb2Rlci5mcmFtZUxlbnNPZmZzZXQmJmRlY29kZXIuYmF0Y2hEZWNvZGUoITApLGRlY29kZXIuZmx1c2goKSxkZWNvZGVyLmRlY29kZSh0LmRhdGEpO2JyZWFrO2Nhc2UiZGVjb2RlIjpkZWNvZGVyLnN0b3JlQnVmZmVyKHQuZGF0YSx0LmluZm8pO2JyZWFrO2Nhc2UiZmx1c2giOmRlY29kZXIuZmx1c2goKTticmVhaztjYXNlImZpbmlzaF9mbGFnIjpzZWxmLnBvc3RNZXNzYWdlKHttc2c6IkJBVENIX0ZJTklTSF9GTEFHIn0pO2JyZWFrO2Nhc2UiZGVzdG9yeSI6ZGVjb2Rlci5kZXN0cm95KCl9fX0pKCk7Cg==",Wt="undefined"!=typeof window&&window.Blob&&new Blob([atob(Zt)],{type:"text/javascript;charset=utf-8"});function jt(){var e=Wt&&(window.URL||window.webkitURL).createObjectURL(Wt);try{return e?new Worker(e,{}):new Worker("data:application/javascript;base64,"+Zt,{type:"module"})}finally{e&&(window.URL||window.webkitURL).revokeObjectURL(e)}}var Xt="KGZ1bmN0aW9uKCl7InVzZSBzdHJpY3QiO2Z1bmN0aW9uIHNoaW1JbXBvcnRTY3JpcHRzKHNyYyl7cmV0dXJuIGZldGNoKHNyYykudGhlbigoZnVuY3Rpb24oZSl7cmV0dXJuIGUudGV4dCgpfSkpLnRoZW4oKGZ1bmN0aW9uKHRleHQpe3NlbGYuZXhwb3J0cz17fSxldmFsKHRleHQpLHNlbGYubT1leHBvcnRzLm19KSl9dmFyIE1BWF9TVFJFQU1fQlVGRkVSX0xFTkdUSD0xMDQ4NTc2LGluaXRUcz0wLERlY29kZXI9ZnVuY3Rpb24oZSl7dGhpcy5pbml0ZWQ9ITEsdGhpcy5zZWxmPWUsdGhpcy5tZXRhPWUubWV0YSx0aGlzLmluZm9saXN0PVtdLGUucGFyX2Jyb2Fkd2F5T25Ccm9hZHdheUluaXRlZD10aGlzLmJyb2Fkd2F5T25Ccm9hZHdheUluaXRlZC5iaW5kKHRoaXMpLGUucGFyX2Jyb2Fkd2F5T25QaWN0dXJlRGVjb2RlZD10aGlzLmJyb2Fkd2F5T25QaWN0dXJlRGVjb2RlZC5iaW5kKHRoaXMpfSxkZWNvZGVyO2Z1bmN0aW9uIG9uUG9zdFJ1bigpeyhkZWNvZGVyPW5ldyBEZWNvZGVyKHRoaXMpKS5pbml0KCl9RGVjb2Rlci5wcm90b3R5cGUudG9VOEFycmF5PWZ1bmN0aW9uKGUsdCl7cmV0dXJuIE1vZHVsZS5IRUFQVTguc3ViYXJyYXkoZSxlK3QpfSxEZWNvZGVyLnByb3RvdHlwZS5pbml0PWZ1bmN0aW9uKCl7TW9kdWxlLl9icm9hZHdheUluaXQoKSx0aGlzLnN0cmVhbUJ1ZmZlcj10aGlzLnRvVThBcnJheShNb2R1bGUuX2Jyb2Fkd2F5Q3JlYXRlU3RyZWFtKE1BWF9TVFJFQU1fQlVGRkVSX0xFTkdUSCwwKSxNQVhfU1RSRUFNX0JVRkZFUl9MRU5HVEgpfSxEZWNvZGVyLnByb3RvdHlwZS5icm9hZHdheU9uUGljdHVyZURlY29kZWQ9ZnVuY3Rpb24oZSx0LG8sbixpLHMscil7dmFyIGE9dGhpcy5pbmZvbGlzdFswXTtpZighYXx8IWEua2V5ZnJhbWV8fHIpe3ZhciBjLGQ9T2JqZWN0LmFzc2lnbih7fSx0aGlzLmluZm9saXN0LnNoaWZ0KCkpLGY9bztjPW87dmFyIHU9dGhpcy50b1U4QXJyYXkoZSxuKmYraSpjKjIpLGw9bmV3IFVpbnQ4QXJyYXkodS5sZW5ndGgpO2wuc2V0KHUpO3ZhciBtPWwuYnVmZmVyO3RoaXMuc2VsZi5wb3N0TWVzc2FnZSh7bXNnOiJERUNPREVEIix3aWR0aDp0LGhlaWdodDpvLHlMaW5lc2l6ZTpuLHV2TGluZXNpemU6aSxpbmZvOmQsYnVmZmVyOm19LFttXSl9fSxEZWNvZGVyLnByb3RvdHlwZS5icm9hZHdheU9uQnJvYWR3YXlJbml0ZWQ9ZnVuY3Rpb24oKXt0aGlzLmluaXRlZD0hMDt2YXIgZT0wO2luaXRUcyYmKGU9cGVyZm9ybWFuY2Uubm93KCktaW5pdFRzKSx0aGlzLnNlbGYucG9zdE1lc3NhZ2Uoe21zZzoiREVDT0RFUl9SRUFEWSIsY29zdDplfSl9LERlY29kZXIucHJvdG90eXBlLmRlY29kZT1mdW5jdGlvbihlLHQpe3QmJnRoaXMuaW5mb2xpc3QucHVzaCh0KSx0JiZ0LmtleWZyYW1lJiYodGhpcy5pbmZvbGlzdD1bdF0pLHRoaXMuc3RyZWFtQnVmZmVyLnNldChlKSxNb2R1bGUuX2Jyb2Fkd2F5UGxheVN0cmVhbShlLmxlbmd0aCwwKX0sRGVjb2Rlci5wcm90b3R5cGUuZGVzdHJveT1mdW5jdGlvbigpe01vZHVsZS5fYnJvYWR3YXlFeGl0KCl9LERlY29kZXIucHJvdG90eXBlLnVwZGF0ZU1ldGE9ZnVuY3Rpb24oZSl7dGhpcy5tZXRhPWV9O3ZhciBXQVNNX0NETl9QQVRIX1BSRUZJWD0iIjtmdW5jdGlvbiBpbml0KGUpe1dBU01fQ0ROX1BBVEhfUFJFRklYPWUuc3BsaXQoIi8iKS5zbGljZSgwLC0xKS5qb2luKCIvIiksaW5pdFRzPXBlcmZvcm1hbmNlLm5vdygpO3ZhciB0PS9hc20vLnRlc3QoZSk7ZGVjb2Rlcnx8KHNlbGYuaW1wb3J0U2NyaXB0cz9uZXcgUHJvbWlzZSgoZnVuY3Rpb24odCxvKXtzZWxmLmNvbnNvbGV8fChzZWxmLmNvbnNvbGU9e2xvZzpmdW5jdGlvbigpe30sd2FybjpmdW5jdGlvbigpe30saW5mbzpmdW5jdGlvbigpe30sZXJyb3I6ZnVuY3Rpb24oKXt9fSk7dHJ5e3NlbGYuaW1wb3J0U2NyaXB0cyhlKSx0KCl9Y2F0Y2gobil7aWYobi5tZXNzYWdlLmluY2x1ZGVzKCJNb2R1bGUgc2NyaXB0cyBkb24ndCBzdXBwb3J0IGltcG9ydFNjcmlwdHMiKSlyZXR1cm4gdChzaGltSW1wb3J0U2NyaXB0cyhlKSk7byhuKX19KSk6c2hpbUltcG9ydFNjcmlwdHMoZSkpLnRoZW4oKGZ1bmN0aW9uKCl7cmV0dXJuIHQ/KGNvbnNvbGUubG9nKCJhdXRvIGluc3RhbmNlIERlY29kZXIhIiksbmV3IFByb21pc2UoKGZ1bmN0aW9uKGUsdCl7c2V0VGltZW91dCgoZnVuY3Rpb24oKXt0cnl7b25Qb3N0UnVuLmNhbGwoc2VsZiksZSgpfWNhdGNoKG8pe3Qobyl9fSkpfSkpKTpzZWxmLm0oe2luc3RhbnRpYXRlV2FzbTpmdW5jdGlvbihlLHQpe2ZldGNoKCIiLmNvbmNhdChXQVNNX0NETl9QQVRIX1BSRUZJWCwiL2RlY29kZXIud2FzbS5qcyIpKS50aGVuKChmdW5jdGlvbihlKXtyZXR1cm4gZS5hcnJheUJ1ZmZlcigpfSkpLnRoZW4oKGZ1bmN0aW9uKHQpe3JldHVybiBXZWJBc3NlbWJseS5pbnN0YW50aWF0ZSh0LGUpfSkpLnRoZW4oKGZ1bmN0aW9uKGUpe3JldHVybiB0KGUuaW5zdGFuY2UpfSkpfX0pLnRoZW4oKGZ1bmN0aW9uKGUpe3NlbGYuTW9kdWxlPWUsb25Qb3N0UnVuLmNhbGwoc2VsZil9KSl9KSkuY2F0Y2goKGZ1bmN0aW9uKGUpe3NlbGYucG9zdE1lc3NhZ2Uoe21zZzoiSU5JVF9GQUlMRUQiLGxvZzplLm1lc3NhZ2V9KX0pKX1zZWxmLm9ubWVzc2FnZT1mdW5jdGlvbihlKXt2YXIgdD1lLmRhdGE7aWYoImluaXQiPT09dC5tc2d8fCJwcmVsb2FkIj09PXQubXNnfHxkZWNvZGVyKXN3aXRjaCh0Lm1zZyl7Y2FzZSJwcmVsb2FkIjppbml0KHQudXJsKTticmVhaztjYXNlImluaXQiOnNlbGYubWV0YT10Lm1ldGEsc2VsZi5wb3N0TWVzc2FnZSh7bXNnOiJMT0ciLGxvZzoid29ya2VyIGluaXRlZCJ9KSxpbml0KHQudXJsKTticmVhaztjYXNlInVwZGF0ZW1ldGEiOnNlbGYubWV0YT10Lm1ldGEsZGVjb2Rlci51cGRhdGVNZXRhKHQubWV0YSk7YnJlYWs7Y2FzZSJpbml0RGVjb2RlciI6ZGVjb2Rlci5kZWNvZGUodC5kYXRhKTticmVhaztjYXNlImRlY29kZSI6ZGVjb2Rlci5kZWNvZGUodC5kYXRhLHQuaW5mbyk7YnJlYWs7Y2FzZSJmaW5pc2hfZmxhZyI6c2VsZi5wb3N0TWVzc2FnZSh7bXNnOiJCQVRDSF9GSU5JU0hfRkxBRyJ9KTticmVhaztjYXNlImRlc3RvcnkiOmRlY29kZXIuZGVzdHJveSgpfX19KSgpOwo=",Yt="undefined"!=typeof window&&window.Blob&&new Blob([atob(Xt)],{type:"text/javascript;charset=utf-8"});function Ht(){var e=Yt&&(window.URL||window.webkitURL).createObjectURL(Yt);try{return e?new Worker(e,{}):new Worker("data:application/javascript;base64,"+Xt,{type:"module"})}finally{e&&(window.URL||window.webkitURL).revokeObjectURL(e)}}var Qt=new(function(){function e(){u(this,e),c(this,"_queue",[]),c(this,"_pendingDecoder",null),c(this,"TAG","DecoderCache")}return l(e,[{key:"genDecoder",value:function(e){return this._initDecoder(e)}},{key:"_initDecoder",value:function(e){var t=this,r=F(),i=r.preloadDecoder,n=r.maxDecodeOnceWasm;e=e||i;var a,s,o=O(),u=o.H264_DECODER_URL,d=o.H265_SIMD_DECODER_URL,l=o.H265_DECODER_URL,c=o.H265_THREAD_DECODER_URL,h=1;if("h265"===e&&(M()?(a=new Ut,s=d,h=2):B()&&F().canUseThreadMode?(a=new jt,s=c,h=1):(a=new Ut,s=l,h=3)),"h264"===e&&(a=new Ht,s=u,h=3),!a)return Promise.resolve();var f,A,p,v=((p=new Promise((function(e,t){f=e,A=t}))).resolve=f,p.reject=A,p);a.postMessage({msg:"preload",batchDecodeCount:n,url:s}),this._pendingDecoder=a,a.id=Date.now()+parseInt(1e3*Math.random()),a.isHevc="h265"===e,a.using=!1,a.ready=!1,L.log(this.TAG,"start init decoder worker, id=",a.id,"hevc=",a.isHevc,"mode=",h);var m=function e(r){t._pendingDecoder=null;var i=r.data.msg;switch("DECODER_READY"!==i&&"INIT_FAILED"!==i||(a.removeEventListener("message",e),a.removeEventListener("error",g)),i){case"DECODER_READY":L.log(t.TAG,"decoder worker inited!, id=",a.id,"cost:",r.data.cost),a.ready=!0,a.using||t._queue.push(a),v.resolve();break;case"INIT_FAILED":L.log(t.TAG,"decoder worker init failed!",r.data.log),v.reject(r.data.log)}},g=function e(t){a.removeEventListener("message",m),a.removeEventListener("error",e),v.reject(null==t?void 0:t.message)};return a.addEventListener("message",m),a.addEventListener("error",g),v}},{key:"cacheDecoder",value:function(e){e.using=!1,e.ready=!0,e.id||(e.id=Date.now()+parseInt(1e3*Math.random())),this._queue.push(e),L.log(this.TAG,"cache decoder, id=",e.id),"h265"===F().preloadDecoder&&1===this._queue.filter((function(e){return!e.using&&e.isHevc})).length&&this.genDecoder("h265")}},{key:"getCachedDecoder",value:function(e){var t,r=this._queue.findIndex((function(t){return!t.using&&t.isHevc===e}));if(-1!==r&&(t=this._queue.splice(r,1)[0]),!t&&this._pendingDecoder&&(t=this._pendingDecoder,this._pendingDecoder=null),t)return t.using=!0,L.warn(this.TAG,"get cached decoder, id=".concat(t.id,", ready=").concat(t.ready)),t}}]),e}()),Kt=F().maxDecodeOnceWasm,zt=function(e){h(r,e);var t=v(r);function r(){var e;u(this,r);for(var i=arguments.length,n=new Array(i),a=0;a<i;a++)n[a]=arguments[a];return c(p(e=t.call.apply(t,[this].concat(n))),"TAG","WasmController"),c(p(e),"_avccpushed",!1),c(p(e),"_maxDecodeOnce",Kt),c(p(e),"_continueDecodeThreshold",Kt/2),c(p(e),"_wasmInitCost",0),c(p(e),"_threadSupported",B()&&F().canUseThreadMode),c(p(e),"_simdSuppported",M()),c(p(e),"_decoderMode",window.WebAssembly?3:4),e}return l(r,[{key:"wasmInitCost",get:function(){var e;return null===(e=this._decoderWorker)||void 0===e?void 0:e._wasmInitCost}},{key:"isHevc",get:function(){var e;return null===(e=this._parent)||void 0===e?void 0:e.isHevc}},{key:"_selectDecodeWorker",value:function(){this.analyse.addWasmInit();var e,t=O(),r=t.H264_DECODER_URL,i=t.H265_DECODER_URL,n=t.H265_THREAD_DECODER_URL,a=t.H265_SIMD_DECODER_URL,s=t.ASM_H264_DECODER_URL,o=t.ASM_H265_DECODER_URL;return L.log(this.TAG,"start init wasm worker:",performance.now(),"hevc:",this.isHevc,"decoderMode:",this._decoderMode),this.isHevc?(e=1===this._decoderMode?n:2===this._decoderMode?a:3===this._decoderMode?i:o)?{decoder:1===this._decoderMode?new jt:new Ut,url:e}:void this._workerErrorCallback("no found decoder url, decodeMode:".concat(this._decoderMode)):(e=4===this._decoderMode?s:r)?{decoder:new Ht,url:e}:void this._workerErrorCallback("no found decoder url, decodeMode:".concat(this._decoderMode))}},{key:"_initWorker",value:function(){this.isHevc&&(this._threadSupported&&(this._decoderMode=1),this._simdSuppported&&(this._decoderMode=2)),this._initDecodeWorkerInternal()}},{key:"_initDecodeWorkerInternal",value:function(){var e=Qt.getCachedDecoder(this.isHevc);if(e)return L.warn(this.TAG,"select decoder from cache"),this.analyse.addWasmInit(),this._avccpushed=!1,this._bindWorkerEvent(e),this._decoderWorker=e,void(e.ready&&(this._decoderReady=!0,this._initDecoderWithConfiguration(e,this.meta),this._workerMessageCallback({type:"DECODER_READY",data:e}),L.log(this.TAG,"decoder ready!")));var t=this._selectDecodeWorker()||{},r=t.decoder,i=t.url;r&&(this._avccpushed=!1,this._bindWorkerEvent(r),r.isHevc=this.isHevc,r.postMessage({msg:"init",meta:{},batchDecodeCount:Kt,url:i}),this._decoderWorker=r)}},{key:"_bindWorkerEvent",value:function(e){var t=this,r=function(r,i){L.log(t.TAG,"worker failed: ",r,i),t._terminateWorker(e),t._decoderWorker=null,!1===F().wasmFallbackToAsm||4===t._decoderMode?t._workerErrorCallback(r):(t._decoderMode=1===t._decoderMode||2===t._decoderMode?3:4,t._initDecodeWorkerInternal())};e._onMessage=function(i){var n,a;switch(i.data.msg){case"DECODER_READY":if(L.log(t.TAG,"wasm worker ready!","cost:",i.data.cost),t._decoderReady=!0,e._wasmInitCost=parseInt(i.data.cost),!t.meta)return;t._avccpushed||t._initDecoderWithConfiguration(e,t.meta),t.emit(me,e),t._workerMessageCallback({type:"DECODER_READY",data:e});break;case"DECODED":if(t._inDecoding=!0,(null===(n=i.data)||void 0===n||null===(a=n.info)||void 0===a?void 0:a.id)!==t._id)return;t._workerMessageCallback({type:"RECEIVE_FRAME",data:i.data});break;case"BATCH_FINISH_FLAG":if(t._inDecoding=!1,!t._workerMessageCallback)return;t._workerMessageCallback({type:"BATCH_FINISH"});break;case"INIT_FAILED":r(i.data.log,1)}},e._onError=function(e){r(e.message,2)},e.addEventListener("message",e._onMessage),e.addEventListener("error",e._onError)}},{key:"_initDecoderWithConfiguration",value:function(e,t){L.log(this.TAG,"init decoder with configuration"),this._avccpushed=!0,e.postMessage({msg:"updatemeta",meta:{}});var r=[t.rawVps||t.vps[0],t.rawSps||t.sps[0],t.rawPps||t.pps[0]].filter(Boolean),i=r.reduce((function(e,t){return e+(t.byteLength+4)}),0),n=new Uint8Array(i),a=0;r.forEach((function(e){n.set([0,0,0,1],a),a+=4,n.set(e,a),a+=e.byteLength})),e.postMessage({msg:"initDecoder",data:n})}},{key:"destroy",value:function(){if(this._decoderWorker)return F().reuseWasmDecoder?(this._offWorkerBind(this._decoderWorker),void Qt.cacheDecoder(this._decoderWorker)):void this._terminateWorker(this._decoderWorker)}},{key:"_offWorkerBind",value:function(e){e.removeEventListener("message",e._onMessage),e.removeEventListener("error",e._onError),e.postMessage({msg:"flush"}),e._onMessage=null,e._onError=null,L.log(this.TAG,"flush decoder and unbind worker event")}},{key:"_terminateWorker",value:function(e){this._offWorkerBind(e),e.postMessage({msg:"destroy"}),e.terminate(),L.log(this.TAG,"destroy decoder worker")}}]),r}(Pt),Jt=function(e){h(r,e);var t=v(r);function r(){var e;u(this,r);for(var i=arguments.length,n=new Array(i),a=0;a<i;a++)n[a]=arguments[a];return c(p(e=t.call.apply(t,[this].concat(n))),"TAG","VideoRenderWithDecoder"),c(p(e),"_hideRenderFlag",0),c(p(e),"_recentMeta",null),c(p(e),"_inChaseFrame",!1),c(p(e),"_decoderErrorCallback",(function(t){e._emitTimelineEvents(ke,oe,e._assembleErr(t,1))})),c(p(e),"_decoderMessageCallback",(function(t){var r,i,n,a=t.type,s=t.data;switch(a){case"DECODER_READY":if(e.analyse.addWasmReady(),!e._frameRender){var o=Object.assign(e._config,{meta:e._meta,canvas:e._canvas,type:e._decodeController.webcodec?"2d":""});try{e._canvas.glInstance?(e._frameRender=e._canvas.glInstance,e._frameRender.updateBind(p(e),e._meta),L.warn(e.TAG,"reuse canvas and context")):(e._frameRender=new Tt(o,p(e)),L.log(e.TAG,"create frameRender with config",o))}catch(t){e._emitTimelineEvents(ke,oe,e._assembleErr(t&&t.message,2))}}e._startDecode();break;case"RECEIVE_FRAME":if(e._inChaseFrame&&(null===(r=e._decodeController)||void 0===r||!r.webcodec))return;e._receiveFrame(s);break;case"BATCH_FINISH":null===(i=p(e))||void 0===i||i._decodeEstimate.resetDecodeDot(),e._inChaseFrame&&(e._inChaseFrame=!1,e._frameQueue.empty()),e._ready||e.inSeeking||null===(n=e._decodeController)||void 0===n||!n.decoderReady||e._startDecode()}})),e}return l(r,[{key:"wasmInitCost",get:function(){var e;return null===(e=this._decodeController)||void 0===e?void 0:e.wasmInitCost}},{key:"hevcThread",get:function(){return 1===this.decodeMode}},{key:"lowlatency",get:function(){return this._parent.lowlatency}},{key:"nextFrameTime",get:function(){var e=this._frameQueue.nextFrame();return(e&&e.info&&e.info.dts||0)/1e3}},{key:"ajustSeekTime",value:function(e,t){var r;L.log(this.TAG,"ajust seek time: ",e),this._frameQueue.empty(),null===(r=this._decodeController)||void 0===r||r.flushDecoder(),this._switchVideoBuffer(e,t)}},{key:"canSeek",value:function(){return!0}},{key:"_appendChunk",value:function(e){var t;if(!this.noVideo&&this._timeRange){if(this._meta){if(this._recentMeta.width!==e.width||this._recentMeta.height!==e.height){L.warn(this.TAG,"metadata changed! width: ".concat(this._recentMeta.width," -> ").concat(e.width,", height: ").concat(this._recentMeta.height," -> ").concat(e.height));var r=e.samples[0];r&&(this._recentMeta=r.meta=Object.assign({},e,{samples:null}))}}else{this._emitTimelineEvents(ke,re),this._recentMeta=this._meta=Object.assign({},e,{samples:null}),L.warn(this.TAG,"video set metadata",this._meta,"configuration:",this.configuration);var i=e.fpsNum/e.fpsDen;i?L.log(this.TAG,"detect fps:",i):L.warn(this.TAG,"no detect fps,start estimate"),this._selectDecoder(),this._initDecoder()}var n;if(this._timeRange.append(e.samples,this._isLive,!this.videoDecode),e.samples=[],!this.inSeeking)this.isLive||this._timeRange.frameLength||this._switchVideoBuffer(this._parent.currentTime),!this._ready&&null!==(t=this._decodeController)&&void 0!==t&&t.decoderReady&&(!this.noAudio&&null!==(n=this._decodeController)&&void 0!==n&&n.inDecoding||this._startDecode()),this.noAudio&&this._emitTimelineEvents(ke,ne)}}},{key:"_selectDecoder",value:function(){if(!this.isHevc&&Gt.isSupported())return this._decodeController=new Gt(this),void(this._decodeEstimate.webcodec=!0);this._decodeController=new zt(this)}},{key:"_initDecoder",value:function(){var e;null===(e=this._decodeController)||void 0===e||e.init(this._decoderMessageCallback,this._decoderErrorCallback)}},{key:"_startDecode",value:function(){var e;null===(e=this._decodeController)||void 0===e||e.doDecode()}},{key:"_switchVideoBuffer",value:function(e,t){var r=this._timeRange.switchBuffer(e);if(r){var i;if(this.noAudio&&this._parent.emit(xe,this.getDtsOfTime(r.start)),t)return void(null===(i=this._decodeController)||void 0===i||i.preciseSeek(e));this._startDecode(t)}}},{key:"_checkToDecode",value:function(){var e;this.inSeeking||null===(e=this._decodeController)||void 0===e||e.checkToDecode(this._frameQueue.length)}},{key:"_render",value:function(e){var t;if(!this.noVideo){var r=this._frameQueue&&this._frameQueue.nextFrame();if(r){var i=r.info;if(!i)return this._frameQueue.shift(),void console.error("not info");this._renderDts=i.dts;var n=i.dts-this.preciseVideoDts;if(!(!e&&n>0&&n<6e4)){this._frameQueue.shift(this.preciseVideoDts),Math.abs(this._lastTimeupdate-i.dts)>250&&(this._emitTimelineEvents(ke,ie,{pts:i.originPts/90}),this._lastTimeupdate=i.dts),L.long&&L.log(this.TAG,"render delay:".concat(n," , timelinePosition:").concat(this.preciseVideoDts," , dts:").concat(i.dts," , cost:").concat(i.cost," , gopID:").concat(i.gopId," , rest:").concat(this._frameQueue.length,", buffer frame:").concat(this._timeRange.frameLength));var a=performance.now();this._hideRenderFlag++,("visible"===document.visibilityState||this._hideRenderFlag%15)&&this._frameRender.render(r.buffer,r.width,r.height,r.yLinesize,r.uvLinesize),null!==(t=this._decodeController)&&void 0!==t&&t.webcodec&&r.buffer.close(),this._renderCost=performance.now()-a,this._checkToDecode()}}else{var s;if(L.log(this.TAG,"lack frame, ","inDecoding:",null===(s=this._decodeController)||void 0===s?void 0:s.inDecoding),this._checkToDecode(),this.noAudio){var o;if(!this.isLive&&Math.abs(this.currentTime-this.duration)<.5)return null==this||this._emitTimelineEvents(ke,ie),null==this||this._emitTimelineEvents(ke,ue),void(null===(o=this._timeRange)||void 0===o||o.clean());this._timeRange.frameLength||(this._ready=!1,this.emit(ye))}}}}},{key:"_updateSegmentEnd",value:function(e){var t;null===(t=this._timeRange)||void 0===t||t.updateSegmentEnd(e)}},{key:"_doChaseFrame",value:function(e){var t=e.frame;this._inChaseFrame=!0,this._timeRange.deletePassed(t.dts),this._frameQueue.empty(),this.noAudio&&this._parent.emit(xe,t.dts)}},{key:"_destroy",value:function(e){var t;L.log(this.TAG,"destroy video render"),m(f(r.prototype),"destroy",this).call(this,e),null===(t=this._decodeController)||void 0===t||t.destroy(),this._decodeController=null}}]),r}(Rt),qt=.1,$t=function(e){h(r,e);var t=v(r);function r(e,i){var n;return u(this,r),(n=t.call(this)).TAG="TimeLine",n._parent=i,n._seeking=!1,n.audioRender=gt.isSupported()?new gt(e,p(n)):new ct(e,p(n)),n.videoRender=new Jt(e,p(n)),n._readyStatus={audio:!1,video:!1},n._paused=!0,n._switchToMultiWorker=!1,n._lowdecodeEmited=!1,n._startPlayed=!1,n._emitReady=!1,n._lastSeekTime=1e-4,n._singleTrack=-1,n._bindEvent(),n._decodeVideo=e.video,n}return l(r,[{key:"analyse",get:function(){return this._parent.analyse}},{key:"ready",get:function(){return this._readyStatus.video&&this._readyStatus.audio}},{key:"played",get:function(){var e=this;return{length:this.currentTime?1:0,start:function(){return 0},end:function(){return e.currentTime}}}},{key:"noAudio",get:function(){return 1===this._singleTrack||2===this._singleTrack}},{key:"isLive",get:function(){return this._parent.live}},{key:"seeking",get:function(){return this._seeking}},{key:"decodeFps",get:function(){return this.videoRender.decodeFps}},{key:"decodeCost",get:function(){return this.videoRender.decodeCost}},{key:"renderCost",get:function(){return this.videoRender.renderCost}},{key:"wasmInitCost",get:function(){return this.videoRender.wasmInitCost}},{key:"fps",get:function(){return this.videoRender.fps}},{key:"totalSize",get:function(){return this.videoRender.totalSize}},{key:"bitrate",get:function(){return this.videoRender.bitrate}},{key:"gopLength",get:function(){return this.videoRender.gopLength}},{key:"currentTime",get:function(){return this.noAudio?this.paused?this.videoRender.nextFrameTime:this.videoRender.currentTime:this.audioRender.currentTime}},{key:"timelinePosition",get:function(){return this.noAudio?performance.now()/1e3:this.audioRender.currentTime}},{key:"canvas",get:function(){return this.videoRender.canvas}},{key:"readyState",get:function(){return this.videoRender.readyState}},{key:"buffered",get:function(){var e=this;return this.noAudio||this.isLive?this.videoRender.buffered:{length:this.audioRender.buffered.length,start:function(t){return Math.max(e.audioRender.buffered.start(t),e.videoRender.buffered.start(t))},end:function(t){return Math.min(e.audioRender.buffered.end(t),e.videoRender.buffered.end(t))}}}},{key:"duration",get:function(){return this.noAudio?this.videoRender.duration:this.isLive?this.audioRender.duration:Math.min(this.audioRender.duration,this.videoRender.duration)}},{key:"paused",get:function(){return this._paused},set:function(e){this._paused=e}},{key:"lowlatency",get:function(){return this._parent.lowlatency}},{key:"decoderMode",get:function(){return this.videoRender.decoderMode}},{key:"currentAudioCanAutoplay",get:function(){return this.audioRender.audioCanAutoplay}},{key:"_getController",value:function(e,t){return e?new xt(t,this):new Jt(t,this)}},{key:"_checkInBuffer",value:function(){for(var e=this.buffered,t=0,r=e.length;t<r;t++)if(e.start(t)<=this.currentTime+qt&&e.end(t)>=this.currentTime)return!0;return!1}},{key:"_resetReadyStatus",value:function(){this._readyStatus.audio=!1,this._readyStatus.video=!1}},{key:"_bindEvent",value:function(){var e=this;this.on(Ye,(function(t){e.videoRender.setRemux(t)})),this.on($e,(function(t){e.emit(et,t)})),this.audioRender.on(Ae,(function(){L.log(e.TAG,"audio ready! seeking=",e._seeking),e._seeking&&setTimeout((function(){try{var t=e.videoRender.getSeekStartPosition(e.currentTime,1/0);if(e.audioRender.isMse&&t)return F().preciseSeek>e.duration&&e.currentTime>qt?(e.audioRender.seekNoSideEffect({position:e.currentTime+qt}),void e.videoRender.ajustSeekTime(e.currentTime,!0)):(e.audioRender.seekNoSideEffect({position:t.position+qt}),void e.videoRender.ajustSeekTime(t.position));e.videoRender.ajustSeekTime(e.currentTime)}catch(e){}}),10),e._readyStatus.video&&e._startRender(),e._readyStatus.audio=!0,e._startPlayed||e.analyse.addAudioReady()})),this.audioRender.on(pe,(function(){e._emitReady&&e.pause()})),this.audioRender.on(ve,(function(){!e.noAudio&&e.currentTime&&(L.warn(e.TAG,"lack data, audio waiting,currentTime:",e.currentTime),e.emit(ke,ie),e.emit(ke,K),e.emit(Ce),e._readyStatus.audio=!1)})),this.videoRender.on(ye,(function(){L.warn(e.TAG,"lack data, video waiting"),e.emit(ke,K),e.emit(Ce),e._readyStatus.video=!1})),this.videoRender.on(ge,(function(){L.log(e.TAG,"video ready!"),e._startPlayed||e.analyse.addVideoReady(),e._readyStatus.audio&&e._startRender("video"),e._readyStatus.video=!0})),this.videoRender.on(_e,(function(){e.currentTime<2||(e.analyse.increaseLowDecodeCount(),e._lowdecodeEmited||(Z++,e._lowdecodeEmited=!0,e.emit(ke,le)))})),this.on(Oe,(function(t){e._singleTrack=t,1!==t&&2!==t||(e._readyStatus.audio=!0),3===t&&(e._readyStatus.video=!0),e.emit(xe,0)})),this.on(Me,(function(){e.removeAllListeners(),e.videoRender=null,e.audioRender=null})),this.on(Le,(function(){e.emit(Re),e._paused=!1,e._lastSeekTime=1e-4,e.noAudio&&e.emit(xe,0)}))}},{key:"_startRender",value:function(e){if(!this._parent.error&&this.videoRender){if(this.noAudio&&this.emit(xe,0),this.videoRender.forceRender(),!this.isLive&&this._paused&&this.seeking&&this._checkInBuffer())return L.log(this.TAG,"set seeking = false"),this._seeking=!1,this.emit(ke,ee),void L.groupEnd();this._startPlayed||(this.analyse.addFirstframe(),this.emit(ke,te),this.emit(ke,he),this._startPlayed=!0),L.log(this.TAG,"emit canplay"),this.emit(ke,z),this._parent.autoplay?(L.warn(this.TAG,"startRender: time=",this.currentTime,"paused:",this.paused,"seeking:",this.seeking),this.emit(Re,e)):(this._parent.autoplay=!0,this.emit(ke,q)),this.emit(Be),this._emitReady=!0,this._seeking&&this._checkInBuffer()&&(L.log(this.TAG,"set seeking = false"),this._seeking=!1,this.emit(ke,ee),L.groupEnd())}}},{key:"_checkHlsTracks",value:function(e){if(!(null==e?void 0:e.samples[0])){if(!this.buffered.length){var t=new Error("lack video sample");t.code=3,this.emit(ke,oe,t)}return!1}return!0}},{key:"appendBuffer",value:function(e,t){this.emit(De,e,t),this.noAudio&&this._seeking&&this.videoRender.ajustSeekTime(this.currentTime)}},{key:"play",value:function(){var e=this;return new Promise((function(t,r){var i=e.currentAudioCanAutoplay;e.noAudio?i=!0:e.audioRender&&e.audioRender.resume().then((function(){if(L.log(e.TAG,"audio render resumed, pause status: ".concat(e._paused,", audioCanAutoplay:").concat(e.currentAudioCanAutoplay)),e._paused||!e.currentAudioCanAutoplay)return i=!1,void e.emit(Ce);i=!0})).catch((function(){})),setTimeout((function(){return L.log(e.TAG,"play() timer done, resumed=".concat(i,", paused=").concat(e.paused)),i?e.videoRender&&!e.videoRender.canAutoPlay?(console.warn("video render an't autoplay"),e.pause(),void t()):(e._paused=!1,void t()):e.paused?void 0:(L.log(e.TAG,"audioCtx can't autoplay"),e.pause(),void r({name:"NotAllowedError"}))}),e.audioRender.isMse?10:60)}))}},{key:"pause",value:function(){this._paused||!this.ready&&!this._seeking||(this.emit(Ce),this._paused=!0,this.emit(ke,q))}},{key:"seek",value:function(e){var t=this;if(this._seeking&&L.groupEnd(),this.isLive){if(this.currentTime<qt||!this.currentAudioCanAutoplay||this.paused)return;var r=this.videoRender.getSeekStartPosition(e,this._parent.preloadTime+1);if(r){if(r.position<this.currentTime)return;var i=this.audioRender.canSeek(r.position),n=this.videoRender.canSeek(r);if(!i||!n)return void L.log(this.TAG,"seek, !!!!!!!!!can not seek, audioCanSeek:",i,"videoCanSeek:",n);L.warn(this.TAG,"seek, chase frame to time: ",r.position,"currentTime:",this.currentTime,"duration:",this.duration),this.videoRender.videoDecode?(this.audioRender.doPause(),r.position=r.position-1.5,this.emit(qe,r)):this.emit(Ze,r)}}else this._lastSeekTime!==e&&(e&&Math.abs(this._lastSeekTime-e)<=.2||(this._lastSeekTime=e,e>=this.duration&&(e=this.duration-1),e<0&&(e=0),L.group(this.TAG,"start seek to:".concat(e,", set seeking status=true")),this._seeking=!0,this.videoRender.setSeekingStatus(!0),this.noAudio?(this.emit(xe,this.videoRender.getDtsOfTime(e)),this.videoRender.ajustSeekTime(e)):this._resetReadyStatus(),this.emit(we,e),new Promise((function(e){t.emit(ke,$),e()}))))}}]),r}(Q()),er={FIRST_DATA:1,AUDIO_MSE_OPEN_START:2,AUDIO_MSE_OPEND:3,AUDIO_FIRSTTIME_APPENDED:4,AUDIO_READY:5,WASM_WORKER_INIT:6,WASM_WORKER_READY:7,FIRST_FRAME_TODECODE:8,VIDEO_READY:9,FIRST_FRAME:10,WAITIGN:11,SEEKING:12,SEEKED:13},tr=Object.entries(er),rr=function(){function e(){u(this,e),c(this,"_dot",[]),c(this,"_currentLowDecodeCount",0)}return l(e,[{key:"getBootStats",value:function(){var e,t=(null===(e=this._dot[0])||void 0===e?void 0:e.dot)||0;return this._dot.map((function(e){return{action:tr.filter((function(t){return t[1]===e.action}))[0][1],dot:parseInt(e.dot-t)}}))}},{key:"getStats",value:function(e){var t,r=this.getBootStats();return{bootStats:r,bitrate:Math.abs(e.bitrate/1e3),decodeFps:e.decodeFps,fps:e.fps,playbackRate:e.playbackRate,firstframe:null===(t=r.filter((function(e){return 10===e.action}))[0])||void 0===t?void 0:t.dot,width:e.videoWidth,height:e.videoHeight,decoderMode:e.decoderMode,vv:U,lowdecodeVV:Z,h265FailureRate:Number((100*W).toFixed(2)),currentLowDecodeCount:this._currentLowDecodeCount}}},{key:"seekElapses",value:function(){for(var e=this.getBootStats(),t=[],r=0,i=0,n=e.length;i<n;i++){var a=e[i];a.action===er.SEEKING&&(r=a.dot),a.action===er.SEEKED&&t.push(a.dot-r)}return t}},{key:"addFirstData",value:function(){this._dot.push({action:er.FIRST_DATA,dot:this._getTimestap()})}},{key:"addAudioBoundMedia",value:function(){this._dot.push({action:er.AUDIO_BOUND_MEDIA,dot:this._getTimestap()})}},{key:"addAudioMseOpenStart",value:function(){this._dot.push({action:er.AUDIO_MSE_OPEN_START,dot:this._getTimestap()})}},{key:"addAudioMseOpend",value:function(){this._dot.push({action:er.AUDIO_MSE_OPEND,dot:this._getTimestap()})}},{key:"addAudioFirstTimeAppended",value:function(){this._dot.push({action:er.AUDIO_FIRSTTIME_APPENDED,dot:this._getTimestap()})}},{key:"addAudioReady",value:function(){this._dot.push({action:er.AUDIO_READY,dot:this._getTimestap()})}},{key:"addWasmInit",value:function(){this._dot.push({action:er.WASM_WORKER_INIT,dot:this._getTimestap()})}},{key:"addWasmReady",value:function(){this._dot.push({action:er.WASM_WORKER_READY,dot:this._getTimestap()})}},{key:"addFirstFrameToDecode",value:function(){this._dot.push({action:er.FIRST_FRAME_TODECODE,dot:this._getTimestap()})}},{key:"addVideoReady",value:function(){this._dot.push({action:er.VIDEO_READY,dot:this._getTimestap()})}},{key:"addFirstframe",value:function(){this._dot.push({action:er.FIRST_FRAME,dot:this._getTimestap()})}},{key:"addWaiting",value:function(){this._dot.push({action:er.WAITIGN,dot:this._getTimestap()})}},{key:"addSeeking",value:function(){this._dot.push({action:er.SEEKING,dot:this._getTimestap()})}},{key:"addSeeked",value:function(){this._dot.push({action:er.SEEKED,dot:this._getTimestap()})}},{key:"_getTimestap",value:function(){return performance.now()}},{key:"increaseLowDecodeCount",value:function(){this._currentLowDecodeCount++}},{key:"reset",value:function(){this._currentLowDecodeCount=0,this._dot=[]}}]),e}(),ir=function(){h(t,"undefined"!=typeof HTMLElement?HTMLElement:function(){});var e=v(t);function t(){var r,i,n,a,s;return u(this,t),(r=e.call(this)).TAG="XGVideo",r._proxyProps(),r._isLive=!0,r._vMeta=null,r._aMeta=null,r._resizeObserver=null,r._eventsBackup=[],r._hevc="h265"===F().preloadDecoder,r._hevc||(r._degradeVideo=document.createElement("video")),r._debounceSeek=(i=r._seek.bind(p(r)),n=Date.now(),a=null,s=!0,function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var o=Date.now();s&&(n=Date.now(),s=!1,i.apply(void 0,t)),o-n>300?(n=o,i.apply(void 0,t)):(a&&window.clearTimeout(a),a=setTimeout((function(){i.apply(void 0,t)}),300))}),r._onTouchEnd=r._onTouchEnd.bind(p(r)),r.analyse=new rr,r}return l(t,[{key:"_proxyProps",value:function(){var e=this;Object.getOwnPropertyNames(t.prototype).forEach((function(t){if(/^__/.test(t)){var r=t.replace("__","");Object.defineProperty(e,r,{get:function(){try{return this[t]}catch(e){}return 0},set:function(e){try{this[t]=e}catch(e){}}})}}))}},{key:"addEventListener",value:function(e,r,i){m(f(t.prototype),"addEventListener",this).call(this,e,r,i),this._degradeVideo&&this._eventsBackup.push([e,r,i])}},{key:"removeEventListener",value:function(e,r,i){m(f(t.prototype),"removeEventListener",this).call(this,e,r,i),this._degradeVideo&&(this._eventsBackup=this._eventsBackup.filter((function(t){return!(t.eventName===e&&t.handler===r&&t.capture===i)})))}},{key:"setAttribute",value:function(e,r){var i;m(f(t.prototype),"setAttribute",this).call(this,e,r),"src"!==e&&(null===(i=this._degradeVideo)||void 0===i||i.setAttribute(e,r))}},{key:"_init",value:function(){this.analyse.reset(),this.timeline=new $t({volume:this.volume,canvas:this.querySelector("canvas"),videoContext:this.videoContext,videoDecode:this.videoDecode,maxVideoHeight:this.getAttribute("maxVideoHeight"),endLevel:parseInt(this.getAttribute("endLevel"))},this),L.log(this.TAG,"timeline init"),this._noSleep=new S,this._logFirstFrame=!1,this._playRequest=null,this._degradeVideoUserGestured=!1,this._bindEvents(),this._vMeta&&!this.videoDecode&&this.setVideoMeta(this._vMeta),this._glCtxOptions&&(this.glCtxOptions=this._glCtxOptions),this.timeline&&(this.innerDegrade&&this.timeline.emit(Ue),this.timeline.emit(Ve,this._isLive?"LIVE":"VOD"),this.timeline.emit(Ie,this.playbackRate),this.muted=this.muted)}},{key:"_bindEvents",value:function(){var e=this;this.timeline.on(ke,(function(t,r){var i;if(t===te&&(e.querySelector("canvas")||(L.log(e.TAG,"_bindEvents, appendChild canvas"),e.appendChild(e.canvas)),e.canvas.style.display="block",null===(i=e.timeline)||void 0===i||i.emit(Ie,e.playbackRate)),t!==re&&t!==de||Promise.resolve().then((function(){e.updateVideoPostion()})),t===oe){if(L.warn(e.TAG,"detect error:",null==r?void 0:r.message),e.pause(),e._disabled(!0),e.innerDegrade||5===e.decoderMode)return e.degradeInfo={decodeFps:e.decodeFps,bitrate:e.bitrate,wasmInitCost:e.wasmInitCost,fps:e.fps,url:e.src,msg:null==r?void 0:r.message,decoderMode:e.decoderMode},void e._innerDispatchEvent("lowdecode");e._err=r}if(t===le)return e._disabled(),e.degradeInfo={decodeFps:e.decodeFps,bitrate:e.bitrate,wasmInitCost:e.wasmInitCost,fps:e.fps,url:e.src,decoderMode:e.decoderMode},void e._innerDispatchEvent(fe[t],e.degradeInfo);if(t===ce&&(e.unsyncInfo=r),t===ue){if(e.paused)return;e.pause()}t===se&&e._noSleep.toPlay(),t===K&&e.analyse.addWaiting(),t===$&&e.analyse.addSeeking(),t===ee&&e.analyse.addSeeked(),e._innerDispatchEvent(fe[t],r)}))}},{key:"_disabled",value:function(e){(this.innerDegrade||e)&&(e?F().disabledWhenErrorOccur&&X(1):F().evaluateVVCount||(this.decodeFps/this.fps<=.6&&this.bitrate<2e6?X(1):X(2)))}},{key:"degrade",value:function(e){var r=this;this.querySelector("canvas")?this.replaceChild(this._degradeVideo,this.canvas):this.appendChild(this._degradeVideo),this._eventsBackup.forEach((function(e){var i,n,a,s=(a=3,function(e){if(Array.isArray(e))return e}(n=e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var i,n,a,s,o=[],u=!0,d=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(i=a.call(r)).done)&&(o.push(i.value),o.length!==t);u=!0);}catch(e){d=!0,n=e}finally{try{if(!u&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(d)throw n}}return o}}(n,a)||y(n,a)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),o=s[0],u=s[1],d=s[2];m(f(t.prototype),"removeEventListener",r).call(r,o,u,d),null===(i=r._degradeVideo)||void 0===i||i.addEventListener(o,u,d)})),this._eventsBackup=[],this.destroy(),e&&(this._degradeVideo.muted=!1,this._degradeVideo.src=e,this._degradeVideo.load())}},{key:"disconnectedCallback",value:function(){L.log(this.TAG,"video disconnected"),document.removeEventListener("touchend",this._onTouchEnd,!0),this.destroy(!0),this._resizeObserver&&this._resizeObserver.disconnect(this)}},{key:"connectedCallback",value:function(){var e=this;L.log(this.TAG,"video connected to document",performance.now()),this.timeline||this._init(),this.style.width="100%",this.style.height="100%",this.style.position="absolute",this.style.left="0px",this.style.top="0px",document.addEventListener("touchend",this._onTouchEnd,!0),ResizeObserver&&(this._resizeObserver=new ResizeObserver((function(t){var r;null!==(r=e.timeline)&&void 0!==r&&r.ready&&e.updateVideoPostion()})),this._resizeObserver.observe(this))}},{key:"_onTouchEnd",value:function(){R(),this._degradeVideoInteract(),this._noSleep&&this._noSleep.enable()}},{key:"_degradeVideoInteract",value:function(){var e=this;if(this._degradeVideo&&(1===this.innerDegrade||3===this.innerDegrade)){if(this._degradeVideoUserGestured)return;var t=this._degradeVideo.play();t&&t.then((function(){e._degradeVideo.pause(),e._degradeVideoUserGestured=!0})).catch((function(e){console.log("degrade video: ",e.message)}))}}},{key:"play",value:function(e){var t=this;if(this.timeline){L.log(this.TAG,"play() called, ready:".concat(this.timeline.ready,", paused:").concat(this.timeline.paused,", force:").concat(e)),this._degradeVideoInteract();var r=0;if(this.timeline.ready&&this.timeline.paused||e){if(e=e||this._isLive,this._playRequest=null,!e)return this.timeline.emit(Le),this._innerDispatchEvent("play"),Promise.resolve();this.destroy(),this._init(),r=setTimeout((function(){try{t._innerDispatchEvent("waiting")}catch(e){}}),300)}return this._playRequest||!this.timeline.ready||this.timeline.paused?(L.log(this.TAG,"request play!"),this._playRequest=this._playRequest||new Promise((function(e,i){t.timeline._paused=!1,t._innerDispatchEvent("play"),t._noSleep.enable(),t.timeline.once("ready",(function(){L.log(t.TAG,"timeline emit ready"),clearTimeout(r),t.timeline.play().then(e).catch(i).finally((function(){t._playRequest=null}))}))})),this.autoplay=!0,this._playRequest):Promise.resolve()}}},{key:"pause",value:function(){this._playRequest=null,this.timeline&&this.timeline.pause();try{this._noSleep.disable(),(e=E||(E=document.querySelector("#hackAudioPP")))&&e.pause()}catch(e){}var e}},{key:"load",value:function(){}},{key:"appendBuffer",value:function(e,t){if(this.timeline&&!this._err){if(this._adaptTracks(e,t),!this._logFirstFrame){var r=e&&e.samples[0],i=t&&t.samples[0];if(!r&&!i)return;if(r||i){var n=(null==e?void 0:e.duration)/((null==e?void 0:e.formatTimescale)||1/0),a=(null==t?void 0:t.duration)/((null==t?void 0:t.formatTimescale)||1/0);L.warn(this.TAG,"video firstDts:".concat(r&&r.dts," , audio firstDts:").concat(i&&i.dts," videoTrack.duration=").concat(n,", audioTrack.duration=").concat(a)),this._logFirstFrame=!0,(n||a)&&(this.setPlayMode("VOD"),this.timeline.emit(Ve,this._isLive?"LIVE":"VOD"),this.duration=Math.min(n||a,a||n)),this.analyse.addFirstData()}this.lowlatency&&(L.warn(this.TAG,"single track! type=",1),this.timeline.emit(Oe,1)),t.exist()||(L.warn(this.TAG,"single track! type=",2),this.timeline.emit(Oe,2)),e.exist()||(L.warn(this.TAG,"single track! type=",3),this.timeline.emit(Oe,3))}e.formatTimescale&&e.samples.forEach((function(t){t.dts=Math.floor(t.dts/e.formatTimescale*1e3),t.pts=Math.floor(t.pts/e.formatTimescale*1e3)})),t.formatTimescale&&t.samples.forEach((function(e){e.dts=Math.floor(e.dts/t.formatTimescale*1e3),e.pts=Math.floor(e.pts/t.formatTimescale*1e3)})),this.timeline.appendBuffer(e,t)}}},{key:"_adaptTracks",value:function(e,t){var r,i;Object.keys(e.meta).forEach((function(t){e[t]=e.meta[t]})),e.vps=[e.meta.vps],e.sps=[e.meta.sps],e.pps=[e.meta.pps],e.width=e.codecWidth,e.height=e.codecHeight,e.exist||(e.exist=function(){return!0}),e.baseDts||(e.baseDts=null===(r=e.samples[0])||void 0===r?void 0:r.dts),t.baseDts||(t.baseDts=null===(i=t.samples[0])||void 0===i?void 0:i.dts),e.samples.forEach((function(t){t.keyframe=!!t.isKeyframe,t.dts-=e.baseDts,t.pts=t.dts+t.cts,t.units=t.nals.map((function(e){return e.body})),t.nals=null})),Object.keys(t.meta).forEach((function(e){t[e]=t.meta[e]})),t.samples.forEach((function(e){e.size=e.data.length,e.dts-=t.baseDts})),t.exist||(t.exist=function(){return!0})}},{key:"setAudioMeta",value:function(e){this._aMeta=e,this.timeline.emit(Se,"audio",e)}},{key:"setVideoMeta",value:function(e){!this._isLive&&this._vMeta||(this.timeline.emit(Se,"video",e),this._vMeta=e)}},{key:"setDecodeMode",value:function(e){this.setAttribute("decodeMode",e)}},{key:"setPlayMode",value:function(e){this._isLive="LIVE"===e}},{key:"endOfStream",value:function(){var e;this.currentTime&&(null===(e=this.timeline)||void 0===e||e.emit(We))}},{key:"updateVideoPostion",value:function(){var e;null===(e=this.timeline)||void 0===e||e.emit(Ee,this.xgfillType,this.containerLayout)}},{key:"_innerDispatchEvent",value:function(e,t){this.dispatchEvent(new CustomEvent(e,{detail:t}))}},{key:"destroy",value:function(e){this.timeline&&(this._noSleep.destroy(),L.log(this.TAG,"call destroy"),this.timeline.emit(Me,e),this.querySelector("video")&&this.removeChild(this.querySelector("video")),this.timeline=null,this._err=null,this._noSleep=null,this._eventsBackup=[])}},{key:"updateObjectPosition",value:function(e,t){this.timeline.emit(Te,this.containerLayout,e,t),this._degradeVideo&&(this._degradeVideo.style.objectPosition="".concat(100*e,"% ").concat(100*t,"%"))}},{key:"setVideoDecode",value:function(){L.log(this.TAG,"set videoDecode",this.videoDecode),this.videoDecode&&this.timeline&&this.timeline.videoRender&&(this.timeline.videoRender.videoDecode=this.videoDecode)}},{key:"live",get:function(){return this._isLive}},{key:"lowlatency",get:function(){return"true"===this.getAttribute("lowlatency")},set:function(e){this.setAttribute("lowlatency",e)}},{key:"autoplay",get:function(){return"true"===this.getAttribute("autoplay")},set:function(e){this.setAttribute("autoplay",e)}},{key:"__canvas",get:function(){return this.timeline.canvas}},{key:"__ended",get:function(){return Math.abs(this.currentTime-this.duration)<.5}},{key:"__width",get:function(){return this.getAttribute("width")||this.videoWidth},set:function(e){var t="number"==typeof e?"".concat(e,"px"):e;this.setAttribute("width",t),this.canvas.width=e}},{key:"__height",get:function(){return this.getAttribute("height")},set:function(e){var t="number"==typeof e?"".concat(e,"px"):e;this.setAttribute("height",t),this.canvas.height=e}},{key:"__videoWidth",get:function(){return this.canvas.width}},{key:"__videoHeight",get:function(){return this.canvas.height}},{key:"__volume",get:function(){return Number(this.getAttribute("volume"))},set:function(e){e<=0&&(e=0),e>=1&&(e=1),this.setAttribute("volume",e),this.muted||this.timeline.emit(Fe,e)}},{key:"__muted",get:function(){return"true"===this.getAttribute("muted")},set:function(e){this.setAttribute("muted",e),this._degradeVideoInteract(),this._noSleep.enable(),this.timeline.emit(Fe,e?0:this.volume)}},{key:"__currentTime",get:function(){if(!this.timeline)return 0;var e=this.timeline.currentTime,t=this.timeline.duration;return Math.min(e,t)},set:function(e){this._debounceSeek(e)}},{key:"_seek",value:function(e){this.timeline&&(this.buffered.length||this.play(),this.paused&&!this._isLive&&0===e&&this.play(),this.timeline.seek(Number(e)))}},{key:"__duration",get:function(){return this._isLive?1/0:this.timeline.duration},set:function(e){this.timeline.emit(Ne,e),this._innerDispatchEvent("durationchange")}},{key:"__seeking",get:function(){return this.timeline.seeking}},{key:"__paused",get:function(){return this.timeline.paused}},{key:"__fps",get:function(){return this.timeline.fps}},{key:"__decodeFps",get:function(){return this.timeline.decodeFps}},{key:"__decodeCost",get:function(){return parseInt(this.timeline.decodeCost)}},{key:"__renderCost",get:function(){return this.timeline.renderCost}},{key:"__wasmInitCost",get:function(){return this.timeline.wasmInitCost}},{key:"__totalSize",get:function(){return this.timeline.totalSize}},{key:"__bitrate",get:function(){return this.timeline.bitrate}},{key:"__gopLength",get:function(){return this.timeline.gopLength}},{key:"__readyState",get:function(){return this.timeline.readyState}},{key:"__buffered",get:function(){return this.timeline.buffered}},{key:"__decoderMode",get:function(){return this.timeline.decoderMode}},{key:"src",get:function(){return this.getAttribute("src")||""},set:function(e){L.log(this.TAG,"set src ",e),this.setAttribute("src",e),this._vMeta=null,this.play(!0),this.timeline||this._init(),this._innerDispatchEvent("loadstart"),U++}},{key:"currentSrc",get:function(){return this.getAttribute("src")||""}},{key:"playbackRate",get:function(){return parseFloat(this.getAttribute("playbackrate")||1)},set:function(e){var t;this.setAttribute("playbackrate",e),null===(t=this.timeline)||void 0===t||t.emit(Ie,e)}},{key:"networkState",get:function(){return 1}},{key:"preloadTime",get:function(){var e=this.getAttribute("preloadtime");if(e){var t=Number.parseFloat(e);if(t>0&&!Number.isNaN(t))return t}return 1/0},set:function(e){e&&Number(e)>0&&this.setAttribute("preloadtime",e)}},{key:"innerDegrade",get:function(){var e=this.getAttribute("innerdegrade");return parseInt(e)}},{key:"__glCtxOptions",set:function(e){this._glCtxOptions=e,this.timeline.emit(Ge,e)}},{key:"__error",get:function(){return this._err},set:function(e){this.timeline.emit(ke,oe,e)}},{key:"degradeVideo",get:function(){return this._degradeVideo}},{key:"degradeInfo",get:function(){return this._deradeInfo},set:function(e){this._deradeInfo=e}},{key:"unsyncInfo",get:function(){return this._unsyncInfo},set:function(e){this._unsyncInfo=e}},{key:"xgfillType",get:function(){return this.parentNode.getAttribute("data-xgfill")}},{key:"containerLayout",get:function(){var e=this.parentNode;return{width:e.clientWidth,height:e.clientHeight}}},{key:"videoDecode",get:function(){return"7"===this.getAttribute("decodeMode")}},{key:"audioMedia",get:function(){var e,t;return null===(e=this.timeline)||void 0===e||null===(t=e.audioRender)||void 0===t?void 0:t.media}},{key:"getStats",value:function(){return this.analyse.getStats(this)}},{key:"getSeekElapses",value:function(){return this.analyse.seekElapses()}},{key:"dump",value:function(){var e=this.buffered;return console.log(e),new Array(e.length).fill(0).map((function(t,r){return[e.start(r),e.end(r)]}))}}],[{key:"version",get:function(){return"0.2.0-alpha.1"}},{key:"init",value:function(e){var r=e.h264Url,i=e.h264AsmUrl,n=e.h265AsmUrl,a=e.h265Url,s=e.h265ThreadUrl,o=e.h265SimdUrl;t.h264Url=r,t.h265Url=a,t.h265AsmUrl=n,t.h264AsmUrl=i,t.h265ThreadUrl=s,t.h265SimdUrl=o}},{key:"getDecodeCapacity",value:function(){return F()}},{key:"getDeviceCapacity",value:function(){return{simd:I,thread:B(),nbCpu:navigator.hardwareConcurrency}}},{key:"setDecodeCapacity",value:function(e){var t;t=e,x=Object.assign({},x,t),e.preloadDecoder&&Qt.genDecoder().catch((function(){}))}},{key:"genDecoder",value:function(e){return Qt.genDecoder(e)}},{key:"cleanDisabled",value:function(){Y()}},{key:"isSupported",value:function(){return!!function(){if("undefined"==typeof customElements)return!1;if(G)return!0;var e=!1,t=!1;try{var r=new(window.AudioContext||window.webkitAudioContext);r.close(),r=null,e=!0}catch(e){}try{for(var i=document.createElement("canvas"),n=["webgl","experimental-webgl","moz-webgl","webkit-3d"],a=0;a<n.length;a++){var s=i.getContext(n[a]);if(s){s=null,i=null,t=!0;break}}G=e&&t&&!!WebAssembly,localStorage.setItem("_sds",G?1:0)}catch(e){}return G}()&&!1===function(){if(!0===(!!j||0!==F().evaluateVVCount&&(U===F().evaluateVVCount&&(W=Z/U),W>=F().disabledByLowdecodePrecent&&(j=!0),j)))return!0;var e=localStorage.getItem("xgv_dis");if(!e)return!1;if("1"===e)return!0;if("2"===e){var t=localStorage.getItem("xgv_dist")||0;if(t=Number(t),((new Date).getTime()-t)/1e3<F().disabledDuration)return!0;Y()}}()}}]),t}();c(ir,"decoderCache",Qt),ir.init({h264Url:"",h264AsmUrl:"",h265Url:"",h265SimdUrl:"",h265ThreadUrl:"",h265AsmUrl:""}),ir.setEleName=function(e){!function(e){w=e}(e);var t=function(e){h(r,e);var t=v(r);function r(){return u(this,r),t.apply(this,arguments)}return l(r)}(ir);customElements.get(P())||customElements.define(P(),t)};try{customElements.get(P())||customElements.define(P(),ir)}catch(e){}}}]);